(function(){function cc(h,q){return new Promise(function(S,b){function f(b){"https://assets.nflxext.com"==b.origin&&b.source==a.contentWindow&&"ready"==b.data&&(window.clearTimeout(M),window.removeEventListener("message",f),window.addEventListener("message",C),S(a))}var a=document.createElement("iframe");a.setAttribute("src",h);a.setAttribute("style","display:none");a.height=1;a.width=1;var M=window.setTimeout(function(){window.removeEventListener("message",f);document.body.removeChild(a);b(Error("timeout waiting for iframe to load"))},
q);window.addEventListener("message",f);document.body.appendChild(a)})}function K(h,q){return M.then(function(M){return new Promise(function(b,f){var a={cmd:h,msgId:++S,arguments:q};z.push({msgId:a.msgId,handler:function(a){a=a.data;a.success?b(a.result):f(Error("crypto-iframe error: "+a.result))}});M.contentWindow.postMessage(a,"https://assets.nflxext.com")})})}function C(h){for(var q,S=z.length;S--&&z[S].msgId!==h.data.msgId;);(q=0>S)||(q=h.data,q=!("https://assets.nflxext.com"===h.origin&&q&&q.hasOwnProperty("success")&&
q.hasOwnProperty("result")&&q.hasOwnProperty("msgId")));q||(q=z[S].handler,z.splice(S,1),q(h))}var h=navigator.userAgent.match(/Chrome\/([0-9]*)/);if(h&&37<=parseInt(h[1])){var S=0,z=[],M=(new Promise(function(h){function q(){document.removeEventListener("DOMContentLoaded",q);h()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",q):h()})).then(function(){return cc("https://assets.nflxext.com/en_us/ffe/player/html/nfcrypto-iframe-inner-2202400.html",2E3)}).catch(function(){return cc("https://assets.nflxext.com/en_us/ffe/player/html/nfcrypto-iframe-inner-2202400.html",
8E3)}),q={subtle:{}};window.crypto.getRandomValues&&(q.getRandomValues=function(h){return window.crypto.getRandomValues(h)});"encrypt decrypt sign verify digest generateKey deriveKey deriveBits importKey exportKey wrapKey unwrapKey".split(" ").map(function(h){q.subtle[h]=function(){return K(h,Array.prototype.slice.call(arguments))}});window.nfCrypto=q}})();
(function(cc,K){var C;function h(a,b){if(!b||"utf-8"===b)return z(a);throw Error("unsupported encoding");}function S(a,b){if(!b||"utf-8"===b)return M(a);throw Error("unsupported encoding");}function z(a){for(var b=0,c,f=a.length,d="";b<f;){c=a[b++];if(c&128)if(192===(c&224))c=((c&31)<<6)+(a[b++]&63);else if(224===(c&240))c=((c&15)<<12)+((a[b++]&63)<<6)+(a[b++]&63);else throw Error("unsupported character");d+=String.fromCharCode(c)}return d}function M(a){var b=a.length,c;c=0;var f,d=0,g;for(f=b;f--;)g=
a.charCodeAt(f),128>g?c++:c=2048>g?c+2:c+3;c=new Uint8Array(c);for(f=0;f<b;f++)g=a.charCodeAt(f),128>g?c[d++]=g:(2048>g?c[d++]=192|g>>>6:(c[d++]=224|g>>>12,c[d++]=128|g>>>6&63),c[d++]=128|g&63);return c}function q(a,b){if(a===b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0}function ia(a){if(!(a&&a.constructor==Uint8Array||Array.isArray(a)))throw new TypeError("Cannot compute the hash code of "+a);for(var b=1,c=0;c<a.length;++c){var f=a[c];
if("number"!==typeof f)throw new TypeError("Cannot compute the hash code over non-numeric elements: "+f);b=31*b+f&4294967295}return b}function ra(a,b){if(a===b)return!0;if(!a||!b)return!1;b instanceof Array||(b=[b]);for(var c=0;c<b.length;++c){for(var f=b[c],d=!1,g=0;g<a.length;++g){var h=a[g];if(f.equals&&"function"===typeof f.equals&&f.equals(h)||f==h){d=!0;break}}if(!d)return!1}return!0}function pa(a,b){return ra(a,b)&&(a.length==b.length||ra(b,a))}function b(a,b,c){var f;c&&(f=c);if("object"!==
typeof a||"function"!==typeof a.result||"function"!==typeof a.error)throw new TypeError("callback must be an object with function properties 'result' and 'error'.");try{var g=b.call(f,a);g!==K&&a.result(g)}catch(d){try{a.error(d)}catch(h){}}}function f(a,c,f){if("object"!==typeof a||"function"!==typeof a.timeout)throw new TypeError("callback must be an object with function properties 'result', 'timeout', and 'error'.");b(a,c,f)}function a(a,b,c){1E5>a&&(a=1E5+a);Object.defineProperties(this,{internalCode:{value:a,
writable:!1,configurable:!1},responseCode:{value:b,writable:!1,configurable:!1},message:{value:c,writable:!1,configurable:!1}})}function Ja(a){switch(a){case Ra.PSK:case Ra.MGK:return!0;default:return!1}}function Wa(a){switch(a){case Ra.PSK:case Ra.MGK:case Ra.X509:case Ra.RSA:case Ra.NPTICKET:case Ra.ECC:return!0;default:return!1}}function g(a){return a.toJSON()}function c(b,c){Fd?c.result(Fd):Promise.resolve().then(function(){return qa.getKeyByName(b)}).catch(function(){return qa.generateKey({name:b},
!1,["wrapKey","unwrapKey"])}).then(function(a){Fd=a;c.result(Fd)}).catch(function(b){c.error(new F(a.INTERNAL_EXCEPTION,"Unable to get system key"))})}function n(a,b){var c=b.masterToken,f=b.userIdToken,g=b.serviceTokens;return{NccpMethod:a.nccpMethod,UserId:a.userId,UT:f&&f.serialNumber,MT:c&&c.serialNumber+":"+c.sequenceNumber,STCount:g&&g.length}}function Bb(a){return a.uniqueKey()}function Ec(c,f,g,n){function q(a,c,f){var g=[];(function w(){a.read(-1,c,{result:function(a){b(f,function(){if(a)g.push(a),
w();else switch(g.length){case 0:return new Uint8Array(0);case 1:return g[0];default:var k,l,u,r=g.length,D=0;for(l=k=0;l<r;l++)k+=g[l].length;k=new Uint8Array(k);for(l=0;l<r;l++)u=g[l],k.set(u,D),D+=u.length;return k}})},timeout:function(){f.timeout()},error:function(a){f.error(a)}})})()}function B(){n.getStoreState({result:function(a){if(a)for(var b=N.slice(),c=0;c<b.length;c++)b[c]({storeState:a})},timeout:function(){c.error("Timeout getting store state",""+e)},error:function(a){c.error("Error getting store state",
""+a)}})}var N=[];this.addEventHandler=function(a,b){switch(a){case "shouldpersist":N.push(b)}};this.send=function(Q,d){var Ta=Q.timeout,hb=new Ce(c,g,Q,n.getKeyRequestData()),x=Q.httpLocation,w=Q.serviceTokens;c.trace("Sending MSL request",{NccpMethod:Q.nccpMethod});f.request(g,hb,new Cf(x),Ta,{result:function(m){b(d,function(){var k=m&&m.getMessageHeader(),l=k&&k.serviceTokens||[];c.trace("Received MSL response",{NccpMethod:Q.nccpMethod},l.map(Bb).join("\n"));if(!m)throw new F(a.INTERNAL_EXCEPTION,
"Null response stream");Q.allowTokenRefresh&&B();if(k=m.getErrorHeader())d.error(k);else{var u={};l.forEach(function(a){u[a.name]=a});w&&w.forEach(function(a){u[a.name]||l.push(a)});l=l.filter(function(a){return qd[a.name]&&!a.isDeleted()});q(m,Ta,{result:function(a){b(d,function(){return{body:h(a),serviceTokens:l}})},timeout:function(){d.timeout()},error:function(a){d.error(a)}})}})},timeout:function(){d.timeout()},error:function(a){d.error(a)}})};this.hasUserIdToken=function(a){return!!n.getUserIdToken(a)};
this.removeUserIdToken=function(a){if(a=n.getUserIdToken(a))n.removeUserIdToken(a),B()};this.isErrorReauth=function(a){return a&&a.errorCode==d.USERDATA_REAUTH};this.isErrorHeader=function(a){return a instanceof bd};this.getErrorCode=function(a){return a&&a.errorCode};this.getStateForMdx=function(a){var b=n.getMasterToken();a=n.getUserIdToken(a);var c=n.getCryptoContext(b);return{masterToken:b,userIdToken:a,cryptoContext:c}};this.buildPlayDataRequest=function(a,b){var d=new Df;f.request(g,new Ce(c,
g,a),d,a.timeout,{result:function(){b.result(d.getRequest())},error:function(){b.result(d.getRequest())},timeout:function(){b.timeout()}})}}function kb(b,c,f,g,d,h){function n(c){var f;return Promise.resolve().then(function(){f=b.authenticationKeyNames[c];if(!f)throw new F(a.KEY_IMPORT_ERROR,"Invalid config keyName "+c);return qa.getKeyByName(f)}).then(function(b){return new Promise(function(c,x){Rb(b,{result:c,error:function(){x(new F(a.KEY_IMPORT_ERROR,"Unable to create "+f+" CipherKey"))}})})}).catch(function(b){throw new F(a.KEY_IMPORT_ERROR,
"Unable to import "+f,b);})}return Promise.resolve().then(function(){if(!qa.getKeyByName)throw new F(a.INTERNAL_EXCEPTION,"No WebCrypto cryptokeys");return Promise.all([n("e"),n("h"),n("w")])}).then(function(a){var dc={};dc[c]=new f(b.esn,a[0],a[1],a[2]);a=new g(b.esn);var Ta=new rd,Ta=[new d(Ta)],hb=new h(c);return{entityAuthFactories:dc,entityAuthData:a,keyExchangeFactories:Ta,keyRequestData:hb}})}function Vb(b,c,f){function g(){return Promise.resolve().then(function(){return qa.generateKey(c,!1,
["wrapKey","unwrapKey"])}).then(function(a){return d(a.publicKey,a.privateKey)})}function d(b,c){return Promise.all([new Promise(function(c,f){Wb(b,{result:c,error:function(b){f(new F(a.INTERNAL_EXCEPTION,"Unable to create keyx public key",b))}})}),new Promise(function(b,f){rb(c,{result:b,error:function(b){f(new F(a.INTERNAL_EXCEPTION,"Unable to create keyx private key",b))}})})]).then(function(a){a=new Gd("rsaKeypairId",f,a[0],a[1]);h&&(a.storeData={keyxPublicKey:b,keyxPrivateKey:c});return a})}
var h=!b.systemKeyWrapFormat;return Promise.resolve().then(function(){var a=b.storeState,c=a&&a.keyxPublicKey,a=a&&a.keyxPrivateKey;return h&&c&&a?d(c,a):g()}).then(function(a){var c={};c[Ra.NONE]=new Jg;var f=new Hd(b.esn),d=[new De];return{entityAuthFactories:c,entityAuthData:f,keyExchangeFactories:d,keyRequestData:a,createKeyRequestData:h?g:K}})}var Fb=cc.nfCrypto||cc.msCrypto||cc.webkitCrypto||cc.crypto,B=Fb&&(Fb.webkitSubtle||Fb.subtle),xb=cc.nfCryptokeys||cc.msCryptokeys||cc.webkitCryptokeys||
cc.cryptokeys;(function(a){var b=function(){function a(c,f){c instanceof b?(this.abv=c.abv,this.position=c.position):(this.abv=c,this.position=f||0)}a.prototype={readByte:function(){return this.abv[this.position++]},writeByte:function(a){this.abv[this.position++]=a},peekByte:function(a){return this.abv[a]},copyBytes:function(a,b,c){var f=new Uint8Array(this.abv.buffer,this.position,c);a=new Uint8Array(a.buffer,b,c);f.set(a);this.position+=c},seek:function(a){this.position=a},skip:function(a){this.position+=
a},getPosition:function(){return this.position},setPosition:function(a){this.position=a},getRemaining:function(){return this.abv.length-this.position},getLength:function(){return this.abv.length},isEndOfStream:function(){return this.position>=this.abv.length},show:function(){var a;return a="AbvStream: pos "+(this.getPosition().toString()+" of "+this.getLength().toString())}};return a}(),c={};(function(){function a(l,k){k.writeByte(l.tagClass<<6|l.constructed<<5|l.tag);var m=l.payloadLen;if(128>m)k.writeByte(m);
else{for(var r=m,w=0;r;)++w,r>>=8;k.writeByte(128|w);for(r=0;r<w;++r)k.writeByte(m>>8*(w-r-1)&255)}if(l.child)for(l.tag==u.BIT_STRING&&k.writeByte(0),m=l._child;m;){if(!a(m,k))return!1;m=m.next}else switch(l.tag){case u.INTEGER:l.backingStore[l.dataIdx]>>7&&k.writeByte(0);k.copyBytes(l.backingStore,l.dataIdx,l.dataLen);break;case u.BIT_STRING:k.writeByte(0);k.copyBytes(l.backingStore,l.dataIdx,l.dataLen);break;case u.OCTET_STRING:k.copyBytes(l.backingStore,l.dataIdx,l.dataLen);break;case u.OBJECT_IDENTIFIER:k.copyBytes(l.backingStore,
l.dataIdx,l.dataLen)}return!0}function f(a){var l=a.readByte(),k=l&127;if(k==l)return k;if(3<k||0===k)return-1;for(var m=l=0;m<k;++m)l=l<<8|a.readByte();return l}function g(a,l,k){var m=a.backingStore,w=new b(m,l);l+=k;k=a;var D,c,A;if(8<E++)return K;for(;w.getPosition()<l;){w.getPosition();A=w.readByte();if(31==(A&31)){for(c=0;A&128;)c<<=8,c|=A&127;A=c}D=A;c=D&31;if(0>c||30<c)return K;A=f(w);if(0>A||A>w.getRemaining())return K;k.constructed=D&32;k.tagClass=(D&192)>>6;k.tag=c;k.dataLen=A;k.dataIdx=
w.getPosition();c=w;var Ka=D;D=A;if(Ka&32)c=!0;else if(Ka<u.BIT_STRING||Ka>u.OCTET_STRING)c=!1;else{var x=new b(c);Ka==u.BIT_STRING&&x.skip(1);x.readByte()>>6&1?c=!1:(Ka=f(x),c=x.getPosition()-c.getPosition()+Ka==D)}c&&(c=w.getPosition(),D=A,k.tag==u.BIT_STRING&&(k.dataIdx++,k.dataLen--,c++,D--),k.child=new r(m,k),g(k.child,c,D));k.tag==u.INTEGER&&(c=w.getPosition(),0==w.peekByte(c)&&w.peekByte(c+1)>>7&&(k.dataIdx++,k.dataLen--));w.skip(A);w.getPosition()<l&&(k.next=new r(m,k.parent),k=k.next)}E--;
return a}function d(a,l,k){if(9!=k)return!1;for(k=0;9>k;++k)if(a[l++]!=A[k])return!1;return!0}function Q(a){if(!(a&&a.child&&a.child.next&&a.child.child&&a.child.next.child))return!1;var l=a.child.child;return d(l.backingStore,l.dataIdx,l.dataLen)&&2==a.nChildren&&2==a.child.nChildren&&2==a.child.next.child.nChildren?!0:!1}function h(a){if(!(a&&a.child&&a.child.next&&a.child.next.child&&a.child.next.next&&a.child.next.next.child))return!1;var l=a.child.next.child;return d(l.backingStore,l.dataIdx,
l.dataLen)&&3==a.nChildren&&2==a.child.next.nChildren&&9==a.child.next.next.child.nChildren?!0:!1}function Ta(a){var l=D.createSequenceNode(),k=new la(l);k.addChild(D.createSequenceNode());k.addChild(D.createOidNode(A));k.addSibling(D.createNullNode());k.addToParent(l,D.createBitStringNode(null));k.addChild(D.createSequenceNode());k.addChild(D.createIntegerNode(a.n));k.addSibling(D.createIntegerNode(a.e));return l}function hb(a){a=a.child.next.child.child;var l=a.data;a=a.next;return new L(l,a.data,
null,null)}function x(a){var l=D.createSequenceNode(),k=new la(l);k.addChild(D.createIntegerNode(new Uint8Array([0])));k.addSibling(D.createSequenceNode());k.addChild(D.createOidNode(A));k.addSibling(D.createNullNode());k.addToParent(l,D.createOctetStringNode(null));k.addChild(D.createSequenceNode());k.addChild(D.createIntegerNode(new Uint8Array([0])));k.addSibling(D.createIntegerNode(a.n));k.addSibling(D.createIntegerNode(a.e));k.addSibling(D.createIntegerNode(a.d));k.addSibling(D.createIntegerNode(a.p));
k.addSibling(D.createIntegerNode(a.q));k.addSibling(D.createIntegerNode(a.dp));k.addSibling(D.createIntegerNode(a.dq));k.addSibling(D.createIntegerNode(a.qi));return l}function w(a){var k=[];a=a.child.next.next.child.child.next;for(var l=0;8>l;l++)k.push(a.data),a=a.next;return new Y(k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7])}function m(a,k,l,m){if(!(a instanceof L||a instanceof Y))return K;if(l)for(var r=0;r<l.length;++r)if(-1==lb.indexOf(l[r]))return K;k={kty:"RSA",alg:k,key_ops:l||[],ext:m==K?!1:
m,n:N(a.n,!0),e:N(a.e,!0)};a instanceof Y&&(k.d=N(a.d,!0),k.p=N(a.p,!0),k.q=N(a.q,!0),k.dp=N(a.dp,!0),k.dq=N(a.dq,!0),k.qi=N(a.qi,!0));return k}function k(a){if(!a.kty||"RSA"!=a.kty||!a.n||!a.e)return K;var k="RSA1_5 RSA-OAEP RSA-OAEP-256 RSA-OAEP-384 RSA-OAEP-512 RS256 RS384 RS512".split(" ");if(a.alg&&-1==k.indexOf(a.alg))return K;k=[];a.use?"enc"==a.use?k=["encrypt","decrypt","wrap","unwrap"]:"sig"==a.use&&(k=["sign","verify"]):k=a.key_ops;var l=a.ext,m=T(a.n,!0),r=T(a.e,!0);if(a.d){var u=T(a.d,
!0),w=T(a.p,!0),b=T(a.q,!0),D=T(a.dp,!0),c=T(a.dq,!0),A=T(a.qi,!0);return new Y(m,r,u,w,b,D,c,A,a.alg,k,l)}return new L(m,r,l,k)}function l(a,k,l,m){this.der=a;this.type=k;this.keyOps=l;this.extractable=m}var u={BER:0,BOOLEAN:1,INTEGER:2,BIT_STRING:3,OCTET_STRING:4,NULL:5,OBJECT_IDENTIFIER:6,OBJECT_DESCRIPTOR:7,INSTANCE_OF_EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED_PPV:11,UTF8_STRING:12,RELATIVE_OID:13,SEQUENCE:16,SET:17,NUMERIC_STRING:18,PRINTABLE_STRING:19,TELETEX_STRING:20,T61_STRING:20,VIDEOTEX_STRING:21,
IA5_STRING:22,UTC_TIME:23,GENERALIZED_TIME:24,GRAPHIC_STRING:25,VISIBLE_STRING:26,ISO64_STRING:26,GENERAL_STRING:27,UNIVERSAL_STRING:28,CHARACTER_STRING:29,BMP_STRING:30},r=function(a,k,l,m,r,u){this._data=a;this._parent=k||K;this._constructed=l||!1;this._tagClass=0;this._tag=m||0;this._dataIdx=r||0;this._dataLen=u||0};r.prototype={_child:K,_next:K,get data(){return new Uint8Array(this._data.buffer.slice(this._dataIdx,this._dataIdx+this._dataLen))},get backingStore(){return this._data},get constructed(){return this._constructed},
set constructed(a){this._constructed=0!=a?!0:!1},get tagClass(){return this._tagClass},set tagClass(a){this._tagClass=a},get tag(){return this._tag},set tag(a){this._tag=a},get dataIdx(){return this._dataIdx},set dataIdx(a){this._dataIdx=a},get dataLen(){return this._dataLen},set dataLen(a){this._dataLen=a},get child(){return this._child},set child(a){this._child=a;this._child.parent=this},get next(){return this._next},set next(a){this._next=a},get parent(){return this._parent},set parent(a){this._parent=
a},get payloadLen(){var a=0;if(this._child){for(var k=this._child;k;)a+=k.length,k=k.next;this._tag==u.BIT_STRING&&a++}else switch(this._tag){case u.INTEGER:a=this._dataLen;this._data[this._dataIdx]>>7&&a++;break;case u.BIT_STRING:a=this._dataLen+1;break;case u.OCTET_STRING:a=this._dataLen;break;case u.NULL:a=0;break;case u.OBJECT_IDENTIFIER:d(this._data,this._dataIdx,this._dataLen)&&(a=9)}return a},get length(){var a=this.payloadLen,k;if(127<a)for(k=a;k;)k>>=8,++a;return a+2},get der(){var k=this.length;
if(!k)return K;var k=new Uint8Array(k),l=new b(k);return a(this,l)?k:K},get nChildren(){for(var a=0,k=this._child;k;)a++,k=k.next;return a}};var D={createSequenceNode:function(){return new r(null,null,!0,u.SEQUENCE,null,null)},createOidNode:function(a){return new r(a,null,!1,u.OBJECT_IDENTIFIER,0,a?a.length:0)},createNullNode:function(){return new r(null,null,!1,u.NULL,null,null)},createBitStringNode:function(a){return new r(a,null,!1,u.BIT_STRING,0,a?a.length:0)},createIntegerNode:function(a){return new r(a,
null,!1,u.INTEGER,0,a?a.length:0)},createOctetStringNode:function(a){return new r(a,null,!1,u.OCTET_STRING,0,a?a.length:0)}},la=function(a){this._currentNode=this._rootNode=a};la.prototype={addChild:function(a){this.addTo(this._currentNode,a)},addSibling:function(a){this.addTo(this._currentNode.parent,a)},addTo:function(a,k){this._currentNode=k;this._currentNode.parent=a;if(a.child){for(var l=a.child;l.next;)l=l.next;l.next=k}else a.child=k},addToParent:function(a,k){this.findNode(a)&&this.addTo(a,
k)},findNode:function(a){for(var k=this._currentNode;k;){if(a==k)return!0;k=k.parent}return!1}};var E=0,A=new Uint8Array([42,134,72,134,247,13,1,1,1]),L=function(a,k,l,m){this.n=a;this.e=k;this.ext=l;this.keyOps=m},Y=function(a,k,l,m,r,u,w,b,D,c,A){this.n=a;this.e=k;this.d=l;this.p=m;this.q=r;this.dp=u;this.dq=w;this.qi=b;this.alg=D;this.keyOps=c;this.ext=A},lb="sign verify encrypt decrypt wrapKey unwrapKey deriveKey deriveBits".split(" ");l.prototype.getDer=function(){return this.der};l.prototype.getType=
function(){return this.type};l.prototype.getKeyOps=function(){return this.keyOps};l.prototype.getExtractable=function(){return this.extractable};c.parse=function(a){E=0;return g(new r(a),0,a.length)};c.show=function(a,k){};c.isRsaSpki=Q;c.isRsaPkcs8=h;c.NodeFactory=D;c.Builder=la;c.tagVal=u;c.RsaPublicKey=L;c.RsaPrivateKey=Y;c.buildRsaSpki=Ta;c.parseRsaSpki=function(a){a=c.parse(a);return Q?hb(a):K};c.buildRsaPkcs8=x;c.parseRsaPkcs8=function(a){a=c.parse(a);return h(a)?w(a):K};c.buildRsaJwk=m;c.parseRsaJwk=
k;c.RsaDer=l;c.rsaDerToJwk=function(a,k,l,r){a=c.parse(a);if(!a)return K;if(Q(a))a=hb(a);else if(h(a))a=w(a);else return K;return m(a,k,l,r)};c.jwkToRsaDer=function(a){a=k(a);if(!a)return K;var m,r;if(a instanceof L)m="spki",r=Ta(a).der;else if(a instanceof Y)m="pkcs8",r=x(a).der;else return K;return new l(r,m,a.keyOps,a.ext)};c.webCryptoAlgorithmToJwkAlg=function(a){return"RSAES-PKCS1-v1_5"==a.name?"RSA1_5":"RSASSA-PKCS1-v1_5"==a.name?"SHA-256"==a.hash.name?"RS256":"SHA-384"==a.hash.name?"RS384":
"SHA-512"==a.hash.name?"RS512":K:K};c.webCryptoUsageToJwkKeyOps=function(a){return a.map(function(a){return"wrapKey"==a?"wrap":"unwrapKey"==a?"unwrap":a})}})();a.ASN1=c})(this);var N,T;(function(){for(var a={},b={},c={"=":0,".":0},f={"=":0,".":0},g=/\s+/g,d=/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/_-]*[=]{0,2}$/,h=64;h--;)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]]=262144*h,b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]]=
4096*h,c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]]=64*h,f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]]=h;for(h=64;h--&&"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h]!="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[h];)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[h]]=262144*h,b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[h]]=4096*h,c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[h]]=
64*h,f["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[h]]=h;N=function(a,b){for(var c="",f=0,x=a.length,w=x-2,m,k=b?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=b?"":"=";f<w;)m=65536*a[f++]+256*a[f++]+a[f++],c+=k[m>>>18]+k[m>>>12&63]+k[m>>>6&63]+k[m&63];f==w?(m=65536*a[f++]+256*a[f++],c+=k[m>>>18]+k[m>>>12&63]+k[m>>>6&63]+l):f==x-1&&(m=65536*a[f++],c+=k[m>>>18]+k[m>>>12&63]+l+l);return c};
T=function(h,dc){h=h.replace(g,"");if(dc){var Ta=h.length%4;if(Ta)for(var Ta=4-Ta,hb=0;hb<Ta;++hb)h+="="}Ta=h.length;if(0!=Ta%4||!d.test(h))throw Error("bad base64: "+h);for(var x=Ta/4*3-("="==h[Ta-1]?1:0)-("="==h[Ta-2]?1:0),w=new Uint8Array(x),m=0,k=0;m<Ta;)hb=a[h[m++]]+b[h[m++]]+c[h[m++]]+f[h[m++]],w[k++]=hb>>>16,k<x&&(w[k++]=hb>>>8&255,k<x&&(w[k++]=hb&255));return w}})();var Ua={};(function(){function a(c){if(!(this instanceof a))return new a(c);for(var x=0,w=d.length;x<w;x++)this[d[x]]="";this.bufferCheckPosition=
Ua.MAX_BUFFER_LENGTH;this.q=this.c=this.p="";this.opt=c||{};this.closed=this.closedRoot=this.sawRoot=!1;this.tag=this.error=null;this.state=Q.BEGIN;this.stack=new g;this.index=this.position=this.column=0;this.line=1;this.slashed=!1;this.unicodeI=0;this.unicodeS=null;b(this,"onready")}function b(a,c,w){if(a[c])a[c](w)}function c(a,x){var w=a.opt,m=a.textNode;w.trim&&(m=m.trim());w.normalize&&(m=m.replace(/\s+/g," "));a.textNode=m;a.textNode&&b(a,x?x:"onvalue",a.textNode);a.textNode=""}function f(a,
x){c(a);x+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c;x=Error(x);a.error=x;b(a,"onerror",x);return a}function h(d){d.state!==Q.VALUE&&f(d,"Unexpected end");c(d);d.c="";d.closed=!0;b(d,"onend");a.call(d,d.opt);return d}var g=Array;Ua.parser=function(b){return new a(b)};Ua.CParser=a;Ua.MAX_BUFFER_LENGTH=65536;Ua.DEBUG=!1;Ua.INFO=!1;Ua.EVENTS="value string key openobject closeobject openarray closearray error end ready".split(" ");var d=["textNode","numberNode"];Ua.EVENTS.filter(function(a){return"error"!==
a&&"end"!==a});var Q=0;Ua.STATE={BEGIN:Q++,VALUE:Q++,OPEN_OBJECT:Q++,CLOSE_OBJECT:Q++,OPEN_ARRAY:Q++,CLOSE_ARRAY:Q++,TEXT_ESCAPE:Q++,STRING:Q++,BACKSLASH:Q++,END:Q++,OPEN_KEY:Q++,CLOSE_KEY:Q++,TRUE:Q++,TRUE2:Q++,TRUE3:Q++,FALSE:Q++,FALSE2:Q++,FALSE3:Q++,FALSE4:Q++,NULL:Q++,NULL2:Q++,NULL3:Q++,NUMBER_DECIMAL_POINT:Q++,NUMBER_DIGIT:Q++};for(var dc in Ua.STATE)Ua.STATE[Ua.STATE[dc]]=dc;Q=Ua.STATE;Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__});var Ta=/[\\"\n]/g;a.prototype=
{end:function(){h(this)},write:function(a){if(this.error)throw this.error;if(this.closed)return f(this,"Cannot write after close. Assign an onready handler.");if(null===a)return h(this);for(var x=a[0],w=this.p;x;){w=x;this.c=x=a.charAt(this.index++);w!==x?this.p=w:w=this.p;if(!x)break;this.position++;"\n"===x?(this.line++,this.column=0):this.column++;switch(this.state){case Q.BEGIN:"{"===x?this.state=Q.OPEN_OBJECT:"["===x?this.state=Q.OPEN_ARRAY:"\r"!==x&&"\n"!==x&&" "!==x&&"\t"!==x&&f(this,"Non-whitespace before {[.");
continue;case Q.OPEN_KEY:case Q.OPEN_OBJECT:if("\r"===x||"\n"===x||" "===x||"\t"===x)continue;if(this.state===Q.OPEN_KEY)this.stack.push(Q.CLOSE_KEY);else if("}"===x){b(this,"onopenobject");b(this,"oncloseobject");this.state=this.stack.pop()||Q.VALUE;continue}else this.stack.push(Q.CLOSE_OBJECT);'"'===x?this.state=Q.STRING:f(this,'Malformed object key should start with "');continue;case Q.CLOSE_KEY:case Q.CLOSE_OBJECT:if("\r"===x||"\n"===x||" "===x||"\t"===x)continue;":"===x?(this.state===Q.CLOSE_OBJECT?
(this.stack.push(Q.CLOSE_OBJECT),c(this,"onopenobject")):c(this,"onkey"),this.state=Q.VALUE):"}"===x?(c(this),b(this,"oncloseobject",void 0),this.state=this.stack.pop()||Q.VALUE):","===x?(this.state===Q.CLOSE_OBJECT&&this.stack.push(Q.CLOSE_OBJECT),c(this),this.state=Q.OPEN_KEY):f(this,"Bad object");continue;case Q.OPEN_ARRAY:case Q.VALUE:if("\r"===x||"\n"===x||" "===x||"\t"===x)continue;if(this.state===Q.OPEN_ARRAY)if(b(this,"onopenarray"),this.state=Q.VALUE,"]"===x){b(this,"onclosearray");this.state=
this.stack.pop()||Q.VALUE;continue}else this.stack.push(Q.CLOSE_ARRAY);'"'===x?this.state=Q.STRING:"{"===x?this.state=Q.OPEN_OBJECT:"["===x?this.state=Q.OPEN_ARRAY:"t"===x?this.state=Q.TRUE:"f"===x?this.state=Q.FALSE:"n"===x?this.state=Q.NULL:"-"===x?this.numberNode+=x:"0"===x?(this.numberNode+=x,this.state=Q.NUMBER_DIGIT):-1!=="123456789".indexOf(x)?(this.numberNode+=x,this.state=Q.NUMBER_DIGIT):f(this,"Bad value");continue;case Q.CLOSE_ARRAY:if(","===x)this.stack.push(Q.CLOSE_ARRAY),c(this,"onvalue"),
this.state=Q.VALUE;else if("]"===x)c(this),b(this,"onclosearray",void 0),this.state=this.stack.pop()||Q.VALUE;else if("\r"===x||"\n"===x||" "===x||"\t"===x)continue;else f(this,"Bad array");continue;case Q.STRING:var w=this.index-1,m=this.slashed,k=this.unicodeI;a:for(;;){if(Ua.DEBUG)for(;0<k;)if(this.unicodeS+=x,x=a.charAt(this.index++),4===k?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),k=0,w=this.index-1):k++,!x)break a;if('"'===x&&!m){this.state=this.stack.pop()||Q.VALUE;(this.textNode+=
a.substring(w,this.index-1))||b(this,"onvalue","");break}if("\\"===x&&!m&&(m=!0,this.textNode+=a.substring(w,this.index-1),x=a.charAt(this.index++),!x))break;if(m)if(m=!1,"n"===x?this.textNode+="\n":"r"===x?this.textNode+="\r":"t"===x?this.textNode+="\t":"f"===x?this.textNode+="\f":"b"===x?this.textNode+="\b":"u"===x?(k=1,this.unicodeS=""):this.textNode+=x,x=a.charAt(this.index++),w=this.index-1,x)continue;else break;Ta.lastIndex=this.index;var l=Ta.exec(a);if(null===l){this.index=a.length+1;this.textNode+=
a.substring(w,this.index-1);break}this.index=l.index+1;x=a.charAt(l.index);if(!x){this.textNode+=a.substring(w,this.index-1);break}}this.slashed=m;this.unicodeI=k;continue;case Q.TRUE:if(""===x)continue;"r"===x?this.state=Q.TRUE2:f(this,"Invalid true started with t"+x);continue;case Q.TRUE2:if(""===x)continue;"u"===x?this.state=Q.TRUE3:f(this,"Invalid true started with tr"+x);continue;case Q.TRUE3:if(""===x)continue;"e"===x?(b(this,"onvalue",!0),this.state=this.stack.pop()||Q.VALUE):f(this,"Invalid true started with tru"+
x);continue;case Q.FALSE:if(""===x)continue;"a"===x?this.state=Q.FALSE2:f(this,"Invalid false started with f"+x);continue;case Q.FALSE2:if(""===x)continue;"l"===x?this.state=Q.FALSE3:f(this,"Invalid false started with fa"+x);continue;case Q.FALSE3:if(""===x)continue;"s"===x?this.state=Q.FALSE4:f(this,"Invalid false started with fal"+x);continue;case Q.FALSE4:if(""===x)continue;"e"===x?(b(this,"onvalue",!1),this.state=this.stack.pop()||Q.VALUE):f(this,"Invalid false started with fals"+x);continue;
case Q.NULL:if(""===x)continue;"u"===x?this.state=Q.NULL2:f(this,"Invalid null started with n"+x);continue;case Q.NULL2:if(""===x)continue;"l"===x?this.state=Q.NULL3:f(this,"Invalid null started with nu"+x);continue;case Q.NULL3:if(""===x)continue;"l"===x?(b(this,"onvalue",null),this.state=this.stack.pop()||Q.VALUE):f(this,"Invalid null started with nul"+x);continue;case Q.NUMBER_DECIMAL_POINT:"."===x?(this.numberNode+=x,this.state=Q.NUMBER_DIGIT):f(this,"Leading zero not followed by .");continue;
case Q.NUMBER_DIGIT:-1!=="0123456789".indexOf(x)?this.numberNode+=x:"."===x?(-1!==this.numberNode.indexOf(".")&&f(this,"Invalid number has two dots"),this.numberNode+=x):"e"===x||"E"===x?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||f(this,"Invalid number has two exponential"),this.numberNode+=x):"+"===x||"-"===x?("e"!==w&&"E"!==w&&f(this,"Invalid symbol in number"),this.numberNode+=x):(this.numberNode&&b(this,"onvalue",parseFloat(this.numberNode)),this.numberNode="",this.index--,
this.state=this.stack.pop()||Q.VALUE);continue;default:f(this,"Unknown state: "+this.state)}}if(this.position>=this.bufferCheckPosition){a=Math.max(Ua.MAX_BUFFER_LENGTH,10);w=x=0;for(m=d.length;w<m;w++){k=this[d[w]].length;if(k>a)switch(d[w]){case "text":break;default:f(this,"Max buffer length exceeded: "+d[w])}x=Math.max(x,k)}this.bufferCheckPosition=Ua.MAX_BUFFER_LENGTH-x+this.position}return this},resume:function(){this.error=null;return this},close:function(){return this.write(null)}}})();var ae,
be;(function(){function a(b,c){c||(c=b.length);return b.reduce(function(a,b,f){return f<c?a+String.fromCharCode(b):a},"")}for(var b={},c=0;256>c;++c){var f=a([c]);b[f]=c}for(var d=Object.keys(b).length,h=[],c=0;256>c;++c)h[c]=[c];ae=function(c){function f(a,r){for(;0<r;){if(k>=m.length)return!1;if(r>l){var u=a,u=u>>>r-l;m[k]|=u&255;r-=l;l=8;++k}else r<=l&&(u=a,u<<=l-r,u&=255,u>>>=8-l,m[k]|=u&255,l-=r,r=0,0==l&&(l=8,++k))}return!0}var h={},g;for(g in b)h[g]=b[g];for(var hb=d,x=[],w=8,m=new Uint8Array(c.length),
k=0,l=8,u=0;u<c.length;++u){var r=c[u];x.push(r);g=a(x);var D=h[g];if(!D){x=a(x,x.length-1);if(!f(h[x],w))return null;0!=hb>>w&&++w;h[g]=hb++;x=[r]}}return 0<x.length&&(g=a(x),D=h[g],!f(D,w))?null:m.subarray(0,8>l?k+1:k)};be=function(a){for(var b=h.slice(),c=0,f=0,d=8,x=new Uint8Array(Math.ceil(1.5*a.length)),w=0,m=0,k=[];c<a.length&&!(8*(a.length-c)-f<d);){for(var l=m=0;l<d;){var u=Math.min(d-l,8-f),r=a[c],r=r<<f,r=r&255,r=r>>>8-u,l=l+u,f=f+u;8==f&&(f=0,++c);m|=(r&255)<<d-l}l=b[m];0==k.length?++d:
(l?k.push(l[0]):k.push(k[0]),b[b.length]=k,k=[],b.length==1<<d&&++d,l||(l=b[m]));m=w+l.length;m>=x.length&&(u=new Uint8Array(Math.ceil(1.5*m)),u.set(x),x=u);x.set(l,w);w=m;k=k.concat(l)}return x.subarray(0,w)}})();var ma,Ia,cd,Id,sd,Ef,Rc,Jd,d;(function(){ma="utf-8";Ia=9007199254740992;var a=cd={GZIP:"GZIP",LZW:"LZW"};Object.freeze(cd);Id=function(b){for(var c=[a.GZIP,a.LZW],f=0;f<c.length&&0<b.length;++f)for(var d=c[f],h=0;h<b.length;++h)if(b[h]==d)return d;return null};var b=sd={AES_CBC_PKCS5Padding:"AES/CBC/PKCS5Padding",
AESWrap:"AESWrap",RSA_ECB_PKCS1Padding:"RSA/ECB/PKCS1Padding"};Object.freeze(sd);Ef=function(a){return b.AES_CBC_PKCS5Padding==a?b.AES_CBC_PKCS5Padding:b.RSA_ECB_PKCS1Padding==a?b.RSA_ECB_PKCS1Padding:b[a]};var c=Rc={HmacSHA256:"HmacSHA256",SHA256withRSA:"SHA256withRSA"};Object.freeze(Rc);Jd=function(a){return c[a]};d={FAIL:1,TRANSIENT_FAILURE:2,ENTITY_REAUTH:3,USER_REAUTH:4,KEYX_REQUIRED:5,ENTITYDATA_REAUTH:6,USERDATA_REAUTH:7,EXPIRED:8,REPLAYED:9,SSOTOKEN_REJECTED:10};Object.freeze(d)})();var ca=
{isObjectLiteral:function(a){return null!==a&&"object"===typeof a&&a.constructor===Object},extendDeep:function(){var a=arguments[0],b=1,c=arguments.length,f=!1,d,h,g,Q;"boolean"===typeof a&&(f=a,a=arguments[1],b=2);for(;b<c;b++)if(null!=(d=arguments[b]))for(h in d)f&&h in a||(Q=d[h],a!==Q&&Q!==K&&(g=a[h],a[h]=null!==g&&null!==Q&&"object"===typeof g&&"object"===typeof Q?ca.extendDeep(f,{},g,Q):Q));return a}};(function(){function a(b,c){return function(){var a=b.base,f;b.base=c;f=b.apply(this,arguments);
b.base=a;return f}}function b(c,f,d){var x,w,m,k;d=d||Q;k=!!d.extendAll;for(x in f)w=f.__lookupGetter__(x),m=f.__lookupSetter__(x),w||m?(w&&c.__defineGetter__(x,w),m&&c.__defineSetter__(x,m)):(w=f[x],m=c[x],"function"===typeof w&&"function"===typeof m&&w!==m?(w.base!==Function.prototype.base&&(w=a(w,m)),w.base=m):(k||d[x])&&ca.isObjectLiteral(w)&&ca.isObjectLiteral(m)&&(w=ca.extendDeep({},m,w)),c[x]=w)}function c(){var a=Array.prototype.slice,b=a.call(arguments,1);return this.extend({init:function x(){var c=
a.call(arguments,0);x.base.apply(this,b.concat(c))}})}function f(a,c){var d=new this(g);b(d,a,c);return h(d)}function d(a,c){b(this.prototype,a,c);return this}function h(a){var b=function(){var a=this.init;a&&arguments[0]!==g&&a.apply(this,arguments)};a&&(b.prototype=a);b.prototype.constructor=b;b.extend=f;b.bind=c;b.mixin=d;return b}var g={},Q={actions:!0};Function.prototype.base=function(){};ca.Class={create:h,mixin:b,extend:function(a,b){var c=h();c.prototype=new a;return c.extend(b)}};ca.mixin=
function(){ca.log&&ca.log.warn("util.mixin is deprecated.  Please change your code to use util.Class.mixin()");b.apply(null,arguments)}})();(function(){function a(b,c){return function(){var a=b.base,w;b.base=c;w=b.apply(this,arguments);b.base=a;return w}}function b(c,f,x){var w,m,k,l;x=x||Q;l=!!x.extendAll;for(w in f)m=f.__lookupGetter__(w),k=f.__lookupSetter__(w),m||k?(m&&c.__defineGetter__(w,m),k&&c.__defineSetter__(w,k)):(m=f[w],k=c[w],"function"===typeof m&&"function"===typeof k&&m!==k?(m.base!==
n&&(m=a(m,k)),m.base=k):(l||x[w])&&ca.isObjectLiteral(m)&&ca.isObjectLiteral(k)&&(m=ca.extendDeep({},k,m)),c[w]=m)}function c(){var a=Array.prototype.slice,b=a.call(arguments,1);return this.extend({init:function w(){var m=a.call(arguments,0);w.base.apply(this,b.concat(m))}})}function f(a,c){var x=new this(g);b(x,a,c);return h(x)}function d(a,c){b(this.prototype,a,c);return this}function h(a){var b=function(){var a=this.init;a&&arguments[0]!==g&&a.apply(this,arguments)};a&&(b.prototype=a);b.prototype.constructor=
b;b.extend=f;b.bind=c;b.mixin=d;return b}var g={},Q={actions:!0},n=function(){};Function.prototype.base=n;ca.Class={create:h,mixin:b,extend:function(a,b){var c=h();c.prototype=new a;return c.extend(b)}};ca.mixin=function(){ca.log&&ca.log.warn("util.mixin is deprecated.  Please change your code to use util.Class.mixin()");b.apply(null,arguments)}})();var Ha;(function(){function a(b){return b==Ia?1:b+1}function b(c){if(0===Object.keys(c._waiters).length)return 0;for(var f=a(c._nextWaiter);!c._waiters[f];)f=
a(f);return f}Ha=ca.Class.create({init:function(){Object.defineProperties(this,{_queue:{value:[],writable:!1,enumerable:!1,configurable:!1},_waiters:{value:{},writable:!1,enumerable:!1,configurable:!1},_nextWaiter:{value:0,writable:!0,enumerable:!1,configurable:!1},_lastWaiter:{value:0,writable:!0,enumerable:!1,configurable:!1}})},cancel:function(a){if(this._waiters[a]){var c=this._waiters[a];delete this._waiters[a];a==this._nextWaiter&&(this._nextWaiter=b(this));c.call(this,K)}},cancelAll:function(){for(;0!==
this._nextWaiter;)this.cancel(this._nextWaiter)},poll:function(c,d){var h=this,g=a(this._lastWaiter);this._lastWaiter=g;f(d,function(){if(0<this._queue.length){var a=this._queue.shift();setTimeout(function(){d.result(a)},0)}else{var f;-1!=c&&(f=setTimeout(function(){delete h._waiters[g];g==h._nextWaiter&&(h._nextWaiter=b(h));d.timeout()},c));this._waiters[g]=function(a){clearTimeout(f);setTimeout(function(){d.result(a)},0)};this._nextWaiter||(this._nextWaiter=g)}},h);return g},add:function(a){if(this._nextWaiter){var c=
this._waiters[this._nextWaiter];delete this._waiters[this._nextWaiter];this._nextWaiter=b(this);c.call(this,a)}else this._queue.push(a)}})})();var ce;(function(){var a=0-Ia;ce=ca.Class.create({nextBoolean:function(){var a=new Uint8Array(1);Fb.getRandomValues(a);return a[0]&1?!0:!1},nextInt:function(a){if(null!==a&&a!==K){if("number"!==typeof a)throw new TypeError("n must be of type number");if(1>a)throw new RangeError("n must be greater than zero");--a;var b=new Uint8Array(4);Fb.getRandomValues(b);
return Math.floor(((b[3]&127)<<24|b[2]<<16|b[1]<<8|b[0])/2147483648*(a-0+1)+0)}a=new Uint8Array(4);Fb.getRandomValues(a);b=(a[3]&127)<<24|a[2]<<16|a[1]<<8|a[0];return a[3]&128?-b:b},nextLong:function(){for(var b=a;b==a;){b=new Uint8Array(7);Fb.getRandomValues(b);var c=16777216*((b[6]&31)<<24|b[5]<<16|b[4]<<8|b[3])+(b[2]<<16|b[1]<<8|b[0]),b=b[6]&128?-c-1:c}return b},nextBytes:function(a){Fb.getRandomValues(a)}})})();var Gc;(function(){function a(b){return b==Ia?1:b+1}function b(c){if(0===Object.keys(c._waitingReaders).length)return 0;
for(var f=a(c._nextReader);!c._waitingReaders[f];)f=a(f);return f}function c(b){if(0===Object.keys(b._waitingWriters).length)return 0;for(var f=a(b._nextWriter);!b._waitingWriters[f];)f=a(f);return f}Gc=ca.Class.create({init:function(){Object.defineProperties(this,{_readers:{value:{},writable:!1,enumerable:!1,configurable:!1},_waitingReaders:{value:{},writable:!1,enumerable:!1,configurable:!1},_writer:{value:null,writable:!0,enumerable:!1,configurable:!1},_waitingWriters:{value:{},writable:!1,enumerable:!1,
configurable:!1},_nextReader:{value:0,writable:!0,enumerable:!1,configurable:!1},_nextWriter:{value:0,writable:!0,enumerable:!1,configurable:!1},_lastNumber:{value:0,writable:!0,enumerable:!1,configurable:!1}})},cancel:function(a){if(this._waitingReaders[a]){var f=this._waitingReaders[a];delete this._waitingReaders[a];a==this._nextReader&&(this._nextReader=b(this));f.call(this,!0)}this._waitingWriters[a]&&(f=this._waitingWriters[a],delete this._waitingWriters[a],a==this._nextWriter&&(this._nextWriter=
c(this)),f.call(this,!0))},cancelAll:function(){for(;0!==this._nextWriter;)this.cancel(this._nextWriter);for(;0!==this._nextReader;)this.cancel(this._nextReader)},readLock:function(c,d){var h=this,g=a(this._lastNumber);this._lastNumber=g;f(d,function(){if(!this._writer&&0===Object.keys(this._waitingWriters).length)return this._readers[g]=!0,g;var a;-1!=c&&(a=setTimeout(function(){delete h._waitingReaders[g];g==h._nextReader&&(h._nextReader=b(h));d.timeout()},c));this._waitingReaders[g]=function(b){clearTimeout(a);
b?setTimeout(function(){d.result(K)},0):(h._readers[g]=!0,setTimeout(function(){d.result(g)},0))};this._nextReader||(this._nextReader=g)},h);return g},writeLock:function(b,d){var h=this,g=a(this._lastNumber);this._lastNumber=g;f(d,function(){if(0===Object.keys(this._readers).length&&0===Object.keys(this._waitingReaders).length&&!this._writer)return this._writer=g;var a;-1!=b&&(a=setTimeout(function(){delete h._waitingWriters[g];g==h._nextWriter&&(h._nextWriter=c(h));d.timeout()},b));this._waitingWriters[g]=
function(b){clearTimeout(a);b?setTimeout(function(){d.result(K)},0):(h._writer=g,setTimeout(function(){d.result(g)},0))};this._nextWriter||(this._nextWriter=g)},h);return g},unlock:function(b){if(b==this._writer)this._writer=null;else{if(!this._readers[b])throw new R("There is no reader or writer with ticket number "+b+".");delete this._readers[b]}if(this._nextWriter)0<Object.keys(this._readers).length||(b=this._waitingWriters[this._nextWriter],delete this._waitingWriters[this._nextWriter],this._nextWriter=
c(this),b.call(this,!1));else{for(var f=this._nextReader;0<Object.keys(this._waitingReaders).length;f=a(f))this._waitingReaders[f]&&(b=this._waitingReaders[f],delete this._waitingReaders[f],b.call(this,!1));this._nextReader=0}}})})();ca.Class.mixin(a,{JSON_PARSE_ERROR:new a(0,d.FAIL,"Error parsing JSON."),JSON_ENCODE_ERROR:new a(1,d.FAIL,"Error encoding JSON."),ENVELOPE_HASH_MISMATCH:new a(2,d.FAIL,"Computed hash does not match envelope hash."),INVALID_PUBLIC_KEY:new a(3,d.FAIL,"Invalid public key provided."),
INVALID_PRIVATE_KEY:new a(4,d.FAIL,"Invalid private key provided."),PLAINTEXT_ILLEGAL_BLOCK_SIZE:new a(5,d.FAIL,"Plaintext is not a multiple of the block size."),PLAINTEXT_BAD_PADDING:new a(6,d.FAIL,"Plaintext contains incorrect padding."),CIPHERTEXT_ILLEGAL_BLOCK_SIZE:new a(7,d.FAIL,"Ciphertext is not a multiple of the block size."),CIPHERTEXT_BAD_PADDING:new a(8,d.FAIL,"Ciphertext contains incorrect padding."),ENCRYPT_NOT_SUPPORTED:new a(9,d.FAIL,"Encryption not supported."),DECRYPT_NOT_SUPPORTED:new a(10,
d.FAIL,"Decryption not supported."),ENVELOPE_KEY_ID_MISMATCH:new a(11,d.FAIL,"Encryption envelope key ID does not match crypto context key ID."),CIPHERTEXT_ENVELOPE_PARSE_ERROR:new a(12,d.FAIL,"Error parsing ciphertext envelope."),CIPHERTEXT_ENVELOPE_ENCODE_ERROR:new a(13,d.FAIL,"Error encoding ciphertext envelope."),SIGN_NOT_SUPPORTED:new a(14,d.FAIL,"Sign not supported."),VERIFY_NOT_SUPPORTED:new a(15,d.FAIL,"Verify not suppoprted."),SIGNATURE_ERROR:new a(16,d.FAIL,"Signature not initialized or unable to process data/signature."),
HMAC_ERROR:new a(17,d.FAIL,"Error computing HMAC."),ENCRYPT_ERROR:new a(18,d.FAIL,"Error encrypting plaintext."),DECRYPT_ERROR:new a(19,d.FAIL,"Error decrypting ciphertext."),INSUFFICIENT_CIPHERTEXT:new a(20,d.FAIL,"Insufficient ciphertext for decryption."),SESSION_KEY_CREATION_FAILURE:new a(21,d.FAIL,"Error when creating session keys."),ASN1_PARSE_ERROR:new a(22,d.FAIL,"Error parsing ASN.1."),ASN1_ENCODE_ERROR:new a(23,d.FAIL,"Error encoding ASN.1."),INVALID_SYMMETRIC_KEY:new a(24,d.FAIL,"Invalid symmetric key provided."),
INVALID_ENCRYPTION_KEY:new a(25,d.FAIL,"Invalid encryption key."),INVALID_HMAC_KEY:new a(26,d.FAIL,"Invalid HMAC key."),WRAP_NOT_SUPPORTED:new a(27,d.FAIL,"Wrap not supported."),UNWRAP_NOT_SUPPORTED:new a(28,d.FAIL,"Unwrap not supported."),UNIDENTIFIED_JWK_TYPE:new a(29,d.FAIL,"Unidentified JSON web key type."),UNIDENTIFIED_JWK_USAGE:new a(30,d.FAIL,"Unidentified JSON web key usage."),UNIDENTIFIED_JWK_ALGORITHM:new a(31,d.FAIL,"Unidentified JSON web key algorithm."),WRAP_ERROR:new a(32,d.FAIL,"Error wrapping plaintext."),
UNWRAP_ERROR:new a(33,d.FAIL,"Error unwrapping ciphertext."),INVALID_JWK:new a(34,d.FAIL,"Invalid JSON web key."),INVALID_JWK_KEYDATA:new a(35,d.FAIL,"Invalid JSON web key keydata."),UNSUPPORTED_JWK_ALGORITHM:new a(36,d.FAIL,"Unsupported JSON web key algorithm."),WRAP_KEY_CREATION_FAILURE:new a(37,d.FAIL,"Error when creating wrapping key."),INVALID_WRAP_CIPHERTEXT:new a(38,d.FAIL,"Invalid wrap ciphertext."),UNSUPPORTED_JWE_ALGORITHM:new a(39,d.FAIL,"Unsupported JSON web encryption algorithm."),JWE_ENCODE_ERROR:new a(40,
d.FAIL,"Error encoding JSON web encryption header."),JWE_PARSE_ERROR:new a(41,d.FAIL,"Error parsing JSON web encryption header."),INVALID_ALGORITHM_PARAMS:new a(42,d.FAIL,"Invalid algorithm parameters."),JWE_ALGORITHM_MISMATCH:new a(43,d.FAIL,"JSON web encryption header algorithms mismatch."),KEY_IMPORT_ERROR:new a(44,d.FAIL,"Error importing key."),KEY_EXPORT_ERROR:new a(45,d.FAIL,"Error exporting key."),DIGEST_ERROR:new a(46,d.FAIL,"Error in digest."),UNSUPPORTED_KEY:new a(47,d.FAIL,"Unsupported key type or algorithm."),
UNSUPPORTED_JWE_SERIALIZATION:new a(48,d.FAIL,"Unsupported JSON web encryption serialization."),XML_PARSE_ERROR:new a(49,d.FAIL,"Error parsing XML."),XML_ENCODE_ERROR:new a(50,d.FAIL,"Error encoding XML."),INVALID_WRAPPING_KEY:new a(51,d.FAIL,"Invalid wrapping key."),UNIDENTIFIED_CIPHERTEXT_ENVELOPE:new a(52,d.FAIL,"Unidentified ciphertext envelope version."),UNIDENTIFIED_SIGNATURE_ENVELOPE:new a(53,d.FAIL,"Unidentified signature envelope version."),UNSUPPORTED_CIPHERTEXT_ENVELOPE:new a(54,d.FAIL,
"Unsupported ciphertext envelope version."),UNSUPPORTED_SIGNATURE_ENVELOPE:new a(55,d.FAIL,"Unsupported signature envelope version."),UNIDENTIFIED_CIPHERSPEC:new a(56,d.FAIL,"Unidentified cipher specification."),UNIDENTIFIED_ALGORITHM:new a(57,d.FAIL,"Unidentified algorithm."),SIGNATURE_ENVELOPE_PARSE_ERROR:new a(58,d.FAIL,"Error parsing signature envelope."),SIGNATURE_ENVELOPE_ENCODE_ERROR:new a(59,d.FAIL,"Error encoding signature envelope."),INVALID_SIGNATURE:new a(60,d.FAIL,"Invalid signature."),
WRAPKEY_FINGERPRINT_NOTSUPPORTED:new a(61,d.FAIL,"Wrap key fingerprint not supported"),UNIDENTIFIED_JWK_KEYOP:new a(62,d.FAIL,"Unidentified JSON web key key operation."),MASTERTOKEN_UNTRUSTED:new a(1E3,d.ENTITY_REAUTH,"Master token is not trusted."),MASTERTOKEN_KEY_CREATION_ERROR:new a(1001,d.ENTITY_REAUTH,"Unable to construct symmetric keys from master token."),MASTERTOKEN_EXPIRES_BEFORE_RENEWAL:new a(1002,d.ENTITY_REAUTH,"Master token expiration timestamp is before the renewal window opens."),MASTERTOKEN_SESSIONDATA_MISSING:new a(1003,
d.ENTITY_REAUTH,"No master token session data found."),MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_RANGE:new a(1004,d.ENTITY_REAUTH,"Master token sequence number is out of range."),MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(1005,d.ENTITY_REAUTH,"Master token serial number is out of range."),MASTERTOKEN_TOKENDATA_INVALID:new a(1006,d.ENTITY_REAUTH,"Invalid master token data."),MASTERTOKEN_SIGNATURE_INVALID:new a(1007,d.ENTITY_REAUTH,"Invalid master token signature."),MASTERTOKEN_SESSIONDATA_INVALID:new a(1008,
d.ENTITY_REAUTH,"Invalid master token session data."),MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_SYNC:new a(1009,d.ENTITY_REAUTH,"Master token sequence number does not have the expected value."),MASTERTOKEN_TOKENDATA_MISSING:new a(1010,d.ENTITY_REAUTH,"No master token data found."),MASTERTOKEN_TOKENDATA_PARSE_ERROR:new a(1011,d.ENTITY_REAUTH,"Error parsing master token data."),MASTERTOKEN_SESSIONDATA_PARSE_ERROR:new a(1012,d.ENTITY_REAUTH,"Error parsing master token session data."),MASTERTOKEN_IDENTITY_REVOKED:new a(1013,
d.ENTITY_REAUTH,"Master token entity identity is revoked."),MASTERTOKEN_REJECTED_BY_APP:new a(1014,d.ENTITY_REAUTH,"Master token is rejected by the application."),USERIDTOKEN_MASTERTOKEN_MISMATCH:new a(2E3,d.USER_REAUTH,"User ID token master token serial number does not match master token serial number."),USERIDTOKEN_NOT_DECRYPTED:new a(2001,d.USER_REAUTH,"User ID token is not decrypted or verified."),USERIDTOKEN_MASTERTOKEN_NULL:new a(2002,d.USER_REAUTH,"User ID token requires a master token."),
USERIDTOKEN_EXPIRES_BEFORE_RENEWAL:new a(2003,d.USER_REAUTH,"User ID token expiration timestamp is before the renewal window opens."),USERIDTOKEN_USERDATA_MISSING:new a(2004,d.USER_REAUTH,"No user ID token user data found."),USERIDTOKEN_MASTERTOKEN_NOT_FOUND:new a(2005,d.USER_REAUTH,"User ID token is bound to an unknown master token."),USERIDTOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(2006,d.USER_REAUTH,"User ID token master token serial number is out of range."),USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(2007,
d.USER_REAUTH,"User ID token serial number is out of range."),USERIDTOKEN_TOKENDATA_INVALID:new a(2008,d.USER_REAUTH,"Invalid user ID token data."),USERIDTOKEN_SIGNATURE_INVALID:new a(2009,d.USER_REAUTH,"Invalid user ID token signature."),USERIDTOKEN_USERDATA_INVALID:new a(2010,d.USER_REAUTH,"Invalid user ID token user data."),USERIDTOKEN_IDENTITY_INVALID:new a(2011,d.USER_REAUTH,"Invalid user ID token user identity."),RESERVED_2012:new a(2012,d.USER_REAUTH,"The entity is not associated with the user."),
USERIDTOKEN_IDENTITY_NOT_FOUND:new a(2013,d.USER_REAUTH,"The user identity was not found."),USERIDTOKEN_PASSWORD_VERSION_CHANGED:new a(2014,d.USER_REAUTH,"The user identity must be reauthenticated because the password version changed."),USERIDTOKEN_USERAUTH_DATA_MISMATCH:new a(2015,d.USER_REAUTH,"The user ID token and user authentication data user identities do not match."),USERIDTOKEN_TOKENDATA_MISSING:new a(2016,d.USER_REAUTH,"No user ID token data found."),USERIDTOKEN_TOKENDATA_PARSE_ERROR:new a(2017,
d.USER_REAUTH,"Error parsing user ID token data."),USERIDTOKEN_USERDATA_PARSE_ERROR:new a(2018,d.USER_REAUTH,"Error parsing user ID token user data."),USERIDTOKEN_REVOKED:new a(2019,d.USER_REAUTH,"User ID token is revoked."),USERIDTOKEN_REJECTED_BY_APP:new a(2020,d.USER_REAUTH,"User ID token is rejected by the application."),SERVICETOKEN_MASTERTOKEN_MISMATCH:new a(3E3,d.FAIL,"Service token master token serial number does not match master token serial number."),SERVICETOKEN_USERIDTOKEN_MISMATCH:new a(3001,
d.FAIL,"Service token user ID token serial number does not match user ID token serial number."),SERVICETOKEN_SERVICEDATA_INVALID:new a(3002,d.FAIL,"Service token data invalid."),SERVICETOKEN_MASTERTOKEN_NOT_FOUND:new a(3003,d.FAIL,"Service token is bound to an unknown master token."),SERVICETOKEN_USERIDTOKEN_NOT_FOUND:new a(3004,d.FAIL,"Service token is bound to an unknown user ID token."),SERVICETOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(3005,d.FAIL,"Service token master token serial number is out of range."),
SERVICETOKEN_USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(3006,d.FAIL,"Service token user ID token serial number is out of range."),SERVICETOKEN_TOKENDATA_INVALID:new a(3007,d.FAIL,"Invalid service token data."),SERVICETOKEN_SIGNATURE_INVALID:new a(3008,d.FAIL,"Invalid service token signature."),SERVICETOKEN_TOKENDATA_MISSING:new a(3009,d.FAIL,"No service token data found."),UNIDENTIFIED_ENTITYAUTH_SCHEME:new a(4E3,d.FAIL,"Unable to identify entity authentication scheme."),ENTITYAUTH_FACTORY_NOT_FOUND:new a(4001,
d.FAIL,"No factory registered for entity authentication scheme."),X509CERT_PARSE_ERROR:new a(4002,d.ENTITYDATA_REAUTH,"Error parsing X.509 certificate data."),X509CERT_ENCODE_ERROR:new a(4003,d.ENTITYDATA_REAUTH,"Error encoding X.509 certificate data."),X509CERT_VERIFICATION_FAILED:new a(4004,d.ENTITYDATA_REAUTH,"X.509 certificate verification failed."),ENTITY_NOT_FOUND:new a(4005,d.FAIL,"Entity not recognized."),INCORRECT_ENTITYAUTH_DATA:new a(4006,d.FAIL,"Entity used incorrect entity authentication data type."),
RSA_PUBLICKEY_NOT_FOUND:new a(4007,d.ENTITYDATA_REAUTH,"RSA public key not found."),NPTICKET_GRACE_PERIOD_EXCEEDED:new a(4008,d.ENTITYDATA_REAUTH,"Fake NP-Tickets cannot be used after the grace period when the Playstation Network is up."),NPTICKET_SERVICE_ID_MISSING:new a(4009,d.ENTITYDATA_REAUTH,"NP-Ticket service ID is missing."),NPTICKET_SERVICE_ID_DISALLOWED:new a(4010,d.ENTITYDATA_REAUTH,"NP-Ticket service ID is not allowed."),NPTICKET_NOT_YET_VALID:new a(4011,d.ENTITYDATA_REAUTH,"NP-Ticket issuance date is in the future."),
NPTICKET_EXPIRED:new a(4012,d.ENTITYDATA_REAUTH,"NP-Ticket has expired."),NPTICKET_PRIVATE_KEY_NOT_FOUND:new a(4013,d.ENTITYDATA_REAUTH,"No private key found for NP-Ticket GUID."),NPTICKET_COOKIE_VERIFICATION_FAILED:new a(4014,d.ENTITYDATA_REAUTH,"NP-Ticket cookie signature verification failed."),NPTICKET_INCORRECT_COOKIE_VERSION:new a(4015,d.ENTITYDATA_REAUTH,"Incorrect NP-Ticket cookie version."),NPTICKET_BROKEN:new a(4016,d.ENTITYDATA_REAUTH,"NP-Ticket broken."),NPTICKET_VERIFICATION_FAILED:new a(4017,
d.ENTITYDATA_REAUTH,"NP-Ticket signature verification failed."),NPTICKET_ERROR:new a(4018,d.ENTITYDATA_REAUTH,"Unknown NP-Ticket TCM error."),NPTICKET_CIPHER_INFO_NOT_FOUND:new a(4019,d.ENTITYDATA_REAUTH,"No cipher information found for NP-Ticket."),NPTICKET_INVALID_CIPHER_INFO:new a(4020,d.ENTITYDATA_REAUTH,"Cipher information for NP-Ticket is invalid."),NPTICKET_UNSUPPORTED_VERSION:new a(4021,d.ENTITYDATA_REAUTH,"Unsupported NP-Ticket version."),NPTICKET_INCORRECT_KEY_LENGTH:new a(4022,d.ENTITYDATA_REAUTH,
"Incorrect NP-Ticket public key length."),UNSUPPORTED_ENTITYAUTH_DATA:new a(4023,d.FAIL,"Unsupported entity authentication data."),CRYPTEX_RSA_KEY_SET_NOT_FOUND:new a(4024,d.FAIL,"Cryptex RSA key set not found."),ENTITY_REVOKED:new a(4025,d.FAIL,"Entity is revoked."),ENTITY_REJECTED_BY_APP:new a(4026,d.ENTITYDATA_REAUTH,"Entity is rejected by the application."),FORCE_LOGIN:new a(5E3,d.USERDATA_REAUTH,"User must login again."),NETFLIXID_COOKIES_EXPIRED:new a(5001,d.USERDATA_REAUTH,"Netflix ID cookie identity has expired."),
NETFLIXID_COOKIES_BLANK:new a(5002,d.USERDATA_REAUTH,"Netflix ID or Secure Netflix ID cookie is blank."),UNIDENTIFIED_USERAUTH_SCHEME:new a(5003,d.FAIL,"Unable to identify user authentication scheme."),USERAUTH_FACTORY_NOT_FOUND:new a(5004,d.FAIL,"No factory registered for user authentication scheme."),EMAILPASSWORD_BLANK:new a(5005,d.USERDATA_REAUTH,"Email or password is blank."),AUTHMGR_COMMS_FAILURE:new a(5006,d.TRANSIENT_FAILURE,"Error communicating with authentication manager."),EMAILPASSWORD_INCORRECT:new a(5007,
d.USERDATA_REAUTH,"Email or password is incorrect."),UNSUPPORTED_USERAUTH_DATA:new a(5008,d.FAIL,"Unsupported user authentication data."),SSOTOKEN_BLANK:new a(5009,d.SSOTOKEN_REJECTED,"SSO token is blank."),SSOTOKEN_NOT_ASSOCIATED:new a(5010,d.USERDATA_REAUTH,"SSO token is not associated with a Netflix user."),USERAUTH_USERIDTOKEN_INVALID:new a(5011,d.USERDATA_REAUTH,"User authentication data user ID token is invalid."),PROFILEID_BLANK:new a(5012,d.USERDATA_REAUTH,"Profile ID is blank."),UNIDENTIFIED_USERAUTH_MECHANISM:new a(5013,
d.FAIL,"Unable to identify user authentication mechanism."),UNSUPPORTED_USERAUTH_MECHANISM:new a(5014,d.FAIL,"Unsupported user authentication mechanism."),SSOTOKEN_INVALID:new a(5015,d.SSOTOKEN_REJECTED,"SSO token invalid."),USERAUTH_MASTERTOKEN_MISSING:new a(5016,d.USERDATA_REAUTH,"User authentication required master token is missing."),ACCTMGR_COMMS_FAILURE:new a(5017,d.TRANSIENT_FAILURE,"Error communicating with the account manager."),SSO_ASSOCIATION_FAILURE:new a(5018,d.TRANSIENT_FAILURE,"SSO user association failed."),
SSO_DISASSOCIATION_FAILURE:new a(5019,d.TRANSIENT_FAILURE,"SSO user disassociation failed."),MDX_USERAUTH_VERIFICATION_FAILED:new a(5020,d.USERDATA_REAUTH,"MDX user authentication data verification failed."),USERAUTH_USERIDTOKEN_NOT_DECRYPTED:new a(5021,d.USERDATA_REAUTH,"User authentication data user ID token is not decrypted or verified."),MDX_USERAUTH_ACTION_INVALID:new a(5022,d.USERDATA_REAUTH,"MDX user authentication data action is invalid."),CTICKET_DECRYPT_ERROR:new a(5023,d.USERDATA_REAUTH,
"CTicket decryption failed."),USERAUTH_MASTERTOKEN_INVALID:new a(5024,d.USERDATA_REAUTH,"User authentication data master token is invalid."),USERAUTH_MASTERTOKEN_NOT_DECRYPTED:new a(5025,d.USERDATA_REAUTH,"User authentication data master token is not decrypted or verified."),CTICKET_CRYPTOCONTEXT_ERROR:new a(5026,d.USERDATA_REAUTH,"Error creating CTicket crypto context."),MDX_PIN_BLANK:new a(5027,d.USERDATA_REAUTH,"MDX controller or target PIN is blank."),MDX_PIN_MISMATCH:new a(5028,d.USERDATA_REAUTH,
"MDX controller and target PIN mismatch."),MDX_USER_UNKNOWN:new a(5029,d.USERDATA_REAUTH,"MDX controller user ID token or CTicket is not decrypted or verified."),USERAUTH_USERIDTOKEN_MISSING:new a(5030,d.USERDATA_REAUTH,"User authentication required user ID token is missing."),MDX_CONTROLLERDATA_INVALID:new a(5031,d.USERDATA_REAUTH,"MDX controller authentication data is invalid."),USERAUTH_ENTITY_MISMATCH:new a(5032,d.USERDATA_REAUTH,"User authentication data does not match entity identity."),USERAUTH_INCORRECT_DATA:new a(5033,
d.FAIL,"Entity used incorrect key request data type"),SSO_ASSOCIATION_WITH_NONMEMBER:new a(5034,d.USERDATA_REAUTH,"SSO user association failed because the customer is not a member."),SSO_ASSOCIATION_WITH_FORMERMEMBER:new a(5035,d.USERDATA_REAUTH,"SSO user association failed because the customer is a former member."),SSO_ASSOCIATION_CONFLICT:new a(5036,d.USERDATA_REAUTH,"SSO user association failed because the token identifies a different member."),USER_REJECTED_BY_APP:new a(5037,d.USERDATA_REAUTH,
"User is rejected by the application."),PROFILE_SWITCH_DISALLOWED:new a(5038,d.TRANSIENT_FAILURE,"Unable to switch user profile."),MEMBERSHIPCLIENT_COMMS_FAILURE:new a(5039,d.TRANSIENT_FAILURE,"Error communicating with the membership manager."),USERIDTOKEN_IDENTITY_NOT_ASSOCIATED_WITH_ENTITY:new a(5040,d.USER_REAUTH,"The entity is not associated with the user."),UNSUPPORTED_COMPRESSION:new a(6E3,d.FAIL,"Unsupported compression algorithm."),COMPRESSION_ERROR:new a(6001,d.FAIL,"Error compressing data."),
UNCOMPRESSION_ERROR:new a(6002,d.FAIL,"Error uncompressing data."),MESSAGE_ENTITY_NOT_FOUND:new a(6003,d.FAIL,"Message header entity authentication data or master token not found."),PAYLOAD_MESSAGE_ID_MISMATCH:new a(6004,d.FAIL,"Payload chunk message ID does not match header message ID ."),PAYLOAD_SEQUENCE_NUMBER_MISMATCH:new a(6005,d.FAIL,"Payload chunk sequence number does not match expected sequence number."),PAYLOAD_VERIFICATION_FAILED:new a(6006,d.FAIL,"Payload chunk payload signature verification failed."),
MESSAGE_DATA_MISSING:new a(6007,d.FAIL,"No message data found."),MESSAGE_FORMAT_ERROR:new a(6008,d.FAIL,"Malformed message data."),MESSAGE_VERIFICATION_FAILED:new a(6009,d.FAIL,"Message header/error data signature verification failed."),HEADER_DATA_MISSING:new a(6010,d.FAIL,"No header data found."),PAYLOAD_DATA_MISSING:new a(6011,d.FAIL,"No payload data found in non-EOM payload chunk."),PAYLOAD_DATA_CORRUPT:new a(6012,d.FAIL,"Corrupt payload data found in non-EOM payload chunk."),UNIDENTIFIED_COMPRESSION:new a(6013,
d.FAIL,"Unidentified compression algorithm."),MESSAGE_EXPIRED:new a(6014,d.EXPIRED,"Message expired and not renewable. Rejected."),MESSAGE_ID_OUT_OF_RANGE:new a(6015,d.FAIL,"Message ID is out of range."),INTERNAL_CODE_NEGATIVE:new a(6016,d.FAIL,"Error header internal code is negative."),UNEXPECTED_RESPONSE_MESSAGE_ID:new a(6017,d.FAIL,"Unexpected response message ID. Possible replay."),RESPONSE_REQUIRES_ENCRYPTION:new a(6018,d.KEYX_REQUIRED,"Message response requires encryption."),PAYLOAD_SEQUENCE_NUMBER_OUT_OF_RANGE:new a(6019,
d.FAIL,"Payload chunk sequence number is out of range."),PAYLOAD_MESSAGE_ID_OUT_OF_RANGE:new a(6020,d.FAIL,"Payload chunk message ID is out of range."),MESSAGE_REPLAYED:new a(6021,d.REPLAYED,"Non-replayable message replayed."),INCOMPLETE_NONREPLAYABLE_MESSAGE:new a(6022,d.FAIL,"Non-replayable message sent non-renewable or without key request data or without a master token."),HEADER_SIGNATURE_INVALID:new a(6023,d.FAIL,"Invalid Header signature."),HEADER_DATA_INVALID:new a(6024,d.FAIL,"Invalid header data."),
PAYLOAD_INVALID:new a(6025,d.FAIL,"Invalid payload."),PAYLOAD_SIGNATURE_INVALID:new a(6026,d.FAIL,"Invalid payload signature."),RESPONSE_REQUIRES_MASTERTOKEN:new a(6027,d.KEYX_REQUIRED,"Message response requires a master token."),RESPONSE_REQUIRES_USERIDTOKEN:new a(6028,d.USER_REAUTH,"Message response requires a user ID token."),REQUEST_REQUIRES_USERAUTHDATA:new a(6029,d.FAIL,"User-associated message requires user authentication data."),UNEXPECTED_MESSAGE_SENDER:new a(6030,d.FAIL,"Message sender is equal to the local entity or not the master token entity."),
NONREPLAYABLE_MESSAGE_REQUIRES_MASTERTOKEN:new a(6031,d.FAIL,"Non-replayable message requires a master token."),NONREPLAYABLE_ID_OUT_OF_RANGE:new a(6032,d.FAIL,"Non-replayable message non-replayable ID is out of range."),MESSAGE_SERVICETOKEN_MISMATCH:new a(6033,d.FAIL,"Service token master token or user ID token serial number does not match the message token serial numbers."),MESSAGE_PEER_SERVICETOKEN_MISMATCH:new a(6034,d.FAIL,"Peer service token master token or user ID token serial number does not match the message peer token serial numbers."),
RESPONSE_REQUIRES_INTEGRITY_PROTECTION:new a(6035,d.KEYX_REQUIRED,"Message response requires integrity protection."),HANDSHAKE_DATA_MISSING:new a(6036,d.FAIL,"Handshake message is not renewable or does not contain key request data."),MESSAGE_RECIPIENT_MISMATCH:new a(6037,d.FAIL,"Message recipient does not match local identity."),UNIDENTIFIED_KEYX_SCHEME:new a(7E3,d.FAIL,"Unable to identify key exchange scheme."),KEYX_FACTORY_NOT_FOUND:new a(7001,d.FAIL,"No factory registered for key exchange scheme."),
KEYX_REQUEST_NOT_FOUND:new a(7002,d.FAIL,"No key request found matching header key response data."),UNIDENTIFIED_KEYX_KEY_ID:new a(7003,d.FAIL,"Unable to identify key exchange key ID."),UNSUPPORTED_KEYX_KEY_ID:new a(7004,d.FAIL,"Unsupported key exchange key ID."),UNIDENTIFIED_KEYX_MECHANISM:new a(7005,d.FAIL,"Unable to identify key exchange mechanism."),UNSUPPORTED_KEYX_MECHANISM:new a(7006,d.FAIL,"Unsupported key exchange mechanism."),KEYX_RESPONSE_REQUEST_MISMATCH:new a(7007,d.FAIL,"Key exchange response does not match request."),
KEYX_PRIVATE_KEY_MISSING:new a(7008,d.FAIL,"Key exchange private key missing."),UNKNOWN_KEYX_PARAMETERS_ID:new a(7009,d.FAIL,"Key exchange parameters ID unknown or invalid."),KEYX_MASTER_TOKEN_MISSING:new a(7010,d.FAIL,"Master token required for key exchange is missing."),KEYX_INVALID_PUBLIC_KEY:new a(7011,d.FAIL,"Key exchange public key is invalid."),KEYX_PUBLIC_KEY_MISSING:new a(7012,d.FAIL,"Key exchange public key missing."),KEYX_WRAPPING_KEY_MISSING:new a(7013,d.FAIL,"Key exchange wrapping key missing."),
KEYX_WRAPPING_KEY_ID_MISSING:new a(7014,d.FAIL,"Key exchange wrapping key ID missing."),KEYX_INVALID_WRAPPING_KEY:new a(7015,d.FAIL,"Key exchange wrapping key is invalid."),KEYX_INCORRECT_DATA:new a(7016,d.FAIL,"Entity used incorrect wrapping key data type"),CRYPTEX_ENCRYPTION_ERROR:new a(8E3,d.FAIL,"Error encrypting data with cryptex."),CRYPTEX_DECRYPTION_ERROR:new a(8001,d.FAIL,"Error decrypting data with cryptex."),CRYPTEX_MAC_ERROR:new a(8002,d.FAIL,"Error computing MAC with cryptex."),CRYPTEX_VERIFY_ERROR:new a(8003,
d.FAIL,"Error verifying MAC with cryptex."),CRYPTEX_CONTEXT_CREATION_FAILURE:new a(8004,d.FAIL,"Error creating cryptex cipher or MAC context."),DATAMODEL_DEVICE_ACCESS_ERROR:new a(8005,d.TRANSIENT_FAILURE,"Error accessing data model device."),DATAMODEL_DEVICETYPE_NOT_FOUND:new a(8006,d.FAIL,"Data model device type not found."),CRYPTEX_KEYSET_UNSUPPORTED:new a(8007,d.FAIL,"Cryptex key set not supported."),CRYPTEX_PRIVILEGE_EXCEPTION:new a(8008,d.FAIL,"Insufficient privileges for cryptex operation."),
CRYPTEX_WRAP_ERROR:new a(8009,d.FAIL,"Error wrapping data with cryptex."),CRYPTEX_UNWRAP_ERROR:new a(8010,d.FAIL,"Error unwrapping data with cryptex."),CRYPTEX_COMMS_FAILURE:new a(8011,d.TRANSIENT_FAILURE,"Error comunicating with cryptex."),CRYPTEX_SIGN_ERROR:new a(8012,d.FAIL,"Error computing signature with cryptex."),INTERNAL_EXCEPTION:new a(9E3,d.TRANSIENT_FAILURE,"Internal exception."),MSL_COMMS_FAILURE:new a(9001,d.FAIL,"Error communicating with MSL entity."),NONE:new a(9999,d.FAIL,"Special unit test error.")});
Object.freeze(a);var F;(function(){F=ca.Class.create(Error());F.mixin({init:function(a,b,c){function f(){return h?h:this.cause&&this.cause instanceof F?this.cause.messageId:K}Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var d=a.message;b&&(d+=" ["+b+"]");var h,g=this.stack;Object.defineProperties(this,{message:{value:d,writable:!1,configurable:!0},error:{value:a,writable:!1,configurable:!0},cause:{value:c,writable:!1,configurable:!0},name:{value:"MslException",writable:!1,
configurable:!0},masterToken:{value:null,writable:!0,configurable:!1},entityAuthenticationData:{value:null,writable:!0,configurable:!1},userIdToken:{value:null,writable:!0,configurable:!1},userAuthenticationData:{value:null,writable:!0,configurable:!1},messageId:{get:f,set:function(a){if(0>a||a>Ia)throw new RangeError("Message ID "+a+" is outside the valid range.");f()||(h=a)},configurable:!0},stack:{get:function(){var a=this.toString();g&&(a+="\n"+g);c&&c.stack&&(a+="\nCaused by "+c.stack);return a},
configurable:!0}})},setEntity:function(a){!a||this.masterToken||this.entityAuthenticationData||(a instanceof Xb?this.masterToken=a:a instanceof Hc&&(this.entityAuthenticationData=a));return this},setUser:function(a){!a||this.userIdToken||this.userAuthenticationData||(a instanceof td?this.userIdToken=a:a instanceof dd&&(this.userAuthenticationData=a));return this},setMessageId:function(a){this.messageId=a;return this},toString:function(){return this.name+": "+this.message}})})();var V=F.extend({init:function Fg(a,
b,c){Fg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslCryptoException",writable:!1,configurable:!0}})}}),aa=F.extend({init:function Gg(a,b,c){Gg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslEncodingException",writable:!1,configurable:!0}})}}),tc=F.extend({init:function Be(a,b,c){Be.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslEntityAuthException",writable:!1,configurable:!0}})}}),Db;(function(){Db=ca.Class.create(Error());Db.mixin({init:function(a,
b,c){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var f=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},requestCause:{value:c,writable:!1,configurable:!1},name:{value:"MslErrorResponseException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();f&&(a+="\n"+f);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+": "+
this.message}})})();var pb;(function(){pb=ca.Class.create(Error());pb.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslIoException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+
": "+this.message}})})();var R;(function(){R=ca.Class.create(Error());R.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslInternalException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+
": "+this.message}})})();var sb;(function(){sb=ca.Class.create(Error());sb.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslInterruptedException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},
toString:function(){return this.name+": "+this.message}})})();var Qa=F.extend({init:function Hg(a,b,c){Hg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslKeyExchangeException",writable:!1,configurable:!0}})}}),oc=F.extend({init:function Ig(a,b){Ig.base.call(this,a);Object.defineProperties(this,{masterToken:{value:b,writable:!1,configurable:!1},name:{value:"MslMasterTokenException",writable:!1,configurable:!0}})}}),Ba=F.extend({init:function Ed(a,b,c){Ed.base.call(this,a,b,c);Object.defineProperties(this,
{name:{value:"MslMessageException",writable:!1,configurable:!0}})}}),Ma=F.extend({init:function Q(a,b,c){Q.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslUserAuthException",writable:!1,configurable:!0}})}}),qa,Ca,ed;(function(){function a(b){return"undefined"===typeof b?!1:b}function b(a){return a&&a.length?(Ca===d.V2014_02&&(a=a.map(function(a){return"wrap"==a?"wrapKey":"unwrap"==a?"unwrapKey":a})),a):Ca===d.V2014_02?"encrypt decrypt sign verify deriveKey wrapKey unwrapKey".split(" "):
"encrypt decrypt sign verify deriveKey wrap unwrap".split(" ")}function c(a,b,k,l,u){return Promise.resolve().then(function(){return B.importKey(a,b,k,l,u)}).catch(function(c){if("spki"!==a&&"pkcs8"!==a)throw c;c=ASN1.webCryptoAlgorithmToJwkAlg(k);var D=ASN1.webCryptoUsageToJwkKeyOps(u);c=ASN1.rsaDerToJwk(b,c,D,l);if(!c)throw Error("Could not make valid JWK from DER input");c=JSON.stringify(c);return B.importKey("jwk",M(c),k,l,u)})}function f(a,b){return Promise.resolve().then(function(){return B.exportKey(a,
b)}).catch(function(k){if("spki"!==a&&"pkcs8"!==a)throw k;return B.exportKey("jwk",b).then(function(a){a=JSON.parse(z(new Uint8Array(a)));a=ASN1.jwkToRsaDer(a);if(!a)throw Error("Could not make valid DER from JWK input");return a.getDer().buffer})})}var d=ed={LEGACY:1,V2014_01:2,V2014_02:3,LATEST:3};Object.freeze(ed);Ca=d.LATEST;qa={encrypt:function(a,b,k){switch(Ca){case d.LEGACY:return new Promise(function(l,c){var r=B.encrypt(a,b,k);r.oncomplete=function(a){l(a.target.result)};r.onerror=function(a){c(a)}});
case d.V2014_01:case d.V2014_02:return B.encrypt(a,b,k).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},decrypt:function(a,b,k){switch(Ca){case d.LEGACY:return new Promise(function(l,c){var r=B.decrypt(a,b,k);r.oncomplete=function(a){l(a.target.result)};r.onerror=function(a){c(a)}});case d.V2014_01:case d.V2014_02:return B.decrypt(a,b,k).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},sign:function(a,b,k){switch(Ca){case d.LEGACY:return new Promise(function(l,c){var r=B.sign(a,b,k);r.oncomplete=function(a){l(a.target.result)};r.onerror=function(a){c(a)}});case d.V2014_01:case d.V2014_02:return B.sign(a,b,k).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},verify:function(a,b,k,l){switch(Ca){case d.LEGACY:return new Promise(function(c,r){var f=B.verify(a,b,k,l);f.oncomplete=function(a){c(a.target.result)};
f.onerror=function(a){r(a)}});case d.V2014_01:case d.V2014_02:return B.verify(a,b,k,l);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},digest:function(a,b){switch(Ca){case d.LEGACY:return new Promise(function(k,l){var c=B.digest(a,b);c.oncomplete=function(a){k(a.target.result)};c.onerror=function(a){l(a)}});case d.V2014_01:case d.V2014_02:return B.digest(a,b).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+
".");}},generateKey:function(c,m,k){var l=a(m),u=b(k);switch(Ca){case d.LEGACY:return new Promise(function(a,k){var b=B.generateKey(c,l,u);b.oncomplete=function(k){a(k.target.result)};b.onerror=function(a){k(a)}});case d.V2014_01:case d.V2014_02:return B.generateKey(c,l,u);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},deriveKey:function(c,m,k,l,u){var r=a(l),f=b(u);switch(Ca){case d.LEGACY:return new Promise(function(a,b){var l=B.deriveKey(c,m,k,r,f);l.oncomplete=
function(k){a(k.target.result)};l.onerror=function(a){b(a)}});case d.V2014_01:case d.V2014_02:return B.deriveKey(c,m,k,r,f);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},importKey:function(f,m,k,l,u){var r=a(l),D=b(u);switch(Ca){case d.LEGACY:return new Promise(function(a,b){var l=B.importKey(f,m,k,r,D);l.oncomplete=function(k){a(k.target.result)};l.onerror=function(a){b(a)}});case d.V2014_01:case d.V2014_02:return c(f,m,k,r,D);default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},exportKey:function(a,b){switch(Ca){case d.LEGACY:return new Promise(function(k,l){var c=B.exportKey(a,b);c.oncomplete=function(a){k(a.target.result)};c.onerror=function(a){l(a)}});case d.V2014_01:case d.V2014_02:return f(a,b).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},wrapKey:function(a,b,k,l){switch(Ca){case d.LEGACY:return new Promise(function(a,c){var f=B.wrapKey(b,k,l);f.oncomplete=function(k){a(k.target.result)};
f.onerror=function(a){c(a)}});case d.V2014_01:case d.V2014_02:return B.wrapKey(a,b,k,l).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},unwrapKey:function(c,m,k,l,u,r,f){switch(Ca){case d.LEGACY:return new Promise(function(a,b){var l=B.unwrapKey(m,u,k);l.oncomplete=function(k){a(k.target.result)};l.onerror=function(a){b(a)}});case d.V2014_01:case d.V2014_02:return B.unwrapKey(c,m,k,l,u,a(r),b(f));default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}}};xb&&xb.getKeyByName&&(qa.getKeyByName=function(a){switch(Ca){case d.LEGACY:return new Promise(function(b,k){var l=xb.getKeyByName(a);l.oncomplete=function(a){b(a.target.result)};l.onerror=function(a){k(a)}});case d.V2014_01:case d.V2014_02:return xb.getKeyByName(a);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}})})();var uc={name:"AES-KW"},Kb={name:"AES-CBC"},ta={name:"HMAC",hash:{name:"SHA-256"}},Xa={name:"RSA-OAEP",hash:{name:"SHA-1"}},
mb={name:"RSAES-PKCS1-v1_5"},Sb={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},yb=["encrypt","decrypt"],ja=["wrap","unwrap"],tb=["sign","verify"],Kd,Rb,Ic;(function(){Kd=ca.Class.create({init:function(c,f,d){function h(a){b(f,function(){var b=a?N(a):K;Object.defineProperties(g,{rawKey:{value:c,writable:!1,configurable:!1},keyData:{value:a,writable:!1,configurable:!1},keyDataB64:{value:b,writable:!1,configurable:!1}});return this},g)}var g=this;b(f,function(){if(!c||"object"!=typeof c)throw new V(a.INVALID_SYMMETRIC_KEY);
!d&&c.extractable?qa.exportKey("raw",c).then(function(a){h(new Uint8Array(a))},function(b){f.error(new V(a.KEY_EXPORT_ERROR,"raw"))}):h(d)},g)},size:function(){return this.keyData.length},toByteArray:function(){return this.keyData},toBase64:function(){return this.keyDataB64}});Rb=function(a,b){new Kd(a,b)};Ic=function(c,f,d,h){b(h,function(){try{c="string"==typeof c?T(c):c}catch(b){throw new V(a.INVALID_SYMMETRIC_KEY,"keydata "+c,b);}qa.importKey("raw",c,f,!0,d).then(function(a){new Kd(a,h,c)},function(b){h.error(new V(a.INVALID_SYMMETRIC_KEY))})})}})();
var Ld,Wb,de;(function(){Ld=ca.Class.create({init:function(c,f,d){function h(a){b(f,function(){Object.defineProperties(g,{rawKey:{value:c,writable:!1,configurable:!1},encoded:{value:a,writable:!1,configurable:!1}});return this},g)}var g=this;b(f,function(){if(!c||"object"!=typeof c||"public"!=c.type)throw new TypeError("Only original public crypto keys are supported.");!d&&c.extractable?qa.exportKey("spki",c).then(function(a){h(new Uint8Array(a))},function(b){f.error(new V(a.KEY_EXPORT_ERROR,"spki"))}):
h(d)})},getEncoded:function(){return this.encoded}});Wb=function(a,b){new Ld(a,b)};de=function(c,f,d,h){b(h,function(){try{c="string"==typeof c?T(c):c}catch(b){throw new V(a.INVALID_PUBLIC_KEY,"spki "+c,b);}qa.importKey("spki",c,f,!0,d).then(function(a){new Ld(a,h,c)},function(b){h.error(new V(a.INVALID_PUBLIC_KEY))})})}})();var Ee,rb;(function(){Ee=ca.Class.create({init:function(c,f,d){function h(a){b(f,function(){Object.defineProperties(g,{rawKey:{value:c,writable:!1,configurable:!1},encoded:{value:a,
writable:!1,configurable:!1}});return this},g)}var g=this;b(f,function(){if(!c||"object"!=typeof c||"private"!=c.type)throw new TypeError("Only original private crypto keys are supported.");!d&&c.extractable?qa.exportKey("pkcs8",c).then(function(a){h(new Uint8Array(a))},function(b){f.error(new V(a.KEY_EXPORT_ERROR,"pkcs8"))}):h(d)})},getEncoded:function(){return this.encoded}});rb=function(a,b){new Ee(a,b)}})();var Fe,Va,ee,Jc;(function(){var c=Jc={V1:1,V2:2};Fe=ca.Class.create({init:function(a,f,
d,h){b(h,function(){var b=c.V1,m=a,k=null,l;for(l in sd)if(sd[l]==a){b=c.V2;m=null;k=a;break}Object.defineProperties(this,{version:{value:b,writable:!1,enumerable:!1,configurable:!1},keyId:{value:m,writable:!1,configurable:!1},cipherSpec:{value:k,writable:!1,configurable:!1},iv:{value:f,writable:!1,configurable:!1},ciphertext:{value:d,writable:!1,configurable:!1}});return this},this)},toJSON:function(){var a={};switch(this.version){case c.V1:a.keyid=this.keyId;this.iv&&(a.iv=N(this.iv));a.ciphertext=
N(this.ciphertext);a.sha256="AA==";break;case c.V2:a.version=this.version;a.cipherspec=this.cipherSpec;this.iv&&(a.iv=N(this.iv));a.ciphertext=N(this.ciphertext);break;default:throw new R("Ciphertext envelope version "+this.version+" encoding unsupported.");}return a}});Va=function(a,b,c,f){new Fe(a,b,c,f)};ee=function(f,d,h){b(h,function(){var b=f.keyid,w=f.cipherspec,m=f.iv,k=f.ciphertext,l=f.sha256;if(!d)if((d=f.version)&&"number"===typeof d&&d===d){var u=!1,r;for(r in c)if(c[r]==d){u=!0;break}if(!u)throw new V(a.UNIDENTIFIED_CIPHERTEXT_ENVELOPE,
"ciphertext envelope "+JSON.stringify(f));}else d=c.V1;switch(d){case c.V1:if("string"!==typeof b||m&&"string"!==typeof m||"string"!==typeof k||"string"!==typeof l)throw new aa(a.JSON_PARSE_ERROR,"ciphertext envelope "+JSON.stringify(f));break;case c.V2:r=f.version;if(r!=c.V2)throw new V(a.UNIDENTIFIED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(f));if("string"!==typeof w||m&&"string"!==typeof m||"string"!==typeof k)throw new aa(a.JSON_PARSE_ERROR,"ciphertext envelope "+JSON.stringify(f));
w=Ef(w);if(!w)throw new V(a.UNIDENTIFIED_CIPHERSPEC,"ciphertext envelope "+JSON.stringify(f));b=w;break;default:throw new V(a.UNSUPPORTED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(f));}try{m&&(m=T(m)),k=T(k)}catch(D){throw new V(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,"encryption envelope "+JSON.stringify(f),D);}new Fe(b,m,k,h)})}})();var vc,Hb,fe,Ge;(function(){var c=Ge={V1:1,V2:2};vc=ca.Class.create({init:function(a,b,f){var d;switch(a){case c.V1:d=f;break;case c.V2:d={};d.version=a;d.algorithm=
b;d.signature=N(f);d=S(JSON.stringify(d),ma);break;default:throw new R("Signature envelope version "+a+" encoding unsupported.");}Object.defineProperties(this,{version:{value:a,writable:!1,enumerable:!1,configurable:!1},algorithm:{value:b,writable:!1,configurable:!1},signature:{value:f,writable:!1,configurable:!1},bytes:{value:d,writable:!1,configurable:!1}})}});Hb=function(){var a,f,d,h;2==arguments.length?(a=c.V1,f=arguments[0],d=null,h=arguments[1]):3==arguments.length&&(a=c.V2,d=arguments[0],
f=arguments[1],h=arguments[2]);b(h,function(){return new vc(a,d,f)})};fe=function(f,d,g){b(g,function(){if(d)switch(d){case c.V1:return new vc(c.V1,null,f);case c.V2:try{var b=h(f,ma),w=JSON.parse(b),m=parseInt(w.version),k=w.algorithm,l=w.signature;if(!m||"number"!==typeof m||m!=m||"string"!==typeof k||"string"!==typeof l)throw new aa(a.JSON_PARSE_ERROR,"signature envelope "+N(f));if(c.V2!=m)throw new V(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+N(f));var u=Jd(k);if(!u)throw new V(a.UNIDENTIFIED_ALGORITHM,
"signature envelope "+N(f));var r=T(l);if(!r)throw new V(a.INVALID_SIGNATURE,"signature envelope "+Base64Util.encode(f));return new vc(c.V2,u,r)}catch(D){if(D instanceof SyntaxError)throw new aa(a.JSON_PARSE_ERROR,"signature envelope "+N(f),D);throw D;}default:throw new V(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+N(f));}try{b=h(f,ma),w=JSON.parse(b)}catch(g){w=null}if(w&&w.version){if(b=w.version,"number"!==typeof b||b!==b)b=c.V1}else b=c.V1;switch(b){case c.V1:return new vc(b,null,f);
case c.V2:u=w.algorithm;l=w.signature;if("string"!==typeof u||"string"!==typeof l)return new vc(c.V1,null,f);u=Jd(u);if(!u)return new vc(c.V1,null,f);try{r=T(l)}catch(E){return new vc(c.V1,null,f)}return new vc(b,u,r);default:throw new V(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+f);}})}})();var ud=ca.Class.create({encrypt:function(a,b){},decrypt:function(a,b){},wrap:function(a,b){},unwrap:function(a,b,c,f){},sign:function(a,b){},verify:function(a,b,c){}}),wc,xc;(function(){var c=xc={RSA_OAEP:Xa.name,
A128KW:uc.name};C="A128GCM";wc=ca.Class.create({init:function(a,b,f,d,w){switch(b){case c.RSA_OAEP:w=w&&(w.rawKey||w);d=d&&(d.rawKey||d);break;case c.A128KW:w=d=d&&(d.rawKey||d);break;default:throw new R("Unsupported algorithm: "+b);}Object.defineProperties(this,{_ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},_algo:{value:b,writable:!1,enumerable:!1,configurable:!1},_enc:{value:f,writable:!1,enumerable:!1,configurable:!1},_wrapKey:{value:w,writable:!1,enumerable:!1,configurable:!1},_unwrapKey:{value:d,
writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(b,c){c.error(new V(a.ENCRYPT_NOT_SUPPORTED))},decrypt:function(b,c){c.error(new V(a.DECRYPT_NOT_SUPPORTED))},wrap:function(c,f){b(f,function(){qa.wrapKey("jwe+jwk",c.rawKey,this._wrapKey,this._wrapKey.algorithm).then(function(a){f.result(a)},function(b){f.error(new V(a.WRAP_ERROR))})},this)},unwrap:function(c,f,d,h){function w(c){b(h,function(){switch(c.type){case "secret":Rb(c,h);break;case "public":Wb(c,h);break;case "private":rb(c,
h);break;default:throw new V(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(h,function(){qa.unwrapKey("jwe+jwk",c,this._unwrapKey,this._unwrapKey.algorithm,f,!1,d).then(function(a){w(a)},function(){h.error(new V(a.UNWRAP_ERROR))})},this)},sign:function(b,c){c.error(new V(a.SIGN_NOT_SUPPORTED))},verify:function(b,c,f){f.error(new V(a.VERIFY_NOT_SUPPORTED))}})})();var Kc=ud.extend({encrypt:function(a,b){b.result(a)},decrypt:function(a,b){b.result(a)},wrap:function(a,b){b.result(a)},unwrap:function(a,b,c,
f){f.result(a)},sign:function(a,b){b.result(new Uint8Array(0))},verify:function(a,b,c){c.result(!0)}}),eb,fc;(function(){var c=fc={ENCRYPT_DECRYPT_OAEP:1,ENCRYPT_DECRYPT_PKCS1:2,WRAP_UNWRAP_OAEP:3,WRAP_UNWRAP_PKCS1:4,SIGN_VERIFY:5};eb=ud.extend({init:function Ta(a,b,f,m,k){Ta.base.call(this);f&&(f=f.rawKey);m&&(m=m.rawKey);Object.defineProperties(this,{id:{value:b,writable:!1,enumerable:!1,configurable:!1},privateKey:{value:f,writable:!1,enumerable:!1,configurable:!1},publicKey:{value:m,writable:!1,
enumerable:!1,configurable:!1},transform:{value:k==c.ENCRYPT_DECRYPT_PKCS1?mb:k==c.ENCRYPT_DECRYPT_OAEP?Xa:"nullOp",writable:!1,enumerable:!1,configurable:!1},wrapTransform:{value:k==c.WRAP_UNWRAP_PKCS1?mb:k==c.WRAP_UNWRAP_OAEP?Xa:"nullOp",writable:!1,enumerable:!1,configurable:!1},algo:{value:k==c.SIGN_VERIFY?Sb:"nullOp",writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(c,f){var d=this;b(f,function(){if("nullOp"==this.transform)return c;if(!this.publicKey)throw new V(a.ENCRYPT_NOT_SUPPORTED,
"no public key");if(0==c.length)return c;qa.encrypt(d.transform,d.publicKey,c).then(function(b){Va(d.id,null,b,{result:function(b){try{var c=JSON.stringify(b);f.result(S(c,ma))}catch(l){f.error(new V(a.ENCRYPT_ERROR,null,l))}},error:function(b){b instanceof F||(b=new V(a.ENCRYPT_ERROR,null,b));f.error(b)}})},function(b){f.error(new V(a.ENCRYPT_ERROR))})},this)},decrypt:function(c,f){var d=this;b(f,function(){if("nullOp"==this.transform)return c;if(!this.privateKey)throw new V(a.DECRYPT_NOT_SUPPORTED,
"no private key");if(0==c.length)return c;var b;try{var m=h(c,ma);b=JSON.parse(m)}catch(k){if(k instanceof SyntaxError)throw new V(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,null,k);throw new V(a.DECRYPT_ERROR,null,k);}ee(b,Jc.V1,{result:function(b){try{if(b.keyId!=d.id)throw new V(a.ENVELOPE_KEY_ID_MISMATCH);var c=f.result;qa.decrypt(d.transform,d.privateKey,b.ciphertext).then(c,function(b){f.error(new V(a.DECRYPT_ERROR))})}catch(k){k instanceof F?f.error(k):f.error(new V(a.DECRYPT_ERROR,null,k))}},error:function(b){b instanceof
aa&&(b=new V(a.CIPHERTEXT_ENVELOPE_ENCODE_ERROR,null,b));b instanceof F||(b=new V(a.DECRYPT_ERROR,null,b));f.error(b)}})},this)},wrap:function(c,f){b(f,function(){if("nullOp"==this.wrapTransform||!this.publicKey)throw new V(a.WRAP_NOT_SUPPORTED,"no public key");var b=f.result;qa.wrapKey("jwk",c.rawKey,this.publicKey,this.wrapTransform).then(b,function(b){f.error(new V(a.WRAP_ERROR))})},this)},unwrap:function(c,f,d,h){function m(c){b(h,function(){switch(c.type){case "secret":Rb(c,h);break;case "public":Wb(c,
h);break;case "private":rb(c,h);break;default:throw new V(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(h,function(){if("nullOp"==this.wrapTransform||!this.privateKey)throw new V(a.UNWRAP_NOT_SUPPORTED,"no private key");qa.unwrapKey("jwk",c,this.privateKey,{name:this.privateKey.algorithm.name,hash:{name:"SHA-1"}},f,!1,d).then(m,function(b){h.error(new V(a.UNWRAP_ERROR))})},this)},sign:function(c,f){b(f,function(){if("nullOp"==this.algo)return new Uint8Array(0);if(!this.privateKey)throw new V(a.SIGN_NOT_SUPPORTED,
"no private key");qa.sign(this.algo,this.privateKey,c).then(function(a){Hb(a,{result:function(a){f.result(a.bytes)},error:f.error})},function(b){f.error(new V(a.SIGNATURE_ERROR))})},this)},verify:function(c,f,d){var h=this;b(d,function(){if("nullOp"==this.algo)return!0;if(!this.publicKey)throw new V(a.VERIFY_NOT_SUPPORTED,"no public key");fe(f,Ge.V1,{result:function(f){b(d,function(){var b=d.result;qa.verify(this.algo,this.publicKey,f.signature,c).then(b,function(b){d.error(new V(a.SIGNATURE_ERROR))})},
h)},error:d.error})},this)}})})();var fd;(function(){fd=ud.extend({init:function dc(a,b,c,f,m){dc.base.call(this);c=c&&c.rawKey;f=f&&f.rawKey;m=m&&m.rawKey;Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},id:{value:b,writable:!1,enumerable:!1,configurable:!1},encryptionKey:{value:c,writable:!1,enumerable:!1,configurable:!1},hmacKey:{value:f,writable:!1,enumerable:!1,configurable:!1},wrapKey:{value:m,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(c,
f){var d=this;b(f,function(){if(!this.encryptionKey)throw new V(a.ENCRYPT_NOT_SUPPORTED,"no encryption/decryption key");if(0==c.length)return c;var b=new Uint8Array(16);this.ctx.getRandom().nextBytes(b);qa.encrypt({name:Kb.name,iv:b},d.encryptionKey,c).then(function(c){c=new Uint8Array(c);Va(d.id,b,c,{result:function(b){try{var c=JSON.stringify(b);f.result(S(c,ma))}catch(l){f.error(new V(a.ENCRYPT_ERROR,null,l))}},error:function(b){b instanceof F||(b=new V(a.ENCRYPT_ERROR,null,b));f.error(b)}})},
function(b){f.error(new V(a.ENCRYPT_ERROR))})},this)},decrypt:function(c,f){var d=this;b(f,function(){if(!this.encryptionKey)throw new V(a.DECRYPT_NOT_SUPPORTED,"no encryption/decryption key");if(0==c.length)return c;var b;try{var g=h(c,ma);b=JSON.parse(g)}catch(m){if(m instanceof SyntaxError)throw new V(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,null,m);throw new V(a.DECRYPT_ERROR,null,m);}ee(b,Jc.V1,{result:function(b){try{if(b.keyId!=d.id)throw new V(a.ENVELOPE_KEY_ID_MISMATCH);qa.decrypt({name:Kb.name,
iv:b.iv},d.encryptionKey,b.ciphertext).then(function(a){a=new Uint8Array(a);f.result(a)},function(){f.error(new V(a.DECRYPT_ERROR))})}catch(c){c instanceof F?f.error(c):f.error(new V(a.DECRYPT_ERROR,null,c))}},error:function(b){b instanceof aa&&(b=new V(a.CIPHERTEXT_ENVELOPE_ENCODE_ERROR,null,b));b instanceof F||(b=new V(a.DECRYPT_ERROR,null,b));f.error(b)}})},this)},wrap:function(c,f){b(f,function(){if(!this.wrapKey)throw new V(a.WRAP_NOT_SUPPORTED,"no wrap/unwrap key");qa.wrapKey("raw",c.rawKey,
this.wrapKey,this.wrapKey.algorithm).then(function(a){f.result(a)},function(b){f.error(new V(a.WRAP_ERROR))})},this)},unwrap:function(c,f,d,h){function g(c){b(h,function(){switch(c.type){case "secret":Rb(c,h);break;case "public":Wb(c,h);break;case "private":rb(c,h);break;default:throw new V(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(h,function(){if(!this.wrapKey)throw new V(a.UNWRAP_NOT_SUPPORTED,"no wrap/unwrap key");qa.unwrapKey("raw",c,this.wrapKey,this.wrapKey.algorithm,f,!1,d).then(function(a){g(a)},
function(b){h.error(new V(a.UNWRAP_ERROR))})},this)},sign:function(c,f){var d=this;b(f,function(){if(!this.hmacKey)throw new V(a.SIGN_NOT_SUPPORTED,"no HMAC key.");qa.sign(ta,this.hmacKey,c).then(function(a){b(f,function(){var b=new Uint8Array(a);Hb(b,{result:function(a){f.result(a.bytes)},error:f.error})},d)},function(){f.error(new V(a.HMAC_ERROR))})},this)},verify:function(c,f,d){var h=this;b(d,function(){if(!this.hmacKey)throw new V(a.VERIFY_NOT_SUPPORTED,"no HMAC key.");fe(f,Ge.V1,{result:function(f){b(d,
function(){qa.verify(ta,this.hmacKey,f.signature,c).then(function(a){d.result(a)},function(b){d.error(new V(a.HMAC_ERROR))})},h)},error:d.error})},this)}})})();var Lb=fd.extend({init:function dc(b,c,f,d,m){if(f||d||m)dc.base.call(this,b,f+"_"+c.sequenceNumber,d,m,null);else{if(!c.isDecrypted())throw new oc(a.MASTERTOKEN_UNTRUSTED,c);dc.base.call(this,b,c.identity+"_"+c.sequenceNumber,c.encryptionKey,c.hmacKey,null)}}}),He=ud.extend({encrypt:function(a,b){b.result(a)},decrypt:function(a,b){b.result(a)},
wrap:function(a,b){b.error(new R("Wrap is unsupported by the MSL token crypto context."))},unwrap:function(a,b,c,f){f.error(new R("Unwrap is unsupported by the MSL token crypto context."))},sign:function(a,b){b.result(new Uint8Array(0))},verify:function(a,b,c){c.result(!1)}}),Ra={PSK:"PSK",MGK:"MGK",X509:"X509",RSA:"RSA",NPTICKET:"NPTICKET",ECC:"ECC",NONE:"NONE"};Object.freeze(Ra);var Hc,Ie;(function(){Hc=ca.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,
configurable:!1}})},getIdentity:function(){},getAuthData:function(){},equals:function(a){return this===a?!0:a instanceof Hc?this.scheme==a.scheme:!1},toJSON:function(){var a={};a.scheme=this.scheme;a.authdata=this.getAuthData();return a}});Ie=function(b,c){var f=c.scheme,d=c.authdata;if(!f||!d)throw new aa(a.JSON_PARSE_ERROR,"entityauthdata "+JSON.stringify(c));if(!Ra[f])throw new tc(a.UNIDENTIFIED_ENTITYAUTH_SCHEME,f);var h=b.getEntityAuthenticationFactory(f);if(!h)throw new tc(a.ENTITYAUTH_FACTORY_NOT_FOUND,
f);return h.createData(b,d)}})();var ge=ca.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createData:function(a,b){},getCryptoContext:function(a,b){}}),gc,Ff;(function(){gc=Hc.extend({init:function Ta(a){Ta.base.call(this,Ra.MGK);Object.defineProperties(this,{identity:{value:a,writable:!1,configurable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function hb(a){return this===
a?!0:a instanceof gc?hb.base.call(this,this,a)&&this.identity==a.identity:!1}});Ff=function(b){var c=b.identity;if(!c)throw new aa(a.JSON_PARSE_ERROR,"mgk authdata"+JSON.stringify(b));return new gc(c)}})();var Gf=ge.extend({init:function Ta(a){Ta.base.call(this,Ra.MGK);Object.defineProperties(this,{localIdentity:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return Ff(b)},getCryptoContext:function(b,c){if(!(c instanceof gc))throw new R("Incorrect authentication data type "+
JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw(new tc(a.ENTITY_NOT_FOUND,"mgk "+c.identity)).setEntity(c);return new Kc}}),yc,Je;(function(){yc=Hc.extend({init:function hb(a){hb.base.call(this,Ra.PSK);Object.defineProperties(this,{identity:{value:a,writable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function x(a){return this===a?!0:a instanceof yc?x.base.call(this,this,a)&&this.identity==a.identity:
!1}});Je=function(b){var c=b.identity;if(!c)throw new aa(a.JSON_PARSE_ERROR,"psk authdata"+JSON.stringify(b));return new yc(c)}})();var Hf;Hf=ge.extend({init:function hb(a){hb.base.call(this,Ra.PSK);Object.defineProperties(this,{localIdentity:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return Je(b)},getCryptoContext:function(b,c){if(!(c instanceof yc))throw new R("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.getIdentity()!=this.localIdentity)throw(new tc(a.ENTITY_NOT_FOUND,
"psk "+c.identity)).setEntity(c);return new Kc}});var he,If;(function(){he=Hc.extend({init:function x(a,b){x.base.call(this,Ra.RSA);Object.defineProperties(this,{identity:{value:a,writable:!1,configurable:!1},publicKeyId:{value:b,writable:!1,configurable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;a.pubkeyid=this.publicKeyId;return a},equals:function w(a){return this===a?!0:a instanceof he?w.base.call(this,this,a)&&this.identity==a.identity&&
this.publicKeyId==a.publicKeyId:!1}});If=function(b){var c=b.identity,k=b.pubkeyid;if(!c||"string"!==typeof c||!k||"string"!==typeof k)throw new aa(a.JSON_PARSE_ERROR,"RSA authdata"+JSON.stringify(b));return new he(c,k)}})();var Kg=ge.extend({init:function x(a){x.base.call(this,Ra.RSA);Object.defineProperties(this,{store:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return If(b)},getCryptoContext:function(b,c){if(!(c instanceof he))throw new R("Incorrect authentication data type "+
c+".");var f=c.identity,k=c.publicKeyId,l=this.store.getPublicKey(k);if(!l)throw(new tc(a.RSA_PUBLICKEY_NOT_FOUND,k)).setEntity(c);return new eb(b,f,null,l,fc.SIGN_VERIFY)}}),Hd,Jf;(function(){Hd=Hc.extend({init:function w(a){w.base.call(this,Ra.NONE);Object.defineProperties(this,{identity:{value:a,writable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function m(a){return this===a?!0:a instanceof Hd?m.base.call(this,
this,a)&&this.identity==a.identity:!1}});Jf=function(b){var c=b.identity;if(!c)throw new aa(a.JSON_PARSE_ERROR,"Unauthenticated authdata"+JSON.stringify(b));return new Hd(c)}})();var Jg=ge.extend({init:function w(){w.base.call(this,Ra.NONE)},createData:function(a,b){return Jf(b)},getCryptoContext:function(a,b){if(!(b instanceof Hd))throw new R("Incorrect authentication data type "+JSON.stringify(b)+".");return new Kc}}),Lg=ca.Class.create({init:function(){Object.defineProperties(this,{rsaKeys:{value:{},
writable:!1,enumerable:!1,configurable:!1}})},addPublicKey:function(a,b){if(!(b instanceof Ld))throw new R("Incorrect key data type "+b+".");this.rsaKeys[a]=b},getIdentities:function(){return Object.keys(this.rsaKeys)},removePublicKey:function(a){delete this.rsaKeys[a]},getPublicKey:function(a){return this.rsaKeys[a]}}),Ke=ca.Class.create({abort:function(){},close:function(){},mark:function(){},reset:function(){},markSupported:function(){},read:function(a,b,c){}}),ie=ca.Class.create({abort:function(){},
close:function(a,b){},write:function(a,b,c,l,f){},flush:function(a,b){}}),Kf=ca.Class.create({init:function(a){Object.defineProperties(this,{_data:{value:a,writable:!1,enumerable:!1,configurable:!1},_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_currentPosition:{value:0,writable:!0,enumerable:!1,configurable:!1},_mark:{value:-1,writable:!0,enumerable:!1,configurable:!1}})},abort:function(){},close:function(){this._close=!0},mark:function(){this._mark=this._currentPosition},reset:function(){if(-1==
this._mark)throw new pb("Stream has not been marked.");this._currentPosition=this._mark},markSupported:function(){return!0},read:function(a,b,c){f(c,function(){if(this._closed)throw new pb("Stream is already closed.");if(this._currentPosition==this._data.length)return null;-1==a&&(a=this._data.length-this._currentPosition);var b=this._data.subarray(this._currentPosition,this._currentPosition+a);this._currentPosition+=b.length;return b},this)}}),je=ca.Class.create({init:function(){var a={_closed:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_result:{value:new Uint8Array(0),writable:!0,enuemrable:!1,configurable:!1},_buffered:{value:[],writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},abort:function(){},close:function(a,b){this._closed=!0;b.result(!0)},write:function(a,b,c,l,d){f(d,function(){if(this._closed)throw new pb("Stream is already closed.");if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+
c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");var l=a.subarray(b,c);this._buffered.push(l);return l.length},this)},flush:function(a,b){for(;0<this._buffered.length;){var c=this._buffered.shift();if(this._result){var l=new Uint8Array(this._result.length+c.length);l.set(this._result);l.set(c,this._result.length);this._result=l}else this._result=new Uint8Array(c)}b.result(!0)},size:function(){this.flush(1,{result:function(){}});return this._result.length},
toByteArray:function(){this.flush(1,{result:function(){}});return this._result}}),Cf,Lf=ca.Class.create({getResponse:function(a,b,c){}});(function(){var a=ie.extend({init:function(a,b){var c={_httpLocation:{value:a,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:b,writable:!0,enumerable:!1,configurable:!1},_buffer:{value:new je,writable:!1,enumerable:!1,configurable:!1},_response:{value:K,writable:!0,enumerable:!1,configurable:!1},_abortToken:{value:K,writable:!0,enumerable:!1,configurable:!1},
_responseQueue:{value:new Ha,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,c)},setTimeout:function(a){this._timeout=a},getResponse:function(a,b){var c=this;this._responseQueue.poll(a,{result:function(a){f(b,function(){a&&this._responseQueue.add(a);return a},c)},timeout:function(){f(b,function(){this._response={isTimeout:!0};this._responseQueue.add(this._response);this.abort();b.timeout()},c)},error:function(a){f(b,function(){this._response={isError:!0};this._responseQueue.add(this._response);
throw a;},c)}})},abort:function(){this._abortToken&&this._abortToken.abort()},close:function(a,b){var c=this;f(b,function(){if(this._response)return!0;var a=this._buffer.toByteArray();0<a.length&&(this._abortToken=this._httpLocation.getResponse({body:a},this._timeout,{result:function(a){c._response={response:a};c._responseQueue.add(c._response)},timeout:function(){c._response={isTimeout:!0};c._responseQueue.add(c._response)},error:function(a){c._response={isError:!0,error:a};c._responseQueue.add(c._response)}}));
return!0},this)},write:function(a,b,c,r,d){f(d,function(){if(this._response)throw new pb("HttpOutputStream already closed.");this._buffer.write(a,b,c,r,d)},this)},flush:function(a,b){f(b,function(){if(this._response)return!0;this._buffer.flush(a,b)},this)}}),b=Ke.extend({init:function(a){Object.defineProperties(this,{_out:{value:a,writable:!1,enumerable:!1,configurable:!1},_buffer:{value:K,writable:!0,enumerable:!1,configurable:!1},_exception:{value:K,writable:!0,enumerable:!1,configurable:!1},_timedout:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_json:{value:K,writable:!0,enumerable:!1,configurable:!1}})},abort:function(){this._out.abort()},close:function(){this._buffer&&this._buffer.close()},mark:function(){this._buffer||this._buffer.mark()},reset:function(){this._buffer&&this._buffer.reset()},markSupported:function(){if(this._buffer)return this._buffer.markSupported()},read:function(a,b,c){function r(r){f(c,function(){if(!r)return new Uint8Array(0);
this._out.getResponse(b,{result:function(r){f(c,function(){var f;if(r.isTimeout)this._timedout=!0,c.timeout();else{if(r.isError)throw this._exception=r.error||new pb("Unknown HTTP exception."),this._exception;if(!r.response)throw this._exception=new pb("Missing HTTP response."),this._exception;r.response.json!==K&&(this._json=r.response.json,this.getJSON=function(){return d._json});f=r.response.content||M("string"===typeof r.response.body?r.response.body:JSON.stringify(this._json));this._buffer=new Kf(f);
this._buffer.read(a,b,c)}},d)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},d)}var d=this;f(c,function(){if(this._exception)throw this._exception;if(this._timedout)c.timeout();else{if(this._aborted)return new Uint8Array(0);this._buffer?this._buffer.read(a,b,c):this._out.close(b,{result:function(a){r(a)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})}},d)}});Cf=ca.Class.create({init:function(a,b){Object.defineProperties(this,{_httpLocation:{value:a,writable:!1,
enumerable:!1,configurable:!1},_timeout:{value:b,writable:!0,enumerable:!1,configurable:!1}})},setTimeout:function(a){this._timeout=a},openConnection:function(){var c=new a(this._httpLocation,this._timeout);return{input:new b(c),output:c}}})})();var Df;(function(){var a=ie.extend({init:function(){var a={_buffer:{value:new Uint8Array,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},setTimeout:function(){},getResponse:function(a,b){b.result({success:!1,content:null,errorHttpCode:K,
errorSubCode:K})},abort:function(){},close:function(a,b){b.result(!0)},write:function(a,b,c,f,d){try{if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");var m=a.subarray(b,c),h=new Uint8Array(this._buffer.length+m.length);h.set(this._buffer);h.set(m,this._buffer.length);this._buffer=h;d.result(m.length)}catch(A){d.error(A)}},flush:function(a,
b){b.result(!0)},request:function(){return this._buffer}}),b=Ke.extend({init:function(){},abort:function(){},close:function(){},mark:function(){},reset:function(){},markSupported:function(){},read:function(a,b,c){c.result(new Uint8Array(16))}});Df=ca.Class.create({init:function(){var c={output:{value:new a,writable:!1,enumerable:!1,configurable:!1},input:{value:new b,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,c)},setTimeout:function(){},openConnection:function(){return{input:this.input,
output:this.output}},getRequest:function(){return z(this.output.request())}})})();var Mf=function(a,b,c){function f(a){a=new Le(h(a,"utf-8"));var b=[],c;for(c=a.nextValue();c!==K;)b.push(c),c=a.nextValue();return b}(function(a,b,f){a.read(-1,b,{result:function(a){a&&a.length?f(null,a):f(null,null)},timeout:function(){c.timeout()},error:function(a){f(a,null)}})})(a,b,function(b,r){b?c.error(b):r?a.getJSON!==K&&"function"===typeof a.getJSON?c.result(a.getJSON()):c.result(f(r)):c.result(null)})},hc=
{SYMMETRIC_WRAPPED:"SYMMETRIC_WRAPPED",ASYMMETRIC_WRAPPED:"ASYMMETRIC_WRAPPED",DIFFIE_HELLMAN:"DIFFIE_HELLMAN",JWE_LADDER:"JWE_LADDER",JWK_LADDER:"JWK_LADDER",AUTHENTICATED_DH:"AUTHENTICATED_DH"};Object.freeze(hc);var Md,Nf;(function(){Md=ca.Class.create({init:function(a){Object.defineProperties(this,{keyExchangeScheme:{value:a,writable:!1,configurable:!1}})},getKeydata:function(){},toJSON:function(){var a={};a.scheme=this.keyExchangeScheme;a.keydata=this.getKeydata();return a},equals:function(a){return this===
a?!0:a instanceof Md?this.keyExchangeScheme==a.keyExchangeScheme:!1},uniqueKey:function(){return this.keyExchangeScheme}});Nf=function(c,f,k){b(k,function(){var b=f.scheme,d=f.keydata;if(!b||!d||"object"!==typeof d)throw new aa(a.JSON_PARSE_ERROR,"keyrequestdata "+JSON.stringify(f));if(!hc[b])throw new Qa(a.UNIDENTIFIED_KEYX_SCHEME,b);var r=c.getKeyExchangeFactory(b);if(!r)throw new Qa(a.KEYX_FACTORY_NOT_FOUND,b);r.createRequestData(c,d,k)})}})();var vd,Me;(function(){vd=ca.Class.create({init:function(a,
b){Object.defineProperties(this,{masterToken:{value:a,writable:!1,configurable:!1},keyExchangeScheme:{value:b,wrtiable:!1,configurable:!1}})},getKeydata:function(){},toJSON:function(){var a={};a.mastertoken=this.masterToken;a.scheme=this.keyExchangeScheme;a.keydata=this.getKeydata();return a},equals:function(a){return this===a?!0:a instanceof vd?this.masterToken.equals(a.masterToken)&&this.keyExchangeScheme==a.keyExchangeScheme:!1},uniqueKey:function(){return this.masterToken.uniqueKey()+":"+this.keyExchangeScheme}});
Me=function(c,f,k){b(k,function(){var l=f.mastertoken,d=f.scheme,r=f.keydata;if(!d||!l||"object"!==typeof l||!r||"object"!==typeof r)throw new aa(a.JSON_PARSE_ERROR,"keyresponsedata "+JSON.stringify(f));if(!hc[d])throw new Qa(a.UNIDENTIFIED_KEYX_SCHEME,d);Sc(c,l,{result:function(f){b(k,function(){var b=c.getKeyExchangeFactory(d);if(!b)throw new Qa(a.KEYX_FACTORY_NOT_FOUND,d);return b.createResponseData(c,f,r)})},error:function(a){k.error(a)}})})}})();var pc;(function(){var c=ca.Class.create({init:function(a,
b){Object.defineProperties(this,{keyResponseData:{value:a,writable:!1,configurable:!1},cryptoContext:{value:b,writable:!1,configurable:!1}})}});pc=ca.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createRequestData:function(a,b,c){},createResponseData:function(a,b,c){},generateResponse:function(a,b,c,f){},getCryptoContext:function(a,b,c,f,r){},generateSessionKeys:function(c,f){b(f,function(){var b=new Uint8Array(16),d=new Uint8Array(32);
c.getRandom().nextBytes(b);c.getRandom().nextBytes(d);Ic(b,Kb,yb,{result:function(b){Ic(d,ta,tb,{result:function(a){f.result({encryptionKey:b,hmacKey:a})},error:function(b){f.error(new V(a.SESSION_KEY_CREATION_FAILURE,null,b))}})},error:function(b){f.error(new V(a.SESSION_KEY_CREATION_FAILURE,null,b))}})})},importSessionKeys:function(a,b,c){Ic(a,Kb,yb,{result:function(a){Ic(b,ta,tb,{result:function(b){c.result({encryptionKey:a,hmacKey:b})},error:function(a){c.error(a)}})},error:function(a){c.error(a)}})}});
pc.KeyExchangeData=c})();var Of,Ne,Pf;(function(){function c(k,l,d,h,g){b(g,function(){switch(l){case f.PSK:var c=new yc(h),L=k.getEntityAuthenticationFactory(Ra.PSK);if(!L)throw new Qa(a.UNSUPPORTED_KEYX_MECHANISM,l);c=L.getCryptoContext(k,c);return new wc(k,xc.A128KW,C,K);case f.MGK:c=new gc(h);L=k.getEntityAuthenticationFactory(Ra.MGK);if(!L)throw new Qa(a.UNSUPPORTED_KEYX_MECHANISM,l);c=L.getCryptoContext(k,c);return new wc(k,xc.A128KW,C,K);case f.WRAP:c=k.getMslCryptoContext();c.unwrap(d,uc,
ja,{result:function(a){b(g,function(){return new wc(k,xc.A128KW,C,a)})},error:g.error});break;default:throw new Qa(a.UNSUPPORTED_KEYX_MECHANISM,l);}})}var f={PSK:"PSK",MGK:"MGK",WRAP:"WRAP"},k=Ne=Md.extend({init:function r(a,b){r.base.call(this,hc.JWE_LADDER);switch(a){case f.WRAP:if(!b)throw new R("Previous wrapping key based key exchange requires the previous wrapping key data and ID.");break;default:b=null}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},wrapdata:{value:b,
writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.mechanism=this.mechanism;this.wrapdata&&(a.wrapdata=N(this.wrapdata));return a},equals:function D(a){return a===this?!0:a instanceof Ne?D.base.call(this,a)&&this.mechanism==a.mechanism&&q(this.wrapdata,a.wrapdata):!1},uniqueKey:function la(){var a=la.base.call(this)+":"+this.mechanism;this.wrapdata&&(a+=":"+ia(this.wrapdata));return a}}),l=Pf=vd.extend({init:function E(a,b,c,f,k){E.base.call(this,a,hc.JWE_LADDER);Object.defineProperties(this,
{wrapKey:{value:b,writable:!1,configurable:!1},wrapdata:{value:c,writable:!1,configurable:!1},encryptionKey:{value:f,writable:!1,configurable:!1},hmacKey:{value:k,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.wrapkey=N(this.wrapKey);a.wrapdata=N(this.wrapdata);a.encryptionkey=N(this.encryptionKey);a.hmackey=N(this.hmacKey);return a},equals:function A(a){return this===a?!0:a instanceof Pf?A.base.call(this,a)&&q(this.wrapKey,a.wrapKey)&&q(this.wrapdata,a.wrapdata)&&q(this.encryptionKey,
a.encryptionKey)&&q(this.hmacKey,a.hmacKey):!1},uniqueKey:function L(){return L.base.call(this)+":"+ia(this.wrapKey)+":"+ia(this.wrapdata)+":"+ia(this.encryptionKey)+":"+ia(this.hmacKey)}});Of=pc.extend({init:function Y(a){Y.base.call(this,hc.JWE_LADDER);Object.defineProperties(this,{repository:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createRequestData:function(c,l,d){b(d,function(){var b=l.mechanism,c=l.wrapdata;if(!b||b==f.WRAP&&(!c||"string"!==typeof c))throw new aa(a.JSON_PARSE_ERROR,
"keydata "+JSON.stringify(l));if(!f[b])throw new Qa(a.UNIDENTIFIED_KEYX_MECHANISM,b);var d;switch(b){case f.WRAP:try{d=T(c)}catch(h){throw new Qa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());}if(null==d||0==d.length)throw new Qa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());break;default:d=null}return new k(b,d)})},createResponseData:function(b,c,f){b=f.wrapkey;var k=f.wrapdata,d=f.encryptionkey,h=f.hmackey;if(!(b&&"string"===typeof b&&k&&"string"===typeof k&&d&&"string"===typeof d&&
h)||"string"!==typeof h)throw new aa(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(f));var m,g,w,oa;try{m=T(b),g=T(k)}catch(Ka){throw new V(a.INVALID_SYMMETRIC_KEY,"keydata "+JSON.stringify(f),Ka);}try{w=T(d)}catch(ib){throw new V(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(f),ib);}try{oa=T(h)}catch(Cb){throw new V(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(f),Cb);}return new l(c,m,g,w,oa)},generateResponse:function(f,d,h,m){function g(a,c,k){Sa.generateSessionKeys(f,{result:function(f){b(m,
function(){ea(a,c,k,f.encryptionKey,f.hmacKey)},Sa)},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);throw a;})}})}function ea(a,k,l,h,g){b(m,function(){c(f,d.mechanism,d.wrapdata,a,{result:function(a){a.wrap(k,{result:function(a){Fc(k,l,h,g,a)},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);throw a;})}})},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);throw a;})}})},Sa)}function Fc(a,c,k,l,d){b(m,function(){var h=new wc(f,xc.A128KW,C,a);h.wrap(k,
{result:function(a){h.wrap(l,{result:function(b){fa(c,d,k,a,l,b)},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);throw a;})}})},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);throw a;})}})},Sa)}function fa(a,c,k,d,g,ea){b(m,function(){var da=f.getTokenFactory();oa?da.renewMasterToken(f,oa,k,g,{result:function(k){b(m,function(){var b=new Lb(f,k),h=new l(k,c,a,d,ea);return new pc.KeyExchangeData(h,b,m)},Sa)},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);
throw a;})}}):da.createMasterToken(f,h,k,g,{result:function(k){b(m,function(){var b=new Lb(f,k),h=new l(k,c,a,d,ea);return new pc.KeyExchangeData(h,b,m)},Sa)},error:m.error})},Sa)}var Sa=this,oa;b(m,function(){if(!(d instanceof k))throw new R("Key request data "+JSON.stringify(d)+" was not created by this factory.");var c=h;if(h instanceof Xb){if(!h.isVerified())throw new oc(a.MASTERTOKEN_UNTRUSTED,h);oa=h;c=h.identity}var l=new Uint8Array(16);f.getRandom().nextBytes(l);Ic(l,uc,ja,{result:function(a){b(m,
function(){f.getMslCryptoContext().wrap(a,{result:function(b){g(c,a,b)},error:function(a){b(m,function(){a instanceof F&&a.setEntity(oa);throw a;},Sa)}})},Sa)},error:function(c){b(m,function(){throw(new V(a.WRAP_KEY_CREATION_FAILURE,null,c)).setEntity(oa);},Sa)}})},Sa)},getCryptoContext:function(c,d,h,g,da){function ea(a,f,k,l,d){b(da,function(){var h=new wc(c,xc.A128KW,C,d);h.unwrap(f.encryptionKey,Kb,yb,{result:function(d){h.unwrap(f.hmacKey,ta,tb,{result:function(a){b(da,function(){this.repository.addCryptoContext(f.wrapdata,
h);this.repository.removeCryptoContext(k);return new Lb(c,f.masterToken,l,d,a)},w)},error:function(c){b(da,function(){c instanceof F&&c.setEntity(a);throw c;})}})},error:function(c){b(da,function(){c instanceof F&&c.setEntity(a);throw c;})}})},w)}var w=this;b(da,function(){if(!(d instanceof k))throw new R("Key request data "+JSON.stringify(d)+" was not created by this factory.");if(!(h instanceof l))throw new R("Key response data "+JSON.stringify(h)+" was not created by this factory.");var g=d.mechanism,
Gb=d.wrapdata;c.getEntityAuthenticationData(null,{result:function(k){b(da,function(){var l=k.getIdentity(),d;switch(g){case f.PSK:d=new yc(l);var Cb=c.getEntityAuthenticationFactory(Ra.PSK);if(!Cb)throw(new Qa(a.UNSUPPORTED_KEYX_MECHANISM,g)).setEntity(k);d=Cb.getCryptoContext(c,d);d=new wc(c,xc.A128KW,C,K);break;case f.MGK:d=new gc(l);Cb=c.getEntityAuthenticationFactory(Ra.MGK);if(!Cb)throw(new Qa(a.UNSUPPORTED_KEYX_MECHANISM,g)).setEntity(k);d=Cb.getCryptoContext(c,d);d=new wc(c,xc.A128KW,C,d.wrapKey);
break;case f.WRAP:d=this.repository.getCryptoContext(Gb);if(!d)throw(new Qa(a.KEYX_WRAPPING_KEY_MISSING,N(Gb))).setEntity(k);break;default:throw(new Qa(a.UNSUPPORTED_KEYX_MECHANISM,g)).setEntity(k);}d.unwrap(h.wrapKey,uc,ja,{result:function(a){ea(k,h,Gb,l,a)},error:function(a){b(da,function(){a instanceof F&&a.setEntity(k);throw a;})}})},w)},error:da.error})},w)}})})();var Tb,Da,ua;(function(){function c(k,l,h,g,A){b(A,function(){switch(l){case f.PSK:var c=new yc(g),Y=k.getEntityAuthenticationFactory(Ra.PSK);
if(!Y)throw new Qa(a.UNSUPPORTED_KEYX_MECHANISM,l);c=Y.getCryptoContext(k,c);return new d(K);case f.MGK:c=new gc(g);Y=k.getEntityAuthenticationFactory(Ra.MGK);if(!Y)throw new Qa(a.UNSUPPORTED_KEYX_MECHANISM,l);c=Y.getCryptoContext(k,c);return new d(K);case f.WRAP:c=k.getMslCryptoContext();c.unwrap(h,uc,ja,{result:function(a){b(A,function(){return new d(a)})},error:A.error});break;default:throw new Qa(a.UNSUPPORTED_KEYX_MECHANISM,l);}})}var f={PSK:"PSK",MGK:"MGK",WRAP:"WRAP"},k=Da=Md.extend({init:function D(a,
b){D.base.call(this,hc.JWK_LADDER);switch(a){case f.WRAP:if(!b)throw new R("Previous wrapping key based key exchange requires the previous wrapping key data and ID.");break;default:b=null}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},wrapdata:{value:b,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.mechanism=this.mechanism;this.wrapdata&&(a.wrapdata=N(this.wrapdata));return a},equals:function la(a){return a===this?!0:a instanceof Da?la.base.call(this,
a)&&this.mechanism==a.mechanism&&q(this.wrapdata,a.wrapdata):!1},uniqueKey:function E(){var a=E.base.call(this)+":"+this.mechanism;this.wrapdata&&(a+=":"+ia(this.wrapdata));return a}}),l=ua=vd.extend({init:function A(a,b,c,f,k){A.base.call(this,a,hc.JWK_LADDER);Object.defineProperties(this,{wrapKey:{value:b,writable:!1,configurable:!1},wrapdata:{value:c,writable:!1,configurable:!1},encryptionKey:{value:f,writable:!1,configurable:!1},hmacKey:{value:k,writable:!1,configurable:!1}})},getKeydata:function(){var a=
{};a.wrapkey=N(this.wrapKey);a.wrapdata=N(this.wrapdata);a.encryptionkey=N(this.encryptionKey);a.hmackey=N(this.hmacKey);return a},equals:function L(a){return this===a?!0:a instanceof ua?L.base.call(this,a)&&q(this.wrapKey,a.wrapKey)&&q(this.wrapdata,a.wrapdata)&&q(this.encryptionKey,a.encryptionKey)&&q(this.hmacKey,a.hmacKey):!1},uniqueKey:function Y(){return Y.base.call(this)+":"+ia(this.wrapKey)+":"+ia(this.wrapdata)+":"+ia(this.encryptionKey)+":"+ia(this.hmacKey)}}),d=ud.extend({init:function(a){a&&
a.rawKey&&(a=a.rawKey);Object.defineProperties(this,{_wrapKey:{value:a,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(b,c){c.error(new V(a.ENCRYPT_NOT_SUPPORTED))},decrypt:function(b,c){c.error(new V(a.DECRYPT_NOT_SUPPORTED))},wrap:function(c,f){b(f,function(){qa.wrapKey("jwk",c.rawKey,this._wrapKey,uc).then(function(a){f.result(a)},function(b){f.error(new V(a.WRAP_ERROR))})},this)},unwrap:function(c,f,k,l){function d(c){b(l,function(){switch(c.type){case "secret":Rb(c,l);break;case "public":Wb(c,
l);break;case "private":rb(c,l);break;default:throw new V(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(l,function(){qa.unwrapKey("jwk",c,this._wrapKey,uc,f,!1,k).then(function(a){d(a)},function(b){l.error(new V(a.UNWRAP_ERROR))})},this)},sign:function(b,c){c.error(new V(a.SIGN_NOT_SUPPORTED))},verify:function(b,c,f){f.error(new V(a.VERIFY_NOT_SUPPORTED))}});Tb=pc.extend({init:function lb(a){lb.base.call(this,hc.JWK_LADDER);Object.defineProperties(this,{repository:{value:a,writable:!1,enumerable:!1,configurable:!1}})},
createRequestData:function(c,l,d){b(d,function(){var b=l.mechanism,c=l.wrapdata;if(!b||b==f.WRAP&&(!c||"string"!==typeof c))throw new aa(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(l));if(!f[b])throw new Qa(a.UNIDENTIFIED_KEYX_MECHANISM,b);var d;switch(b){case f.WRAP:try{d=T(c)}catch(h){throw new Qa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());}if(null==d||0==d.length)throw new Qa(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());break;default:d=null}return new k(b,d)})},createResponseData:function(b,
c,f){b=f.wrapkey;var k=f.wrapdata,d=f.encryptionkey,h=f.hmackey;if(!(b&&"string"===typeof b&&k&&"string"===typeof k&&d&&"string"===typeof d&&h)||"string"!==typeof h)throw new aa(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(f));var m,u,g,Ka;try{m=T(b),u=T(k)}catch(ib){throw new V(a.INVALID_SYMMETRIC_KEY,"keydata "+JSON.stringify(f),ib);}try{g=T(d)}catch(Cb){throw new V(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(f),Cb);}try{Ka=T(h)}catch(w){throw new V(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(f),
w);}return new l(c,m,u,g,Ka)},generateResponse:function(f,h,m,g){function ea(a,c,k){oa.generateSessionKeys(f,{result:function(f){b(g,function(){Fc(a,c,k,f.encryptionKey,f.hmacKey)},oa)},error:function(a){b(g,function(){a instanceof F&&a.setEntity(Ka);throw a;})}})}function Fc(a,k,l,d,m){b(g,function(){c(f,h.mechanism,h.wrapdata,a,{result:function(a){a.wrap(k,{result:function(a){fa(k,l,d,m,a)},error:function(a){b(g,function(){a instanceof F&&a.setEntity(Ka);throw a;})}})},error:function(a){b(g,function(){a instanceof
F&&a.setEntity(Ka);throw a;})}})},oa)}function fa(a,c,f,k,l){b(g,function(){var h=new d(a);h.wrap(f,{result:function(a){h.wrap(k,{result:function(b){Sa(c,l,f,a,k,b)},error:function(a){b(g,function(){a instanceof F&&a.setEntity(Ka);throw a;})}})},error:function(a){b(g,function(){a instanceof F&&a.setEntity(Ka);throw a;})}})},oa)}function Sa(a,c,k,d,h,u){b(g,function(){var ea=f.getTokenFactory();Ka?ea.renewMasterToken(f,Ka,k,h,{result:function(k){b(g,function(){var b=new Lb(f,k),h=new l(k,c,a,d,u);
return new pc.KeyExchangeData(h,b,g)},oa)},error:function(a){b(g,function(){a instanceof F&&a.setEntity(Ka);throw a;})}}):ea.createMasterToken(f,m,k,h,{result:function(k){b(g,function(){var b=new Lb(f,k),h=new l(k,c,a,d,u);return new pc.KeyExchangeData(h,b,g)},oa)},error:g.error})},oa)}var oa=this,Ka;b(g,function(){if(!(h instanceof k))throw new R("Key request data "+JSON.stringify(h)+" was not created by this factory.");var c=m;if(m instanceof Xb){if(!m.isVerified())throw new oc(a.MASTERTOKEN_UNTRUSTED,
m);Ka=m;c=m.identity}var l=new Uint8Array(16);f.getRandom().nextBytes(l);Ic(l,uc,ja,{result:function(a){b(g,function(){f.getMslCryptoContext().wrap(a,{result:function(b){ea(c,a,b)},error:function(a){b(g,function(){a instanceof F&&a.setEntity(Ka);throw a;},oa)}})},oa)},error:function(c){b(g,function(){throw(new V(a.WRAP_KEY_CREATION_FAILURE,null,c)).setEntity(Ka);},oa)}})},oa)},getCryptoContext:function(c,h,g,da,ea){function w(a,f,k,l,h){b(ea,function(){var m=new d(h);m.unwrap(f.encryptionKey,Kb,yb,
{result:function(d){m.unwrap(f.hmacKey,ta,tb,{result:function(a){b(ea,function(){this.repository.addCryptoContext(f.wrapdata,m);this.repository.removeCryptoContext(k);return new Lb(c,f.masterToken,l,d,a)},fa)},error:function(c){b(ea,function(){c instanceof F&&c.setEntity(a);throw c;})}})},error:function(c){b(ea,function(){c instanceof F&&c.setEntity(a);throw c;})}})},fa)}var fa=this;b(ea,function(){if(!(h instanceof k))throw new R("Key request data "+JSON.stringify(h)+" was not created by this factory.");
if(!(g instanceof l))throw new R("Key response data "+JSON.stringify(g)+" was not created by this factory.");var da=h.mechanism,oa=h.wrapdata;c.getEntityAuthenticationData(null,{result:function(k){b(ea,function(){var l=k.getIdentity(),h;switch(da){case f.PSK:h=new yc(l);var ec=c.getEntityAuthenticationFactory(Ra.PSK);if(!ec)throw(new Qa(a.UNSUPPORTED_KEYX_MECHANISM,da)).setEntity(k);h=ec.getCryptoContext(c,h);h=new d(h.wrapKey);break;case f.MGK:h=new gc(l);ec=c.getEntityAuthenticationFactory(Ra.MGK);
if(!ec)throw(new Qa(a.UNSUPPORTED_KEYX_MECHANISM,da)).setEntity(k);h=ec.getCryptoContext(c,h);h=new d(h.wrapKey);break;case f.WRAP:h=this.repository.getCryptoContext(oa);if(!h)throw(new Qa(a.KEYX_WRAPPING_KEY_MISSING,N(oa))).setEntity(k);break;default:throw(new Qa(a.UNSUPPORTED_KEYX_MECHANISM,da)).setEntity(k);}h.unwrap(g.wrapKey,uc,ja,{result:function(a){w(k,g,oa,l,a)},error:function(a){b(ea,function(){a instanceof F&&a.setEntity(k);throw a;})}})},fa)},error:ea.error})},fa)}})})();var Mg=ca.Class.create({addCryptoContext:function(a,
b){},getCryptoContext:function(a){},removeCryptoContext:function(a){}}),De,wd,Gd,Qf;(function(){function c(b,k,l,d,h){switch(l){case f.JWE_RSA:case f.JWEJS_RSA:return new wc(b,xc.RSA_OAEP,C,d,h);case f.JWK_RSA:return new eb(b,k,d,h,fc.WRAP_UNWRAP_OAEP);case f.JWK_RSAES:return new eb(b,k,d,h,fc.WRAP_UNWRAP_PKCS1);default:throw new V(a.UNSUPPORTED_KEYX_MECHANISM,l);}}var f=wd={RSA:"RSA",ECC:"ECC",JWE_RSA:"JWE_RSA",JWEJS_RSA:"JWEJS_RSA",JWK_RSA:"JWK_RSA",JWK_RSAES:"JWK_RSAES"},k=Gd=Md.extend({init:function D(a,
b,c,f){D.base.call(this,hc.ASYMMETRIC_WRAPPED);Object.defineProperties(this,{keyPairId:{value:a,writable:!1,configurable:!1},mechanism:{value:b,writable:!1,configurable:!1},publicKey:{value:c,writable:!1,configurable:!1},privateKey:{value:f,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.keypairid=this.keyPairId;a.mechanism=this.mechanism;a.publickey=N(this.publicKey.getEncoded());return a},equals:function la(a){if(a===this)return!0;if(!(a instanceof Gd))return!1;var b=this.privateKey===
a.privateKey||this.privateKey&&a.privateKey&&q(this.privateKey.getEncoded(),a.privateKey.getEncoded());return la.base.call(this,a)&&this.keyPairId==a.keyPairId&&this.mechanism==a.mechanism&&q(this.publicKey.getEncoded(),a.publicKey.getEncoded())&&b},uniqueKey:function E(){var a=this.publicKey.getEncoded(),b=this.privateKey&&this.privateKey.getEncoded(),a=E.base.call(this)+":"+this.keyPairId+":"+this.mechanism+":"+ia(a);b&&(a+=":"+ia(b));return a}}),l=function(c,l){b(l,function(){var b=c.keypairid,
d=c.mechanism,h=c.publickey;if(!b||"string"!==typeof b||!d||!h||"string"!==typeof h)throw new aa(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(c));if(!f[d])throw new Qa(a.UNIDENTIFIED_KEYX_MECHANISM,d);try{var g=T(h);switch(d){case f.JWE_RSA:case f.JWEJS_RSA:case f.JWK_RSA:de(g,Xa,ja,{result:function(a){l.result(new k(b,d,a,null))},error:function(a){l.error(a)}});break;case f.JWK_RSAES:de(g,mb,ja,{result:function(a){l.result(new k(b,d,a,null))},error:function(a){l.error(a)}});break;default:throw new V(a.UNSUPPORTED_KEYX_MECHANISM,
d);}}catch(u){if(!(u instanceof F))throw new V(a.INVALID_PUBLIC_KEY,"keydata "+JSON.stringify(c),u);throw u;}})},d=Qf=vd.extend({init:function A(a,b,c,f){A.base.call(this,a,hc.ASYMMETRIC_WRAPPED);Object.defineProperties(this,{keyPairId:{value:b,writable:!1,configurable:!1},encryptionKey:{value:c,writable:!1,configurable:!1},hmacKey:{value:f,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.keypairid=this.keyPairId;a.encryptionkey=N(this.encryptionKey);a.hmackey=N(this.hmacKey);return a},
equals:function L(a){return this===a?!0:a instanceof Qf?L.base.call(this,a)&&this.keyPairId==a.keyPairId&&q(this.encryptionKey,a.encryptionKey)&&q(this.hmacKey,a.hmacKey):!1},uniqueKey:function Y(){return Y.base.call(this)+":"+this.keyPairId+":"+ia(this.encryptionKey)+":"+ia(this.hmacKey)}});De=pc.extend({init:function lb(){lb.base.call(this,hc.ASYMMETRIC_WRAPPED)},createRequestData:function(a,b,c){l(b,c)},createResponseData:function(b,c,f){b=f.keypairid;var k=f.encryptionkey,l=f.hmackey;if(!b||"string"!==
typeof b||!k||"string"!==typeof k||!l||"string"!==typeof l)throw new aa(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(f));var h;try{h=T(k)}catch(m){throw new V(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(f),m);}var g;try{g=T(l)}catch(w){throw new V(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(f),w);}return new d(c,b,h,g)},generateResponse:function(a,f,l,h){function m(k,d){b(h,function(){var m=c(a,f.keyPairId,f.mechanism,null,f.publicKey);m.wrap(k,{result:function(a){b(h,function(){m.wrap(d,
{result:function(b){g(k,a,d,b)},error:function(a){b(h,function(){a instanceof F&&l instanceof Xb&&a.setEntity(l);throw a;},fa)}})},fa)},error:function(a){b(h,function(){a instanceof F&&l instanceof Xb&&a.setEntity(l);throw a;},fa)}})},fa)}function g(c,k,m,ea){b(h,function(){var g=a.getTokenFactory();l instanceof Xb?g.renewMasterToken(a,l,c,m,{result:function(c){b(h,function(){var b=new Lb(a,c),l=new d(c,f.keyPairId,k,ea);return new pc.KeyExchangeData(l,b,h)},fa)},error:function(a){b(h,function(){a instanceof
F&&a.setEntity(l);throw a;},fa)}}):g.createMasterToken(a,l,c,m,{result:function(c){b(h,function(){var b=new Lb(a,c),l=new d(c,f.keyPairId,k,ea);return new pc.KeyExchangeData(l,b,h)},fa)},error:h.error})},fa)}var fa=this;b(h,function(){if(!(f instanceof k))throw new R("Key request data "+JSON.stringify(f)+" was not created by this factory.");this.generateSessionKeys(a,{result:function(a){m(a.encryptionKey,a.hmacKey)},error:function(a){b(h,function(){a instanceof F&&l instanceof Xb&&a.setEntity(l);
throw a;},fa)}})},fa)},getCryptoContext:function(f,l,h,m,g){var Fc=this;b(g,function(){if(!(l instanceof k))throw new R("Key request data "+JSON.stringify(l)+" was not created by this factory.");if(!(h instanceof d))throw new R("Key response data "+JSON.stringify(h)+" was not created by this factory.");var fa=l.keyPairId,n=h.keyPairId;if(fa!=n)throw(new Qa(a.KEYX_RESPONSE_REQUEST_MISMATCH,"request "+fa+"; response "+n)).setEntity(m);n=l.privateKey;if(!n)throw(new Qa(a.KEYX_PRIVATE_KEY_MISSING,"request Asymmetric private key")).setEntity(m);
var oa=c(f,fa,l.mechanism,n,null);oa.unwrap(h.encryptionKey,Kb,yb,{result:function(a){oa.unwrap(h.hmacKey,ta,tb,{result:function(c){f.getEntityAuthenticationData(null,{result:function(k){b(g,function(){var b=k.getIdentity();return new Lb(f,h.masterToken,b,a,c)},Fc)},error:function(a){b(g,function(){a instanceof F&&a.setEntity(m);throw a;},Fc)}})},error:function(a){b(g,function(){a instanceof F&&a.setEntity(m);throw a;},Fc)}})},error:function(a){b(g,function(){a instanceof F&&a.setEntity(m);throw a;
},Fc)}})},Fc)}})})();var Le=ca.Class.create({init:function(a){var b=Ua.parser(),c=[],f=[],d,h,g,la=0,E=!1;b.onerror=function(a){E||(E=!0,b.end())};b.onopenobject=function(a){if(d)d[g]={},f.push(d),d=d[g];else if(h){var b={};f.push(h);h.push(b);d=b;h=K}else d={};g=a};b.oncloseobject=function(){var a=f.pop();a?"object"===typeof a?d=a:(d=K,h=a):(c.push(d),la=b.index,d=K)};b.onopenarray=function(){if(d)d[g]=[],f.push(d),h=d[g],d=K;else if(h){var a=[];f.push(h);h.push(a);h=a}else h=[]};b.onclosearray=
function(){var a=f.pop();a?"object"===typeof a?(d=a,h=K):h=a:(c.push(h),la=b.index,h=K)};b.onkey=function(a){g=a};b.onvalue=function(a){d?d[g]=a:h?h.push(a):(c.push(a),la=b.index)};b.write(a).close();Object.defineProperties(this,{_values:{value:c,writable:!1,enumerable:!1,configurable:!1},_lastIndex:{value:la,writable:!0,enumerable:!1,configurable:!1}})},more:function(){return 0<this._values.length},nextValue:function(){return 0==this._values.length?K:this._values.shift()},lastIndex:function(){return this._lastIndex}}),
Rf,Qe,Re,Sf,Se,Te;(function(){var c=Qe="entityauthdata",f=Re="mastertoken",k=Sf="headerdata",l=Se="errordata",d=Te="signature";Rf=function(h,g,la,E){b(E,function(){var b=g[c],L=g[f],Y=g[d];if(b&&"object"!==typeof b||L&&"object"!==typeof L||"string"!==typeof Y)throw new aa(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(g));var lb;try{lb=T(Y)}catch(ec){throw new Ba(a.HEADER_SIGNATURE_INVALID,"header/errormsg "+JSON.stringify(g),ec);}var Gb=null;b&&(Gb=Ie(h,b));var da=g[k];if(da!=K&&null!=da){if("string"!==
typeof da)throw new aa(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(g));L?Sc(h,L,{result:function(a){Ue(h,da,Gb,a,lb,la,E)},error:function(a){E.error(a)}}):Ue(h,da,Gb,null,lb,la,E)}else if(b=g[l],b!=K&&null!=b){if("string"!==typeof b)throw new aa(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(g));Ve(h,b,Gb,lb,E)}else throw new aa(a.JSON_PARSE_ERROR,JSON.stringify(g));})}})();var bd,Tf,Ve;(function(){function c(a,b){this.errordata=a;this.signature=b}bd=ca.Class.create({init:function(c,
f,l,d,h,g,w,E,A,L){var Y=this;b(L,function(){0>g&&(g=-1);if(0>d||d>Ia)throw new R("Message ID "+d+" is out of range.");if(!f)throw new Ba(a.MESSAGE_ENTITY_NOT_FOUND);if(A)return Object.defineProperties(this,{entityAuthenticationData:{value:f,writable:!1,configurable:!1},recipient:{value:l,writable:!1,configurable:!1},messageId:{value:d,writable:!1,configurable:!1},errorCode:{value:h,writable:!1,configurable:!1},internalCode:{value:g,writable:!1,configurable:!1},errorMessage:{value:w,writable:!1,configurable:!1},
userMessage:{value:E,writable:!1,configurable:!1},errordata:{value:A.errordata,writable:!1,enumerable:!1,configurable:!1},signature:{value:A.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var lb={};l&&(lb.recipient=l);lb.messageid=d;lb.errorcode=h;0<g&&(lb.internalcode=g);w&&(lb.errormsg=w);E&&(lb.usermsg=E);var ec;try{ec=c.getEntityAuthenticationFactory(f.scheme).getCryptoContext(c,f)}catch(Gb){throw Gb instanceof F&&(Gb.setEntity(f),Gb.setMessageId(d)),Gb;}lb=S(JSON.stringify(lb),ma);
ec.encrypt(lb,{result:function(a){b(L,function(){ec.sign(a,{result:function(c){b(L,function(){Object.defineProperties(this,{entityAuthenticationData:{value:f,writable:!1,configurable:!1},recipient:{value:l,writable:!1,configurable:!1},messageId:{value:d,writable:!1,configurable:!1},errorCode:{value:h,writable:!1,configurable:!1},internalCode:{value:g,writable:!1,configurable:!1},errorMessage:{value:w,writable:!1,configurable:!1},userMessage:{value:E,writable:!1,configurable:!1},errordata:{value:a,
writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},Y)},error:function(a){b(L,function(){a instanceof F&&(a.setEntity(f),a.setMessageId(d));throw a;},Y)}})},Y)},error:function(a){b(L,function(){a instanceof F&&(a.setEntity(f),a.setMessageId(d));throw a;},Y)}})},Y)},toJSON:function(){var a={};a[Qe]=this.entityAuthenticationData;a[Se]=N(this.errordata);a[Te]=N(this.signature);return a}});Tf=function(a,b,c,f,d,h,g,E,A){new bd(a,b,c,
f,d,h,g,E,null,A)};Ve=function(f,k,l,g,r){b(r,function(){if(!l)throw new Ba(a.MESSAGE_ENTITY_NOT_FOUND);var D;try{var la=l.scheme,E=f.getEntityAuthenticationFactory(la);if(!E)throw new tc(a.ENTITYAUTH_FACTORY_NOT_FOUND,la);D=E.getCryptoContext(f,l)}catch(A){throw A instanceof F&&A.setEntity(l),A;}try{k=T(k)}catch(L){throw(new Ba(a.HEADER_DATA_INVALID,k,L)).setEntity(l);}if(!k||0==k.length)throw(new Ba(a.HEADER_DATA_MISSING,k)).setEntity(l);D.verify(k,g,{result:function(A){b(r,function(){if(!A)throw(new V(a.MESSAGE_VERIFICATION_FAILED)).setEntity(l);
D.decrypt(k,{result:function(D){b(r,function(){var b=h(D,ma),A;try{A=JSON.parse(b)}catch(E){if(E instanceof SyntaxError)throw(new aa(a.JSON_PARSE_ERROR,"errordata "+b,E)).setEntity(l);throw E;}var ea=A.recipient!==K?A.recipient:null,L=parseInt(A.messageid),la=parseInt(A.errorcode),Y=parseInt(A.internalcode),oa=A.errormsg,Ka=A.usermsg;if(ea&&"string"!==typeof ea||!L||L!=L||!la||la!=la||A.internalcode&&Y!=Y||oa&&"string"!==typeof oa||Ka&&"string"!==typeof Ka)throw(new aa(a.JSON_PARSE_ERROR,"errordata "+
b)).setEntity(l);if(0>L||L>Ia)throw(new Ba(a.MESSAGE_ID_OUT_OF_RANGE,"errordata "+b)).setEntity(l);A=!1;for(var ib in d)if(d[ib]==la){A=!0;break}A||(la=d.FAIL);if(Y){if(0>Y)throw(new Ba(a.INTERNAL_CODE_NEGATIVE,"errordata "+b)).setEntity(l).setMessageId(L);}else Y=-1;b=new c(k,g);new bd(f,l,ea,L,la,Y,oa,Ka,b,r)})},error:function(a){b(r,function(){a instanceof F&&a.setEntity(l);throw a;})}})})},error:function(a){b(r,function(){a instanceof F&&a.setEntity(l);throw a;})}})})}})();var Ng=ca.Class.create({getUserMessage:function(a,
b){}}),Nd,Uf,We;(function(){We=function(a,b){if(!a||!b)return null;var c=a.compressionAlgorithms.filter(function(a){for(var c=0;c<b.compressionAlgorithms.length;++c)if(a==b.compressionAlgorithms[c])return!0;return!1}),f=a.languages.filter(function(a){for(var c=0;c<b.languages.length;++c)if(a==b.languages[c])return!0;return!1});return new Nd(c,f)};Nd=ca.Class.create({init:function(a,b){a||(a=[]);b||(b=[]);a.sort();Object.defineProperties(this,{compressionAlgorithms:{value:a,writable:!1,enumerable:!0,
configurable:!1},languages:{value:b,writable:!1,enumerable:!0,configurable:!1}})},toJSON:function(){var a={};a.compressionalgos=this.compressionAlgorithms;a.languages=this.languages;return a},equals:function(a){return this===a?!0:a instanceof Nd?pa(this.compressionAlgorithms,a.compressionAlgorithms)&&pa(this.languages,a.languages):!1},uniqueKey:function(){return this.compressionAlgorithms.join(":")+"|"+this.languages.join(":")}});Uf=function(b){var c=b.compressionalgos,f=b.languages;if(c&&!(c instanceof
Array)||f&&!(f instanceof Array))throw new aa(a.JSON_PARSE_ERROR,"capabilities "+JSON.stringify(b));b=[];for(var l=0;c&&l<c.length;++l){var d=c[l];cd[d]&&b.push(d)}return new Nd(b,f)}})();var Od,Vf,Ue,Wf,Xf;(function(){function c(a,b,f,k,d){this.customer=a;this.sender=b;this.messageCryptoContext=f;this.headerdata=k;this.signature=d}function f(a,b,c,k,d,l,h,g,r,m,u,D,A,E,L,la,w,Y,n,q){return{cryptoContext:{value:b,writable:!1,configurable:!1},customer:{value:c,writable:!1,configurable:!1},entityAuthenticationData:{value:k,
writable:!1,configurable:!1},masterToken:{value:d,writable:!1,configurable:!1},sender:{value:l,writable:!1,configurable:!1},messageId:{value:h,writable:!1,configurable:!1},nonReplayableId:{value:la,writable:!1,configurable:!1},keyRequestData:{value:g,writable:!1,configurable:!1},keyResponseData:{value:r,writable:!1,configurable:!1},userAuthenticationData:{value:m,writable:!1,configurable:!1},userIdToken:{value:u,writable:!1,configurable:!1},serviceTokens:{value:D,writable:!1,configurable:!1},peerMasterToken:{value:A,
writable:!1,configurable:!1},peerUserIdToken:{value:E,writable:!1,configurable:!1},peerServiceTokens:{value:L,writable:!1,configurable:!1},messageCapabilities:{value:Y,writable:!1,configurable:!1},renewable:{value:w,writable:!1,enumerable:!1,configurable:!1},headerdata:{value:n,writable:!1,enumerable:!1,configurable:!1},signature:{value:q,writable:!1,enumerable:!1,configurable:!1}}}function k(b,c,f){if(f){if(c=b.getMslStore().getCryptoContext(f))return c;if(!f.isVerified()||!f.isDecrypted())throw new oc(a.MASTERTOKEN_UNTRUSTED,
f);return new Lb(b,f)}f=c.scheme;var k=b.getEntityAuthenticationFactory(f);if(!k)throw new tc(a.ENTITYAUTH_FACTORY_NOT_FOUND,f);return k.getCryptoContext(b,c)}function d(c,f,k,l,g){b(g,function(){f.verify(k,l,{result:function(c){b(g,function(){if(!c)throw new V(a.MESSAGE_VERIFICATION_FAILED);f.decrypt(k,{result:function(a){b(g,function(){return h(a,ma)})},error:function(a){g.error(a)}})})},error:function(a){g.error(a)}})})}function g(a,c,f){b(f,function(){if(c)Me(a,c,f);else return null})}function r(a,
c,f,k){b(k,function(){if(c)Tc(a,c,f,k);else return null})}function D(a,c,f,k){b(k,function(){if(f)Xe(a,c,f,k);else return null})}function la(c,f,k,d,l,h,g){function r(f,g,u){if(g>=f.length){var D=[],A;for(A in m)D.push(m[A]);u.result(D)}else{D=f[g];if("object"!==typeof D)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+h);Pd(c,D,k,d,l,{result:function(a){b(u,function(){m[a.uniqueKey()]=a;r(f,g+1,u)})},error:function(a){u.error(a)}})}}var m={};b(g,function(){if(f){if(!(f instanceof Array))throw new aa(a.JSON_PARSE_ERROR,
"headerdata "+h);r(f,0,g)}else return[]})}function E(c,f,k,d,l,h){function g(c,f,k){b(k,function(){var b=f.peermastertoken;if(b&&"object"!==typeof b)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+l);if(!b)return null;Sc(c,b,k)})}function r(c,f,k,d){b(d,function(){var b=f.peeruseridtoken;if(b&&"object"!==typeof b)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+l);if(!b)return null;Tc(c,b,k,d)})}b(h,function(){if(!c.isPeerToPeer())return{peerMasterToken:null,peerUserIdToken:null,peerServiceTokens:[]};
g(c,f,{result:function(a){b(h,function(){var g=k?k.masterToken:a;r(c,f,g,{result:function(k){b(h,function(){la(c,f.peerservicetokens,g,k,d,l,{result:function(c){b(h,function(){return{peerMasterToken:a,peerUserIdToken:k,peerServiceTokens:c}})},error:function(a){b(h,function(){a instanceof F&&(a.setEntity(g),a.setUser(k));throw a;})}})})},error:function(a){b(h,function(){a instanceof F&&a.setEntity(g);throw a;})}})})},error:h.error})})}function A(c,f,k,d){function l(a,f){b(d,function(){if(f>=a.length)return h;
Nf(c,a[f],{result:function(c){b(d,function(){h.push(c);l(a,f+1)})},error:function(a){d.error(a)}})})}var h=[];b(d,function(){var b=f.keyrequestdata;if(!b)return h;if(!(b instanceof Array))throw new aa(a.JSON_PARSE_ERROR,"headerdata "+k);l(b,0)})}var L=Wf=ca.Class.create({init:function(a,b,c,f,k,d,l,h,g){Object.defineProperties(this,{messageId:{value:a,writable:!1,configurable:!1},nonReplayableId:{value:b,writable:!1,configurable:!1},renewable:{value:c,writable:!1,configurable:!1},capabilities:{value:f,
writable:!1,configurable:!1},keyRequestData:{value:k,writable:!1,configurable:!1},keyResponseData:{value:d,writable:!1,configurable:!1},userAuthData:{value:l,writable:!1,configurable:!1},userIdToken:{value:h,writable:!1,configurable:!1},serviceTokens:{value:g,writable:!1,configurable:!1}})}}),Y=Xf=ca.Class.create({init:function(a,b,c){Object.defineProperties(this,{peerMasterToken:{value:a,writable:!1,configurable:!1},peerUserIdToken:{value:b,writable:!1,configurable:!1},peerServiceTokens:{value:c,
writable:!1,configurable:!1}})}});Od=ca.Class.create({init:function(a,c,d,l,h,g,r){function u(A){b(r,function(){c=d?null:c;var u=l.nonReplayableId,E=l.renewable,L=l.capabilities,nb=l.messageId,la=l.keyRequestData?l.keyRequestData:[],ic=l.keyResponseData,w=l.userAuthData,Y=l.userIdToken,n=l.serviceTokens?l.serviceTokens:[],q,Sa,B;a.isPeerToPeer()?(q=h.peerMasterToken,Sa=h.peerUserIdToken,B=h.peerServiceTokens?h.peerServiceTokens:[]):(Sa=q=null,B=[]);if(0>nb||nb>Ia)throw new R("Message ID "+nb+" is out of range.");
if(!c&&!d)throw new R("Message entity authentication data or master token must be provided.");var N,T;ic?a.isPeerToPeer()?(N=d,T=ic.masterToken):(N=ic.masterToken,T=q):(N=d,T=q);if(Y&&(!N||!Y.isBoundTo(N)))throw new R("User ID token must be bound to a master token.");if(Sa&&(!T||!Sa.isBoundTo(T)))throw new R("Peer user ID token must be bound to a peer master token.");n.forEach(function(a){if(a.isMasterTokenBound()&&(!N||!a.isBoundTo(N)))throw new R("Master token bound service tokens must be bound to the provided master token.");
if(a.isUserIdTokenBound()&&(!Y||!a.isBoundTo(Y)))throw new R("User ID token bound service tokens must be bound to the provided user ID token.");},this);B.forEach(function(a){if(a.isMasterTokenBound()&&(!T||!a.isBoundTo(T)))throw new R("Master token bound peer service tokens must be bound to the provided peer master token.");if(a.isUserIdTokenBound()&&(!Sa||!a.isBoundTo(Sa)))throw new R("User ID token bound peer service tokens must be bound to the provided peer user ID token.");},this);if(g){var M=
g.customer,C=g.messageCryptoContext,z=f(a,C,M,c,d,A,nb,la,ic,w,Y,n,q,Sa,B,u,E,L,g.headerdata,g.signature);Object.defineProperties(this,z);return this}var M=Y?Y.customer:null,z={};A&&(z.sender=A);z.messageid=nb;"number"===typeof u&&(z.nonreplayableid=u);z.renewable=E;L&&(z.capabilities=L);0<la.length&&(z.keyrequestdata=la);ic&&(z.keyresponsedata=ic);w&&(z.userauthdata=w);Y&&(z.useridtoken=Y);0<n.length&&(z.servicetokens=n);q&&(z.peermastertoken=q);Sa&&(z.peeruseridtoken=Sa);0<B.length&&(z.peerservicetokens=
B);var C;try{C=k(a,c,d)}catch(K){throw K instanceof F&&(K.setEntity(d),K.setEntity(c),K.setUser(Y),K.setUser(w),K.setMessageId(nb)),K;}z=S(JSON.stringify(z),ma);C.encrypt(z,{result:function(k){b(r,function(){C.sign(k,{result:function(l){b(r,function(){var b=f(a,C,M,c,d,A,nb,la,ic,w,Y,n,q,Sa,B,u,E,L,k,l);Object.defineProperties(this,b);return this},D)},error:function(a){b(r,function(){a instanceof F&&(a.setEntity(d),a.setEntity(c),a.setUser(Y),a.setUser(w),a.setMessageId(nb));throw a;},D)}})},D)},
error:function(a){b(r,function(){a instanceof F&&(a.setEntity(d),a.setEntity(c),a.setUser(Y),a.setUser(w),a.setMessageId(nb));throw a;},D)}})},D)}var D=this;b(r,function(){g?u(g.sender):d?a.getEntityAuthenticationData(null,{result:function(a){a=a.getIdentity();u(a)},error:r.error}):u(null)},D)},isEncrypting:function(){return this.masterToken||Ja(this.entityAuthenticationData.scheme)},isRenewable:function(){return this.renewable},toJSON:function(){var a={};this.masterToken?a[Re]=this.masterToken:a[Qe]=
this.entityAuthenticationData;a[Sf]=N(this.headerdata);a[Te]=N(this.signature);return a}});Vf=function(a,b,c,f,k,d){new Od(a,b,c,f,k,null,d)};Ue=function(f,h,m,da,ea,n,fa){b(fa,function(){m=da?null:m;if(!m&&!da)throw new Ba(a.MESSAGE_ENTITY_NOT_FOUND);var q=h;try{h=T(q)}catch(oa){throw new Ba(a.HEADER_DATA_INVALID,q,oa);}if(!h||0==h.length)throw new Ba(a.HEADER_DATA_MISSING,q);var Ka;try{Ka=k(f,m,da)}catch(ib){throw ib instanceof F&&(ib.setEntity(da),ib.setEntity(m)),ib;}d(f,Ka,h,ea,{result:function(k){b(fa,
function(){var d;try{d=JSON.parse(k)}catch(l){if(l instanceof SyntaxError)throw(new aa(a.JSON_PARSE_ERROR,"headerdata "+k,l)).setEntity(da).setEntity(m);throw l;}var ib=parseInt(d.messageid);if(!ib||ib!=ib)throw(new aa(a.JSON_PARSE_ERROR,"headerdata "+k)).setEntity(da).setEntity(m);if(0>ib||ib>Ia)throw(new Ba(a.MESSAGE_ID_OUT_OF_RANGE,"headerdata "+k)).setEntity(da).setEntity(m);var ic=da?d.sender:null;if(da&&(!ic||"string"!==typeof ic))throw(new aa(a.JSON_PARSE_ERROR,"headerdata "+k)).setEntity(da).setEntity(m).setMessageId(ib);
var q=d.keyresponsedata;if(q&&"object"!==typeof q)throw(new aa(a.JSON_PARSE_ERROR,"headerdata "+k)).setEntity(da).setEntity(m).setMessageId(ib);var oa=fa;fa={result:function(a){oa.result(a)},error:function(a){a instanceof F&&(a.setEntity(da),a.setEntity(m),a.setMessageId(ib));oa.error(a)}};g(f,q,{result:function(l){b(fa,function(){var g=!f.isPeerToPeer()&&l?l.masterToken:da,u=d.useridtoken;if(u&&"object"!==typeof u)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+k);r(f,u,g,{result:function(r){b(fa,
function(){var u=d.userauthdata;if(u&&"object"!==typeof u)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+k);D(f,g,u,{result:function(u){b(fa,function(){var D;if(u){var nb=u.scheme,q=f.getUserAuthenticationFactory(nb);if(!q)throw(new Ma(a.USERAUTH_FACTORY_NOT_FOUND,nb)).setUser(r).setUser(u);nb=da?da.identity:m.getIdentity();D=q.authenticate(f,nb,u,r)}else D=r?r.customer:null;la(f,d.servicetokens,g,r,n,k,{result:function(g){b(fa,function(){var nb=d.nonreplayableid!==K?parseInt(d.nonreplayableid):null,
la=d.renewable;if(nb!=nb||"boolean"!==typeof la)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+k);if(0>nb||nb>Ia)throw new Ba(a.NONREPLAYABLE_ID_OUT_OF_RANGE,"headerdata "+k);var q=null,oa=d.capabilities;if(oa){if("object"!==typeof oa)throw new aa(a.JSON_PARSE_ERROR,"headerdata "+k);q=Uf(oa)}A(f,d,k,{result:function(a){E(f,d,l,n,k,{result:function(k){b(fa,function(){var b=k.peerMasterToken,d=k.peerUserIdToken,A=k.peerServiceTokens,E=new L(ib,nb,la,q,a,l,u,r,g),b=new Y(b,d,A),d=new c(D,ic,Ka,h,ea);
new Od(f,m,da,E,b,d,fa)})},error:fa.error})},error:function(a){b(fa,function(){a instanceof F&&(a.setUser(r),a.setUser(u));throw a;})}})})},error:function(a){b(fa,function(){a instanceof F&&(a.setEntity(g),a.setUser(r),a.setUser(u));throw a;})}})})},error:fa.error})})},error:fa.error})})},error:fa.error})})},error:fa.error})})}})();var Ye,Ze,$e;(function(){function c(a,b){this.payload=a;this.signature=b}Ye=ca.Class.create({init:function(a,c,f,d,h,g,la,E){var A=this;b(E,function(){if(0>a||a>Ia)throw new R("Sequence number "+
a+" is outside the valid range.");if(0>c||c>Ia)throw new R("Message ID "+c+" is outside the valid range.");if(la)return Object.defineProperties(this,{sequenceNumber:{value:a,writable:!1,configurable:!1},messageId:{value:c,writable:!1,configurable:!1},compressionAlgo:{value:d,writable:!1,configurable:!1},data:{value:h,writable:!1,configurable:!1},endofmsg:{value:f,writable:!1,enumerable:!1,configurable:!1},payload:{value:la.payload,writable:!1,enumerable:!1,configurable:!1},signature:{value:la.signature,
writable:!1,enumerable:!1,configurable:!1}}),this;var L;d?(L=af(d,h),L||(d=null,L=h)):(d=null,L=h);var Y={};Y.sequencenumber=a;Y.messageid=c;f&&(Y.endofmsg=f);d&&(Y.compressionalgo=d);Y.data=N(L);L=S(JSON.stringify(Y),ma);g.encrypt(L,{result:function(L){b(E,function(){g.sign(L,{result:function(g){b(E,function(){Object.defineProperties(this,{sequenceNumber:{value:a,writable:!1,configurable:!1},messageId:{value:c,writable:!1,configurable:!1},compressionAlgo:{value:d,writable:!1,configurable:!1},data:{value:h,
writable:!1,configurable:!1},endofmsg:{value:f,writable:!1,enumerable:!1,configurable:!1},payload:{value:L,writable:!1,enumerable:!1,configurable:!1},signature:{value:g,writable:!1,enumerable:!1,configurable:!1}});return this},A)},error:function(a){E.error(a)}})},A)},error:function(a){E.error(a)}})},A)},isEndOfMessage:function(){return this.endofmsg},toJSON:function(){var a={};a.payload=N(this.payload);a.signature=N(this.signature);return a}});Ze=function(a,b,c,f,d,h,g){new Ye(a,b,c,f,d,h,null,g)};
$e=function(f,k,d){b(d,function(){var g=f.payload,r=f.signature;if(!g||"string"!==typeof g||"string"!==typeof r)throw new aa(a.JSON_PARSE_ERROR,"payload chunk "+JSON.stringify(f));var D,la;try{D=T(g)}catch(E){throw new Ba(a.PAYLOAD_INVALID,"payload chunk "+JSON.stringify(f),E);}try{la=T(r)}catch(A){throw new Ba(a.PAYLOAD_SIGNATURE_INVALID,"payload chunk "+JSON.stringify(f),A);}k.verify(D,la,{result:function(f){b(d,function(){if(!f)throw new V(a.PAYLOAD_VERIFICATION_FAILED);k.decrypt(D,{result:function(f){b(d,
function(){var b=h(f,ma),g;try{g=JSON.parse(b)}catch(r){if(r instanceof SyntaxError)throw new aa(a.JSON_PARSE_ERROR,"payload chunk payload "+b,r);throw r;}var m=parseInt(g.sequencenumber),u=parseInt(g.messageid),A=g.endofmsg,E=g.compressionalgo;g=g.data;if(!m||m!=m||!u||u!=u||A&&"boolean"!==typeof A||E&&"string"!==typeof E||"string"!==typeof g)throw new aa(a.JSON_PARSE_ERROR,"payload chunk payload "+b);if(0>m||m>Ia)throw new F(a.PAYLOAD_SEQUENCE_NUMBER_OUT_OF_RANGE,"payload chunk payload "+b);if(0>
u||u>Ia)throw new F(a.PAYLOAD_MESSAGE_ID_OUT_OF_RANGE,"payload chunk payload "+b);A||(A=!1);if(E&&!cd[E])throw new Ba(a.UNIDENTIFIED_COMPRESSION,E);var L;try{L=T(g)}catch(n){throw new Ba(a.PAYLOAD_DATA_CORRUPT,g,n);}if(L&&0!=L.length)b=E?me(E,L):L;else{if(0<g.length)throw new Ba(a.PAYLOAD_DATA_CORRUPT,g);if(A)b=new Uint8Array(0);else throw new Ba(a.PAYLOAD_DATA_MISSING,g);}L=new c(D,la);new Ye(m,u,A,E,b,k,L,d)})},error:function(a){d.error(a)}})})},error:function(a){d.error(a)}})})}})();var ne,gd,
xd,Uc,Qd,$f;(function(){function c(f,d,k,l,h){function g(){b(h,function(){u>=d.length&&(u=0,++m);if(m>=w.length){if(n)throw n;throw new Qa(a.KEYX_FACTORY_NOT_FOUND,JSON.stringify(d));}var c=w[m],k=d[u];c.scheme!=k.keyExchangeScheme?(++u,g()):c.generateResponse(f,k,da,{result:function(a){h.result(a)},error:function(a){b(h,function(){if(!(a instanceof F))throw a;n=a;++u;g()})}})})}var m=0,u=0,w=f.getKeyExchangeFactories(),n,da=k?k:l;g()}function f(a,k,d,l,h){b(h,function(){var f=k.keyRequestData;if(k.isRenewable()&&
0<f.length)l?l.isRenewable()||l.isExpired()?c(a,f,l,null,h):a.getTokenFactory().isNewestMasterToken(a,l,{result:function(k){b(h,function(){if(k)return null;c(a,f,l,null,h)})},error:h.error}):c(a,f,null,d.getIdentity(),h);else return null})}function k(c,f,k,d){b(d,function(){var b=f.userIdToken,l=f.userAuthenticationData,h=f.messageId;if(b&&b.isVerified()){if(b.isRenewable()&&f.isRenewable()||b.isExpired()||!b.isBoundTo(k)){l=c.getTokenFactory();l.renewUserIdToken(c,b,k,d);return}}else if(f.isRenewable()&&
k&&l){b=f.customer;if(!b){var b=l.scheme,g=c.getUserAuthenticationFactory(b);if(!g)throw(new Ma(a.USERAUTH_FACTORY_NOT_FOUND,b)).setEntity(k).setUser(l).setMessageId(h);b=g.authenticate(c,k.identity,l,null)}l=c.getTokenFactory();l.createUserIdToken(c,b,k,d);return}return b})}var d=new Uint8Array(0),h=gd=function(a){if(0>a||a>Ia)throw new R("Message ID "+a+" is outside the valid range.");return a==Ia?0:a+1};xd=function(a){if(0>a||a>Ia)throw new R("Message ID "+a+" is outside the valid range.");return 0==
a?Ia:a-1};Uc=function(a,c,f,k,d){b(d,function(){if(k==K||null==k){var l=a.getRandom();do k=l.nextLong();while(0>k||k>Ia)}else if(0>k||k>Ia)throw new R("Message ID "+k+" is outside the valid range.");a.getEntityAuthenticationData(null,{result:function(l){b(d,function(){var b=a.getMessageCapabilities();return new ne(a,k,b,l,c,f,null,null,null,null,null)})},error:function(a){d.error(a)}})})};Qd=function(a,c,d){b(d,function(){function l(a){b(d,function(){a instanceof F&&(a.setEntity(g),a.setEntity(L),
a.setUser(w),a.setUser(n),a.setMessageId(q));throw a;})}var g=c.masterToken,L=c.entityAuthenticationData,w=c.userIdToken,n=c.userAuthenticationData,q=c.messageId,B=h(q);f(a,c,L,g,{result:function(f){b(d,function(){var h=f?f.keyResponseData.masterToken:h=g;a.getEntityAuthenticationData(null,{result:function(m){b(d,function(){k(a,c,h,{result:function(k){b(d,function(){w=k;var b=We(c.messageCapabilities,a.getMessageCapabilities()),d=c.keyResponseData,l=c.serviceTokens;return a.isPeerToPeer()?new ne(a,
B,b,m,d?d.masterToken:c.peerMasterToken,c.peerUserIdToken,c.peerServiceTokens,g,w,l,f):new ne(a,B,b,m,d?d.masterToken:g,w,l,null,null,null,f)})},error:l})})},error:l})})},error:l})})};$f=function(a,c,f,k,d){b(d,function(){a.getEntityAuthenticationData(null,{result:function(l){b(d,function(){var b;if(c!=K&&null!=c)b=h(c);else{var g=a.getRandom();do b=g.nextInt();while(0>b||b>Ia)}Tf(a,l,b,f.responseCode,f.internalCode,f.message,k,d)})},error:function(a){d.error(a)}})})};ne=ca.Class.create({init:function(a,
b,c,f,k,d,l,h,g,m,u){if(!a.isPeerToPeer()&&(h||g))throw new R("Cannot set peer master token or peer user ID token when not in peer-to-peer mode.");var ea;ea=u&&!a.isPeerToPeer()?u.keyResponseData.masterToken:k;var w={};a.getMslStore().getServiceTokens(ea,d).forEach(function(a){w[a.name]=a},this);l&&l.forEach(function(a){w[a.name]=a},this);var n,q,oa={};a.isPeerToPeer()&&(n=h,q=g,l=u?u.keyResponseData.masterToken:h,a.getMslStore().getServiceTokens(l,g).forEach(function(a){oa[a.name]=a},this),m&&m.forEach(function(a){oa[a.name]=
a},this));Object.defineProperties(this,{_ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},_entityAuthData:{value:f,writable:!1,enumerable:!1,configurable:!1},_masterToken:{value:k,writable:!0,enumerable:!1,configurable:!1},_messageId:{value:b,writable:!1,enumerable:!1,configurable:!1},_capabilities:{value:c,writable:!1,enumerable:!1,configurable:!1},_keyExchangeData:{value:u,writable:!1,enumerable:!1,configurable:!1},_nonReplayable:{value:!1,writable:!0,enumerable:!1,configurable:!1},_renewable:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_keyRequestData:{value:{},writable:!1,enumerable:!1,configurable:!1},_userAuthData:{value:null,writable:!0,enumerable:!1,configurable:!1},_userIdToken:{value:d,writable:!0,enumerable:!1,configurable:!1},_serviceTokens:{value:w,writable:!1,enumerable:!1,configurable:!1},_peerMasterToken:{value:n,writable:!0,enumerable:!1,configurable:!1},_peerUserIdToken:{value:q,writable:!0,enumerable:!1,configurable:!1},_peerServiceTokens:{value:oa,writable:!1,enumerable:!1,
configurable:!1}})},getMessageId:function(){return this._messageId},getMasterToken:function(){return this._masterToken},getUserIdToken:function(){return this._userIdToken},getKeyExchangeData:function(){return this._keyExchangeData},willEncryptHeader:function(){return this._masterToken||Ja(this._entityAuthData.scheme)},willEncryptPayloads:function(){return this._masterToken||!this._ctx.isPeerToPeer()&&this._keyExchangeData||Ja(this._entityAuthData.scheme)},willIntegrityProtectHeader:function(){return this._masterToken||
Wa(this._entityAuthData.scheme)},willIntegrityProtectPayloads:function(){return this._masterToken||!this._ctx.isPeerToPeer()&&this._keyExchangeData||Wa(this._entityAuthData.scheme)},getHeader:function(c){b(c,function(){var b=this._keyExchangeData?this._keyExchangeData.keyResponseData:null,f=[],k;for(k in this._serviceTokens)f.push(this._serviceTokens[k]);var d=[],l;for(l in this._keyRequestData)d.push(this._keyRequestData[l]);if(this._nonReplayable){if(!this._masterToken)throw new Ba(a.NONREPLAYABLE_MESSAGE_REQUIRES_MASTERTOKEN);
l=this._ctx.getMslStore().getNonReplayableId(this._masterToken)}else l=null;b=new Wf(this._messageId,l,this._renewable,this._capabilities,d,b,this._userAuthData,this._userIdToken,f);f=[];for(k in this._peerServiceTokens)f.push(this._peerServiceTokens[k]);k=new Xf(this._peerMasterToken,this._peerUserIdToken,f);Vf(this._ctx,this._entityAuthData,this._masterToken,b,k,c)},this)},isNonReplayable:function(){return this._nonReplayable},setNonReplayable:function(a){this._nonReplayable=a;return this},isRenewable:function(){return this._renewable},
setRenewable:function(a){this._renewable=a;return this},setAuthTokens:function(a,b){if(b&&!b.isBoundTo(a))throw new R("User ID token must be bound to master token.");if(this._keyExchangeData&&!this._ctx.isPeerToPeer())throw new R("Attempt to set message builder master token when key exchange data exists as a trusted network server.");var c;try{c=this._ctx.getMslStore().getServiceTokens(a,b)}catch(f){if(f instanceof F)throw new R("Invalid master token and user ID token combination despite checking above.",
f);throw f;}var k=[],d;for(d in this._serviceTokens)k.push(this._serviceTokens[d]);k.forEach(function(c){(c.isUserIdTokenBound()&&!c.isBoundTo(b)||c.isMasterTokenBound()&&!c.isBoundTo(a))&&delete this._serviceTokens[c.name]},this);c.forEach(function(a){this._serviceTokens[a.name]=a},this);this._masterToken=a;this._userIdToken=b},setUserAuthenticationData:function(a){this._userAuthData=a;return this},setCustomer:function(a,c){var f=this;b(c,function(){if(!this._ctx.isPeerToPeer()&&null!=this._userIdToken||
this._ctx.isPeerToPeer()&&null!=this._peerUserIdToken)throw new R("User ID token or peer user ID token already exists for the remote user.");var k;k=this._keyExchangeData?this._keyExchangeData.keyResponseData.masterToken:this._ctx.isPeerToPeer()?this._peerMasterToken:this._masterToken;if(!k)throw new R("User ID token or peer user ID token cannot be created because no corresponding master token exists.");this._ctx.getTokenFactory().createUserIdToken(this._ctx,a,k,{result:function(a){b(c,function(){this._ctx.isPeerToPeer()?
this._peerUserIdToken=a:(this._userIdToken=a,this._userAuthData=null);return!0},f)},error:function(a){c.error(a)}})},f)},addKeyRequestData:function(a){this._keyRequestData[a.uniqueKey()]=a;return this},removeKeyRequestData:function(a){delete this._keyRequestData[a.uniqueKey()];return this},addServiceToken:function(b){var c;c=this._keyExchangeData&&!this._ctx.isPeerToPeer()?this._keyExchangeData.keyResponseData.masterToken:this._masterToken;if(b.isMasterTokenBound()&&!b.isBoundTo(c))throw(new Ba(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,
"st "+JSON.stringify(b)+"; mt "+JSON.stringify(c))).setEntity(c);if(b.isUserIdTokenBound()&&!b.isBoundTo(this._userIdToken))throw(new Ba(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; uit "+JSON.stringify(this._userIdToken))).setEntity(c).setUser(this._userIdToken);this._serviceTokens[b.name]=b;return this},addServiceTokenIfAbsent:function(a){this._serviceTokens[a.name]||this.addServiceToken(a);return this},excludeServiceToken:function(a){delete this._serviceTokens[a];return this},
deleteServiceToken:function(a,c){var f=this;b(c,function(){var k=this._serviceTokens[a];if(!k)return this;var h=k.isMasterTokenBound()?this._masterToken:null,k=k.isUserIdTokenBound()?this._userIdToken:null;Lc(this._ctx,a,d,h,k,!1,null,new Kc,{result:function(a){b(c,function(){return this.addServiceToken(a)},f)},error:function(a){a instanceof F&&(a=new R("Failed to create and add empty service token to message.",a));c.error(a)}})},f)},getServiceTokens:function(){var a=[],b;for(b in this._serviceTokens)a.push(this._serviceTokens[b]);
return a},getPeerMasterToken:function(){return this._peerMasterToken},getPeerUserIdToken:function(){return this._peerUserIdToken},setPeerAuthTokens:function(b,c){if(!this._ctx.isPeerToPeer())throw new R("Cannot set peer master token or peer user ID token when not in peer-to-peer mode.");if(c&&!b)throw new R("Peer master token cannot be null when setting peer user ID token.");if(c&&!c.isBoundTo(b))throw(new Ba(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit "+c+"; mt "+b)).setEntity(b).setUser(c);var f;try{f=
this._ctx.getMslStore().getServiceTokens(b,c)}catch(k){if(k instanceof F)throw new R("Invalid peer master token and user ID token combination despite proper check.",k);throw k;}Object.keys(this._peerServiceTokens).forEach(function(a){var f=this._peerServiceTokens[a];f.isUserIdTokenBound()&&!f.isBoundTo(c)?delete this._peerServiceTokens[a]:f.isMasterTokenBound()&&!f.isBoundTo(b)&&delete this._peerServiceTokens[a]},this);f.forEach(function(a){var b=a.name;this._peerServiceTokens[b]||(this._peerServiceTokens[b]=
a)},this);this._peerUserIdToken=c;this._peerMasterToken=b;return this},addPeerServiceToken:function(b){if(!this._ctx.isPeerToPeer())throw new R("Cannot set peer service tokens when not in peer-to-peer mode.");if(b.isMasterTokenBound()&&!b.isBoundTo(this._peerMasterToken))throw(new Ba(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; mt "+JSON.stringify(this._peerMasterToken))).setEntity(this._peerMasterToken);if(b.isUserIdTokenBound()&&!b.isBoundTo(this._peerUserIdToken))throw(new Ba(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,
"st "+JSON.stringify(b)+"; uit "+JSON.stringify(this._peerUserIdToken))).setEntity(this._peerMasterToken).setUser(this._peerUserIdToken);this._peerServiceTokens[b.name]=b;return this},addPeerServiceTokenIfAbsent:function(a){this._peerServiceTokens[a.name]||this.addPeerServiceToken(a);return this},excludePeerServiceToken:function(a){delete this._peerServiceTokens[a];return this},deletePeerServiceToken:function(a,c){var f=this;b(c,function(){var k=this._peerServiceTokens[a];if(!k)return this;var h=
k.isMasterTokenBound()?this._peerMasterToken:null,k=k.isUserIdTokenBound()?this._peerUserIdToken:null;Lc(this._ctx,a,d,h,k,!1,null,new Kc,{result:function(a){b(c,function(){return this.addPeerServiceToken(a)},f)},error:function(a){a instanceof F&&(a=new R("Failed to create and add empty peer service token to message.",a));c.error(a)}})},f)},getPeerServiceTokens:function(){var a=[],b;for(b in this._peerServiceTokens)a.push(this._peerServiceTokens[b]);return a}})})();var oe;(function(){function a(b,
c){return c[b]?c[b]:c[""]}function c(a){var b=a.builder.getKeyExchangeData();return b&&!a.ctx.isPeerToPeer()?b.keyResponseData.masterToken:a.builder.getMasterToken()}oe=ca.Class.create({init:function(a,b,c){a={ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},cryptoContexts:{value:b.getCryptoContexts(),writable:!1,enumerable:!1,configurable:!1},builder:{value:c,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},isPrimaryMasterTokenAvailable:function(){return c(this)?
!0:!1},isPrimaryUserIdTokenAvailable:function(){return this.builder.getUserIdToken()?!0:!1},isPeerMasterTokenAvailable:function(){return this.builder.getPeerMasterToken()?!0:!1},isPeerUserIdTokenAvailable:function(){return this.builder.getPeerUserIdToken()?!0:!1},getPrimaryServiceTokens:function(){return this.builder.getServiceTokens()},getPeerServiceTokens:function(){return this.builder.getPeerServiceTokens()},addPrimaryServiceToken:function(a){try{return this.builder.addServiceToken(a),!0}catch(b){if(b instanceof
Ba)return!1;throw b;}},addPeerServiceToken:function(a){try{return this.builder.addPeerServiceToken(a),!0}catch(b){if(b instanceof Ba)return!1;throw b;}},addUnboundPrimaryServiceToken:function(c,f,d,h,g){var m=this;b(g,function(){var E=a(c,this.cryptoContexts);if(!E)return!1;Lc(this.ctx,c,f,null,null,d,h,E,{result:function(a){b(g,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof Ba)throw new R("Service token bound to incorrect authentication tokens despite being unbound.",b);
throw b;}return!0},m)},error:function(a){g.error(a)}})},m)},addUnboundPeerServiceToken:function(c,f,d,h,g){var m=this;b(g,function(){var E=a(c,this.cryptoContexts);if(!E)return!1;Lc(this.ctx,c,f,null,null,d,h,E,{result:function(a){b(g,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof Ba)throw new R("Service token bound to incorrect authentication tokens despite being unbound.",b);throw b;}return!0},m)},error:function(a){g.error(a)}})},m)},addMasterBoundPrimaryServiceToken:function(f,
d,h,g,D){var n=this;b(D,function(){var E=c(this);if(!E)return!1;var A=a(f,this.cryptoContexts);if(!A)return!1;Lc(this.ctx,f,d,E,null,h,g,A,{result:function(a){b(D,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof Ba)throw new R("Service token bound to incorrect authentication tokens despite setting correct master token.",b);throw b;}return!0},n)},error:function(a){D.error(a)}})},n)},addMasterBoundPeerServiceToken:function(c,f,d,h,g){var m=this;b(g,function(){var E=this.builder.getPeerMasterToken();
if(!E)return!1;var A=a(c,this.cryptoContexts);if(!A)return!1;Lc(this.ctx,c,f,E,null,d,h,A,{result:function(a){b(g,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof Ba)throw new R("Service token bound to incorrect authentication tokens despite setting correct master token.",b);throw b;}return!0},m)},error:function(a){g.error(a)}})},m)},addUserBoundPrimaryServiceToken:function(f,d,h,g,D){var n=this;b(D,function(){var E=c(this);if(!E)return!1;var A=this.builder.getUserIdToken();
if(!A)return!1;var L=a(f,this.cryptoContexts);if(!L)return!1;Lc(this.ctx,f,d,E,A,h,g,L,{result:function(a){b(D,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof Ba)throw new R("Service token bound to incorrect authentication tokens despite setting correct master token and user ID token.",b);throw b;}return!0},n)},error:function(a){D.error(a)}})},n)},addUserBoundPeerServiceToken:function(c,f,d,h,g){var m=this;b(g,function(){var E=this.builder.getPeerMasterToken();if(!E)return!1;
var A=this.builder.getPeerUserIdToken();if(!A)return!1;var n=a(c,this.cryptoContexts);if(!n)return!1;Lc(this.ctx,c,f,E,A,d,h,n,{result:function(a){b(g,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof Ba)throw new R("Service token bound to incorrect authentication tokens despite setting correct master token and user ID token.",b);throw b;}return!0},m)},error:function(a){g.error(a)}})},m)},excludePrimaryServiceToken:function(a){for(var b=this.builder.getServiceTokens(),c=
0;c<b.length;++c)if(b[c].name==a)return this.builder.excludeServiceToken(a),!0;return!1},excludePeerServiceToken:function(a){for(var b=this.builder.getPeerServiceTokens(),c=0;c<b.length;++c)if(b[c].name==a)return this.builder.excludePeerServiceToken(a),!0;return!1},deletePrimaryServiceToken:function(a,c){b(c,function(){for(var b=this.builder.getServiceTokens(),f=0;f<b.length;++f)if(b[f].name==a){this.builder.deleteServiceToken(a,{result:function(){c.result(!0)},error:function(a){c.error(a)}});return}return!1},
this)},deletePeerServiceToken:function(a,c){b(c,function(){for(var b=this.builder.getPeerServiceTokens(),f=0;f<b.length;++f)if(b[f].name==a){this.builder.deletePeerServiceToken(a,{result:function(){c.result(!0)},error:function(a){c.error(a)}});return}return!1},this)}})})();var ag,bf;(function(){function c(f,d,l,h){b(h,function(){function c(){b(h,function(){if(q>=l.length){if(n)throw n;throw new Qa(a.KEYX_RESPONSE_REQUEST_MISMATCH,JSON.stringify(l));}var d=l[q];E!=d.keyExchangeScheme?(++q,c()):A.getCryptoContext(f,
d,w,g,{result:h.result,error:function(a){b(h,function(){if(!(a instanceof F))throw a;n=a;++q;c()})}})})}var g=d.masterToken,w=d.keyResponseData;if(!w)return null;var E=w.keyExchangeScheme,A=f.getKeyExchangeFactory(E);if(!A)throw new Qa(a.KEYX_FACTORY_NOT_FOUND,E);var n,q=0;c()})}ag=Ke.extend({init:function(b,d,l,h,g,D,n){var E=this;f(n,function(){function f(){E._ready=!0;E._readyQueue.add(!0)}function n(a,b){try{var c=b.masterToken;a.getTokenFactory().isMasterTokenRevoked(a,c,{result:function(d){d?
(E._errored=(new oc(d,c)).setUser(b.userIdToken).setUser(b.userAuthenticationData).setMessageId(b.messageId),f()):q(a,b)},error:function(a){a instanceof F&&(a.setEntity(b.masterToken),a.setUser(b.userIdToken),a.setUser(b.userAuthenticationData),a.setMessageId(b.messageId));E._errored=a;f()}})}catch(d){d instanceof F&&(d.setEntity(b.masterToken),d.setUser(b.userIdToken),d.setUser(b.userAuthenticationData),d.setMessageId(b.messageId)),E._errored=d,f()}}function q(a,b){try{var c=b.masterToken,d=b.userIdToken;
d?a.getTokenFactory().isUserIdTokenRevoked(a,c,d,{result:function(k){k?(E._errored=(new MslUserIdTokenException(k,d)).setEntity(c).setUser(d).setMessageId(b.messageId),f()):la(a,b)},error:function(a){a instanceof F&&(a.setEntity(b.masterToken),a.setUser(b.userIdToken),a.setUser(b.userAuthenticationData),a.setMessageId(b.messageId));E._errored=a;f()}}):la(a,b)}catch(k){k instanceof F&&(k.setEntity(b.masterToken),k.setUser(b.userIdToken),k.setUser(b.userAuthenticationData),k.setMessageId(b.messageId)),
E._errored=k,f()}}function la(b,c){try{var d=c.masterToken;d.isExpired()?c.isRenewable()&&0!=c.keyRequestData.length?b.getTokenFactory().isMasterTokenRenewable(b,d,{result:function(a){a?(E._errored=(new Ba(a,"Master token is expired and not renewable.")).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),f()):B(b,c)},error:function(a){a instanceof F&&(a.setEntity(c.masterToken),a.setUser(c.userIdToken),a.setUser(c.userAuthenticationData),a.setMessageId(c.messageId));
E._errored=a;f()}}):(E._errored=(new Ba(a.MESSAGE_EXPIRED,JSON.stringify(c))).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),f()):B(b,c)}catch(k){k instanceof F&&(k.setEntity(c.masterToken),k.setUser(c.userIdToken),k.setUser(c.userAuthenticationData),k.setMessageId(c.messageId)),E._errored=k,f()}}function B(b,c){try{var d=c.masterToken,k=c.nonReplayableId;"number"===typeof k?d?b.getTokenFactory().acceptNonReplayableId(b,d,k,{result:function(b){b||(E._errored=
(new Ba(a.MESSAGE_REPLAYED,JSON.stringify(c))).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId));f()},error:function(a){a instanceof F&&(a.setEntity(d),a.setUser(c.userIdToken),a.setUser(c.userAuthenticationData),a.setMessageId(c.messageId));E._errored=a;f()}}):(E._errored=(new Ba(a.INCOMPLETE_NONREPLAYABLE_MESSAGE,JSON.stringify(c))).setEntity(c.entityAuthenticationData).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),
f()):f()}catch(l){l instanceof F&&(l.setEntity(c.masterToken),l.setEntity(c.entityAuthenticationData),l.setUser(c.userIdToken),l.setUser(c.userAuthenticationData),l.setMessageId(c.messageId)),E._errored=l,f()}}var N={_source:{value:d,writable:!1,enumerable:!1,configurable:!1},_parser:{value:K,writable:!0,enumerable:!1,configurable:!1},_charset:{value:l,writable:!1,enumerable:!1,configurable:!1},_remainingData:{value:"",writable:!0,enumerable:!1,configurable:!1},_timeout:{value:D,writable:!1,enumerable:!1,
configurable:!1},_header:{value:K,writable:!0,enumerable:!1,configurable:!1},_cryptoContext:{value:K,writable:!0,enumerable:!1,configurable:!1},_keyxCryptoContext:{value:K,writable:!0,enumerable:!1,configurable:!1},_payloadSequenceNumber:{value:1,writable:!0,enuemrable:!1,configurable:!1},_eom:{value:!1,writable:!0,enumerable:!1,configurable:!1},_closeSource:{value:!1,writable:!0,enumerable:!1,configurable:!1},_payloads:{value:[],writable:!0,enumerable:!1,configurable:!1},_payloadIndex:{value:-1,
writable:!0,enumerable:!1,configurable:!1},_payloadOffset:{value:0,writable:!0,enuemrable:!1,configurable:!1},_markOffset:{value:0,writable:!0,enumerable:!1,configurable:!1},_currentPayload:{value:null,writable:!0,enumerable:!1,configurable:!1},_readException:{value:null,writable:!0,enumerable:!1,configurable:!1},_ready:{value:!1,writable:!0,enumerable:!1,configurable:!1},_readyQueue:{value:new Ha,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},
_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_errored:{value:null,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,N);Mf(E._source,D,{result:function(d){E._json=d;E._jsonIndex=0;null===E._json?(E._errored=new aa(a.MESSAGE_DATA_MISSING),f()):Rf(b,E._json[E._jsonIndex++],g,{result:function(a){E._header=a;if(E._header instanceof bd)E._keyxCryptoContext=null,E._cryptoContext=null,f();else{var d=E._header;c(b,d,h,{result:function(a){try{E._keyxCryptoContext=a;
b.isPeerToPeer()||!E._keyxCryptoContext?E._cryptoContext=d.cryptoContext:E._cryptoContext=E._keyxCryptoContext;try{var c=d.masterToken;c&&(b.isPeerToPeer()||c.isVerified())?n(b,d):B(b,d)}catch(k){k instanceof F&&(k.setEntity(d.masterToken),k.setUser(d.userIdToken),k.setUser(d.userAuthenticationData),k.setMessageId(d.messageId)),E._errored=k,f()}}catch(l){l instanceof F&&(l.setEntity(d.masterToken),l.setEntity(d.entityAuthenticationData),l.setUser(d.userIdToken),l.setUser(d.userAuthenticationData),
l.setMessageId(d.messageId)),E._errored=l,f()}},error:function(a){a instanceof F&&(a.setEntity(d.masterToken),a.setEntity(d.entityAuthenticationData),a.setUser(d.userIdToken),a.setUser(d.userAuthenticationData),a.setMessageId(d.messageId));E._errored=a;f()}})}},error:function(a){E._errored=a;f()}})},timeout:function(){E._timedout=!0;f()},error:function(a){E._errored=a;f()}});return this},E)},nextData:function(b,c){var d=this;f(c,function(){function b(a){f(a,function(){var c;if(this._jsonIndex<this._json.length)return c=
this._json[this._jsonIndex++];Mf(this._source,this._timeout,{result:function(c){c&&c.length&&0<c.length?(c.forEach(function(a){this._json.push(a)}),b(a)):(this._eom=!0,a.result(null))},timeout:function(){a.timeout()},error:function(b){a.error(b)}})},d)}var h=this.getMessageHeader();if(!h)throw new R("Read attempted with error message.");if(-1!=this._payloadIndex&&this._payloadIndex<this._payloads.length)return this._payloads[this._payloadIndex++];if(this._eom)return null;b({result:function(b){f(c,
function(){if(!b)return null;if("object"!==typeof b)throw new aa(a.MESSAGE_FORMAT_ERROR);$e(b,this._cryptoContext,{result:function(b){f(c,function(){var c=h.masterToken,f=h.entityAuthenticationData,d=h.userIdToken,k=h.getUserAuthenticationData;if(b.messageId!=h.messageId)throw(new Ba(a.PAYLOAD_MESSAGE_ID_MISMATCH,"payload mid "+b.messageId+" header mid "+h.messageId)).setEntity(c).setEntity(f).setUser(d).setUser(k);if(b.sequenceNumber!=this._payloadSequenceNumber)throw(new Ba(a.PAYLOAD_SEQUENCE_NUMBER_MISMATCH,
"payload seqno "+b.sequenceNumber+" expected seqno "+this._payloadSequenceNumber)).setEntity(c).setEntity(f).setUser(d).setUser(k);++this._payloadSequenceNumber;b.isEndOfMessage()&&(this._eom=!0);c=b.data;this._payloads.push(c);this._payloadIndex=-1;return c},d)},error:function(b){b instanceof SyntaxError&&(b=new aa(a.JSON_PARSE_ERROR,"payloadchunk",b));c.error(b)}})},d)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},d)},isReady:function(a,b){function c(){f(b,function(){if(this._aborted)return!1;
if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;return!0}},d)}var d=this;f(b,function(){this._ready?c():this._readyQueue.poll(a,{result:function(a){f(b,function(){if(a===K)return!1;c()},d)},timeout:function(){b.timeout()},error:function(a){b.error(a)}})},d)},getMessageHeader:function(){return this._header instanceof Od?this._header:null},getErrorHeader:function(){return this._header instanceof bd?this._header:null},getIdentity:function(){var a=this.getMessageHeader();if(a){var b=
a.masterToken;return b?b.identity:a.entityAuthenticationData.getIdentity()}return this.getErrorHeader().entityAuthenticationData.getIdentity()},getCustomer:function(){var a=this.getMessageHeader();return a?a.customer:null},getPayloadCryptoContext:function(){return this._cryptoContext},getKeyExchangeCryptoContext:function(){return this._keyxCryptoContext},closeSource:function(a){this._closeSource=a},abort:function(){this._aborted=!0;this._source.abort();this._readyQueue.cancelAll()},close:function(){this._closeSource&&
this._source.close()},mark:function(){if(this._currentPayload){for(;0<this._payloads.length&&this._payloads[0]!==this._currentPayload;)this._payloads.shift();this._payloadIndex=0;this._currentPayload=this._payloads[this._payloadIndex++];this._markOffset=this._payloadOffset}else this._payloadIndex=-1,this._payloads=[]},markSupported:function(){return!0},read:function(a,b,c){function d(){f(c,function(){function d(c){f(c,function(){if(u&&n>=u.length)return u.subarray(0,n);var l=-1;if(this._currentPayload){var g=
this._currentPayload.length-this._payloadOffset;if(!u){var q=g;if(-1!=this._payloadIndex)for(var la=this._payloadIndex;la<this._payloads.length;++la)q+=this._payloads[la].length;0<q&&(u=new Uint8Array(q))}g=Math.min(g,u?u.length-n:0);0<g&&(l=this._currentPayload.subarray(this._payloadOffset,this._payloadOffset+g),u.set(l,w),l=g,w+=g,this._payloadOffset+=g)}-1!=l?(n+=l,d(c)):this.nextData(b,{result:function(b){f(c,function(){if(this._aborted)return u?u.subarray(0,n):new Uint8Array(0);this._currentPayload=
b;this._payloadOffset=0;if(this._currentPayload)d(c);else return 0==n&&0!=a?null:u?u.subarray(0,n):new Uint8Array(0)},h)},timeout:function(){c.timeout(u?u.subarray(0,n):new Uint8Array(0))},error:function(a){f(c,function(){a instanceof F&&(a=new pb("Error reading the payload chunk.",a));if(0<n)return h._readException=a,u.subarray(0,n);throw a;},h)}})},h)}if(this._aborted)return new Uint8Array(0);if(this._timedout)c.timeout(new Uint8Array(0));else{if(this._errored)throw this._errored;if(null!=this._readException){var g=
this._readException;this._readException=null;throw g;}var u=-1!=a?new Uint8Array(a):K,w=0,n=0;d(c)}},h)}var h=this;f(c,function(){if(-1>a)throw new RangeError("read requested with illegal length "+a);this._ready?d():this._readyQueue.poll(b,{result:function(a){a===K?c.result(!1):d()},timeout:function(){c.timeout(new Uint8Array(0))},error:function(a){c.error(a)}})},h)},reset:function(){this._payloadIndex=0;0<this._payloads.length?(this._currentPayload=this._payloads[this._payloadIndex++],this._payloadOffset=
this._markOffset):this._currentPayload=null}});bf=function(a,b,c,f,d,h,g){new ag(a,b,c,f,d,h,g)}})();var cf,pe;(function(){cf=ie.extend({init:function(a,b,c,d,h,g,n){var q=this;f(n,function(){function f(){q._ready=!0;q._readyQueue.add(!0)}var n=We(a.getMessageCapabilities(),d.messageCapabilities),D=null;n&&(D=Id(n.compressionAlgorithms));n={_destination:{value:b,writable:!1,enumerable:!1,configurable:!1},_charset:{value:c,writable:!1,enumerable:!1,configurable:!1},_capabilities:{value:n,writable:!1,
enumerable:!1,configurable:!1},_header:{value:d,writable:!1,enumerable:!1,configurable:!1},_compressionAlgo:{value:D,writable:!0,enumerable:!1,configurable:!1},_cryptoContext:{value:h,writable:!1,enumerable:!1,configurable:!1},_payloadSequenceNumber:{value:1,writable:!0,enumerable:!1,configurable:!1},_currentPayload:{value:[],writable:!0,enumerable:!1,configurable:!1},_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_payloads:{value:[],writable:!1,enumerable:!1,configurable:!1},_ready:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_readyQueue:{value:new Ha,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_errored:{value:null,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,n);var Y=S(JSON.stringify(d),c);b.write(Y,0,Y.length,g,{result:function(a){try{q._aborted?f():a<Y.length?(q._timedout=!0,f()):b.flush(g,{result:function(a){q._aborted||(q._timedout=
!a);f()},timeout:function(){q._timedout=!0;f()},error:function(a){q._errored=a;f()}})}catch(c){q._errored=c,f()}},timeout:function(){q._timedout=!0;f()},error:function(a){q._errored=a;f()}});return this},q)},setCompressionAlgorithm:function(a,b,c){function d(){h.flush(b,{result:function(b){f(c,function(){if(!b)throw new pb("flush() aborted");this._compressionAlgo=a;return!0},h)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})}var h=this;f(c,function(){if(!this.getMessageHeader())throw new R("Cannot write payload data for an error message.");
if(this._compressionAlgo==a)return!0;if(a){if(!this._capabilities)return!1;for(var b=this._capabilities.compressionAlgorithms,c=0;c<b.length;++c)if(b[c]==a){d();return}return!1}d()},h)},getMessageHeader:function(){return this._header instanceof Od?this._header:null},getErrorMessage:function(){return this._header instanceof bd?this._header:null},getPayloads:function(){return this._payloads},abort:function(){this._aborted=!0;this._destination.abort();this._readyQueue.cancelAll()},close:function(a,b){var c=
this;f(b,function(){if(this._aborted)return!1;if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;if(this._closed)return!0;this._closed=!0;this.flush(a,{result:function(a){f(b,function(){a&&(this._currentPayload=null);return a},c)},timeout:function(){b.timeout()},error:function(a){b.error(a)}})}},c)},flush:function(a,b){function c(){f(b,function(){if(this._aborted)return!1;if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;if(!this._currentPayload||!this._closed&&
0==this._currentPayload.length)return!0;var c=this.getMessageHeader();if(!c)return!0;var k=0;this._currentPayload&&this._currentPayload.forEach(function(a){k+=a.length});for(var h=new Uint8Array(k),g=0,n=0;this._currentPayload&&n<this._currentPayload.length;++n){var A=this._currentPayload[n];h.set(A,g);g+=A.length}Ze(this._payloadSequenceNumber,c.messageId,this._closed,this._compressionAlgo,h,this._cryptoContext,{result:function(c){f(b,function(){this._payloads.push(c);var k=S(JSON.stringify(c),this._charset);
this._destination.write(k,0,k.length,a,{result:function(k){f(b,function(){if(this._aborted)return!1;k<c.length?b.timeout():this._destination.flush(a,{result:function(a){f(b,function(){if(this._aborted)return!1;if(a)return++this._payloadSequenceNumber,this._currentPayload=this._closed?null:[],!0;b.timeout()},d)},timeout:function(){b.timeout()},error:function(a){a instanceof F&&(a=new pb("Error encoding payload chunk [sequence number "+d._payloadSequenceNumber+"].",a));b.error(a)}})},d)},timeout:function(a){b.timeout()},
error:function(a){a instanceof F&&(a=new pb("Error encoding payload chunk [sequence number "+d._payloadSequenceNumber+"].",a));b.error(a)}})},d)},error:function(a){a instanceof F&&(a=new pb("Error encoding payload chunk [sequence number "+d._payloadSequenceNumber+"].",a));b.error(a)}})}},d)}var d=this;f(b,function(){this._ready?c():this._readyQueue.poll(a,{result:function(a){a===K?b.result(!1):c()},timeout:function(){b.timeout()},error:function(a){b.error(a)}})},d)},write:function(a,b,c,d,h){f(h,
function(){if(this._aborted)return!1;if(this._timedout)h.timeout();else{if(this._errored)throw this._errored;if(this._closed)throw new pb("Message output stream already closed.");if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");if(!this.getMessageHeader())throw new R("Cannot write payload data for an error message.");var f=a.subarray(b,
b+c);this._currentPayload.push(f);return f.length}},this)}});pe=function(a,b,c,f,d,h,g){new cf(a,b,c,f,d,h,g)}})();var bg=ca.Class.create({sentHeader:function(a){},receivedHeader:function(a){}});Object.freeze({USERDATA_REAUTH:d.USERDATA_REAUTH,SSOTOKEN_REJECTED:d.SSOTOKEN_REJECTED});var yd=ca.Class.create({getCryptoContexts:function(){},getRecipient:function(){},isEncrypted:function(){},isIntegrityProtected:function(){},isNonReplayable:function(){},isRequestingTokens:function(){},getUserId:function(){},
getUserAuthData:function(a,b,c,f){},getCustomer:function(){},getKeyRequestData:function(a){},updateServiceTokens:function(a,b,c){},write:function(a,b,c){},getDebugContext:function(){}});ca.Class.create({getInputStream:function(a){},getOutputStream:function(a){}});var df;(function(){function c(a){return function(){a.abort()}}function h(a,b){Object.defineProperties(this,{masterToken:{value:a,writable:!1,configurable:!1},ticket:{value:b,writable:!1,configurable:!1}})}function k(a,b){Object.defineProperties(this,
{builder:{value:a,writable:!1,configurable:!1},msgCtx:{value:b,writable:!1,configurable:!1}})}function l(a,b,c){Object.defineProperties(this,{requestHeader:{value:a,writable:!1,configurable:!1},payloads:{value:b,writable:!1,configurable:!1},handshake:{value:c,writable:!1,configurable:!1}})}function g(a,b){Object.defineProperties(this,{requestHeader:{value:b.requestHeader,writable:!1,configurable:!1},payloads:{value:b.payloads,writable:!1,configurable:!1},handshake:{value:b.handshake,writable:!1,configurable:!1},
response:{value:a,writable:!1,configurable:!1}})}function r(a){for(;a;){if(a instanceof sb)return!0;a=a instanceof F?a.cause:K}return!1}function n(a,b,c,d,k,h,l,g,m){$f(b,d,k,h,{result:function(d){c&&c.sentHeader(d);pe(b,l,ma,d,null,null,g,{result:function(b){a.setAbort(function(){b.abort()});b.close(g,{result:function(a){f(m,function(){if(!a)throw new sb("sendError aborted.");return a})},timeout:function(){m.timeout()},error:function(a){m.error(a)}})},timeout:function(){},error:function(a){m.error(a)}})},
error:function(a){m.error(a)}})}var q=ie.extend({close:function(a,b){b.result(!0)},write:function(a,c,f,d,k){b(k,function(){return Math.min(a.length-c,f)})},flush:function(a,b){b.result(!0)}}),E=Ng.extend({getUserMessage:function(a,b){return null}}),A=yd.extend({init:function(a){Object.defineProperties(this,{_appCtx:{value:a,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContexts:function(){return this._appCtx.getCryptoContexts()},isEncrypted:function(){return this._appCtx.isEncrypted()},
isIntegrityProtected:function(){return this._appCtx.isIntegrityProtected()},isNonReplayable:function(){return this._appCtx.isNonReplayable()},isRequestingTokens:function(){return this._appCtx.isRequestingTokens()},getUserId:function(){return this._appCtx.getUserId()},getUserAuthData:function(a,b,c,f){this._appCtx.getUserAuthData(a,b,c,f)},getCustomer:function(){return this._appCtx.getCustomer()},getKeyRequestData:function(a){this._appCtx.getKeyRequestData(a)},updateServiceTokens:function(a,b,c){this._appCtx.updateServiceTokens(a,
b,c)},write:function(a,b,c){this._appCtx.write(a,b,c)},getDebugContext:function(){return this._appCtx.getDebugContext()}}),L=A.extend({init:function oa(a,b){oa.base.call(this,b);Object.defineProperties(this,{_payloads:{value:a,writable:!1,enumerable:!1,configurable:!1}})},write:function(a,b,c){function d(h,l){if(h==k._payloads.length)c.result(!0);else{var g=k._payloads[h];a.setCompressionAlgorithm(g.compressionAlgo,b,{result:function(m){a.write(g.data,0,g.data.length,b,{result:function(m){f(c,function(){g.isEndOfMessage()?
d(h+1,l):a.flush(b,{result:function(a){c.result(a)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},k)},timeout:function(a){c.timeout(a)},error:function(a){c.error(a)}})},timeout:function(){},error:function(a){c.error(a)}})}}var k=this;d(0)}}),Y=A.extend({init:function Ka(a){Ka.base.call(this,a)},isEncrypted:function(){return!1},isNonReplayable:function(){return!1},write:function(a,b,c){c.result(!0)}}),B={},N,T,da,ea,S=ca.Class.create({init:function(a){a||(a=new E);Object.defineProperties(this,
{_filterFactory:{value:null,writable:!0,enumerable:!1,configurable:!1},_renewingContexts:{value:[],writable:!1,enumerable:!1,configurable:!1},_masterTokenLocks:{value:{},writable:!1,enumerable:!1,configurable:!1},_messageRegistry:{value:a,writable:!1,enumerable:!1,configurable:!1}})},setFilterFactory:function(a){this._filterFactory=a},getNewestMasterToken:function(a,b,c,d){var k=this;f(d,function(){var l=b.getMslStore(),g=l.getMasterToken();if(!g)return null;var u=g.uniqueKey(),r=this._masterTokenLocks[u];
r||(r=new Gc,this._masterTokenLocks[u]=r);var n=r.readLock(c,{result:function(n){f(d,function(){if(n===K)throw new sb("getNewestMasterToken aborted.");var A=l.getMasterToken();if(g.equals(A))return new h(g,n);r.unlock(n);r.writeLock(c,{result:function(h){f(d,function(){if(h===K)throw new sb("getNewestMasterToken aborted.");delete this._masterTokenLocks[u];r.unlock(h);return this.getNewestMasterToken(a,b,c,d)},k)},timeout:function(){d.timeout()},error:function(a){d.error(a)}})},k)},timeout:function(){d.timeout()},
error:function(a){d.error(a)}});a.setAbort(function(){n&&(r.cancel(n),n=K)})},k)},deleteMasterToken:function(a,b){if(b){var c=this;setTimeout(function(){var f=b.uniqueKey(),d=c._masterTokenLocks[f];d||(d=new Gc,c._masterTokenLocks[f]=d);d.writeLock(-1,{result:function(k){a.getMslStore().removeCryptoContext(b);delete c._masterTokenLocks[f];d.unlock(k)},timeout:function(){throw new R("Unexpected timeout received.");},error:function(a){throw a;}})},0)}},releaseMasterToken:function(a){if(a&&a.masterToken){var b=
a.masterToken.uniqueKey(),b=this._masterTokenLocks[b];if(!b)throw new R("Master token read/write lock does not exist when it should.");b.unlock(a.ticket)}},updateOutgoingCryptoContexts:function(a,b,c){var f=a.getMslStore();!a.isPeerToPeer()&&c&&(f.setCryptoContext(c.keyResponseData.masterToken,c.cryptoContext),this.deleteMasterToken(a,b.masterToken))},updateIncomingCryptoContexts:function(a,b,c){var f=c.getMessageHeader();if(f){var d=a.getMslStore();if(f=f.keyResponseData)d.setCryptoContext(f.masterToken,
c.getKeyExchangeCryptoContext()),this.deleteMasterToken(a,b.masterToken)}},storeServiceTokens:function(a,b,c,f){a=a.getMslStore();for(var d=[],k=0;k<f.length;++k){var h=f[k];if(!h.isBoundTo(b)||!b.isVerified()){var l=h.data;l&&0==l.length?a.removeServiceTokens(h.name,h.isMasterTokenBound()?b:null,h.isUserIdTokenBound()?c:null):d.push(h)}}0<d.length&&a.addServiceTokens(d)},buildRequest:function(a,c,f,d,k){var h=this;this.getNewestMasterToken(a,c,d,{result:function(a){b(k,function(){var d=a&&a.masterToken,
l;if(d){l=f.getUserId();var g=c.getMslStore();l=(l=l?g.getUserIdToken(l):null)&&l.isBoundTo(d)?l:null}else l=null;Uc(c,d,l,null,{result:function(c){b(k,function(){c.setNonReplayable(f.isNonReplayable());return{builder:c,tokenTicket:a}})},error:function(c){b(k,function(){this.releaseMasterToken(a);c instanceof F&&(c=new R("User ID token not bound to master token despite internal check.",c));throw c;},h)}})},h)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},buildResponse:function(a,
b,c,d,k,h){var l=this;Qd(b,d,{result:function(g){f(h,function(){g.setNonReplayable(c.isNonReplayable());if(!b.isPeerToPeer()&&!d.keyResponseData)return{builder:g,tokenTicket:null};this.getNewestMasterToken(a,b,k,{result:function(a){f(h,function(){var f=a&&a.masterToken,d;if(f){d=c.getUserId();var k=b.getMslStore();d=(d=d?k.getUserIdToken(d):null)&&d.isBoundTo(f)?d:null}else d=null;g.setAuthTokens(f,d);return{builder:g,tokenTicket:a}},l)},timeout:function(){h.timeout()},error:function(a){h.error(a)}})},
l)},error:function(a){h.error(a)}})},buildErrorResponse:function(a,b,c,h,l,g,m){function u(a,d){f(m,function(){var h=gd(l.messageId),g=new L(d,c);Uc(b,null,null,h,{result:function(c){f(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(a.peerMasterToken,a.peerUserIdToken);c.setNonReplayable(g.isNonReplayable());return{errorResult:new k(c,g),tokenTicket:null}},n)},error:function(a){m.error(a)}})},n)}function r(d,h){n.getNewestMasterToken(a,b,g,{result:function(a){f(m,function(){var g=a&&a.masterToken,
u=gd(l.messageId),r=new L(h,c);Uc(b,g,null,u,{result:function(c){f(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(d.peerMasterToken,d.peerUserIdToken);c.setNonReplayable(r.isNonReplayable());return{errorResult:new k(c,r),tokenTicket:a}},n)},error:function(a){m.error(a)}})},n)},timeout:function(){m.timeout()},error:function(a){m.error(a)}})}var n=this;f(m,function(){var A=h.requestHeader,w=h.payloads,q=l.errorCode;switch(q){case d.ENTITYDATA_REAUTH:case d.ENTITY_REAUTH:b.getEntityAuthenticationData(q,
{result:function(a){f(m,function(){if(!a)return null;u(A,w)},n)},error:function(a){m.error(a)}});break;case d.USERDATA_REAUTH:case d.SSOTOKEN_REJECTED:c.getUserAuthData(q,!1,!0,{result:function(a){f(m,function(){if(!a)return null;r(A,w)},n)},error:function(a){m.error(a)}});break;case d.USER_REAUTH:r(A,w);break;case d.KEYX_REQUIRED:var q=gd(l.messageId),D=new L(w,c);Uc(b,null,null,q,{result:function(a){f(m,function(){b.isPeerToPeer()&&a.setPeerAuthTokens(A.peerMasterToken,A.peerUserIdToken);a.setRenewable(!0);
a.setNonReplayable(D.isNonReplayable());return{errorResult:new k(a,D),tokenTicket:null}},n)},error:function(a){m.error(a)}});break;case d.EXPIRED:this.getNewestMasterToken(a,b,g,{result:function(a){f(m,function(){var d=a&&a.masterToken,h=A.userIdToken,g=gd(l.messageId),u=new L(w,c);Uc(b,d,h,g,{result:function(c){f(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(A.peerMasterToken,A.peerUserIdToken);A.masterToken.equals(d)&&c.setRenewable(!0);c.setNonReplayable(u.isNonReplayable());return{errorResult:new k(c,
u),tokenTicket:a}},n)},error:function(a){m.error(a)}},n)},n)},timeout:function(){m.timeout()},error:function(a){m.error(a)}});break;case d.REPLAYED:this.getNewestMasterToken(a,b,g,{result:function(a){f(m,function(){var d=a&&a.masterToken,h=A.userIdToken,g=gd(l.messageId),u=new L(w,c);Uc(b,d,h,g,{result:function(c){f(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(A.peerMasterToken,A.peerUserIdToken);A.masterToken.equals(d)?(c.setRenewable(!0),c.setNonReplayable(!1)):c.setNonReplayable(u.isNonReplayable());
return{errorResult:new k(c,u),tokenTicket:a}},n)},error:function(a){m.error(a)}})},n)},timeout:function(){m.timeout()},error:function(a){m.error(a)}});break;default:return null}},n)},cleanupContext:function(a,b,c){switch(c.errorCode){case d.ENTITY_REAUTH:this.deleteMasterToken(a,b.masterToken);break;case d.USER_REAUTH:c=b.userIdToken,b.masterToken&&c&&a.getMslStore().removeUserIdToken(c)}},send:function(a,b,c,d,k,h,g){function m(a,d,h){f(g,function(){var l=k.getPeerUserIdToken();!b.isPeerToPeer()&&
!d||b.isPeerToPeer()&&!l?(l=c.getCustomer())?k.setCustomer(l,{result:function(b){f(g,function(){d=k.getUserIdToken();u(a,d,h)},w)},error:function(a){g.error(a)}}):u(a,d,h):u(a,d,h)},w)}function u(a,b,d){f(g,function(){var h=!d&&(!c.isEncrypted()||k.willEncryptPayloads())&&(!c.isIntegrityProtected()||k.willIntegrityProtectPayloads())&&(!c.isNonReplayable()||k.isNonReplayable()&&a);h||k.setNonReplayable(!1);var l=[];k.isRenewable()&&(!a||a.isRenewable()||c.isNonReplayable())?c.getKeyRequestData({result:function(c){f(g,
function(){for(var f=0;f<c.length;++f){var d=c[f];l.push(d);k.addKeyRequestData(d)}r(a,b,h,l)},w)},error:function(a){g.error(a)}}):r(a,b,h,l)},w)}function r(l,m,u,A){f(g,function(){var r=new oe(b,c,k);c.updateServiceTokens(r,!u,{result:function(r){k.getHeader({result:function(r){f(g,function(){var f=c.getDebugContext();f&&f.sentHeader(r);f=k.getKeyExchangeData();this.updateOutgoingCryptoContexts(b,r,f);this.storeServiceTokens(b,l,m,r.serviceTokens);f=!b.isPeerToPeer()&&f?f.cryptoContext:r.cryptoContext;
if(a.isAborted())throw new sb("send aborted.");var A=null!=this._filterFactory?this._filterFactory.getOutputStream(d):d;pe(b,A,ma,r,f,h,{result:function(b){a.setAbort(function(){b.abort()});n(b,r,u)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})},w)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})},error:function(a){g.error(a)}})},w)}function n(d,k,l){if(l)c.write(d,h,{result:function(b){f(g,function(){if(a.isAborted())throw new sb("MessageOutputStream write aborted.");
A(d,k,l)},w)},timeout:function(){g.timeout()},error:function(a){g.error(a)}});else{var m=new q,u=new Kc;pe(b,m,ma,k,u,h,{result:function(b){c.write(b,h,{result:function(c){f(g,function(){if(a.isAborted())throw new sb("MessageOutputStream proxy write aborted.");b.close(h,{result:function(a){f(g,function(){if(!a)throw new sb("MessageOutputStream proxy close aborted.");var c=b.getPayloads();A(d,k,l,c)},w)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})},w)},timeout:function(){g.timeout()},
error:function(a){g.error(a)}})},timeout:function(){g.timeout()},error:function(a){g.error(a)}})}}function A(a,b,c,d){a.close(h,{result:function(k){f(g,function(){if(!k)throw new sb("MessageOutputStream close aborted.");d||(d=a.getPayloads());return new l(b,d,!c)},w)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})}var w=this;f(g,function(){var a=k.getMasterToken(),b=k.getUserIdToken(),d=!1;if(c.getUserId()){var h=!b;c.getUserAuthData(null,k.isRenewable(),h,{result:function(c){f(g,
function(){c&&(k.willEncryptHeader()&&k.willIntegrityProtectHeader()?k.setUserAuthenticationData(c):d=!0);m(a,b,d)},w)},error:function(a){g.error(a)}})}else m(a,b,d)},w)},receive:function(b,c,k,h,l,g,m){var u=this;f(m,function(){if(b.isAborted())throw new sb("receive aborted.");var r=[];l&&(r=l.keyRequestData.filter(function(){return!0}));var n=k.getCryptoContexts(),A=this._filterFactory?this._filterFactory.getInputStream(h):h;bf(c,A,ma,r,n,g,{result:function(h){b.setAbort(function(){h.abort()});
h.isReady(g,{result:function(b){f(m,function(){if(!b)throw new sb("MessageInputStream aborted.");var g=h.getMessageHeader(),r=h.getErrorHeader(),n=k.getDebugContext();n&&n.receivedHeader(g?g:r);if(l&&(n=r?r.errorCode:null,g||n!=d.FAIL&&n!=d.TRANSIENT_FAILURE&&n!=d.ENTITY_REAUTH&&n!=d.ENTITYDATA_REAUTH)){var n=g?g.messageId:r.messageId,A=gd(l.messageId);if(n!=A)throw new Ba(a.UNEXPECTED_RESPONSE_MESSAGE_ID,"expected "+A+"; received "+n);}c.getEntityAuthenticationData(null,{result:function(b){f(m,function(){var f=
b.getIdentity(),d;if(g){d=g.entityAuthenticationData;var m=g.masterToken;d=m?g.sender:d.getIdentity();if(m&&m.isDecrypted()&&m.identity!=d||f==d)throw new Ba(a.UNEXPECTED_MESSAGE_SENDER,d);l&&this.updateIncomingCryptoContexts(c,l,h);f=g.keyResponseData;c.isPeerToPeer()?(f=f?f.masterToken:g.peerMasterToken,m=g.peerUserIdToken,d=g.peerServiceTokens):(f=f?f.masterToken:g.masterToken,m=g.userIdToken,d=g.serviceTokens);var u=k.getUserId();u&&m&&!m.isVerified()&&c.getMslStore().addUserIdToken(u,m);this.storeServiceTokens(c,
f,m,d)}else if(d=r.entityAuthenticationData.getIdentity(),f==d)throw new Ba(a.UNEXPECTED_MESSAGE_SENDER,d);return h},u)},error:m.error})},u)},timeout:function(){m.timeout()},error:function(a){m.error(a)}})},timeout:function(){m.timeout()},error:function(a){m.error(a)}})},u)},sendReceive:function(a,b,c,d,k,h,l,m,r){function n(w,q){f(r,function(){h.setRenewable(q);this.send(a,b,c,k,h,l,{result:function(k){f(r,function(){var h=k.requestHeader.keyRequestData;m||k.handshake||!h.isEmpty()?this.receive(a,
b,c,d,k.requestHeader,l,{result:function(a){f(r,function(){q&&this.releaseRenewalLock(b,w,a);return new g(a,k)},A)},timeout:function(){f(r,function(){q&&this.releaseRenewalLock(b,w,null);r.timeout()},A)},error:function(a){f(r,function(){q&&this.releaseRenewalLock(b,w,null);throw a;},A)}}):f(r,function(){q&&this.releaseRenewalLock(b,w,null);return new g(null,k)},A)},A)},timeout:function(){f(r,function(){q&&this.releaseRenewalLock(b,w,null);r.timeout()},A)},error:function(a){f(r,function(){q&&this.releaseRenewalLock(b,
w,null);throw a;},A)}})},A)}var A=this;f(r,function(){var f=new Ha;this.acquireRenewalLock(a,b,c,f,h,l,{result:function(a){n(f,a)},timeout:function(){r.timeout()},error:function(a){a instanceof sb?r.result(null):r.error(a)}})},A)},acquireRenewalLock:function(a,b,c,d,k,h,l){function g(r,n,A){f(l,function(){if(a.isAborted())throw new sb("acquireRenewalLock aborted.");for(var w=null,q=0;q<this._renewingContexts.length;++q){var D=this._renewingContexts[q];if(D.ctx===b){w=D.queue;break}}if(!w)return this._renewingContexts.push({ctx:b,
queue:d}),!0;var E=w.poll(h,{result:function(a){f(l,function(){if(a===K)throw new sb("acquireRenewalLock aborted.");w.add(a);if(a===B||a.isExpired())g(a,n,A);else{if(A&&!n||n&&!n.isBoundTo(a)){var f=b.getMslStore().getUserIdToken(A);n=f&&f.isBoundTo(a)?f:null}k.setAuthTokens(a,n);k.isRenewable()&&a.equals(r)?g(a,n,A):c.isRequestingTokens()&&!n?g(a,n,A):m(a,n)}},u)},timeout:function(){},error:function(a){}});a.setAbort(function(){E&&(w.cancel(E),E=K)})},u)}function m(k,h){f(l,function(){if(a.isAborted())throw new sb("acquireRenewalLock aborted.");
if(!k||k.isRenewable()||!h&&c.getUserId()||h&&h.isRenewable()){for(var f=null,l=0;l<this._renewingContexts.length;++l){var g=this._renewingContexts[l];if(g.ctx===b){f=g.queue;break}}if(!f)return this._renewingContexts.push({ctx:b,queue:d}),!0}return!1},u)}var u=this;f(l,function(){var a=k.getMasterToken(),b=k.getUserIdToken(),f=c.getUserId();c.isEncrypted()&&!k.willEncryptPayloads()||c.isIntegrityProtected()&&!k.willIntegrityProtectPayloads()||k.isRenewable()||!a&&c.isNonReplayable()||a&&a.isExpired()||
!(b||!f||k.willEncryptHeader()&&k.willIntegrityProtectHeader())||c.isRequestingTokens()&&(!a||f&&!b)?g(a,b,f):m(a,b)},u)},releaseRenewalLock:function(a,b,c){for(var f,d,k=0;k<this._renewingContexts.length;++k){var h=this._renewingContexts[k];if(h.ctx===a){f=k;d=h.queue;break}}if(d!==b)throw new R("Attempt to release renewal lock that is not owned by this queue.");c?(c=c.messageHeader)?(d=c.keyResponseData)?b.add(d.masterToken):(a=a.isPeerToPeer()?c.peerMasterToken:c.masterToken)?b.add(a):b.add(B):
b.add(B):b.add(B);this._renewingContexts.splice(f,1)}});df=ca.Class.create({init:function(){var a={_impl:{value:new S,writable:!1,enumerable:!1,configurable:!1},_shutdown:{value:!1,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},setFilterFactory:function(a){this._impl.setFilterFactory(a)},shutdown:function(){this._shutdown=!0},receive:function(a,b,f,d,k,h){if(this._shutdown)throw new F("MslControl is shutdown.");var l=new N(this._impl,a,b,f,d,k);setTimeout(function(){l.call(h)},
0);return c(l)},respond:function(a,b,f,d,k,h,l){if(this._shutdown)throw new F("MslControl is shutdown.");var g=new T(this._impl,a,b,f,d,k,h);setTimeout(function(){g.call(l)},0);return c(g)},error:function(a,b,f,d,k,h,l){if(this._shutdown)throw new F("MslControl is shutdown.");var g=new da(this._impl,a,b,f,d,k,h);setTimeout(function(){g.call(l)},0);return c(g)},request:function(a,b){if(this._shutdown)throw new F("MslControl is shutdown.");var f,d,k,h,l;if(5==arguments.length){if(f=arguments[2],k=d=
null,h=arguments[3],l=arguments[4],a.isPeerToPeer()){l.error(new R("This method cannot be used in peer-to-peer mode."));return}}else if(6==arguments.length&&(f=null,d=arguments[2],k=arguments[3],h=arguments[4],l=arguments[5],!a.isPeerToPeer())){l.error(new R("This method cannot be used in trusted network mode."));return}var g=new ea(this._impl,a,b,f,d,k,null,0,h);setTimeout(function(){g.call(l)},0);return c(g)}});N=ca.Class.create({init:function(a,b,c,f,d,k){Object.defineProperties(this,{_ctrl:{value:a,
writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_input:{value:f,writable:!1,enumerable:!1,configurable:!1},_output:{value:d,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:k,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:K,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},
abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},call:function(b){function c(k){f(b,function(){var c=k.messageHeader;if(!c)return k;this.setAbort(function(){k.abort()});k.mark(Number.MAX_VALUE);k.read(1,h._timeout,{result:function(a){f(b,function(){if(a&&0==a.length)return null;if(a)return k.reset(),k;d(k)},h)},timeout:function(){b.timeout()},error:function(d){f(b,function(){if(r(d))return null;var k=c?c.messageId:null,l,g;d instanceof
pb?(l=a.MSL_COMMS_FAILURE,g=d):(l=a.INTERNAL_EXCEPTION,g=new R("Error peeking into the message payloads."));n(this,this._ctx,this._msgCtx.getDebugContext(),k,l,null,this._output,this._timeout,{result:function(a){b.error(g)},timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return null;throw new Db("Error peeking into the message payloads.",a,d);},h)}})},h)}})},h)}function d(c){f(b,function(){c.close();this._ctrl.buildResponse(this,this._ctx,this._msgCtx,c.messageHeader,this._timeout,
{result:function(a){f(b,function(){var f=a.builder,d=a.tokenTicket,h=c.messageHeader,l=new Y(this._msgCtx);if(!this._ctx.isPeerToPeer()||h.isEncrypting()||h.keyResponseData)k(h,f,l,d);else{var g=new ea(this._ctrl,this._ctx,l,null,this._input,this._output,a,1,this._timeout);this.setAbort(function(){g.abort()});g.call(b)}},h)},timeout:function(){b.timeout()},error:function(d){f(b,function(){if(r(d))return null;var k,l,g,m;d instanceof F?(k=d.messageId,l=d.error,g=c.messageHeader.messageCapabilities,
g=this._ctrl.messageRegistry.getUserMessage(l,g?g.languages:null),m=d):(k=requestHeader?requestHeader.messageId:null,l=a.INTERNAL_EXCEPTION,g=null,m=new R("Error creating an automatic handshake response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),k,l,g,this._output,this._timeout,{result:function(a){b.error(m)},timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return null;throw new Db("Error creating an automatic handshake response.",a,d);},h)}})},h)}})},h)}function k(c,
d,l,g){f(b,function(){d.setRenewable(!1);this._ctrl.send(this._ctx,l,this._output,d,this._timeout,{result:function(a){f(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(g);return null},h)},timeout:function(){f(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(g);b.timeout()},h)},error:function(d){f(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(g);if(r(d))return null;var k,l,m,u;d instanceof F?(k=d.messageId,l=d.error,m=c?c.messageCapabilities:
null,m=this._ctrl.messageRegistry.getUserMessage(l,m?m.languages:null),u=d):d instanceof pb?(k=c?c.messageId:null,l=a.MSL_COMMS_FAILURE,m=null,u=d):(k=c?c.messageId:null,l=a.INTERNAL_EXCEPTION,m=null,u=new R("Error sending an automatic handshake response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),k,l,m,this._output,this._timeout,{result:function(a){b.error(u)},timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return null;throw new Db("Error sending an automatic handshake response.",
a,d);},h)}})},h)}})},h)}var h=this;f(b,function(){this._ctrl.receive(this,this._ctx,this._msgCtx,this._input,null,this._timeout,{result:function(a){c(a)},timeout:function(){b.timeout()},error:function(c){f(b,function(){if(r(c))return null;var d,k,l,g;c instanceof F?(d=c.messageId,k=c.error,l=this._ctrl.messageRegistry.getUserMessage(k,null),g=c):(d=null,k=a.INTERNAL_EXCEPTION,l=null,g=new R("Error receiving the message header.",c));n(this,this._ctx,this._msgCtx.getDebugContext(),d,k,l,this._output,
this._timeout,{result:function(a){b.error(g)},timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return null;throw new Db("Error receiving the message header.",a,c);},h)}})},h)}})},h)}});T=ca.Class.create({init:function(a,b,c,f,d,k,h){Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_input:{value:f,writable:!1,enumerable:!1,
configurable:!1},_output:{value:d,writable:!1,enumerable:!1,configurable:!1},_request:{value:k,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:h,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:K,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},trustedNetworkExecute:function(b,
c,d){var k=this;f(d,function(){if(12<c+1)return!1;var h;if(h=this._msgCtx.isIntegrityProtected()&&!b.willIntegrityProtectHeader()?a.RESPONSE_REQUIRES_INTEGRITY_PROTECTION:this._msgCtx.isEncrypted()&&!b.willEncryptPayloads()?a.RESPONSE_REQUIRES_ENCRYPTION:null){var l=xd(b.getMessageId());n(this,this._ctx,this._msgCtx.getDebugContext(),l,h,null,this._output,this._timeout,{result:function(a){d.result(!1)},timeout:function(){d.timeout()},error:function(a){f(d,function(){if(r(a))return!1;throw new Db("Response requires encryption or integrity protection but cannot be protected: "+
h,a,null);},k)}})}else!this._msgCtx.getCustomer()||b.getMasterToken()||b.getKeyExchangeData()?(b.setRenewable(!1),this._ctrl.send(this._ctx,this._msgCtx,this._output,b,this._timeout,{result:function(a){d.result(!0)},timeout:function(){d.timeout()},error:function(a){d.error(a)}})):(l=xd(b.getMessageId()),n(this,this._ctx,this._msgCtx.getDebugContext(),l,a.RESPONSE_REQUIRES_MASTERTOKEN,null,this._output,this._timeout,{result:function(a){d.result(!1)},timeout:function(){d.timeout()},error:function(a){f(d,
function(){if(r(a))return!1;throw new Db("Response wishes to attach a user ID token but there is no master token.",a,null);},k)}}))},k)},peerToPeerExecute:function(b,c,d,k){function h(a){f(k,function(){var c=a.response;c.close();c=c.getErrorHeader();this._ctrl.cleanupContext(this._ctx,a.requestHeader,c);this._ctrl.buildErrorResponse(this,this._ctx,b,a,c,{result:function(a){f(k,function(){if(!a)return!1;var b=a.errorResult,c=a.tokenTicket;this.peerToPeerExecute(b.msgCtx,b.builder,d,{result:function(a){f(k,
function(){this._ctrl.releaseMasterToken(c);return a},l)},timeout:function(){f(k,function(){this._ctrl.releaseMasterToken(c);k.timeout()},l)},error:function(a){f(k,function(){this._ctrl.releaseMasterToken(c);throw a;},l)}})},l)}})},l)}var l=this;f(k,function(){if(12<d+2)return!1;if(null!=b.getCustomer()&&null==c.getPeerMasterToken()&&null==c.getKeyExchangeData()){var g=xd(c.getMessageId());n(this,this._ctx,b.getDebugContext(),g,a.RESPONSE_REQUIRES_MASTERTOKEN,null,this._output,this._timeout,{result:function(a){k.result(!1)},
timeout:function(){k.timeout()},error:function(a){f(k,function(){if(r(a))return!1;throw new Db("Response wishes to attach a user ID token but there is no master token.",a,null);},l)}})}else this._ctrl.sendReceive(this._ctx,b,this._input,this._output,c,this._timeout,!1,{result:function(a){f(k,function(){function c(){m.read(32768,l._timeout,{result:function(a){f(k,function(){a?c():g()},l)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}function g(){f(k,function(){var c=new L(a.payloads,
b);this._ctrl.buildResponse(this,this._ctx,c,u,this._timeout,{result:function(a){f(k,function(){var b=a.tokenTicket;this.peerToPeerExecute(c,a.builder,d,{result:function(a){f(k,function(){this._ctrl.releaseMasterToken(b);return a},l)},timeout:function(){f(k,function(){this._ctrl.releaseMasterToken(b);k.timeout()},l)},error:function(a){f(k,function(){this._ctrl.releaseMasterToken(b);throw a;},l)}})},l)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},l)}var m=a.response;d+=2;if(!m)return!0;
var u=m.getMessageHeader();if(u){var r=a.payloads,r=0<r.length&&0<r[0].data.length;if(a.handshake&&r)c();else return!0}else h(a)},l)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},l)},call:function(b){var c=this;this._ctrl.buildResponse(this,this._ctx,this._msgCtx,this._request,this._timeout,{result:function(d){f(b,function(){var k=d.builder,h=d.tokenTicket;this._ctx.isPeerToPeer()?this.peerToPeerExecute(this._msgCtx,k,3,{result:function(a){f(b,function(){this._ctx.isPeerToPeer()&&
this.releaseMasterToken(h);return a},c)},timeout:function(){f(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);b.timeout()},c)},error:function(d){f(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);if(r(d))return!1;var l=xd(k.getMessageId()),g,m,u;d instanceof F?(g=d.error,m=this._request.messageCapabilities,m=this._ctrl.messageRegistry.getUserMessage(g,m?m.languages:null),u=d):d instanceof pb?(g=a.MSL_COMMS_FAILURE,m=null,u=d):(g=a.INTERNAL_EXCEPTION,m=null,u=new R("Error sending the response.",
d));n(this,this._ctx,this._msgCtx.getDebugContext(),l,g,m,this._output,this._timeout,{result:function(a){b.error(u)},timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return!1;throw new Db("Error sending the response.",a,null);},c)}})},c)}}):this.trustedNetworkExecute(k,3,{result:function(a){f(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);return a},c)},timeout:function(){f(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);b.timeout()},c)},
error:function(d){f(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);if(r(d))return!1;var l=xd(k.getMessageId()),g,m,u;d instanceof F?(g=d.error,m=this._request.messageCapabilities,m=this._ctrl.messageRegistry.getUserMessage(g,m?m.languages:null),u=d):d instanceof pb?(g=a.MSL_COMMS_FAILURE,m=null,u=d):(g=a.INTERNAL_EXCEPTION,m=null,u=new R("Error sending the response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),l,g,m,this._output,this._timeout,{result:function(a){b.error(u)},
timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return!1;throw new Db("Error sending the response.",a,null);},c)}})},c)}})},c)},timeout:function(){b.timeout()},error:function(d){f(b,function(){if(r(d))return!1;var k,h,l,g;d instanceof F?(k=d.messageId,h=d.error,l=this._request.messageCapabilities,l=this._ctrl.messageRegistry.getUserMessage(h,l?l.languages:null),g=d):(k=null,h=a.INTERNAL_EXCEPTION,l=null,g=new R("Error building the response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),
k,h,l,this._output,this._timeout,{result:function(a){b.error(g)},timeout:function(){b.timeout()},error:function(a){f(b,function(){if(r(a))return null;throw new Db("Error building the response.",a,d);},c)}})},c)}})}});da=ca.Class.create({init:function(a,b,c,f,d,k,h){Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_appError:{value:f,writable:!1,
enumerable:!1,configurable:!1},_output:{value:output,writable:!1,enumerable:!1,configurable:!1},_request:{value:k,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:h,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:K,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=
a},call:function(b){var c=this;f(b,function(){var d;if(this._appError==ENTITY_REJECTED)d=this._request.masterToken?a.MASTERTOKEN_REJECTED_BY_APP:a.ENTITY_REJECTED_BY_APP;else if(this._appError==USER_REJECTED)d=this._request.userIdToken?a.USERIDTOKEN_REJECTED_BY_APP:a.USER_REJECTED_BY_APP;else throw new R("Unhandled application error "+this._appError+".");var k=this._request.messageCapabilities,k=this._ctrl.messageRegistry.getUserMessage(d,k?k.languages:null);n(this,this._ctx,this._msgCtx.getDebugContext(),
this._request.messageId,d,k,this._output,this._timeout,{result:function(a){b.result(a)},timeout:b.timeout,error:function(a){f(b,function(){if(r(a))return!1;if(a instanceof F)throw a;throw new R("Error building the error response.",a);},c)}})},c)}});var fa={result:function(){},timeout:function(){},error:function(){}};ea=ca.Class.create({init:function(a,b,c,d,f,k,h,l,g){var m;h?(m=h.builder,h=h.tokenTicket):h=m=null;Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},
_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_remoteEntity:{value:d,writable:!1,enumerable:!1,configurable:!1},_input:{value:f,writable:!0,enumerable:!1,configurable:!1},_output:{value:k,writable:!0,enumerable:!1,configurable:!1},_openedStreams:{value:!1,writable:!0,enumerable:!1,configurable:!1},_builder:{value:m,writable:!0,enumerable:!1,configurable:!1},_tokenTicket:{value:h,writable:!0,enumerable:!1,configurable:!1},_timeout:{value:g,
writable:!1,enumerable:!1,configurable:!1},_msgCount:{value:l,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:K,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},execute:function(a,b,c,d,k){function h(b){function l(a){f(k,function(){var c=b.response;return a?a:c},g)}f(k,
function(){var h=b.response;h.close();var m=h.getErrorHeader();this._ctrl.cleanupContext(this._ctx,b.requestHeader,m);this._ctrl.buildErrorResponse(this,this._ctx,a,b,m,c,{result:function(a){f(k,function(){if(!a)return h;var b=a.errorResult,m=a.tokenTicket,u=b.builder,b=b.msgCtx;if(this._ctx.isPeerToPeer())this.execute(b,u,this._timeout,d,{result:function(a){f(k,function(){this._ctrl.releaseMasterToken(m);l(a)},g)},timeout:function(){f(k,function(){this._ctrl.releaseMasterToken(m);k.timeout()},g)},
error:function(a){f(k,function(){this._ctrl.releaseMasterToken(m);k.error(a)},g)}});else{this._openedStreams&&(this._input.close(),this._output.close(c,fa));var r=new ea(this._ctrl,this._ctx,b,this._remoteEntity,null,null,{builder:u,tokenTicket:m},d,this._timeout);this.setAbort(function(){r.abort()});r.call({result:function(a){l(a)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}},g)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},g)}function l(b){f(k,function(){function h(){m.read(32768,
g._timeout,{result:function(a){a?h():l()},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}function l(){f(k,function(){var h=new L(b.payloads,a);this._ctrl.buildResponse(this,this._ctx,a,u,c,{result:function(a){f(k,function(){var b=a.tokenTicket;this.execute(h,a.builder,this._timeout,d,{result:function(a){f(k,function(){this._ctrl.releaseMasterToken(b);return a},g)},timeout:function(){f(k,function(){this._ctrl.releaseMasterToken(b);k.timeout()},g)},error:function(a){f(k,function(){this._ctrl.releaseMasterToken(b);
throw a;},g)}})},g)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},g)}var m=b.response,u=m.getMessageHeader(),r=b.payloads,r=0<r.length&&0<r[0].data.length;if(!this._ctx.isPeerToPeer()){if(!b.handshake||!r)return m;this._openedStreams&&(this._input.close(),this._output.close(c,fa));var n=new L(b.payloads,a);this._ctrl.buildResponse(this,this._ctx,a,u,c,{result:function(a){f(k,function(){var b=new ea(this._ctrl,this._ctx,n,this._remoteEntity,null,null,a,d,this._timeout);this.setAbort(function(){b.abort()});
b.call(k)},g)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}else if(b.handshake&&r)h();else if(0<u.keyRequestData.length){var A=new Y(a);this._ctrl.buildResponse(this,this._ctx,A,u,c,{result:function(a){f(k,function(){var b=a.builder,c=a.tokenTicket;m.mark();m.read(1,this._timeout,{result:function(a){f(k,function(){function h(){m.read(32768,g._timeout,{result:function(a){a?h():l()},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}function l(){g.execute(A,b,g._timeout,
d,{result:function(a){f(k,function(){this._ctrl.releaseMasterToken(c);return a},g)},timeout:function(){f(k,function(){this._ctrl.releaseMasterToken(c);k.timeout()},g)},error:function(a){f(k,function(){this._ctrl.releaseMasterToken(c);throw a;},g)}})}if(a)if(m.reset(),12>=d+1)b.setRenewable(!1),this._ctrl.send(this,this._ctx,A,this._output,b,this._timeout,{result:function(a){f(k,function(){this.releaseMasterToken(c);return m},g)},timeout:function(){k.timeout()},error:function(a){k.error(a)}});else return this.releaseMasterToken(c),
m;else h()},g)},timeout:function(){f(k,function(){this.releaseMasterToken(c);k.timeout()},g)},error:function(a){f(k,function(){this.releaseMasterToken(c);throw a;},g)}})},g)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}},g)}var g=this;f(k,function(){if(12<d+2)return null;this._ctrl.sendReceive(this,this._ctx,a,this._input,this._output,b,c,!0,{result:function(a){f(k,function(){if(!a)return null;var b=a.response;d+=2;b.getMessageHeader()?l(a):h(a)},g)},timeout:function(){k.timeout()},
error:function(a){k.error(a)}})},g)},call:function(a){function b(d,k,h){f(a,function(){this.execute(this._msgCtx,d,h,this._msgCount,{result:function(b){f(a,function(){this._ctrl.releaseMasterToken(k);this._openedStreams&&this._output.close(h,fa);b&&b.closeSource(this._openedStreams);return b},c)},timeout:function(){f(a,function(){this._ctrl.releaseMasterToken(k);this._openedStreams&&(this._output.close(h,fa),this._input.close());a.timeout()},c)},error:function(b){f(a,function(){this._ctrl.releaseMasterToken(k);
this._openedStreams&&(this._output.close(h,fa),this._input.close());if(r(b))return null;throw b;},c)}})},c)}var c=this;f(a,function(){var d=this._timeout;if(!this._input||!this._output)try{this._remoteEntity.setTimeout(this._timeout);var k=Date.now(),h=this._remoteEntity.openConnection();this._output=h.output;this._input=h.input;-1!=d&&(d=this._timeout-(Date.now()-k));this._openedStreams=!0}catch(l){this._builder&&this._ctrl.releaseMasterToken(this._tokenTicket);this._output&&this._output.close(this._timeout,
fa);this._input&&this._input.close();if(r(l))return null;throw l;}this._builder?b(this._builder,this._tokenTicket,d):this._ctrl.buildRequest(this,this._ctx,this._msgCtx,this._timeout,{result:function(k){f(a,function(){b(k.builder,k.tokenTicket,d)},c)},timeout:function(){f(a,function(){this._openedStreams&&(this._output.close(this._timeout,fa),this._input.close());a.timeout()},c)},error:function(b){f(a,function(){this._openedStreams&&(this._output.close(this._timeout,fa),this._input.close());if(r(b))return null;
throw b;},c)}})},c)}})})();var ef,ff;(function(){ef=ca.Class.create({init:function(a){Object.defineProperties(this,{id:{value:a,writable:!1,configurable:!1}})},toJSON:function(){var a={};a.id=this.id;return a},equals:function(a){return this===a?!0:a instanceof ef?this.id==a.id:!1},uniqueKey:function(){return this.id}});ff=function(b){var c=b.id;if(!c)throw new aa(a.JSON_PARSE_ERROR,JSON.stringify(b));return new ef(c)}})();ca.Class.create({isNewestMasterToken:function(a,b,c){},isMasterTokenRevoked:function(a,
b){},acceptNonReplayableId:function(a,b,c,d){},createMasterToken:function(a,b,c,d,f){},isMasterTokenRenewable:function(a,b,c){},renewMasterToken:function(a,b,c,d,f){},isUserIdTokenRevoked:function(a,b,c,d){},createUserIdToken:function(a,b,c,d){},renewUserIdToken:function(a,b,c,d){}});var Xb,Sc;(function(){function c(a,b,d,f){this.sessiondata=a;this.tokendata=b;this.signature=d;this.verified=f}Xb=ca.Class.create({init:function(a,c,d,f,h,g,n,q,A,w,Y){var F=this;b(Y,function(){if(d.getTime()<c.getTime())throw new R("Cannot construct a master token that expires before its renewal window opens.");
if(0>f||f>Ia)throw new R("Sequence number "+f+" is outside the valid range.");if(0>h||h>Ia)throw new R("Serial number "+h+" is outside the valid range.");var B=Math.floor(c.getTime()/1E3),T=Math.floor(d.getTime()/1E3),da;if(w)da=w.sessiondata;else{var ea={};g&&(ea.issuerdata=g);ea.identity=n;ea.encryptionkey=N(q.toByteArray());ea.hmackey=N(A.toByteArray());da=S(JSON.stringify(ea),ma)}if(w)return Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:B,
writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:T,writable:!1,enumerable:!1,configurable:!1},sequenceNumber:{value:f,writable:!1,configurable:!1},serialNumber:{value:h,writable:!1,configurable:!1},issuerData:{value:g,writable:!1,configurable:!1},identity:{value:n,writable:!1,configurable:!1},encryptionKey:{value:q,writable:!1,configurable:!1},hmacKey:{value:A,writable:!1,configurable:!1},sessiondata:{value:da,writable:!1,enumerable:!1,configurable:!1},verified:{value:w.verified,
writable:!1,enumerable:!1,configurable:!1},tokendata:{value:w.tokendata,writable:!1,enumerable:!1,configurable:!1},signature:{value:w.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var M=a.getMslCryptoContext();M.encrypt(da,{result:function(c){b(Y,function(){var d={};d.renewalwindow=B;d.expiration=T;d.sequencenumber=f;d.serialnumber=h;d.sessiondata=N(c);var k=S(JSON.stringify(d),ma);M.sign(k,{result:function(c){b(Y,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,
configurable:!1},renewalWindowSeconds:{value:B,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:T,writable:!1,enumerable:!1,configurable:!1},sequenceNumber:{value:f,writable:!1,enumerable:!1,configurable:!1},serialNumber:{value:h,writable:!1,enumerable:!1,configurable:!1},issuerData:{value:g,writable:!1,configurable:!1},identity:{value:n,writable:!1,configurable:!1},encryptionKey:{value:q,writable:!1,configurable:!1},hmacKey:{value:A,writable:!1,configurable:!1},sessiondata:{value:da,
writable:!1,enumerable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:k,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},F)},error:function(a){Y.error(a)}})},F)},error:function(a){Y.error(a)}})},this)},get renewalWindow(){return new Date(1E3*this.renewalWindowSeconds)},get expiration(){return new Date(1E3*this.expirationSeconds)},isDecrypted:function(){return this.sessiondata?
!0:!1},isVerified:function(){return this.verified},isRenewable:function(a){return this.isVerified()?this.renewalWindow.getTime()<=this.ctx.getTime():!0},isExpired:function(a){return this.isVerified()?this.expiration.getTime()<=this.ctx.getTime():!1},isNewerThan:function(a){if(this.sequenceNumber==a.sequenceNumber)return this.expiration>a.expiration;if(this.sequenceNumber>a.sequenceNumber){var b=this.sequenceNumber-Ia+127;return a.sequenceNumber>=b}b=a.sequenceNumber-Ia+127;return this.sequenceNumber<
b},toJSON:function(){var a={};a.tokendata=N(this.tokendata);a.signature=N(this.signature);return a},equals:function(a){return this===a?!0:a instanceof Xb?this.serialNumber==a.serialNumber&&this.sequenceNumber==a.sequenceNumber&&this.expiration.getTime()==a.expiration.getTime():!1},uniqueKey:function(){return this.serialNumber+":"+this.sequenceNumber+this.expiration.getTime()}});Sc=function(d,f,l){b(l,function(){var g=d.getMslCryptoContext(),r=f.tokendata,n=f.signature;if("string"!==typeof r||"string"!==
typeof n)throw new aa(a.JSON_PARSE_ERROR,"mastertoken "+JSON.stringify(f));var q,E;try{q=T(r)}catch(A){throw new F(a.MASTERTOKEN_TOKENDATA_INVALID,"mastertoken "+JSON.stringify(f),A);}if(!q||0==q.length)throw new aa(a.MASTERTOKEN_TOKENDATA_MISSING,"mastertoken "+JSON.stringify(f));try{E=T(n)}catch(L){throw new F(a.MASTERTOKEN_SIGNATURE_INVALID,"mastertoken "+JSON.stringify(f),L);}g.verify(q,E,{result:function(f){b(l,function(){var k,r,n,A,D,L=h(q,ma);try{var B=JSON.parse(L);k=parseInt(B.renewalwindow);
r=parseInt(B.expiration);n=parseInt(B.sequencenumber);A=parseInt(B.serialnumber);D=B.sessiondata}catch(N){if(N instanceof SyntaxError)throw new aa(a.MASTERTOKEN_TOKENDATA_PARSE_ERROR,"mastertokendata "+L,N);throw N;}if(!k||k!=k||!r||r!=r||"number"!==typeof n||n!=n||"number"!==typeof A||A!=A||"string"!==typeof D)throw new aa(a.MASTERTOKEN_TOKENDATA_PARSE_ERROR,"mastertokendata "+L);if(r<k)throw new F(a.MASTERTOKEN_EXPIRES_BEFORE_RENEWAL,"mastertokendata "+L);if(0>n||n>Ia)throw new F(a.MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_RANGE,
"mastertokendata "+L);if(0>A||A>Ia)throw new F(a.MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"mastertokendata "+L);var S=new Date(1E3*k),M=new Date(1E3*r),z;try{z=T(D)}catch(C){throw new F(a.MASTERTOKEN_SESSIONDATA_INVALID,D,C);}if(!z||0==z.length)throw new F(a.MASTERTOKEN_SESSIONDATA_MISSING,D);f?g.decrypt(z,{result:function(k){b(l,function(){var g,u,r,D,L=h(k,ma);try{var ea=JSON.parse(L);g=ea.issuerdata;u=ea.identity;r=ea.encryptionkey;D=ea.hmackey}catch(B){if(B instanceof SyntaxError)throw new aa(a.MASTERTOKEN_SESSIONDATA_PARSE_ERROR,
"sessiondata "+L,B);throw B;}if(g&&"object"!==typeof g||!u||"string"!==typeof r||"string"!==typeof D)throw new aa(a.MASTERTOKEN_SESSIONDATA_PARSE_ERROR,"sessiondata "+L);Ic(r,Kb,yb,{result:function(h){Ic(D,ta,tb,{result:function(a){b(l,function(){var b=new c(k,q,E,f);new Xb(d,S,M,n,A,g,u,h,a,b,l)})},error:function(b){l.error(new V(a.MASTERTOKEN_KEY_CREATION_ERROR,b))}})},error:function(b){l.error(new V(a.MASTERTOKEN_KEY_CREATION_ERROR,b))}})})},error:function(a){l.error(a)}}):(k=new c(null,q,E,f),
new Xb(d,S,M,n,A,null,null,null,null,k,l))})},error:function(a){l.error(a)}})})}})();var td,Tc;(function(){function c(a,b,d){this.tokendata=a;this.signature=b;this.verified=d}td=ca.Class.create({init:function(a,c,d,f,h,g,n,q,A){var w=this;b(A,function(){if(d.getTime()<c.getTime())throw new R("Cannot construct a user ID token that expires before its renewal window opens.");if(!f)throw new R("Cannot construct a user ID token without a master token.");if(0>h||h>Ia)throw new R("Serial number "+h+" is outside the valid range.");
var B=Math.floor(c.getTime()/1E3),T=Math.floor(d.getTime()/1E3),M=f.serialNumber;if(q){var z=q.tokendata,da=q.signature,ea=q.verified,M=f.serialNumber;Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:B,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:T,writable:!1,enumerable:!1,configurable:!1},mtSerialNumber:{value:M,writable:!1,configurable:!1},serialNumber:{value:h,writable:!1,configurable:!1},issuerData:{value:g,
writable:!1,configurable:!1},customer:{value:n,writable:!1,configurable:!1},verified:{value:ea,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:z,writable:!1,enumerable:!1,configurable:!1},signature:{value:da,writable:!1,enumerable:!1,configurable:!1}});return this}z={};g&&(z.issuerdata=g);z.identity=n;var z=S(JSON.stringify(z),ma),C=a.getMslCryptoContext();C.encrypt(z,{result:function(c){b(A,function(){var d={};d.renewalwindow=B;d.expiration=T;d.mtserialnumber=M;d.serialnumber=h;d.userdata=
N(c);var k=S(JSON.stringify(d),ma);C.sign(k,{result:function(c){b(A,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:B,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:T,writable:!1,enumerable:!1,configurable:!1},mtSerialNumber:{value:f.serialNumber,writable:!1,configurable:!1},serialNumber:{value:h,writable:!1,configurable:!1},issuerData:{value:g,writable:!1,configurable:!1},customer:{value:n,writable:!1,
configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:k,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},w)},error:function(a){b(A,function(){a instanceof F&&a.setEntity(f);throw a;},w)}})},w)},error:function(a){b(A,function(){a instanceof F&&a.setEntity(f);throw a;},w)}})},this)},get renewalWindow(){return new Date(1E3*this.renewalWindowSeconds)},get expiration(){return new Date(1E3*this.expirationSeconds)},
isVerified:function(){return this.verified},isDecrypted:function(){return this.customer?!0:!1},isRenewable:function(){return this.renewalWindow.getTime()<=this.ctx.getTime()},isExpired:function(){return this.expiration.getTime()<=this.ctx.getTime()},isBoundTo:function(a){return a&&a.serialNumber==this.mtSerialNumber},toJSON:function(){var a={};a.tokendata=N(this.tokendata);a.signature=N(this.signature);return a},equals:function(a){return this===a?!0:a instanceof td?this.serialNumber==a.serialNumber&&
this.mtSerialNumber==a.mtSerialNumber:!1},uniqueKey:function(){return this.serialNumber+":"+this.mtSerialNumber}});Tc=function(d,f,g,u){b(u,function(){var r=d.getMslCryptoContext(),n=f.tokendata,q=f.signature;if("string"!==typeof n||"string"!==typeof q)throw(new aa(a.JSON_PARSE_ERROR,"useridtoken "+JSON.stringify(f))).setEntity(g);var E,A;try{E=T(n)}catch(L){throw(new F(a.USERIDTOKEN_TOKENDATA_INVALID,"useridtoken "+JSON.stringify(f),L)).setEntity(g);}if(!E||0==E.length)throw(new aa(a.USERIDTOKEN_TOKENDATA_MISSING,
"useridtoken "+JSON.stringify(f))).setEntity(g);try{A=T(q)}catch(B){throw(new F(a.USERIDTOKEN_TOKENDATA_INVALID,"useridtoken "+JSON.stringify(f),B)).setEntity(g);}r.verify(E,A,{result:function(f){b(u,function(){var k,n,q,D,L,B=h(E,ma);try{var Y=JSON.parse(B);k=parseInt(Y.renewalwindow);n=parseInt(Y.expiration);q=parseInt(Y.mtserialnumber);D=parseInt(Y.serialnumber);L=Y.userdata}catch(N){if(N instanceof SyntaxError)throw(new aa(a.USERIDTOKEN_TOKENDATA_PARSE_ERROR,"usertokendata "+B,N)).setEntity(g);
throw N;}if(!k||k!=k||!n||n!=n||"number"!==typeof q||q!=q||"number"!==typeof D||D!=D||"string"!==typeof L)throw(new aa(a.USERIDTOKEN_TOKENDATA_PARSE_ERROR,"usertokendata "+B)).setEntity(g);if(n<k)throw(new F(a.USERIDTOKEN_EXPIRES_BEFORE_RENEWAL,"mastertokendata "+B)).setEntity(g);if(0>q||q>Ia)throw(new F(a.USERIDTOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"usertokendata "+B)).setEntity(g);if(0>D||D>Ia)throw(new F(a.USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"usertokendata "+B)).setEntity(g);var la=new Date(1E3*
k),M=new Date(1E3*n);if(!g||q!=g.serialNumber)throw(new F(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+q+"; mt "+JSON.stringify(g))).setEntity(g);var S;try{S=T(L)}catch(z){throw(new F(a.USERIDTOKEN_USERDATA_INVALID,L,z)).setEntity(g);}if(!S||0==S.length)throw(new F(a.USERIDTOKEN_USERDATA_MISSING,L)).setEntity(g);f?r.decrypt(S,{result:function(k){b(u,function(){var b,r,n=h(k,ma);try{var q=JSON.parse(n);b=q.issuerdata;r=q.identity}catch(L){if(L instanceof SyntaxError)throw(new aa(a.USERIDTOKEN_USERDATA_PARSE_ERROR,
"userdata "+n)).setEntity(g);throw L;}if(b&&"object"!==typeof b||"object"!==typeof r)throw(new aa(a.USERIDTOKEN_USERDATA_PARSE_ERROR,"userdata "+n)).setEntity(g);var B;try{B=ff(r)}catch(Y){throw(new F(a.USERIDTOKEN_IDENTITY_INVALID,"userdata "+n,Y)).setEntity(g);}r=new c(E,A,f);new td(d,la,M,g,D,b,B,r,u)})},error:function(a){b(u,function(){a instanceof F&&a.setEntity(g);throw a;})}}):(k=new c(E,A,f),new td(d,la,M,g,D,null,null,k,u))})},error:function(a){b(u,function(){a instanceof F&&a.setEntity(g);
throw a;})}})})}})();var Vc,Lc,Pd;(function(){function c(b,d){var f=b.tokendata;if("string"!==typeof f)throw new aa(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b));var g;try{g=T(f)}catch(m){throw new F(a.SERVICETOKEN_TOKENDATA_INVALID,"servicetoken "+JSON.stringify(b),m);}if(!g||0==g.length)throw new aa(a.SERVICETOKEN_TOKENDATA_MISSING,"servicetoken "+JSON.stringify(b));var n;try{n=JSON.parse(h(g,ma)).name}catch(q){if(q instanceof SyntaxError)throw new aa(a.JSON_PARSE_ERROR,"servicetoken "+
JSON.stringify(b),q);throw q;}if(!n)throw new aa(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b));return d[n]?d[n]:d[""]}function d(a,b,c){this.tokendata=a;this.signature=b;this.verified=c}Vc=ca.Class.create({init:function(a,c,d,f,h,g,m,n,q,w){var B=this;b(w,function(){if(f&&h&&!h.isBoundTo(f))throw new R("Cannot construct a service token bound to a master token and user ID token where the user ID token is not bound to the same master token.");var T=f?f.serialNumber:-1,M=h?h.serialNumber:-1;
if(q)return z=q.tokendata,Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:c,writable:!1,configurable:!1},mtSerialNumber:{value:T,writable:!1,configurable:!1},uitSerialNumber:{value:M,writable:!1,configurable:!1},data:{value:d,writable:!1,configurable:!1},encrypted:{value:g,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:m,writable:!1,configurable:!1},verified:{value:q.verified,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:z,
writable:!1,enumerable:!1,configurable:!1},signature:{value:q.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var da;m?(da=af(m,d),da.length<d.length||(m=null,da=d)):(m=null,da=d);var ea={};ea.name=c;-1!=T&&(ea.mtserialnumber=T);-1!=M&&(ea.uitserialnumber=M);ea.encrypted=g;m&&(ea.compressionalgo=m);if(g&&0<da.length)n.encrypt(da,{result:function(q){b(w,function(){ea.servicedata=N(q);var L=S(JSON.stringify(ea),ma);n.sign(L,{result:function(f){b(w,function(){Object.defineProperties(this,
{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:c,writable:!1,configurable:!1},mtSerialNumber:{value:T,writable:!1,configurable:!1},uitSerialNumber:{value:M,writable:!1,configurable:!1},data:{value:d,writable:!1,configurable:!1},encrypted:{value:g,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:m,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:L,writable:!1,enumerable:!1,configurable:!1},signature:{value:f,
writable:!1,enumerable:!1,configurable:!1}});return this},B)},error:function(a){b(w,function(){a instanceof F&&(a.setEntity(f),a.setUser(h));throw a;})}})},B)},error:function(a){b(w,function(){a instanceof F&&(a.setEntity(f),a.setUser(h));throw a;})}});else{ea.servicedata=N(da);var z=S(JSON.stringify(ea),ma);n.sign(z,{result:function(f){b(w,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:c,writable:!1,configurable:!1},mtSerialNumber:{value:T,
writable:!1,configurable:!1},uitSerialNumber:{value:M,writable:!1,configurable:!1},data:{value:d,writable:!1,configurable:!1},encrypted:{value:g,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:m,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:z,writable:!1,enumerable:!1,configurable:!1},signature:{value:f,writable:!1,enumerable:!1,configurable:!1}});return this},B)},error:function(a){b(w,function(){a instanceof F&&(a.setEntity(f),
a.setUser(h));throw a;})}})}},this)},isEncrypted:function(){return this.encrypted},isVerified:function(){return this.verified},isDecrypted:function(){return this.data?!0:!1},isDeleted:function(){return this.data&&0==this.data.length},isMasterTokenBound:function(){return-1!=this.mtSerialNumber},isBoundTo:function(a){return a?a instanceof Xb?a.serialNumber==this.mtSerialNumber:a instanceof td?a.serialNumber==this.uitSerialNumber:!1:!1},isUserIdTokenBound:function(){return-1!=this.uitSerialNumber},isUnbound:function(){return-1==
this.mtSerialNumber&&-1==this.uitSerialNumber},toJSON:function(){var a={};a.tokendata=N(this.tokendata);a.signature=N(this.signature);return a},equals:function(a){return this===a?!0:a instanceof Vc?this.name==a.name&&this.mtSerialNumber==a.mtSerialNumber&&this.uitSerialNumber==a.uitSerialNumber:!1},uniqueKey:function(){return this.name+":"+this.mtSerialNumber+":"+this.uitSerialNumber}});Lc=function(a,b,c,d,f,h,g,m,n){new Vc(a,b,c,d,f,h,g,m,null,n)};Pd=function(f,g,u,n,q,B){b(B,function(){!q||q instanceof
ud||(q=c(g,q));var E=g.tokendata,A=g.signature;if("string"!==typeof E||"string"!==typeof A)throw(new aa(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(g))).setEntity(u).setEntity(n);var L,N;try{L=T(E)}catch(M){throw(new F(a.SERVICETOKEN_TOKENDATA_INVALID,"servicetoken "+JSON.stringify(g),M)).setEntity(u).setEntity(n);}if(!L||0==L.length)throw(new aa(a.SERVICETOKEN_TOKENDATA_MISSING,"servicetoken "+JSON.stringify(g))).setEntity(u).setEntity(n);try{N=T(A)}catch(S){throw(new F(a.SERVICETOKEN_SIGNATURE_INVALID,
"servicetoken "+JSON.stringify(g),S)).setEntity(u).setEntity(n);}var z,da,ea,C,fa,K,oa=h(L,ma);try{var ia=JSON.parse(oa);z=ia.name;da=ia.mtserialnumber?parseInt(ia.mtserialnumber):-1;ea=ia.uitserialnumber?parseInt(ia.uitserialnumber):-1;C=ia.encrypted;fa=ia.compressionalgo;K=ia.servicedata}catch(V){if(V instanceof SyntaxError)throw(new aa(a.JSON_PARSE_ERROR,"servicetokendata "+oa,V)).setEntity(u).setEntity(n);throw V;}if(!z||"number"!==typeof da||da!=da||"number"!==typeof ea||ea!=ea||"boolean"!==
typeof C||fa&&"string"!==typeof fa||"string"!==typeof K)throw(new aa(a.JSON_PARSE_ERROR,"servicetokendata "+oa)).setEntity(u).setEntity(n);if(ia.mtserialnumber&&0>da||da>Ia)throw(new F(a.SERVICETOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"servicetokendata "+oa)).setEntity(u).setEntity(n);if(ia.uitserialnumber&&0>ea||ea>Ia)throw(new F(a.SERVICETOKEN_USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"servicetokendata "+oa)).setEntity(u).setEntity(n);if(-1!=da&&(!u||da!=u.serialNumber))throw(new F(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,
"st mtserialnumber "+da+"; mt "+u)).setEntity(u).setEntity(n);if(-1!=ea&&(!n||ea!=n.serialNumber))throw(new F(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,"st uitserialnumber "+ea+"; uit "+n)).setEntity(u).setEntity(n);C=!0===C;var R;if(fa){if(!cd[fa])throw new F(a.UNIDENTIFIED_COMPRESSION,fa);R=fa}else R=null;q?q.verify(L,N,{result:function(c){b(B,function(){if(c){var h;try{h=T(K)}catch(g){throw(new F(a.SERVICETOKEN_SERVICEDATA_INVALID,"servicetokendata "+oa,g)).setEntity(u).setEntity(n);}if(!h||0!=K.length&&
0==h.length)throw(new F(a.SERVICETOKEN_SERVICEDATA_INVALID,"servicetokendata "+oa)).setEntity(u).setEntity(n);if(C&&0<h.length)q.decrypt(h,{result:function(a){b(B,function(){var b=R?me(R,a):a,h=new d(L,N,c);new Vc(f,z,b,-1!=da?u:null,-1!=ea?n:null,C,R,q,h,B)})},error:function(a){b(B,function(){a instanceof F&&(a.setEntity(u),a.setUser(n));throw a;})}});else{h=R?me(R,h):h;var l=new d(L,N,c);new Vc(f,z,h,-1!=da?u:null,-1!=ea?n:null,C,R,q,l,B)}}else h=""==K?new Uint8Array(0):null,l=new d(L,N,c),new Vc(f,
z,h,-1!=da?u:null,-1!=ea?n:null,C,R,q,l,B)})},error:function(a){b(B,function(){a instanceof F&&(a.setEntity(u),a.setUser(n));throw a;})}}):(E=""==K?new Uint8Array(0):null,A=new d(L,N,!1),new Vc(f,z,E,-1!=da?u:null,-1!=ea?n:null,C,R,q,A,B))})}})();var qc={EMAIL_PASSWORD:"EMAIL_PASSWORD",NETFLIXID:"NETFLIXID",SSO:"SSO",SWITCH_PROFILE:"SWITCH_PROFILE",MDX:"MDX"};Object.freeze(qc);var dd,Xe;(function(){dd=ca.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},
getAuthData:function(){},equals:function(a){return this===a?!0:a instanceof dd?this.scheme==a.scheme:!1},toJSON:function(){var a={};a.scheme=this.scheme;a.authdata=this.getAuthData();return a}});Xe=function(c,d,f,h){b(h,function(){var b=f.scheme,g=f.authdata;if(!b||!g)throw new aa(a.JSON_PARSE_ERROR,"userauthdata "+JSON.stringify(f));if(!qc[b])throw new Ma(a.UNIDENTIFIED_USERAUTH_SCHEME,b);var n=c.getUserAuthenticationFactory(b);if(!n)throw new Ma(a.USERAUTH_FACTORY_NOT_FOUND,b);n.createData(c,d,
g,h)})}})();var qe=ca.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createData:function(a,b,c,d){},authenticate:function(a,b,c,d){}}),zd,cg;(function(){zd=dd.extend({init:function m(a,b){m.base.call(this,qc.NETFLIXID);Object.defineProperties(this,{netflixId:{value:a,writable:!1,configurable:!1},secureNetflixId:{value:b,writable:!1,configurable:!1}})},getAuthData:function(){var a={};a.netflixid=this.netflixId;this.secureNetflixId&&(a.securenetflixid=
this.secureNetflixId);return a},equals:function k(a){return this===a?!0:a instanceof zd?k.base.call(this,a)&&this.netflixId==a.netflixId&&this.secureNetflixId==a.secureNetflixId:!1}});cg=function(b){var c=b.netflixid,d=b.securenetflixid;if(!c)throw new aa(a.JSON_PARSE_ERROR,"NetflixId authdata "+JSON.stringify(b));return new zd(c,d)}})();var Pg=qe.extend({init:function m(){m.base.call(this,qc.NETFLIXID)},createData:function(a,c,d,f){b(f,function(){return cg(d)})},authenticate:function(b,c,d,f){if(!(d instanceof
zd))throw new R("Incorrect authentication data type "+d+".");b=d.secureNetflixId;if(!d.netflixId||!b)throw(new Ma(a.NETFLIXID_COOKIES_BLANK)).setUser(d);throw(new Ma(a.UNSUPPORTED_USERAUTH_DATA,this.scheme)).setUser(d);}}),Rd,re;(function(){Rd=dd.extend({init:function k(a,b){k.base.call(this,qc.EMAIL_PASSWORD);Object.defineProperties(this,{email:{value:a,writable:!1,configurable:!1},password:{value:b,writable:!1,configurable:!1}})},getAuthData:function(){var a={};a.email=this.email;a.password=this.password;
return a},equals:function l(a){return this===a?!0:a instanceof Rd?l.base.call(this,this,a)&&this.email==a.email&&this.password==a.password:!1}});re=function(b){var c=b.email,d=b.password;if(!c||!d)throw new aa(a.JSON_PARSE_ERROR,"email/password authdata "+JSON.stringify(b));return new Rd(c,d)}})();var Qg=qe.extend({init:function k(){k.base.call(this,qc.EMAIL_PASSWORD)},createData:function(a,c,d,f){b(f,function(){return re(d)})},authenticate:function(b,c,d,f){if(!(d instanceof Rd))throw new R("Incorrect authentication data type "+
d+".");b=d.password;if(!d.email||!b)throw(new Ma(a.EMAILPASSWORD_BLANK)).setUser(d);throw(new Ma(a.UNSUPPORTED_USERAUTH_DATA,this.scheme)).setUser(d);}}),Ad,se,Wc,gf,Sd,hf;(function(){function c(a,b){return"<"+a+">"+b+"</"+a+">"}function d(a){return a.replace(/[<>&"']/g,function(a){return A[a]})}function f(a){return encodeURIComponent(a).replace("%20","+").replace(/[!'()]/g,escape).replace(/\*/g,"%2A")}var g=Wc={MSL:"MSL",NTBA:"NTBA",MSL_LEGACY:"MSL_LEGACY"},n=ca.Class.create({getAction:function(){},
getNonce:function(){},getPin:function(){},getSignature:function(){},getEncoding:function(){},equals:function(){}}),B=gf=n.extend({init:function(c,d,f,k,h,g,l){function n(k){b(l,function(){var b;try{var g={};g.useridtoken=c;g.action=d;g.nonce=f;g.pin=N(k);b=S(JSON.stringify(g),ma)}catch(n){throw new aa(a.JSON_ENCODE_ERROR,"MSL-based MDX authdata",n);}h.sign(b,{result:function(a){u(b,a)},error:l.error})},r)}function u(a,h){b(l,function(){Object.defineProperties(this,{_userIdToken:{value:c,writable:!1,
enumerable:!1,configurable:!1},_action:{value:d,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:f,writable:!1,enumerable:!1,configurable:!1},_pin:{value:k,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:a,writable:!1,enumerable:!1,configurable:!1},_signature:{value:h,writable:!1,enumerable:!1,configurable:!1}});return this},r)}var r=this;b(l,function(){g?u(g.encoding,g.signature):h.encrypt(S(k,ma),{result:function(a){n(a)},error:l.error})},r)},getUserIdToken:function(){return this._userIdToken},
getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof B?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin&&this._userIdToken.equals(a._userIdToken):!1}});gf.ACTION="userauth";var E=function(c,d,f,k,g){function l(k){b(g,function(){var l=h(f,ma),u,r,q,A;try{var B=JSON.parse(l);
u=B.useridtoken;r=B.action;q=B.nonce;A=B.pin}catch(D){if(D instanceof SyntaxError)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+l,D);throw D;}if(!(u&&"object"===typeof u&&r&&"string"===typeof r&&q&&"number"===typeof q&&A)||"string"!==typeof A)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+l);Tc(c,u,d,{result:function(c){b(g,function(){if(!c.isDecrypted())throw new Ma(a.USERAUTH_USERIDTOKEN_NOT_DECRYPTED,"MDX authdata "+l);n(k,c,r,q,A)})},error:function(c){b(g,function(){if(c instanceof F)throw new Ma(a.USERAUTH_USERIDTOKEN_INVALID,
"MDX authdata "+l,c);throw c;})}})})}function n(a,c,d,l,u){b(g,function(){var n=T(u);a.decrypt(n,{result:function(a){b(g,function(){var b=h(a,ma);new B(c,d,l,b,null,{encoding:f,signature:k},g)})},error:g.error})})}b(g,function(){var h;try{var n=c.getMslStore().getCryptoContext(d);h=n?n:new Lb(c,d)}catch(u){if(u instanceof oc)throw new Ma(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+N(f));throw u;}h.verify(f,k,{result:function(c){b(g,function(){if(!c)throw new V(a.MDX_USERAUTH_VERIFICATION_FAILED,
"MDX authdata "+N(f));l(h)})},error:g.error})})},A={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},L=Sd=n.extend({init:function(a,b,f,h){var g=c("action",d(a)),n=c("nonce",b.toString());f=c("pin",f);g=c("registerdata",g+n+f);g=S(g,"utf-8");Object.defineProperties(this,{_action:{value:a,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:b,writable:!1,enumerable:!1,configurable:!1},_pin:{value:null,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:g,writable:!1,enumerable:!1,
configurable:!1},_signature:{value:h,writable:!1,enumerable:!1,configurable:!1}})},getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof L?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin:!1}});Sd.ACTION="regpairrequest";var Y=hf=n.extend({init:function(a,h,g,n,r,q){function A(g){b(q,
function(){var b=N(g),r=c("action",d(a)),A=c("nonce",h.toString()),D=c("pin",b),r=c("registerdata",r+A+D),L=S(r,"utf-8"),b="action="+f(a)+"&nonce="+f(h.toString())+"&pin="+f(b);n.sign(S(b,"utf-8"),{result:function(a){B(L,a)},error:q.error})},D)}function B(c,d){b(q,function(){Object.defineProperties(this,{_action:{value:a,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:h,writable:!1,enumerable:!1,configurable:!1},_pin:{value:g,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:c,
writable:!1,enumerable:!1,configurable:!1},_signature:{value:d,writable:!1,enumerable:!1,configurable:!1}});return this},D)}var D=this;b(q,function(){r?B(r.encoding,r.signature):n.encrypt(S(g,"utf-8"),{result:function(a){A(a)},error:q.error})},D)},getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof
Y?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin:!1}});hf.ACTION=Sd.ACTION;var M=function(c,d,k,g,l){b(l,function(){var n=c.getMslStore().getCryptoContext(d),r=n?n:new Lb(c,d),n=h(k,"utf-8"),q=(new DOMParser).parseFromString(n,"application/xml"),n=q.getElementsByTagName("action"),A=q.getElementsByTagName("nonce"),q=q.getElementsByTagName("pin"),B=n&&1==n.length&&n[0].firstChild?n[0].firstChild.nodeValue:null,D=A&&1==A.length&&A[0].firstChild?parseInt(A[0].firstChild.nodeValue):
null,L=q&&1==q.length&&q[0].firstChild?q[0].firstChild.nodeValue:null;if(!B||!D||!L)throw new aa(a.XML_PARSE_ERROR,"MDX authdata "+N(k));n="action="+f(B)+"&nonce="+f(D.toString())+"&pin="+f(L);r.verify(S(n,"utf-8"),g,{result:function(c){b(l,function(){if(!c)throw new V(a.MDX_USERAUTH_VERIFICATION_FAILED,"MDX authdata "+N(k));var d=T(L);r.decrypt(d,{result:function(a){b(l,function(){var b=h(a,"utf-8");new Y(B,D,b,null,{encoding:k,signature:g},l)})},error:l.error})})},error:l.error})})};Ad=dd.extend({init:function Gb(a,
b,c,d,f,k){Gb.base.call(this,qc.MDX);var h=null,l=null,n=null;if("string"===typeof c)a=g.MSL_LEGACY,n=c;else if(c instanceof Uint8Array)a=g.NTBA,l=c;else if(c instanceof Xb)a=g.MSL,h=c;else throw new TypeError("Controller token "+c+" is not a master token, encrypted CTicket, or MSL token construct.");var u=c=null,q=null,A=null;if(k){var D=k.controllerAuthData;c=D.getAction();u=D.getPin();q=k.userIdToken;D instanceof B?A=D.getUserIdToken().customer:q&&(A=q.customer)}Object.defineProperties(this,{mechanism:{value:a,
writable:!1,configurable:!1},action:{value:c,writable:!1,configurable:!1},targetPin:{value:b,writable:!1,configurable:!1},controllerPin:{value:u,writable:!1,configurable:!1},customer:{value:A,writable:!1,configurable:!1},_masterToken:{value:h,writable:!1,enumerable:!1,configurable:!1},_encryptedCTicket:{value:l,writable:!1,enumerable:!1,configurable:!1},_mslTokens:{value:n,writable:!1,enumerable:!1,configurable:!1},_controllerEncoding:{value:d,writable:!1,enumerable:!1,configurable:!1},_signature:{value:f,
writable:!1,enumerable:!1,configurable:!1}})},getAuthData:function(){var a={};switch(this.mechanism){case g.MSL:var b=JSON.parse(JSON.stringify(this._masterToken));a.mastertoken=b;break;case g.NTBA:b=h(this._encryptedCTicket,"utf-8");a.cticket=b;break;case g.MSL_LEGACY:a.cticket=this._mslTokens;break;default:throw new R("Unsupported MDX mechanism.");}a.pin=this.targetPin;a.mdxauthdata=N(this._controllerEncoding);a.signature=N(this._signature);return a},equals:function da(a){return this===a?!0:a instanceof
Ad?da.base.call(this,a)&&(this._masterToken==a._masterToken||this._masterToken&&this._masterToken.equals(a._masterToken))&&(this._encryptedCTicket==a._encryptedCTicket||this._encryptedCTicket&&q(this._encryptedCTicket,a._encryptedCTicket))&&this._mslTokens==a._mslTokens&&q(this._controllerEncoding,a._controllerEncoding)&&q(this._signature,a._signature):!1}});se=function(c,d,f){function k(h,g,l,n){Sc(c,g,{result:function(k){b(f,function(){if(!k.isDecrypted())throw new Ma(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,
"MDX authdata "+d.toString());E(c,k,l,n,{result:function(a){b(f,function(){var b=a.getEncoding(),d=a.getSignature();return new Ad(c,h,k,b,d,{controllerAuthData:a,userIdToken:null})})},error:f.error})})},error:function(c){b(f,function(){if(c instanceof F)throw new Ma(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}function g(c,d,k,h){b(f,function(){throw new Ma(a.UNSUPPORTED_USERAUTH_MECHANISM,"NtbaControllerData$parse");})}function l(k,g,n,u){function r(f,k){b(k,
function(){var g;try{g=T(f)}catch(l){throw new Ma(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),l);}if(!g||0==g.length)throw new Ma(a.USERAUTH_MASTERTOKEN_MISSING,"MDX authdata "+JSON.stringify(d));try{var n=JSON.parse(h(g,"utf-8"));Sc(c,n,{result:function(c){b(k,function(){if(!c.isDecrypted())throw new Ma(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+d.toString());return c})},error:function(c){b(k,function(){if(c instanceof F)throw new Ma(a.USERAUTH_MASTERTOKEN_INVALID,
"MDX authdata "+JSON.stringify(d),c);throw c;})}})}catch(u){if(u instanceof SyntaxError)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d),u);throw u;}})}function q(f,k,g){b(g,function(){var l;try{l=T(f)}catch(n){throw new Ma(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),n);}if(!l||0==l.length)throw new Ma(a.USERAUTH_USERIDTOKEN_MISSING,"MDX authdata "+JSON.stringify(d));try{var u=JSON.parse(h(l,"utf-8"));Tc(c,u,k,{result:function(c){b(g,function(){if(!c.isDecrypted())throw new Ma(a.USERAUTH_USERIDTOKEN_NOT_DECRYPTED,
"MDX authdata "+JSON.stringify(d));return c})},error:function(c){b(g,function(){if(c instanceof F)throw new Ma(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}catch(r){if(r instanceof SyntaxError)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d),r);throw r;}})}b(f,function(){var h=g.split(",");if(3!=h.length||"1"!=h[0])throw new Ma(a.UNIDENTIFIED_USERAUTH_MECHANISM,"MDX authdata "+JSON.stringify(d));r(h[1],{result:function(l){q(h[2],l,{result:function(h){M(c,
l,n,u,{result:function(a){b(f,function(){return new Ad(c,k,g,n,u,{controllerAuthData:a,userIdToken:h})})},error:function(c){b(f,function(){if(c instanceof oc)throw new Ma(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+JSON.stringify(d),c);throw c;})}})},error:f.error})},error:f.error})})}b(f,function(){var b=d.pin,c=d.mdxauthdata,f=d.signature;if(!b||"string"!==typeof b||!c||"string"!==typeof c||!f||"string"!==typeof f)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));var h,
n;try{h=T(c),n=T(f)}catch(u){throw new Ma(a.MDX_CONTROLLERDATA_INVALID,"MDX authdata "+JSON.stringify(d),u);}if(d.mastertoken){c=d.mastertoken;if(!c||"object"!==typeof c)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));k(b,c,h,n)}else if(d.cticket){c=d.cticket;if(!c||"string"!==typeof c)throw new aa(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));-1==c.indexOf(",")?g(b,c,h,n):l(b,c,h,n)}else throw new Ma(a.UNIDENTIFIED_USERAUTH_MECHANISM,"MDX authdata "+JSON.stringify(d));
})}})();var dg;(function(){var b=gf.ACTION,c=Sd.ACTION,d=hf.ACTION;dg=qe.extend({init:function D(){D.base.call(this,qc.MDX)},createData:function(a,b,c,d){se(a,c,d)},authenticate:function(f,h,g,n){if(!(g instanceof Ad))throw new R("Incorrect authentication data type "+g.getClass().getName()+".");f=g.action;switch(g.mechanism){case Wc.MSL:if(b!=f)throw(new Ma(a.MDX_USERAUTH_ACTION_INVALID)).setUser(g);break;case Wc.NTBA:if(c!=f)throw(new Ma(a.MDX_USERAUTH_ACTION_INVALID)).setUser(g);break;case Wc.MSL_LEGACY:if(d!=
f)throw(new Ma(a.MDX_USERAUTH_ACTION_INVALID)).setUser(g);}f=g.controllerPin;h=g.targetPin;if(!f||!h)throw(new Ma(a.MDX_PIN_BLANK)).setUser(g);if(f!=h)throw(new Ma(a.MDX_PIN_MISMATCH)).setUser(g);f=g.customer;if(!f)throw(new Ma(a.MDX_USER_UNKNOWN)).setUser(g);if(n&&(n=n.customer,!f.equals(n)))throw(new Ma(a.USERIDTOKEN_USERAUTH_DATA_MISMATCH,"uad customer "+f+"; uit customer "+n)).setUser(g);return f}})})();Object.freeze({ENTITY_REAUTH:d.ENTITY_REAUTH,ENTITYDATA_REAUTH:d.ENTITYDATA_REAUTH});var Rg=
ca.Class.create({getTime:function(){},getRandom:function(){},isPeerToPeer:function(){},getMessageCapabilities:function(){},getEntityAuthenticationData:function(a,b){},getMslCryptoContext:function(){},getEntityAuthenticationFactory:function(a){},getUserAuthenticationFactory:function(a){},getTokenFactory:function(){},getKeyExchangeFactory:function(a){},getKeyExchangeFactories:function(){},getMslStore:function(){}}),eg=ca.Class.create({setCryptoContext:function(a,b){},getMasterToken:function(){},getNonReplayableId:function(a){},
getCryptoContext:function(a){},removeCryptoContext:function(a){},clearCryptoContexts:function(){},addUserIdToken:function(a,b){},getUserIdToken:function(a){},removeUserIdToken:function(a){},clearUserIdTokens:function(){},addServiceTokens:function(a){},getServiceTokens:function(a,b){},removeServiceTokens:function(a,b,c){},clearServiceTokens:function(){}}),af,me;(function(){var b=cd;af=function(c,d){switch(c){case b.LZW:return ae(d);case b.GZIP:return gzip$compress(d);default:throw new F(a.UNSUPPORTED_COMPRESSION,
c);}};me=function(c,d,f){switch(c){case b.LZW:return be(d);case b.GZIP:return gzip$uncompress(d);default:throw new F(a.UNSUPPORTED_COMPRESSION,c.name());}}})();eg.extend({setCryptoContext:function(a,b){},getMasterToken:function(){return null},getNonReplayableId:function(a){return 1},getCryptoContext:function(a){return null},removeCryptoContext:function(a){},clearCryptoContexts:function(){},addUserIdToken:function(a,b){},getUserIdToken:function(a){return null},removeUserIdToken:function(a){},clearUserIdTokens:function(){},
addServiceTokens:function(a){},getServiceTokens:function(b,c){if(c){if(!b)throw new F(a.USERIDTOKEN_MASTERTOKEN_NULL);if(!c.isBoundTo(b))throw new F(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+c.mtSerialNumber+"; mt "+b.serialNumber);}return[]},removeServiceTokens:function(b,c,d){if(d&&c&&!d.isBoundTo(c))throw new F(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+d.masterTokenSerialNumber+"; mt "+c.serialNumber);},clearServiceTokens:function(){}});var jc;(function(){jc=eg.extend({init:function l(){l.base.call(this);
Object.defineProperties(this,{masterTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},cryptoContexts:{value:{},writable:!1,enumerable:!1,configurable:!1},userIdTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},nonReplayableIds:{value:{},writable:!1,enumerable:!1,configurable:!1},unboundServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},mtServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},uitServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1}})},
setCryptoContext:function(a,b){if(b){var c=a.uniqueKey();this.masterTokens[c]=a;this.cryptoContexts[c]=b}else this.removeCryptoContext(a)},getMasterToken:function(){var a=null,b;for(b in this.masterTokens){var c=this.masterTokens[b];if(!a||c.isNewerThan(a))a=c}return a},getNonReplayableId:function(a){a=a.serialNumber;var b;b=this.nonReplayableIds[a]!==K?this.nonReplayableIds[a]:0;if(0>b||b>Ia)throw new R("Non-replayable ID "+b+" is outside the valid range.");b=b==Ia?0:b+1;return this.nonReplayableIds[a]=
b},getCryptoContext:function(a){return this.cryptoContexts[a.uniqueKey()]},removeCryptoContext:function(a){var b=a.uniqueKey();if(this.masterTokens[b]){delete this.masterTokens[b];delete this.cryptoContexts[b];var b=a.serialNumber,c;for(c in this.masterTokens)if(this.masterTokens[c].serialNumber==b)return;delete this.nonReplayableIds[b];Object.keys(this.userIdTokens).forEach(function(b){b=this.userIdTokens[b];b.isBoundTo(a)&&this.removeUserIdToken(b)},this);try{this.removeServiceTokens(null,a,null)}catch(d){if(d instanceof
F)throw new R("Unexpected exception while removing master token bound service tokens.",d);throw d;}}},clearCryptoContexts:function(){[this.masterTokens,this.cryptoContexts,this.nonReplayableIds,this.userIdTokens,this.uitServiceTokens,this.mtServiceTokens].forEach(function(a){for(var b in a)delete a[b]},this)},addUserIdToken:function(b,c){var d=!1,f;for(f in this.masterTokens)if(c.isBoundTo(this.masterTokens[f])){d=!0;break}if(!d)throw new F(a.USERIDTOKEN_MASTERTOKEN_NOT_FOUND,"uit mtserialnumber "+
c.mtSerialNumber);this.userIdTokens[b]=c},getUserIdToken:function(a){return this.userIdTokens[a]},removeUserIdToken:function(a){var b=null,c;for(c in this.masterTokens){var d=this.masterTokens[c];if(a.isBoundTo(d)){b=d;break}}Object.keys(this.userIdTokens).forEach(function(c){if(this.userIdTokens[c].equals(a)){delete this.userIdTokens[c];try{this.removeServiceTokens(null,b,a)}catch(d){if(d instanceof F)throw new R("Unexpected exception while removing user ID token bound service tokens.",d);throw d;
}}},this)},clearUserIdTokens:function(){for(var a in this.userIdTokens){var b=this.userIdTokens[a];try{this.removeServiceTokens(null,null,b)}catch(c){if(c instanceof F)throw new R("Unexpected exception while removing user ID token bound service tokens.",c);throw c;}delete this.userIdTokens[a]}},addServiceTokens:function(b){b.forEach(function(b){if(b.isUnbound())this.unboundServiceTokens[b.uniqueKey()]=b;else{if(b.isMasterTokenBound()){var c=!1,d;for(d in this.masterTokens)if(b.isBoundTo(this.masterTokens[d])){c=
!0;break}if(!c)throw new F(a.SERVICETOKEN_MASTERTOKEN_NOT_FOUND,"st mtserialnumber "+b.mtSerialNumber);}if(b.isUserIdTokenBound()){var c=!1,f;for(f in this.userIdTokens)if(b.isBoundTo(this.userIdTokens[f])){c=!0;break}if(!c)throw new F(a.SERVICETOKEN_USERIDTOKEN_NOT_FOUND,"st uitserialnumber "+b.uitSerialNumber);}b.isMasterTokenBound()&&((f=this.mtServiceTokens[b.mtSerialNumber])||(f={}),f[b.uniqueKey()]=b,this.mtServiceTokens[b.mtSerialNumber]=f);b.isUserIdTokenBound()&&((f=this.uitServiceTokens[b.uitSerialNumber])||
(f={}),f[b.uniqueKey()]=b,this.uitServiceTokens[b.uitSerialNumber]=f)}},this)},getServiceTokens:function(b,c){if(c){if(!b)throw new F(a.USERIDTOKEN_MASTERTOKEN_NULL);if(!c.isBoundTo(b))throw new F(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+c.mtSerialNumber+"; mt "+b.serialNumber);}var d={},f;for(f in this.unboundServiceTokens){var g=this.unboundServiceTokens[f];d[g.uniqueKey()]=g}if(b&&(g=this.mtServiceTokens[b.serialNumber]))for(f in g){var h=g[f];h.isUserIdTokenBound()||(d[f]=h)}if(c&&
(g=this.uitServiceTokens[c.serialNumber]))for(f in g)h=g[f],h.isBoundTo(b)&&(d[f]=h);g=[];for(f in d)g.push(d[f]);return g},removeServiceTokens:function(b,c,d){if(d&&c&&!d.isBoundTo(c))throw new F(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+d.mtSerialNumber+"; mt "+c.serialNumber);if(b&&!c&&!d){Object.keys(this.unboundServiceTokens).forEach(function(a){this.unboundServiceTokens[a].name==b&&delete this.unboundServiceTokens[a]},this);for(var f in this.mtServiceTokens){var g=this.mtServiceTokens[f],
h=Object.keys(g);h.forEach(function(a){g[a].name==b&&delete g[a]},this);this.mtServiceTokens[f]=g}for(var n in this.uitServiceTokens)g=this.uitServiceTokens[n],f=Object.keys(g),f.forEach(function(a){g[a].name==b&&delete g[a]},this),this.uitServiceTokens[n]=g}if(c&&!d){if(g=this.mtServiceTokens[c.serialNumber])h=Object.keys(g),h.forEach(function(a){var c=g[a];b&&c.name!=b||delete g[a]},this),this.mtServiceTokens[c.serialNumber]=g;for(n in this.uitServiceTokens){var q=this.uitServiceTokens[n];f=Object.keys(q);
f.forEach(function(a){var d=q[a];b&&d.name!=b||d.isBoundTo(c)&&delete q[a]},this);this.uitServiceTokens[n]=q}}d&&(g=this.uitServiceTokens[d.serialNumber])&&(f=Object.keys(g),f.forEach(function(a){var d=g[a];b&&d.name!=b||c&&!d.isBoundTo(c)||delete g[a]},this),this.uitServiceTokens[d.serialNumber]=g)},clearServiceTokens:function(){[this.unboundServiceTokens,this.mtServiceTokens,this.uitServiceTokens].forEach(function(a){for(var b in a)delete a[b]},this)}})})();var rd=Mg.extend({init:function l(){l.base.call(this);
Object.defineProperties(this,{_contextMap:{value:{},writable:!1,enumerable:!1,configurable:!1}})},addCryptoContext:function(a,b){if(b&&a&&a.length){var c=N(a);this._contextMap[c]=b}},getCryptoContext:function(a){return a&&a.length?(a=N(a),this._contextMap[a]||null):null},removeCryptoContext:function(a){a&&a.length&&(a=N(a),delete this._contextMap[a])}}),Td=Gf.extend({init:function u(a,b,c,d){u.base.call(this,a);Object.defineProperties(this,{_kde:{value:b,writable:!1,enumerable:!1,configurable:!1},
_kdh:{value:c,writable:!1,enumerable:!1,configurable:!1},_kdw:{value:d,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContext:function(b,c){if(!(c instanceof gc))throw new R("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw new tc(a.ENTITY_NOT_FOUND,"mgk "+c.identity);return new fd(b,this.localIdentity,this._kde,this._kdh,this._kdw)}}),Sg=Hf.extend({init:function r(a,b,c,d){r.base.call(this,a);Object.defineProperties(this,{_kpe:{value:b,writable:!1,
enumerable:!1,configurable:!1},_kph:{value:c,writable:!1,enumerable:!1,configurable:!1},_kpw:{value:d,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContext:function(b,c){if(!(c instanceof yc))throw new R("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw new tc(a.ENTITY_NOT_FOUND,"psk "+c.identity);return new fd(b,this.localIdentity,this._kpe,this._kph,this._kpw)}}),Tg=jc.extend({init:function D(a,b,c,d,f,g){D.base.call(this);this._log=a;
this._esn=b;this._keyRequestData=c;this._createKeyRequestData=d;this._systemKeyName=f;this._systemKeyWrapFormat=g},setCryptoContext:function la(a,b,c){var d=this;d._log.trace("Adding MasterToken",{SequenceNumber:a.sequenceNumber,SerialNumber:a.serialNumber,Expiration:a.expiration.getTime()});la.base.call(this,a,b);!c&&(a=d._createKeyRequestData)&&(d._log.trace("Generating new keyx request data"),a().then(function(a){d._keyRequestData=a},function(a){d._log.error("Unable to generate new keyx request data",
""+a)}))},addUserIdToken:function E(a,b){this._log.trace("Adding UserIdToken",{UserId:a,SerialNumber:b.serialNumber,MTSerialNumber:b.mtSerialNumber,Expiration:b.expiration.getTime()});E.base.call(this,a,b)},addServiceTokens:function A(a){A.base.call(this,a.filter(function(a){return!qd[a.name]}))},getKeyRequestData:function(){return this._keyRequestData},getStoreState:function(a){var c=this;b(a,function(){var d=c.getMasterToken();d?c.getKeysForStore(d,{result:function(f){b(a,function(){var a=c.userIdTokens,
b=Object.keys(a).map(function(b){var f=a[b];return{userId:b,userIdTokenJSON:a[b].toJSON(),serviceTokenJSONList:c.getServiceTokens(d,f).map(g)}});f.esn=c._esn;f.masterTokenJSON=d.toJSON();f.userList=b;var h=c._keyRequestData.storeData;h&&Object.keys(h).forEach(function(a){f[a]=h[a]});return f})},timeout:a.timeout,error:a.error}):a.result(null)})},getKeysForStore:function(c,d){var f=this;b(d,function(){var b=f.getCryptoContext(c),b={encryptionKey:b.encryptionKey,hmacKey:b.hmacKey};if(b.encryptionKey&&
b.hmacKey)if(f._systemKeyWrapFormat)f.wrapKeysWithSystemKey(b,d);else return b;else throw new F(a.INTERNAL_EXCEPTION,"Unable to get CryptoContext keys");})},wrapKeysWithSystemKey:function(d,f){var g=this;c(this._systemKeyName,{result:function(c){b(f,function(){var b=d.encryptionKey,h=d.hmacKey,n=b[hd],q=h[hd];if(n&&q)return{wrappedEncryptionKey:n,wrappedHmacKey:q};Promise.resolve().then(function(){return Promise.all([qa.wrapKey(g._systemKeyWrapFormat,b,c,c.algorithm),qa.wrapKey(g._systemKeyWrapFormat,
h,c,c.algorithm)])}).then(function(a){n=N(a[0]);b[hd]=n;q=N(a[1]);h[hd]=q;f.result({wrappedEncryptionKey:n,wrappedHmacKey:q})}).catch(function(b){f.error(new F(a.INTERNAL_EXCEPTION,"Error wrapping key with SYSTEM key",b))})})},timeout:f.timeout,error:f.error})},unwrapKeysWithSystemKey:function(d,f){var g=this;c(this._systemKeyName,{result:function(c){b(f,function(){var b=T(d.wrappedEncryptionKey),h=T(d.wrappedHmacKey);Promise.resolve().then(function(){return Promise.all([qa.unwrapKey(g._systemKeyWrapFormat,
b,c,c.algorithm,Kb,!1,yb),qa.unwrapKey(g._systemKeyWrapFormat,h,c,c.algorithm,ta,!1,tb)])}).then(function(a){var b=a[0];a=a[1];b[hd]=d.wrappedEncryptionKey;a[hd]=d.wrappedHmacKey;f.result({encryptionKey:b,hmacKey:a})}).catch(function(b){f.error(new F(a.INTERNAL_EXCEPTION,"Error unwrapping with SYSTEM key",b))})})},timeout:f.timeout,error:f.error})},loadStoreState:function(a,b,c,d){function f(d){function g(){if(!B&&N&&F&&T){B=!0;var c=new Lb(b,N,a.esn,{rawKey:F},{rawKey:T});n.setCryptoContext(N,c,
!0);d.result(N)}}function h(a,b){q.error(a,b&&""+b);B||(B=!0,d.error())}var B,N,F,T;c.masterTokenJSON?(Sc(b,c.masterTokenJSON,{result:function(a){N=a;g()},timeout:function(){h("Timeout parsing MasterToken")},error:function(a){h("Error parsing MasterToken",a)}}),n._systemKeyWrapFormat?n.unwrapKeysWithSystemKey(c,{result:function(a){F=a.encryptionKey;T=a.hmacKey;g()},timeout:function(){h("Timeout unwrapping keys")},error:function(a){h("Error unwrapping keys",a)}}):Promise.resolve().then(function(){return qa.encrypt({name:Kb.name,
iv:new Uint8Array(16)},c.encryptionKey,new Uint8Array(1))}).then(function(a){F=c.encryptionKey}).catch(function(a){h("Error loading encryptionKey")}).then(function(){return qa.sign(ta,c.hmacKey,new Uint8Array(1))}).then(function(a){T=c.hmacKey;g()}).catch(function(a){h("Error loading hmacKey")})):h("Persisted store is corrupt")}function g(a,d){var f;try{f=c.userList.slice()}catch(q){}f?function Cb(){var c=f.shift();c?Tc(b,c.userIdTokenJSON,a,{result:function(b){try{n.addUserIdToken(c.userId,b),h(a,
b,c.serviceTokenJSONList,{result:Cb,timeout:Cb,error:Cb})}catch(d){Cb()}},timeout:Cb,error:Cb}):d.result()}():d.result()}function h(a,c,d,f){var g;try{g=d.slice()}catch(q){}if(g){var A=n.getCryptoContext(a);(function Pe(){var d=g.shift();d?Pd(b,d,a,c,A,{result:function(a){n.addServiceTokens([a]);Pe()},timeout:function(){Pe()},error:function(){Pe()}}):f.result()})()}else f.result()}var n=this,q=n._log;c.esn!=n._esn?(q.error("ESN mismatch, starting fresh"),d.error()):f({result:function(a){g(a,d)},timeout:d.timeout,
error:d.error})}}),qd={"streaming.servicetokens.movie":!0,"streaming.servicetokens.license":!0},hd="$netflix$msl$wrapsys",Fd,Ug=Rg.extend({init:function(a,b,c,d,f,g){var h=new Nd([cd.LZW]),n=new Lg;n.addPublicKey(b,c);d[Ra.RSA]=new Kg(n);b={};b[qc.EMAIL_PASSWORD]=new Qg;b[qc.NETFLIXID]=new Pg;b[qc.MDX]=new dg;a={_mslCryptoContext:{value:new He,writable:!0,enumerable:!1,configurable:!1},_capabilities:{value:h,writable:!1,enumerable:!1,configurable:!1},_entityAuthData:{value:f,writable:!0,enumerable:!1,
configurable:!1},_entityAuthFactories:{value:d,writable:!1,enumerable:!1,configurable:!1},_userAuthFactories:{value:b,writable:!1,enumerable:!1,configurable:!1},_keyExchangeFactories:{value:g,writable:!1,enumerable:!1,configurable:!1},_store:{value:a,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},getTime:function(){return Date.now()},getRandom:function(){return new ce},isPeerToPeer:function(){return!1},getMessageCapabilities:function(){return this._capabilities},getEntityAuthenticationData:function(a,
b){b.result(this._entityAuthData)},getMslCryptoContext:function(){return this._mslCryptoContext},getEntityAuthenticationFactory:function(a){return this._entityAuthFactories[a]},getUserAuthenticationFactory:function(a){return this._userAuthFactories[a]},getTokenFactory:function(){return null},getKeyExchangeFactory:function(a){return this._keyExchangeFactories.filter(function(b){return b.scheme==a})[0]},getKeyExchangeFactories:function(){return this._keyExchangeFactories},getMslStore:function(){return this._store}}),
Ce=yd.extend({init:function(a,b,c,d){this._log=a;this._mslContext=b;this._mslRequest=c;this._keyRequestData=d},getCryptoContexts:function(){return{}},isEncrypted:function(){return!!this._mslRequest.encrypted},isNonReplayable:function(){return!!this._mslRequest.nonReplayable},isRequestingTokens:function(){return!0},getUserId:function(){return this._mslRequest.userId||null},getUserAuthData:function(a,c,d,f){var g=this._mslRequest,h=this._mslContext;b(f,function(){if(a)return null;if(g.email)return new Rd(g.email,
g.password);if(g.netflixId)return new zd(g.netflixId,g.secureNetflixId);if(g.mdxControllerToken){var b=(new Sd("regpairrequest",g.mdxNonce,g.mdxEncryptedPinB64,g.mdxSignature)).getEncoding();return new Ad(h,g.mdxPin,g.mdxControllerToken,b,g.mdxSignature)}if(d&&g.getIdCookies){var c=g.getIdCookies(),b=c.netflixId,c=c.secureNetflixId;if(b)return new zd(b,c)}return null})},getCustomer:function(){return null},getKeyRequestData:function(a){a.result(this._mslRequest.allowTokenRefresh?[this._keyRequestData]:
[])},updateServiceTokens:function(a,b,c){var d=this._log,f=(this._mslRequest.serviceTokens||[]).slice(),g=this._mslContext;b=g.getMslStore();var h=a.builder.getMasterToken(),n=this.getUserId(),q=b.getUserIdToken(n);(function Sa(){var b=f.shift();if(b)try{b instanceof Vc?(a.addPrimaryServiceToken(b),Sa()):Pd(g,b,h,q,null,{result:function(b){try{a.addPrimaryServiceToken(b)}catch(c){d.warn("Exception adding service token",""+c)}Sa()},timeout:function(){d.warn("Timeout parsing service token");Sa()},error:function(a){d.warn("Error parsing service token",
""+a);Sa()}})}catch(n){d.warn("Exception processing service token",""+n),Sa()}else c.result(!0)})()},write:function(a,b,c){var d=S(this._mslRequest.body);a.write(d,0,d.length,b,{result:function(f){f!=d.length?c.error(new pb("Not all data was written to output.")):a.flush(b,{result:function(){c.result(!0)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},getDebugContext:function(){this._dc||(this._dc=new te(this._log,
this._mslRequest));return this._dc}}),te=bg.extend({init:function(a,b){this._log=a;this._mslRequest=b},sentHeader:function(a){this._log.trace("Sent MSL header",n(this._mslRequest,a),a.serviceTokens&&a.serviceTokens.map(Bb).join("\n"))},receivedHeader:function(a){var b=n(this._mslRequest,a),c=a.errorCode;c?this._log.warn("Received MSL error header",b,{errorCode:c,errorMessage:a.errorMessage,internalCode:a.internalCode}):this._log.trace("Received MSL header",b)}}),jf={PSK:function(a){return kb(a,Ra.PSK,
Sg,yc,Tb,Da)},MGK:function(a){return kb(a,Ra.MGK,Td,gc,Tb,Da)},MGK_WITH_FALLBACK:function(b){var c;switch(b.esnPrefix){case "GOOGEUR001":case "GOOGLEXX01":c="PSK";break;default:c="MGK"}var d=jf[c];if(!d)throw new F(a.INTERNAL_EXCEPTION,"Invalid fallback authenticationType: "+c);return d(b)},MGK_JWE:function(a){return kb(a,Ra.MGK,Td,gc,Of,Ne)},JWK_RSA:function(a){return Vb(a,{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},wd.JWK_RSA)},JWK_RSAES:function(a){return Vb(a,
{name:"RSAES-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])},wd.JWK_RSAES)},JWEJS_RSA:function(a){return Vb(a,{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])},wd.JWEJS_RSA)}};cc.netflix=cc.netflix||{};cc.netflix.msl={createMslClient:function(b,c){var d=b.log,f,g,h,n=b.notifyMilestone||function(){};Promise.resolve().then(function(){if(!(B&&B.generateKey&&B.importKey&&B.unwrapKey))throw new F(a.INTERNAL_EXCEPTION,"No WebCrypto");Ca=B.generateKey({name:"AES-CBC",
length:128},!0,yb).then?ed.V2014_02:ed.LEGACY;n("mslisik");return qa.importKey("spki",b.serverIdentityKeyData,Sb,!1,["verify"])}).then(function(b){return new Promise(function(c,d){Wb(b,{result:c,error:function(){d(new F(a.KEY_IMPORT_ERROR,"Unable to create server identity verification key"))}})})}).then(function(c){f=c;if(c=jf[b.authenticationType])return n("mslcc"),c(b);throw new F(a.INTERNAL_EXCEPTION,"Invalid authenticationType: "+b.authenticationType);}).then(function(a){g=new Tg(d,b.esn,a.keyRequestData,
a.createKeyRequestData,b.authenticationKeyNames.s,b.systemKeyWrapFormat);h=new Ug(g,b.serverIdentityId,f,a.entityAuthFactories,a.entityAuthData,a.keyExchangeFactories);var c=b.storeState;if(c)return n("mslss"),d.info("Loading store state"),new Promise(function(a,d){g.loadStoreState(b,h,c,{result:a,timeout:a,error:a})});d.info("No store state, starting fresh")}).then(function(){var a=new df;n("msldone");c.result(new Ec(d,a,h,g))}).catch(function(a){c.error(a)})},IHttpLocation:Lf,MslIoException:pb}})(window);
(function(){(function K(C,h,S){function z(q,ra){if(!h[q]){if(!C[q]){var pa="function"==typeof require?require:void 0;if(!ra&&pa)return pa(q,!0);if(M)return M(q,!0);pa=Error("Cannot find module '"+q+"'");throw pa.code="MODULE_NOT_FOUND",pa;}pa=h[q]={Ta:{}};C[q][0].call(pa.Ta,function(b){var f=C[q][1][b];return z(f?f:b)},pa,pa.Ta,K,C,h,S)}return h[q].Ta}for(var M="function"==typeof require?require:void 0,q=0;q<S.length;q++)z(S[q]);return z})({1:[function(K){(function(C,h){function S(a){a=Ja(a)?id(a):
a;return ci.qg(a)}function z(){return!0}function M(){}function q(){}function ia(a){return null!==a&&a!==h}function ra(a){return"object"==typeof a}function pa(a){return a&&a.constructor==ab}function b(a,b,c){return"number"==typeof a&&!isNaN(a)&&isFinite(a)&&(b===h||a>=b)&&(c===h||a<=c)}function f(a,c,t){return b(a,c,t)&&0==a%1}function a(a){return a&&Vg.test(a)}function Ja(a){return"string"==typeof a}function Wa(a){return Ja(a)&&a}function g(a){return"function"==typeof a}function c(a,b){for(var c in a)a.hasOwnProperty(c)&&
b(c,a[c])}function n(a,b,t){if(b)if(t){var d=t.ah,f=t.prefix,g=t.Ye;c(b,function(b,c){if(!g||ia(c))a[(f||"")+(d?b.toLowerCase():b)]=c})}else c(b,function(b,c){a[b]=c});return a}function Bb(a,b,c,d){if(a){var f=a[b];g(f)&&(c=f.apply(a,Wg.call(arguments,3)))}}function Ec(a){var b={};c(a,function(a,y){b[a]=y});return b}function kb(a){for(var b=0,c=arguments.length;b<c;){var d=arguments[b++];if(ia(d))return d}}function Vb(a){for(var b,c=!0,d;c;)for(c=!1,b=a.length;--b;)d=a[b],d.startTime<a[b-1].startTime&&
(a[b]=a[b-1],a[b-1]=d,c=!0)}function Fb(a){for(var b={},c=a.length;c--;)b[a[c]]=!0;return b}function B(a){return Mc(a,10)}function xb(a,b){return jb(a+kf()*(b-a))}function N(a){if(a){var b=a.stack,c=a.number;a=""+a;b?(b=""+b,0!=b.indexOf(a)&&(b=a+"\n"+b)):b=a;c&&(b+="\nnumber:"+c);return b}}function T(a){return b(a)?a.toFixed(0):""}function Ua(a){return b(a)?(a/1E3).toFixed(0):""}function ae(a){return b(a)?a.toFixed():""}function be(a,b){try{var c=Yb.plugins,d=c.length,f;for(f=0;f<d;f++)if(b.test(c[f][a]))return c[f];
return!1}catch(g){}}function ma(){var a=be("filename",/widevinecdm/i);if(a){try{var b=a.description.match(/version: ([0-9.]+)/);if(b&&b[1])return b[1]}catch(c){}return"true"}return"false"}function Ia(){try{var a=Mb.defineProperty({},"videoCapabilities",{value:[{contentType:'video/mp4; codecs="avc1.640028"'}]});Yb.requestMediaKeySystemAccess("com.widevine.alpha",[a]).then(function(){Xc.cpth264wv=!0}).catch(function(){Xc.cpth264wv=!1})}catch(b){}}function cd(a,b){if(a===b)return!0;if(!a||!b)return!1;
for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!==b[c]))return!1;return!0}function Id(a,b){if(a.length==b.length){for(var c=a.length;c--;)if(a[c]!=b[c])return!1;return!0}return!1}function sd(a){if(a){var b=a.length;if(b)return b=xb(0,b-1),a[b]}}function Ef(a,b){function c(){a.removeEventListener("loadedmetadata",c);b.apply(this,arguments)}a.addEventListener("loadedmetadata",c)}function Rc(){var a=ub.cookie.split("; "),b=a.length,c,d,f,g={};for(c=0;c<b;c++)if(d=di(a[c]))f=d.indexOf("="),
0<f&&(g[d.substr(0,f)]=d.substr(f+1));return g}function Jd(){var a,b;if(a=Jd.mn)return a;a=lf.search.substr(1);b=a.indexOf("#");0<=b&&(a=a.substr(0,b));a=d(a);return Jd.mn=a}function d(a){for(var b=/[+]/g,c=(a||"").split("&"),d={},f,g=0;g<c.length;g++)a=di(c[g]),f=a.indexOf("="),0<=f?d[ei(a.substr(0,f).replace(b,"%20")).toLowerCase()]=ei(a.substr(f+1).replace(b,"%20")):d[a.toLowerCase()]=null;return d}function ca(a){var b="";c(a,function(a,y){b&&(b+="&");b+=Ud(a)+"="+Ud(y)});return b}function Ha(a,
b,d,f){var g=ub.createElement(a);b&&(g.style.cssText=b);d&&(g.innerHTML=d);f&&c(f,function(a,b){g.setAttribute(a,b)});return g}function ce(a){var b="";c(a,function(a,y){b+=(b?";":"")+a+":"+y});return b}function Gc(a,b){var c=a[0];if(b<=c[0])return c.slice(1);for(var d=1,f;f=a[d++];){if(b<=f[0]){var d=(b-c[0])/(f[0]-c[0]),g=[];Ea(c.length,f.length);for(var h=1;h<c.length;h++)g.push((c[h]||0)+d*((f[h]||0)-(c[h]||0)));return g}c=f}return c.slice(1)}function F(a){return Qj.call(a,function(a,b){return a-
b})}function V(a){for(var b=0,c=a.length;c--;)b+=a[c];return b}function aa(a,b){var c=-1,d=a.length,f,g;if(1===arguments.length){for(;++c<d&&!(null!=(f=a[c])&&f<=f);)f=h;for(;++c<d;)null!=(g=a[c])&&g>f&&(f=g)}else{for(;++c<d&&!(null!=(f=b.call(a,a[c],c))&&f<=f);)f=h;for(;++c<d;)null!=(g=b.call(a,a[c],c))&&g>f&&(f=g)}return f}function tc(a,b){var c=-1,d=a.length,f,g;if(1===arguments.length){for(;++c<d&&!(null!=(f=a[c])&&f<=f);)f=h;for(;++c<d;)null!=(g=a[c])&&f>g&&(f=g)}else{for(;++c<d&&!(null!=(f=
b.call(a,a[c],c))&&f<=f);)f=h;for(;++c<d;)null!=(g=b.call(a,a[c],c))&&f>g&&(f=g)}return f}function Db(a){return g(a.then)?a:new Vd(function(b,c){a.oncomplete=function(){b(a.result)};a.onerror=function(){c(a.error)}})}function pb(a,c){function d(a){0>f.indexOf(a)&&b(a)&&f.push(a)}a=a.slice();F(a);var f=[];if(!c||!c.length)return a;if(!a.length)return[];var g=c.length,h,k;try{for(;g--;){var l=""+c[g],bb=B(l);switch(l[l.length-1]){case "-":for(h=a.length;h--;)if(k=a[h],k<bb){d(k);break}break;case "+":for(h=
0;h<a.length;h++)if(k=a[h],k>bb){d(k);break}break;default:0<=a.indexOf(bb)&&d(bb)}}}catch(p){}f.length||f.push(a[0]);F(f);return f}function R(a,b,c){var d;a/b>c?(d=jb(b*c),a=b):(d=a,a=jb(a/c));return{width:d,height:a}}function sb(a,b){var c=a.length,d=(c-1)*b+1;if(1===d)return a[0];if(d==c)return a[c-1];c=ya(d);return a[c-1]+(d-c)*(a[c]-a[c-1])}function Qa(a){try{return d(Xg(a)).bt}catch(b){}}function oc(a,b){b=jd.isArray(b)?b:[b];for(var c=a.length,d=0;d<c;d++)for(var f=0;f<b.length;f++)if(a[d].type==
b[f])return a[d];throw new Za("Box not found "+b);}function Ba(a){return a.rb("trak/mdia/minf/stbl/stsd/enca|encv").children.filter(function(a){return"sinf"==a.type&&"cenc"==a.yg.schm.bs})[0].rb("schi/tenc").Vj}function Ma(a){function b(a,y){var d=c[a];c[a]=c[y];c[y]=d}var c=new ab(a);b(0,3);b(1,2);b(4,5);b(6,7);return c}function qa(a,b,c){return a>=b?a<=c?a:c:b}function Ca(a){if(b(a))return(a/1E3).toFixed(3)}function ed(a,b){var c=Wg.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,b){return"undefined"!=
typeof c[b]?c[b]:a})}function uc(a){for(var b=a.length,c=new Uint16Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}function Kb(a){function b(){if(g)for(var a;a=d.pop();)a(h)}function c(a){g=!0;h=a;b()}var d=[],f,g,h;return function(g){d.push(g);f||(f=!0,a(c));b()}}function ta(a){return C.setTimeout(a,0)}function Xa(a,b){return C.setTimeout(a,b)}function mb(a){C.clearTimeout(a)}function Sb(a,b){return C.setInterval(a,b)}function yb(a){C.clearInterval(a)}function ja(){var a=mf()-kd;if(a<Yg){var b=
Yg+1,c=b-a;ta(function(){wa.warn("Clock roll-back detected, adjusting time",{Delta:""+-c})});kd-=c;a=b}return Yg=a}function tb(){return ya(mf()/1E3)}function Kd(){}function Rb(a){function b(d){h=null;c(d||a)}function c(a){var y=ja();if(g){var d=a-(y-f);0>=d?(a=g,g=null,f=y,a()):h=h||Xa(b.bind(this,a),d)}}var d=this,f=-a,g,h;this.Ah=function(b){a=b};this.lb=function(a){g=a;h=h||ta(b)};this.as=function(a){d.Ec();ta(a)};this.Ec=function(){h&&mb(h)}}function Ic(a){var b=0,c;this.get=function(){var d=
ja();if(!c||1E3<d-b)b=d,c=a();return c};this.clear=function(){c=h}}function Ld(a){this.Ha={index:a.index,qa:a.qa,Tc:a.Tc,ma:a.ma,Uc:a.Uc,Ub:re.prototype.Ub};this.r=function(a){this.Pi=a};this.r.prototype=this}function Wb(a){var b=a.length,c,d=1;if(b>d){c=de(a[d]);if(b==d+1)return c;for(var f={};d<b;)n(f,c),c=de(a[++d]);return f}}function de(a){return a&&ra(a)?a.Ga?a.Ga:g(a.Ee)?a.Ee():Rj.test(a.name)?{Exception:a.message||""+a,StackTrace:a.stack||"nostack"}:a:ia(a)?{Details:""+a}:{}}function Ee(a,
b,d){var f=a.fields||{},g=""+a.message;c(f,function(a,b){Sj.hasOwnProperty(a)||(g+=", "+a+": "+b)});g=g.replace(Tj," ");a=(a.time/1E3).toFixed(3)+"|"+(a.Ha&&a.Ha.index||0)+"|"+(Uj[a.level]||a.level)+"|"+a.category+"| "+g;f.Exception&&(a+="\r\n"+f.Exception);b&&f.StackTrace&&(a+="\r\n"+f.StackTrace);d&&f.Details&&(a+="\r\n"+f.Details);return a}function rb(){var a={},b="$es$"+Vj++;n(this,{addListener:function(c,d,f){var g="$netflix$player$order"+b+"$"+c;if(a){var h=a[c]?a[c].slice():[];f&&(d[g]=f);
0>h.indexOf(d)&&(h.push(d),h.sort(function(a,b){return(a[g]||0)-(b[g]||0)}));a[c]=h}},removeListener:function(b,c){if(a&&a[b]){for(var d=a[b].slice(),f;0<=(f=d.indexOf(c));)d.splice(f,1);a[b]=d}},Ov:function(b){return a&&!!(a[b]||(a[b]=[])).length},B:function(b,c,d){if(a)for(var f=a[b]||(a[b]=[]),g=0;g<f.length;g++)if(d)(function(){var a=f[g];ta(function(){a(c)})})();else f[g](c)},Dh:function(b,c){if(a){var d=a[b]||(a[b]=[]);c=c||{};for(var f=0;f<d.length&&!c.Ej;f++)d[f](c)}},Ec:function(){a=h}})}
function Fe(){function a(y){var f=c.indexOf(y);0<=f?c.splice(f,1):y==d&&(d=h);ta(b)}function b(){for(var h=0,O,k;!d&&(O=f[h]);){if(0>=c.length||!O.Uj)f.splice(h,1),k=g++,O.Uj?d=k:c.push(k),O.Un({c:!0,jw:k,hf:function(){a(k)}});h++}}var c=[],d,f=[],g=1;n(this,{sn:function(a,c){f.push({Uj:a,Un:c});b()},hf:a})}function Va(a,b){function c(a,b){return(a["$netflix$player$order"+g]||0)-(b["$netflix$player$order"+g]||0)}var d=this,f=b?[b]:[],g="$op$"+Wj++;n(d,{value:a,addListener:function(a,b){f.indexOf(a);
a["$netflix$player$order"+g]=b;f=f.slice();f.push(a);f.sort(c)},removeListener:function(a){f=f.slice();var b;0<=(b=f.indexOf(a))&&f.splice(b,1)},set:function(a,b){if(d.value!==a){var c={oldValue:d.value,newValue:a};b&&n(c,b);d.value=a;for(var y=f,t=y.length,g=0;g<t;g++)y[g](c)}}})}function ee(){}function Jc(a,b){var c;n(this,{jc:function(){c||(c=Xa(b,a))},wb:function(){c&&(mb(c),c=h)}})}function vc(a){var b,c="";for(b=8;b--;)c=(Xj[a&15]||"0")+c,a>>>=4;return c}function Hb(a,b,c){this.errorCode=a||
U.cc;b&&ra(b)?(this.g=b.g,this.P=b.P,this.C=b.C,this.qe=b.Zo,this.Ic=b.Ic,this.sg=b.sg,this.Jc=b.Jc,this.td=b.td,this.Ca=b.Ca,this.We=b.method):(this.g=b,this.P=c);a=this.stack=[this.errorCode];this.g?a.push(this.g):this.P&&a.push(P.cc);this.P&&a.push(this.P);this.qd=fg+a.join("-")}function fe(a){return 1100<=a&&1199>=a}function Ge(a){return 1300<=a&&1399>=a}function ud(a){return 1900<=a&&1999>=a}function wc(a,b){B(a);return 1<=a&&9>=a?b+a:b}function xc(a){return wc(a,P.Pl)}function Kc(a){return wc(a,
P.ml)}function eb(a){var b={};b.ErrorSubCode=a.g||P.cc;a.P&&(b.ErrorExternalCode=a.P);a.C&&(b.ErrorDetails=a.C);return b}function fc(a){fi[a]=ja()}function fd(a){if(Ja(a)&&Yj.test(a)){var b=a.split(".");if(4===b.length){for(var c=0;c<b.length;c++){var d=B(b[c]);if(0>d||!f(d,0,255)||1!==b[c].length&&0===b[c].indexOf("0"))return}return a}}}function Lb(a){var b=0;if(fd(a)===a)return a=a.split("."),b+=B(a[0])<<24,b+=B(a[1])<<16,b+=B(a[2])<<8,b+B(a[3])}function He(a){if(Ja(a)&&a.match(Zj)){var b=a.split(":");
if(-1!==b[b.length-1].indexOf(".")){a=Lb(b[b.length-1])>>>0;var c=[];c.push((a>>>16&65535).toString(16));c.push((a&65535).toString(16));b.pop();b.push(c[0]);b.push(c[1]);a=b.join(":")}a=a.split("::");if(!(2<a.length||1===a.length&&8!==b.length)){if(1<a.length)if(b=a[0].split(":"),a=a[1].split(":"),1===b.length&&""===b[0]&&(b=[]),1===a.length&&""===a[0]&&(a=[]),c=8-(b.length+a.length),1>c)b=[];else{var d;for(d=0;d<c;d++)b.push("0");for(d=0;d<a.length;d++)b.push(a[d])}a=b.length;if(8===a){for(;a--;)if(c=
Mc(b[a],16),!f(c,0,65535))return;return b.join(":")}}}}function Ra(a,b,c){var d=fd(a),f=He(a),g=fd(b),h=He(b);if(!d&&!f||!g&&!h||d&&!g||f&&!h)return!1;if(a===d)return c=-1<<32-c,(Lb(a)&c)!==(Lb(b)&c)?!1:!0;if(a===f){a=a.split(":");b=b.split(":");for(d=ya(c/16);d--;)if(a[d]!==b[d])return!1;c%=16;if(0!==c)for(a=Mc(a[d],16).toString(2),b=Mc(b[d],16).toString(2),a="0000000000000000".substring(0,16-a.length)+a,b="0000000000000000".substring(0,16-b.length)+b,d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}return!1}
function Hc(a,b){var c;this.Ch=function(){c||(c=Sb(b,a))};this.pd=function(){c&&(yb(c),c=h)}}function Ie(a,b,c,d,f){wd(a,function(a){a.c?ak(a.object,b,c,d,function(a){a.c?f({c:!0,entries:a.entries}):f(a)}):f(a)})}function ge(){function a(c){var y=d.Hg();if(f!=y){var t,g;y<m&&(g=l||p[ya(y*W)]||p[0]);if(g){for(;g&&g.endTime<y;)g=g.next;for(;g&&g.previous&&g.previous.endTime>=y;)g=g.previous}g&&(g.startTime<=y&&y<=g.endTime?(t=g,b(g.endTime-y)):b(g.startTime-y));l=g;f=y;k!=t&&(k=t,!c&&d.jh&&d.jh())}}
function b(a){bb&&(mb(bb),bb=h);g&&0<a&&(bb=Xa(c,a+bk))}function c(){bb=h;a()}var d=this,f,g,k,l,bb,p,m,W;n(d,{Ik:function(b){var c=b&&b.length;l=k=f=h;p=b;m=c&&Ea.apply(null,b.map(function(a){return a.endTime}));W=c&&c/m;a()},Hg:h,start:function(){g=!0;a()},stop:function(){g=!1;bb&&(mb(bb),bb=h)},gp:function(){a(!0);return k},jh:h})}function gc(a,b,c,d,f){var g="";a.textNodes.forEach(function(a){var y=g,k=a.style,l=gi(a.text);for(a=a.lineBreaks;a--;)l="<br />"+l;var n=k.characterStyle;a=d[n];var W;
0<=n.indexOf("MONOSPACE")?(n=k.cellResolution,W=a&&n&&(40===n.x&&19===n.y?W=4/3/(40/19):52===n.x&&19===n.y&&(W=16/9/(52/19)),W)?a.width/a.fontSize/W:void 0,W=W||a.lineHeight):W=a.lineHeight;W=k.characterSize*b.height/(W||1);W=0<f?ya(W*f):jb(W);W={"font-size":W+"px","line-height":"normal","font-weight":"normal"};k.characterItalic&&(W["font-style"]="italic");k.characterUnderline&&(W["text-decoration"]="underline");k.characterColor&&(W.color=k.characterColor);k.backgroundColor&&0!==k.backgroundOpacity&&
(n=k.backgroundColor,a=k.backgroundOpacity,a=a!==h?a:1,n=n.substring(1),n=Mc(n,16),W["background-color"]="rgba("+(n>>16&255)+","+(n>>8&255)+","+(n&255)+","+a+")");a=k.characterEdgeColor||"#000000";switch(k.characterEdgeAttributes){case Zg:W["text-shadow"]=a+" 0px 0px 13px";break;case hi:W["text-shadow"]="-1px 0px "+a+",0px 1px "+a+",1px 0px "+a+",0px -1px "+a;break;case ck:W["text-shadow"]="-1px -1px white, 0px -1px white, -1px 0px white, 1px 1px black, 0px 1px black, 1px 0px black";break;case dk:W["text-shadow"]=
"1px 1px white, 0px 1px white, 1px 0px white, -1px -1px black, 0px -1px black, -1px 0px black"}W=ce(W);(a=c[k.characterStyle||"PROPORTIONAL_SANS_SERIF"])&&(W+=";"+a);k=k.characterOpacity;0<k&&1>k&&(l='<span style="opacity:'+k+'">'+l+"</span>");g=y+('<span style="'+W+'">'+l+"</span>")});return g}function Ff(a,b,d,f,g){var h="",k=g.width;g=g.height;for(var l=b.length;l--;){var bb=b[l],p=a[l],p=p&&p.region,n="position:absolute;background:"+f+";width:"+jb(bb.width+2*d)+"px;height:"+jb(bb.height+2*d)+
"px;";c(Gf(p,bb,k,g,d),function(a,b){n+=a+":"+b+";"});h+='<div style="'+n+'"></div>'}return h}function Gf(a,b,c,d,f){var g={};"right"==a.horizontalAlignment?g.right=100*(c-b.left-b.width-f)/c+"%":g.left=100*(b.left-f)/c+"%";"bottom"==a.verticalAlignment?g.bottom=100*(d-b.top-b.height-f)/d+"%":g.top=100*(b.top-f)/d+"%";return g}function yc(a){function b(){var c=f.parentNode,h=c&&c.clientWidth,O=c&&c.clientHeight,W=c=0,m={width:h,height:O},v,I;if(0<h&&0<O&&g){k&&(m=R(h,O,k),c=jb((h-m.width)/2),W=jb((O-
m.height)/2));var H=g.blocks;v=H&&H.map(function(b){var c=gc(b,m,a,G),d={display:"block","white-space":"nowrap"};switch(b.region.horizontalAlignment){case "left":d["text-align"]="left";break;case "right":d["text-align"]="right";break;default:d["text-align"]="center"}b=ce(d)+";position:absolute";return Ha("div",b,c,$g)})}n(d,{left:c+"px",right:c+"px",top:W+"px",bottom:W+"px"});f.style.display="none";f.innerHTML="";if(v&&v.length){h=m.width;c=m.height;v.forEach(function(a){f.appendChild(a)});var q=
ce(d);f.style.cssText=q+";visibility:hidden;z-index:-1";var J=[],Z,X,ka;for(I=v.length;I--;)X=v[I],ka=H[I],Z=Je(X,ka,h,c),Z.width>h&&(X.innerHTML=gc(ka,m,a,G,h/Z.width),Z=Je(X,ka,h,c)),J[I]=Z;I=m;l&&(I=Hf(m,l,O,W));J=he(J,I);if(W=H&&H[0]&&H[0].textNodes&&H[0].textNodes[0]&&H[0].textNodes[0].style)O=W.windowColor,W=W.windowOpacity,O&&0<W&&(I=jb(c/50),O=Ff(H,J,I,O,m),O=Ha("div","position:absolute;left:0;top:0;right:0;bottom:0;opacity:"+W,O,$g),f.insertBefore(O,f.firstChild));f.style.display="none";
for(I=J.length;I--;)Z=J[I],n(v[I].style,Gf(H[I].region,Z,h,c,0));f.style.cssText=q}}var d={position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"block"},f=Ha("DIV",h,h,{"class":"player-timedtext"}),g,k,G=function(a){var b={};c(a,function(a,c){var y=Ha("DIV","display:block;position:fixed;z-index:-1;visibility:hidden;font-size:1000px;"+c+";","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",$g);ub.body.appendChild(y);var d={fontSize:1E3,height:y.clientHeight,width:y.clientWidth/52,
lineHeight:y.clientHeight/1E3};ub.body.removeChild(y);b[a]=d});return b}(a),l;f.onselectstart=function(){return!1};n(this,{sj:function(){return f},rs:function(a){k=a},us:function(a){g=a;b()},Pr:b,Bh:function(a){l=a;b()}})}function Je(a,b,c,d){var f=b.region,g=(f.marginTop||0)*d,h=(f.marginBottom||0)*d,k=(f.marginLeft||0)*c,l=(f.marginRight||0)*c;b=a.clientWidth||1;a=a.clientHeight||1;switch(f.verticalAlignment){case "top":d=g;break;case "center":d=(g+d-h-a)/2;break;default:d=d-h-a}switch(f.horizontalAlignment){case "left":c=
k;break;case "right":c=c-l-b;break;default:c=(k+c-l-b)/2}return{top:d,left:c,width:b,height:a}}function Hf(a,b,c,d){return{height:c-Ea(d,b.bottom|0)-Ea(d,b.top|0),width:a.width}}function he(a,b){function c(a,b,y){if(a&&1<a.length){for(var f=[],t=[],g=0;g<a.length;g++)f[g]=0,t[g]=0;for(var h=!1,g=0;g<a.length;g++)for(var k=g+1;k<a.length;k++){var O,ba=a[g],l=a[k];if(0>ba.width||0>l.width||l.left>ba.left+ba.width||l.left+l.width<ba.left||l.top>ba.top+ba.height?0:l.top+l.height>=ba.top){O=Ea(ba.left,
l.left);var va=Ea(ba.top,l.top);O={width:Ea(Fa(ba.left+ba.width,l.left+l.width)-O,0),height:Ea(Fa(ba.top+ba.height,l.top+l.height)-va,0),x:O,y:va}}else O=void 0;if(O&&1<O.width&&1<O.height)if(va=O.width<=O.height,ba=d(a[g]),l=d(a[k]),va&&b||!va&&!b)O=Ea(O.width/2,.25),ba.x<=l.x?(t[g]-=O,t[k]+=O):(t[k]-=O,t[g]+=O);else if(va&&!b||!va&&b)ba=Ea(O.height/2,.25),f[g]-=ba,f[k]+=ba}for(g=0;g<a.length;g++){if(-.25>t[g]&&0<=a[g].left+t[g]||.25<t[g]&&a[g].left+a[g].width+t[g]<=y.width)a[g].left+=t[g],h=!0;
if(-.25>f[g]&&0<=a[g].top+f[g]||.25<f[g]&&a[g].top+a[g].height+f[g]<=y.height)a[g].top+=f[g],h=!0}return h}}function d(a){return{x:a.left+a.width/2,y:a.top+a.height/2}}var f=a.map(function(a){return{top:a.top,left:a.left,width:a.width,height:a.height}});(function(a,b){a.forEach(function(a){0>a.left&&a.left+a.width<b.width?a.left+=Fa(-a.left,b.width-(a.left+a.width)):a.left+a.width>b.width&&0<a.left&&(a.left-=Fa(a.left+a.width-b.width,a.left));0>a.top&&a.top+a.height<b.height?a.top+=Fa(-a.top,b.height-
(a.top+a.height)):a.top+a.height>b.height&&0<a.top&&(a.top-=Fa(a.top+a.height-b.height,a.top))})})(f,b);for(var g=0;50>g&&c(f,!0,b);g++);for(g=0;50>g&&c(f,!1,b);g++);return f}function If(a){ii.root.getDirectory("netflix.player.namedatapair",ji,function(b){a({c:!0,Do:b})},function(){a({g:P.dn})})}function Kg(a,b,c){function d(){c({g:P.$m})}a.getFile(b,ki,function(a){a.file(function(b){var y=new li;y.onloadend=function(){c({c:!0,text:y.result,wg:a})};y.onerror=d;y.readAsText(b)},d)},d)}function Hd(a,
b,c,d,f){function g(){f&&f({g:P.cn})}function h(a){a.createWriter(function(b){try{b.onwriteend=function(){b.onwriteend=null;b.onerror=null;b.truncate(b.position);f&&f({c:!0,wg:a})},b.onerror=g,b.write(new ek([c]))}catch(y){g()}},g)}b.createWriter?h(b):a.getFile(b,d?fk:ji,h,g)}function Jf(a,b,c){function d(){c&&c({g:P.bn})}function f(a){a.remove(function(){c&&c(xa)},d)}b.remove?f(b):a.getFile(b,ki,f,d)}function Jg(a){var b={};a({c:!0,Hh:{load:function(a,c){b.hasOwnProperty(a)?c({c:!0,data:b[a],Td:a}):
c({g:P.uc})},save:function(a,c,y,d){y&&b.hasOwnProperty(a)?d({c:!1}):(b[a]=c,d&&d({c:!0,Td:a}))},remove:function(a,c){delete b[a];c&&c(xa)}}})}function Lg(a){function b(){b=q;a({c:!0,Hh:{load:function(a,b){c(a,function(c){Kg(d,a,function(a){ta(c.hf);if(a.c){var y=a.text,d;try{y&&(d=ob.parse(y))}catch(f){b({g:P.en});return}d?b({c:!0,data:d,Td:a.wg}):b({g:P.uc})}else b(a)})})},save:function(a,b,y,f){var g=a.name||a,h=ob.stringify(b);c(g,function(b){Hd(d,a,h,y,function(a){ta(b.hf);a.c?f&&f({c:!0,Td:a.wg}):
f&&f(a)})})},remove:function(a,b){c(a.name||a,function(c){Jf(d,a,function(a){ta(c.hf);b&&b(a)})})}}})}function c(a,b){(f[a]||(f[a]=new Fe)).sn(!0,b)}var d,f={};If(function(c){c.c?(d=c.Do,b()):a(c)})}function Ke(a){function b(d,f){b=q;h&&h.wb();if(d){var g={g:d};f&&(g.C=f);a(g)}else a({c:!0,Hh:{load:function(a,b){c("get",!1,a,function(c){var y;try{var d=c.target.result;y=d?{c:!0,data:d.data,Td:a}:{g:P.uc}}catch(f){y={g:P.vi,C:N(f)}}b(y)},function(a){b({g:P.vi,C:a})},function(){b({g:P.wi})})},save:function(a,
b,y,d){c(y?"add":"put",!0,{name:a,data:b},function(){d&&d({c:!0,Td:a})},function(a){d&&d({g:P.hn,C:a})},function(){d&&d({g:P.zi})})},remove:function(a,b){c("delete",!0,a,function(){b&&b(xa)},function(a){b&&b({g:P.ti,C:a})},function(){b&&b({g:P.Lf})})}}})}function c(a,b,y,f,t,h){function k(){ba&&ba.wb();O&&(O.onsuccess=null,O.onerror=null)}try{var O=g.transaction("namedatapairs",b?"readwrite":"readonly").objectStore("namedatapairs")[a](y);O.onsuccess=function(a){k();f(a)};O.onerror=function(){k();
t(d(O))};var ba=new Jc(v.Ok,function(){k();h()});ba.jc()}catch(l){k(),t(N(l))}}function d(a){a=a&&a.error;return"onerror: "+(a&&(a.name||""+a))}var f=new wa.r("Storage"),g;if(ah){var h=new Jc(v.Ok,function(){b(P.ai)});h.jc();fc("idbo");var k=ah.open("netflix.player",1);k?(k.onblocked=function(){b(P.sl)},k.onupgradeneeded=function(){fc("idbun");g=k.result;g.createObjectStore("namedatapairs",{keyPath:"name"})},k.onsuccess=function(){fc("idbs");g=k.result;b()},k.onerror=function(){fc("idbe");var a=d(k);
f.error("IndexedDB open error",a);b(P.tl,a)}):b(P.$h)}else bh?b(P.rl,N(bh)):b(P.Zh)}function ie(a){function d(a,b){c(a,function(a,c){g(c)?b[a]=c.call(h,b[a]):ra(c)&&(b[a]=b[a]||{},d(c,b[a]))})}function t(a,b){var c=Wg.call(arguments,1);return function(b){ia(b)&&(c[1]=b);return a.apply(h,c)}}function k(a){a=a.toLowerCase();Ga.hasOwnProperty(a)&&(ga[a]=Ga[a]);return a}function ba(a,b,c){a=a.toLowerCase();if(ga.hasOwnProperty(a)){var y=ga[a];try{y=c?c(y):y}catch(d){y=h}if(y!==h)return y;wa.error("Invalid configuration value. Name: "+
a)}return b}function l(a,b,c,y){return ba(a,b,function(a){Ja(a)&&(a=B(a));if(f(a,c,y))return a})}function G(a,b,c,y){return ba(a,b,function(a){Ja(a)&&(a=B(a));if(f(a,c||0,y))return a})}function Ya(a,c,y,d){return ba(a,c,function(a){Ja(a)&&(a=rc(a));if(b(a,y,d))return a})}function m(a,b,c){return ba(a,b,function(a){if(c?c.test(a):Ja(a))return a})}function p(a,b){return ba(a,b,function(a){if("true"==a||!0===a)return!0;if("false"==a||!1===a)return!1})}function q(a,b,c,y){a=a.split("|");for(var d=a.length;d--;)if(a[d]=
B(a[d]),!f(a[d],b||0,c))return;if(y===h||a.length>=y)return a}function W(a,b,c,y,d){return ba(a,b,function(a){return q(a,c,y,d)})}function $a(a,b,c,y,d,f){return ba(a,b,function(a){a=a.split(";");for(var b=a.length;b--;)if(a[b]=q(a[b],c,y),a[b]===h||a[b].length!=d)return;if(f===h||a.length>=f)return a})}function Na(a,b){a=a.toLowerCase();if(ga.hasOwnProperty(a)){for(var c=ga[a],c=jd.isArray(c)?c:c.split("|"),y=c.length;y--;)if(Ja(c[y]))c[y]=ob.parse(Xg(c[y]));else return wa.error("Invalid configuration value."),
b;return c}return b}function I(a,b,c,y){return ba(a,b,function(a){a=jd.isArray(a)?a:a.split("|");for(var b=a.length;b--;)if(c?!c.test(a[b]):!Wa(a[b]))return;if(y===h||a.length>=y)return a})}function H(a,b,c){return ba(a,b,function(a){var y={};n(y,b);if(Ja(a)){a=a.split(";");for(var d=a.length;d--;){var f=a[d],g=f.indexOf(":");if(0>=g)return;var t=f.substring(0,g);if(f=f.substring(g+1)){if(c&&!c.test(f))return;y[t]=f}else delete y[t]}}else n(y,a);return y})}function sa(a){var b=[];c(a,function(a,c){var y;
try{y=ob.stringify(c)}catch(d){y="cantparse"}b.push(a+"="+y)});return b.join("\n")}var J=/^[0-9-+]+$/,Z=/^(2\.14)|(2\.15)|(2\.16)|(3\.0)$/,X=/^[0-9]+[%]?$/,ka=/^[0-9]*$/,ga,Ga,Oa,vb=!0,mi=!1,La=!0,r=!1,na=!0;(function(){function b(a){a.split(",").forEach(function(a){var b=a.indexOf("=");0<b&&(ga[a.substring(0,b).toLowerCase()]=a.substring(b+1))})}ga={};n(ga,ni);a&&a.length&&gk.call(a,function(a){Ja(a)?b(a):ra(a)&&n(ga,a,{ah:!0})});Ga=n({},Jd(),{ah:!0});var c=Rc().cadmiumconfig;c&&(wa.info("Config cookie loaded",
c),b(c));hk&&n(ga,Ga)})();Oa=/^test/i.test(m(k("environment")))||/^test|int$/i.test(m(k("env")));v={};var u={ov:function(a){return vb=p(k("enableDDPlus"),kb(a,!0))},sv:function(a){return La=p(k("enableLSSDH"),kb(a,!0))},qv:function(a){return mi=p(k("enableHEVC"),kb(a,!1))},rv:function(a){return na=p(k("enableImageSubs"),kb(a,!0))},Vf:function(a){return I("audioProfiles",kb(a,oi)).filter(function(a){return"ddplus-5.1-dash"===a?ik&&vb:!0})},gv:function(a){return r=p("disableHD",kb(a,!1))},Rh:function(a){a=
I("videoProfiles",kb(a,ch)).filter(function(a){return"playready-h264mpl31-dash"===a?!r:"playready-h264mpl40-dash"===a?!r&&jk:/^hevc-/.test(a)?mi:!0});return pi(a)},pt:t(m,k("videoCodecs"),Hg()),ad:function(a){return I("timedTextProfiles",kb(a,qi)).filter(function(a){return"dfxp-ls-sdh"===a?La:"nflx-cmisc"===a?na:!0})},Mj:t(G,k("imageSubsResolution"),0),Oe:t(I,k("keySystemIdList"),ri,h,1),Vn:t(m,k("canHDCP"),kk||"constrict",/^(constrict|ifpresent|never)$/),el:t(m,"widevineRASC","CAUSwwUKvQIIAxIQ5US6QAvBDzfTtjb4tU/7QxiH8c+TBSKOAjCCAQoCggEBAObzvlu2hZRsapAPx4Aa4GUZj4/GjxgXUtBH4THSkM40x63wQeyVxlEEo1D/T1FkVM/S+tiKbJiIGaT0Yb5LTAHcJEhODB40TXlwPfcxBjJLfOkF3jP6wIlqbb6OPVkDi6KMTZ3EYL6BEFGfD1ag/LDsPxG6EZIn3k4S3ODcej6YSzG4TnGD0szj5m6uj/2azPZsWAlSNBRUejmP6Tiota7g5u6AWZz0MsgCiEvnxRHmTRee+LO6U4dswzF3Odr2XBPD/hIAtp0RX8JlcGazBS0GABMMo2qNfCiSiGdyl2xZJq4fq99LoVfCLNChkn1N2NIYLrStQHa35pgObvhwi7ECAwEAAToQdGVzdC5uZXRmbGl4LmNvbRKAA4TTLzJbDZaKfozb9vDv5qpW5A/DNL9gbnJJi/AIZB3QOW2veGmKT3xaKNQ4NSvo/EyfVlhc4ujd4QPrFgYztGLNrxeyRF0J8XzGOPsvv9Mc9uLHKfiZQuy21KZYWF7HNedJ4qpAe6gqZ6uq7Se7f2JbelzENX8rsTpppKvkgPRIKLspFwv0EJQLPWD1zjew2PjoGEwJYlKbSbHVcUNygplaGmPkUCBThDh7p/5Lx5ff2d/oPpIlFvhqntmfOfumt4i+ZL3fFaObvkjpQFVAajqmfipY0KAtiUYYJAJSbm2DnrqP7+DmO9hmRMm9uJkXC2MxbmeNtJHAHdbgKsqjLHDiqwk1JplFMoC9KNMp2pUNdX9TkcrtJoEDqIn3zX9p+itdt3a9mVFc7/ZL4xpraYdQvOwP5LmXj9galK3s+eQJ7bkX6cCi+2X+iBmCMx4R0XJ3/1gxiM5LiStibCnfInub1nNgJDojxFA3jH/IuUcblEf/5Y0s1SzokBnR8V0KbA=="),
lw:function(){return-1},mq:t(l,k("logDisplayMaxEntryCount"),1E3,-1),pq:t(l,k("logToConsoleLevel"),-1),xe:function(){return Oa},Sr:t(p,"requireNetflixId",!1),Tr:t(p,"requireSecureNetflixId",!1),ft:t(p,"upgradeNetflixId",!0),Qq:t(m,"netflixIdEsnPrefix"),Wo:t(p,"enforceSinglePlayback",!0),Xo:t(p,"enforceSingleSession",!1),bg:t(p,"closeOtherPlaybacks",!0),pa:t(p,k("useASE"),!1),Cn:t(G,"asyncLoadTimeout",15E3,1),rq:t(G,"mainThreadMonitorPollRate",0),Fe:t(m,"groupName",""),bl:t(G,k("verbosePlaybackInfoDenominator"),
100),zn:t(p,k("allowPleaseCallMessage"),!1),Qr:t(p,"renderTimedText",!0),Vk:t(H,"timedTextStyleDefaults",{}),Wk:t(H,"timedTextStyleOverrides",{}),Ts:t(H,"timedTextFontFamilyMapping",si||{"default":"font-family:Arial,Helvetica;font-weight:bolder"}),Us:t(G,k("timedTextTimeOverride"),0),Uk:t(G,"timedTextSimpleFallbackThreshold",lk),gg:t(m,k("customDfxpUrl")),Yn:t(I,"cdnIdWhiteList",[]),Xn:t(I,"cdnIdBlackList",[]),Ag:t(m,k("forceAudioTrack")),Mq:t(p,"muteVolumeOnPlaybackClose",!0),ze:t(m,k("forceTimedTextTrack")),
Ls:t(G,"storageMinimumSize",0,0),Pk:t(m,"storageType","idb",/^(none|fs|idb)$/),Ok:t(G,"storageTimeout",8E3,1),kq:t(G,"lockExpiration",1E4),lq:t(G,"lockRefresh",3E3),Hq:t(G,"minBufferingTimeInMilliseconds",4E3),yr:t(G,"progressBackwardsGraceTimeMilliseconds",4E3),zr:t(G,"progressBackwardsMinPercent",10),Nn:t(m,k("bookmarkIgnoreBeginning"),"30000",X),On:t(m,k("bookmarkIgnoreEnd"),"5%",X),dg:t(m,"connectionStrategy","parallel",/^(parallel|single)$/),Ji:t(m,k("bandwidthMeterType"),"sliding_window",/^(historical|sliding_window)$/),
Zj:t(G,"maxParallelConnections",3),ir:t(m,"parallelDownloadManagerType","chunk",/^(subchunk|chunk)$/),uq:t(G,"maxChunksInProgressForSubchunking",3),Ns:t(G,"subchunkLength",dh(2,17)),jr:t(Ya,"parallelSafeBufferThreshhold",40/240),qn:t(Ya,"abortDownloadBufferThreshhold",40/240),Gh:t(G,"slidingWindowWidthMilliseconds",3E4),nr:t(p,"pingOnConnectTimeout",!0),mr:t(G,"pingCDNTimeoutMilliseconds",8E3),Gd:t(G,"maxBufferSizeMilliseconds",232E3,1E4,145152E5),Hb:t(G,"maxBufferSizeBytes",0),Fi:t(G,"backBufferSizeMilliseconds",
1E4,0,145152E5),Ln:t(G,"backToFrontBufferRatioPercent",25,0,1E3),Uf:t(G,"audioChunkSizeMilliseconds",16E3),ot:t(G,"videoChunkSizeMilliseconds",4004),Jo:t(p,"droppedFrameRateFilterEnabled",!1),Ko:t(G,"droppedFrameRateFilterMaxObservation",60,10,1E3),Mo:t($a,"droppedFrameRateFilterPolicy",[[4,15],[8,9],[12,2],[20,1]],h,h,2,0),No:t(p,"droppedFrameRateFilterWithoutRebufferEnabled",!1),ve:t(G,"droppedFrameRateFilterBasedOnPreviousSession"),fj:t(W,"droppedFrameRateFilterBasedOnPreviousSessionPolicy"),Lo:t(G,
"droppedFrameRateFilterMinHeight",384),Qo:t(G,"droppedFramesStorageSessionLimit",10),Po:t(G,"droppedFramesStorageInterval",6E4),Oo:t(W,"droppedFramesPercentilesList",[]),Ao:t(G,k("defaultVolume"),100,0,100),$i:t(p,"disableVideoRightClickMenu",!0),Va:t(G,"minDecoderBufferMilliseconds",1E3,0,145152E5),fr:t(G,"optimalDecoderBufferMilliseconds",5E3,0,145152E5),wq:t(G,"maxDecoderBufferMilliseconds",7E3,0,145152E5),Wi:t(G,"decoderTimeoutMilliseconds",1E4,1),aj:t(p,"disgardMediaOnAppend",!1),Bn:t(p,"appendMediaBeforeInit",
!1),lr:t(G,"pauseTimeoutLimitMilliseconds",18E5),Nj:t(G,"inactivityMonitorInterval",3E4,0),rn:t(W,"abrdelLogPointsSeconds",[15,30,60,120],0,h,4),Ep:t(m,k("heuristicsAlgorithm"),""),dp:t($a,k("fixedVideoBitrates"),[],h,h,2,0),Qj:t(I,k("initialVideoBitrates"),["0+","400+","900+"],J,1),Qp:t(I,k("initialVideoBitratesForCarreraFallback"),["0+","400+","900+"],J,1),Pp:t(I,k("initialAudioBitrates"),["0+","90+","150+"],J,1),Dn:t(G,"audioBandwidthDenominator",15,1),Mk:t(G,"simulationLimitMilliseconds",12E5,
1E4),Fp:t(G,"highStreamSimulationMilliseconds",12E4,1),sr:t($a,"prebufferBitrate",[[500,235],[1E3,560],[5E3,1050],[1E4,1050],[3E4,3E3]],h,h,2,1),Rk:t($a,"switchUpToBitrate",[[235,560],[375,750],[560,1050],[750,1400],[1050,1750],[1750,3E3],[2350,1E5]],h,h,2,1),mh:t(G,"prebufferMinAudioMilliseconds",6E3),nh:t(G,"prebufferMinVideoMilliseconds",6E3),tr:t(G,"prebufferMaxMilliseconds",3E4),Kr:t(G,"rebufferMaxMilliseconds",232E3),Uo:t(p,"enableTrickPlay",!1),fe:t(W,"additionalDownloadSimulationParams",[2E3,
2E3,100],0,h,3),ct:t(G,"trickPlayHighResolutionBitrateThreshold",1E3),dt:t(G,"trickPlayHighResolutionThresholdMilliseconds",1E4),et:t(Ya,"trickplayBufferFactor",.5),$s:t(G,"trickPlayDownloadRetryCount",1),qk:t(W,"prebufferSimulationParams",[2E3,2E3,60],0,h,3),Ki:t($a,"bufferingSimulationParams",[[6E4,1E3,1E3,100],[12E4,1E3,1E3,20],[18E4,0,0,0]],h,h,4,1),Xf:t($a,"bufferingSwitchUpSimulationParams",[[6E4,3E3,3E3,140],[12E4,3E3,3E3,60],[18E4,0,0,0]],h,h,4,1),cj:t(G,"doNotSwitchDownIfBufferIsAboveMilliseconds",
18E4),So:t(p,"enableHistorical",!0),Tg:t(G,"histAggregationTimeSpanInSeconds",300),Gp:t(G,"histCompareBitsIPv4",24),Hp:t(G,"histCompareBitsIPv6",32),Gj:t(m,"histFilterType","none",/^(none|timeofDay|dayOfWeekAndTimeOfDay)$/),Jj:t(G,"histSizeLimit",1E3),Ij:t(G,"histMinSampleSize",1),Hj:t(G,"histMaxSampleSize",1E3),Kj:t(G,"histTimeOfDayRangeInSeconds",3600),Wn:t(H,"carreraParameters",{1750:7,1050:5,750:4.5,560:4.5,375:4.5}),Ni:t(l,"carreraMediaSecondsToDownload",8E3),Li:t(l,"carreraChunksToAverage",
10),Nu:t(Ya,"carreraConfidenceThreshold",.7),Mi:t(l,"carreraHistoricalPercentileToUse",50),Wg:t(m,"initialBitrateSelectionAlgorithm","default",/^(default|carrera)$/),Pn:{Aq:t(G,"maxReservoirSizeMilliseconds",12E4),zq:t(G,"maxOutageProtectionMilliseconds",6E4),vq:t(G,"maxCushionSizeInBufferPercentage",90),Ur:t(G,"reservoirLookAheadChunks",60),Gs:t(G,"startupPhaseInChunks",30),Hs:t(p,"startupQualityOptimization",!0),Ro:t(p,"dynamicReservoir",!0),Zp:t(p,"isUsingStrictMaxChunkSize",!0),Zs:t(p,"transitFromInitialPhase",
!0),Is:t(p,"startupSafeRateCalculationEnabled",!0),Js:t(p,"startupThresholdFunctionOfBufferEnabled",!0),Es:t(p,"startupLookAheadCalculationEnabled",!1),Fs:t(G,"startupLookAheadChunks",120),Vp:t(p,"isReservoirManualSet",!1),tq:t(G,"manualReservoirMilliseconds",9E4),Rp:t(p,"isCushionManualSet",!1),sq:t(G,"manualCushionMilliseconds",126E3),Up:t(p,"isLookingAhead",!1),Yp:t(p,"isUsingRateMap",!1)},eb:t(W,"failedDownloadRetryWaits",[10,200,500,1E3,2E3,4E3,8E3,16E3]),xv:t(W,"failedDownloadRetryWaitsASE",
[10,200,500,1E3,2E3,4E3]),ht:t(p,"useCDNExponentialBackoff",!0),Dk:t(G,"selectCdnDownloadRetryCountBeforeCdnSwitch",2),ps:t(G,"selectCdnTimeoutMilliseconds",1E3),os:t(G,"selectCdnSignificantLatency",300),mf:t(G,"selectCdnBandwidthThresholdKbps",2E3),Ek:t(m,"selectCdnType","bandwidth",/^(latency|bandwidth)$/),ie:t(G,"bandwidthTestBytesPerCdn",204800),mt:t(p,"useVariableConnectTimeout",!1),Iq:t(G,"minConnectTimeoutMilliseconds",4E3),Pb:t(G,"connectTimeoutMilliseconds",8E3,500),mo:t(G,"connectTimeoutBufferDiscount",
2),no:t(G,"connectTimeoutoutUpperLimitMultiplier",1E4),Kd:t(G,"noProgressTimeoutMilliseconds",8E3,500),kt:t(p,"useOnLineApi",!1),Dp:t(G,"headerDownloadRetryCountBeforeCdnSwitch",1),Tk:t(G,"timedTextDownloadRetryCountBeforeCdnSwitch",1),Oj:t(G,"initialHeaderDownloadTimeout",2E3),Fj:t(G,"headerDownloadTimeout",3E3),fp:t(p,"forcePresentingStateToPlaying",!1),ms:t(G,"seekBackOnAudioTrackChangeMilliseconds",8E3),Qk:t(I,k("supportedAudioTrackTypes"),[],h,1),Ps:t(I,k("supportedAudioBitrates"),[],J),Qs:t(I,
k("supportedVideoBitrates"),[],J),Pj:t(G,"initialLogFlushTimeout",5E3),Wc:t(m,"playdataPersistKey",Oa?"unsentplaydatatest":"unsentplaydata"),nf:t(p,"sendPersistedPlaydata",!0),kh:t(G,"playdataPersistIntervalMilliseconds",4E3),qr:t(p,"playdataPrepareRequest",!1),Rg:t(G,"heartbeatCooldown",1E4,1E3),oq:t(I,"logPerformanceTiming","navigationStart redirectStart fetchStart secureConnectionStart requestStart domLoading".split(" ")),Fq:t(p,"midplayEnabled",!0),ak:t(G,"midplayIntervalMilliseconds",3E5),Gq:t(W,
"midplayKeyPoints",[15E3,3E4,6E4,12E4]),bj:t(G,k("dlprestartCount"),0),og:t(G,"downloadReportDenominator",0),Ho:t(G,"downloadReportInterval",3E5),re:t(I,"downloadReportTcpInfo",[]),jv:t(G,"downloadReportTraceInterval",1E3),Mn:t(H,k("bookmarkByMovieId"),{}),Wb:t(p,k("limitedDurationLicense"),!1),Qe:t(G,k("licenseRenewalRequestDelay"),0),Wj:t(p,k("limitedDurationFlagOverride"),h),Sd:t(p,k("secureStopEnabled"),!1),Bk:t(p,k("secureStopFromPersistedKeySession"),!1),gs:t(G,"secureStopKeyMessageTimeoutMilliseconds",
2E3,1),fs:t(G,"secureStopKeyAddedTimeoutMilliseconds",1E3,1),ks:t(G,k("secureStopPersistedKeyMessageTimeoutMilliseconds"),2500,1),ls:t(G,k("secureStopPersistedKeySessionRetries"),17,1),js:t(G,"secureStopPersistedKeyAddedTimeoutUnmatchedSession",1E3,1),ds:t(p,k("secureStopDisplayLogWindowOnError"),!1),es:t(p,k("secureStopIgnoreVideoError"),!1),jt:t(p,k("useCdmId"),!1),Op:t(I,"initSegmentBoxTypeList",["ftyp","moov"]),Jp:t(I,"ignorePsshList",mk||[]),ut:t(p,"workaroundSaio",!0),vt:t(p,"workaroundTenc",
!0),fl:t(p,k("workaroundAudioKeyFrame"),!1),Tn:t(p,k("callEndOfStream"),ti),jo:t(p,k("clipLongVideo"),ui),xs:t(p,k("setVideoElementSize"),nk),fo:t(p,k("clearVideoSrc"),!0),Yi:t(G,k("delayPlayPause"),0),Kn:t(p,k("avoidSBRemove"),!1),vr:t(p,k("preferOldEme"),!0),Br:t(p,k("promiseBasedEme"),!1),Zq:t(p,k("nudgeSourceBuffer"),!1),Ck:t(l,k("seekDelta"),1),ur:t(p,k("preciseSeeking"),!1),Xi:t(H,k("delayErrorHandling")),Ws:t(p,"trackingLogEnabled",!0),Ys:t(m,"trackingLogUrl",Oa?"https://customerevents.test.netflix.com/track/debug":
"https://customerevents.netflix.com/track/debug",Vg),Xs:t(W,"trackingLogStallKeyPoints",[1E4,3E4,6E4,12E4]),tg:t(m,"esnUrl"),lj:t(G,"esnUrlTimeout",6E3),hj:t(p,k("enableEmeVerboseLogging"),!1),Nq:t(m,"nccpAppId","",ka),Oq:t(m,"nccpSessionId","",ka),$n:t(m,"cdnProxyUrl"),Ib:{Fv:t(p,"nccpForceRegister",!1),Ev:t(p,"nccpForceAuthenticationRenewal",!1),ye:t(m,k("nccpForceDebugLogLevel"),h,/^(ERROR|WARN|INFO|TRACE)$/),oh:t(m,"nccpProtocolVersion","3.1",Z),Cr:t(H,"protocolVersionOverrides",{mdxregister:"2.16"},
Z),xj:function(){return function(a){return this.Cr()[a]||this.oh()}.bind(u.Ib)},hc:t(m,"nccpControllerUrl",Oa?"https://cbp.nccp.test.netflix.com/nccp/controller":"https://cbp.nccp.netflix.com/nccp/controller",Vg),Dr:t(m,"nccpProxyPath",""),As:function(){return"2.0000.340.011"},Zk:t(m,"nccpUIVersion"),ao:function(){return"1"},tk:t(I,"preferredLanguages",Og,/^[a-zA-Z-]{2,5}$/,1),Wr:t(p,"nccpRetryOnNetworkFailures",!0),An:t(p,"nccpAlwaysIncludeIdsInPlaydata",!0)},Wf:t(m,"authenticationType","JWK_RSA"),
En:t(H,"authenticationKeyNames",n({e:"DKE",h:"DKH",w:"DKW",s:"DKS"},ok)),Rs:t(m,"systemKeyWrapFormat",pk),Kq:t(p,"mslDeleteStore",!1),Lq:t(p,"mslPersistStore",!0),Dy:t(W,"streamingFailureRetryWaits",[4E3,8E3]),Qw:t(G,"minInitVideoBitrate",560),zw:t(G,"maxInitVideoBitrate",1050),Nw:t(G,"minAcceptableVideoBitrate",235),pv:t(p,"enableGoodQualityBuffering",!1),Tw:t(G,"minRequiredBuffer",3E4),Sw:t(G,"minPrebufSize",6E3),ww:t(G,"maxBufferingTime",2E3),Wv:t(Na,"initialBitrateSelectionCurve",null),Ly:t(G,
"throughputPercentForAudio",15),Iu:t(G,"bandwidthMargin",10),Ju:t(Na,"bandwidthMarginCurve",[{m:38,b:8E3},{m:50,b:6E4},{m:17,b:12E4},{m:0,b:24E4}]),Tv:t(G,"highWatermarkLevel",3E4),Oy:t(G,"toStableThreshold",3E4),Py:t(G,"toUnstableThreshold",15E3),Cy:t(p,"skipBitrateInUpswitch",!0),Vy:t(G,"watermarkLevelForSkipStart",8E3),Rv:t(G,"highStreamRetentionWindow",9E4),Sv:t(G,"highStreamTransitionWindow",3E5),rw:t(G,"lowestBufForUpswitch",9E3),kw:t(G,"lockPeriodAfterDownswitch",15E3),qw:t(G,"lowWatermarkLevel",
15E3),Gw:t(G,"maxSimuLength",6E5),sw:t(G,"lowestWaterMarkLevel",6E3),Mw:t(Ya,"mediaRate",1.5),zv:t(Ya,"fastUpswitchFactor",3),Aw:t(G,"maxMediaBufferAllowed",24E4),nw:t(G,"lowGradeModeEnterThreshold",12E4),ow:t(G,"lowGradeModeExitThreshold",9E4),yw:t(G,"maxDomainFailureWaitDuration",3E4),vw:t(G,"maxAttemptsOnFailure",18),vv:t(p,"exhaustAllLocationsForFailure",!0),Bw:t(G,"maxNetworkErrorsDuringBuffering",20),xw:t(G,"maxBufferingTimeAllowedWithNetworkError",6E4),yv:t(G,"fastDomainSelectionBwThreshold",
2E3),My:t(G,"throughputProbingEnterThreshold",4E4),Ny:t(G,"throughputProbingExitThreshold",34E3),iw:t(G,"locationProbingTimeout",1E4),Cv:t(G,"finalLocationSelectionBwThreshold",1E4),Jy:t(Ya,"throughputHighConfidenceLevel",.75),Ky:t(Ya,"throughputLowConfidenceLevel",.4),Cw:t(G,"maxPartialBuffersAtBufferingStart",2),Rw:t(G,"minPendingBufferLen",6E3),Dw:t(G,"maxPendingBufferLen",12E3),Hw:t(G,"maxStreamingSkew",4E3),Ew:t(G,"maxPendingBufferPercentage",10),Fw:t(G,"maxRequestsInBuffer",60),Qv:t(G,"headerRequestSize",
4096),Ow:t(G,"minBufferLenForHeaderDownloading",1E4),fy:t(G,"reserveForSkipbackBufferMs",1E4),Ux:t(p,"pipelineEnabled",!1),Ry:t(G,"updatePtsIntervalMs",1E3),Mu:t(G,"bufferLevelNotifyIntervalMs",2E3),av:t(G,"defaultHeaderCacheSize",4),$u:t(G,"defaultHeaderCacheDataCount",3),mv:t(p,"enableAbandonTesting",!1),yu:t(G,"abandonRequestFrequency",4),Ey:t(G,"streamingStatusIntervalMs",2E3),Vx:t(G,"prebufferTimeLimit",24E4),Pw:t(G,"minBufferLevelForTrackSwitch",2E3),Rx:t(G,"penaltyFactorForLongConnectTime",
2),mw:t(G,"longConnectTimeThreshold",200),Au:t(G,"additionalBufferingLongConnectTime",2E3),Bu:t(G,"additionalBufferingPerFailure",8E3),Zw:t(G,"networkFailureResetWaitMs",2E3),Yw:t(G,"networkFailureAbandonMs",6E4),Iw:t(G,"maxThrottledNetworkFailures",3),Iy:t(G,"throttledNetworkFailureThresholdMs",200),nv:t(p,"enableAbortBlock",!1),pw:t(G,"lowThroughputThreshold",400),Vw:t(p,"mp4ParsingInNative",!0),Xx:t(p,"pruneRequestsFromNative",!0)},ha=!0;gg=function(a){a&&(ga=n({},a,{ah:!0}),d(u,v),wa.trace("Config applied for",
sa(ha?ga:a)),ha=!1)};gg(ga)}function Kf(a,b){return Ja(a)&&"%"==a[a.length-1]?jb(rc(a)*b/100):a}function je(){return 3<=B(v.Ib.oh)}function Cf(a,b,c,d){n(this,{jj:b,lc:a,cs:qk||"cadmium",kv:c,kj:d})}function Lf(){for(var a="",b=ya(kd/1E3),c=6;c--;)a="0123456789ACDEFGHJKLMNPQRTUVWXYZ"[b%32]+a,b=ya(b/32);for(;30>a.length;)a+="0123456789ACDEFGHJKLMNPQRTUVWXYZ"[xb(0,31)];return a}function Df(){try{var a=v.xe?"NetflixIdTest":"NetflixId",b=Rc()[a],c=Qa(b);return"dbl"==c||"dev"==c}catch(d){}}function Mf(a){ld.N({url:v.tg,
Pb:v.lj,Kd:v.lj,type:eh,withCredentials:!0,Xb:function(a){a=ob.parse(a).data.esn;if(!vi.test(a))throw new Za("bad esn");var b=a.match(vi)[2];if(!Wa(b))throw new Za("bad deviceId");hg=a;return b}},a)}function hc(a){a=new Yc(zc(a));a.Z();return{bq:a.vk(),Vo:a.vk()}}function Md(a,b){var c=a.url.split("?"),d=c[0],f;f=a.offset;(f=f!==h?a.length!==h?f+"-"+(a.offset+a.length-1):f+"-":void 0)&&(b.Kb=f,d="/"==d[d.length-1]?d+"range/":d+"/range/",d+=f);f=a.zc?"random="+(1E17*kf()).toFixed(0):"";d=c[1]?d+("?"+
c[1]+(f?"&"+f:"")):d+(f?"?"+f:"");!a.i||d&&0==d.toLowerCase().indexOf("https")||(c=v&&v.$n)&&(d=c.replace("{URL}",d).replace("{EURL}",Ud(d)));b.url=d}function Nf(){return!1!==Yb.onLine}function vd(a,b,d,f){var g=f.lh,k=f.headers;a.open(g?"POST":"GET",b,!d);switch(f.responseType){case Ac:a.responseType="arraybuffer";break;case wi:Bb(a,"overrideMimeType",h,"text/xml")}g&&(b={"Content-Type":Ja(g)?"text/plain":"application/x-octet-stream"},k=k?n(b,k):b);k&&c(k,function(b,c){a.setRequestHeader(b,c)});
f.withCredentials&&(a.withCredentials=!0);a.msCaching!==h&&(a.msCaching="disabled");g?a.send(g):a.send()}function Me(a,b){switch(b.type){case Ac:return a.response||new ArrayBuffer(0);case wi:return a.responseXML;default:return a.responseText}}function pc(a){function b(a){b=q;f.onload=null;f.onabort=null;f.onerror=null;var c=f.status;!a&&200<=c&&299>=c?(g.content=Me(f,g),g.c=!0):(g.g=a?P.Za:P.bd,g.Ca=g.P=c,g.c=!1)}var c=/^[a-z]*:\/\/.*/i,d=a.url,f=new xi,g={L:a,type:a.responseType};Kd(Ja(d)&&!c.test(d));
f.onload=function(){b()};f.onerror=function(){b()};f.onabort=function(){b(!0)};vd(f,d,!0,a);return g}function Of(a){function b(c){a.fireEvent(ue,c)}return{N:function(c,d){c.Ha=a;var f=ld.N(c,d);a.fireEvent(nf,f);f.Di(b);return f}}}function Ne(a){return{N:function(b,c){b.Ha=a;var d;a.i.value&&v.nr&&(d={or:new Pf(a.ua),xq:v.Zj,kk:0,i:a.i.value});d=ld.N(b,c,d);a.fireEvent(nf,d);d.Di(function(b){a.fireEvent(ue,b)});return d}}}function Pf(a){function b(a,c,y){if(c.Qa[a.id])return{responseType:Ac,url:c.Qa[a.id],
Xb:jf,offset:c.j.t[y?y.index:0].offset,length:8,i:a,track:c.track,stream:c,Cb:y.type+"-"+y.index+"-ping",zc:!0}}this.ua=a;this.ping=function(a){function c(a){mb(k);y(a)}function y(b){(b=b&&b.c)&&a.Os();!b&&a.nj()}var d=this.ua,f=a.stream,g=a.G,h;if(a.kk>a.xq)a.nj();else if(g&&!g.media){(f=b(a.i,f,g))&&(h=d.N(f,c));var k=Xa(function(){y();h&&h.abort()},v.mr)}}}function Tb(a,b){for(var c=1;(b=arguments[c++])&&(a=a[b]););return a}function Da(a,b){var c;a?c=B(a[Ib]):b!==h&&(c=b);return c}function ua(a,
b){var c;a?c=a[Ib]:b!==h&&(c=b);return c}function Mg(a){if(Wa(a)){var b=(new rk).parseFromString(a,"text/xml"),c=b.getElementsByTagName("parsererror");if(c&&c[0]){try{wa.error("parser error details",{errornode:(new sk).serializeToString(c[0]),xmlData:a.slice(0,300),fileSize:a.length})}catch(d){}throw new Za("xml parser error");}return b}throw new Za("bad xml text");}function De(a){var b,c,d={};d[ig]=a.localName;var f={};d[Zb]=f;var g=[];d[fh]=g;var h=a.attributes;b=h.length;for(c=0;c<b;c++){var k=
h[c];f[k.localName]=k.value}a=a.childNodes;b=a.length;f={};for(c=0;c<b;c++)switch(h=a[c],h.nodeType){case tk:h=De(h);k=h[ig];h[uk]=d;g.push(h);d[k]?f[k][Nb]=h:d[k]=h;f[k]=h;break;case vk:case wk:h=h.text||h.nodeValue,g.push(h),d[Ib]||(d[Ib]=h)}return d}function wd(a,b){var c,d;try{c=Mg(a)}catch(f){wa.error("xml2xmlDoc exception",f)}ta(function(){if(c&&c.documentElement)try{d=De(c.nodeType==xk?c.documentElement:c)}catch(a){wa.error("xmlDoc2js exception",a)}ta(function(){d?b({c:!0,object:d}):b({c:!1,
g:P.pl})})})}function Gd(a,b,d,f){Kd(ra(a)&&!jd.isArray(a));f=f||"";var g="",h=a.hasOwnProperty(Zb)&&a[Zb];h&&c(h,function(a,b){g&&(g+=" ");g+=a+'="'+Le(b)+'"'});d=(b?b+":":"")+d;var h=f+"<"+d+(g?" "+g:""),k=a.hasOwnProperty(Ib)&&a[Ib];if(k)return h+">"+Le(k)+"</"+d+">";a=Qf(a,b,f+"  ");return h+(a?">\n"+a+"\n"+f+"</"+d+">":"/>")}function Qf(a,b,d){Kd(ra(a)&&!jd.isArray(a));d=d||"";var f="";c(a,function(a,c){if("$"!=a[0]){var y;y=c;y=jd.isArray(y)?y:[y];for(var g=0;g<y.length;g++)if(c=y[g],f&&(f+=
"\n"),ra(c))f+=Gd(c,b,a,d);else{var h=(b?b+":":"")+a;f+=d+"<"+h+">"+Le(c)+"</"+h+">"}}});return f}function Le(a){return Ja(a)?gi(a):b(a)?""+a:""}function Rf(a,b,d,f){function k(a,b){v("netflixid",h,h,a,function(a){if(a.c){var c=Tb(a.Yc,"netflixiddata","netflixidpair");a=ua(c.netflixid);var c=ua(c.securenetflixid),y=/^[^=]*=([^;]*)/;b({c:!0,ea:a.match(y)[1],Ya:c.match(y)[1],gh:a,sh:c})}else b(a)})}function l(a,b,c){v("mdxpair",{targetuuid:a.Gy,controllerrequest:{cticket:a.uo,pairdata:{nonce:a.Rq,controlleruuid:a.Vu},
pairdatahmac:a.Qx}},h,b,function(a){if(a.c){a=a.Vr.mdxpairgrant;var b=a.controllererror,y=a.targetsharedsecret,d=a.grantdata,f,g;d&&(g={nonce:Da(d.nonce),controlleruuid:ua(d.controlleruuid),controlleruserid:ua(d.controlleruserid),controllersharedsecret:ua(d.controllersharedsecret),targetuuid:ua(d.targetuuid),targetuserid:ua(d.targetuserid)},f=ua(a.grantdatahmac));y&&(g=g||{},g.targetsharedsecret=ua(y.sharedsecret));c({c:!0,Su:b&&{Tu:Da(b.controllererrorcode)},Mv:g,Nv:f})}else c(a)})}function G(c,
d,h,t,k,l,ba){function G(){var b=0;va={softwareversion:a.As,sdkversion:f.cs,certificationversion:a.ao,preferredlanguages:{appselectedlanguages:{language:a.tk.map(function(a){return{index:b++,bcp47:a}})}},clientservertimes:{servertime:p(),clienttime:k}};a.Zk&&(va.uiversion=a.Zk);n()}function n(){var a='<?xml version="1.0" encoding="utf-8"?>\n<nccp:request xmlns:nccp="http://www.netflix.com/eds/nccp/'+m+'">\n'+Gd(va,"nccp","header")+"\n"+Gd(Ya,"nccp",d)+"\n</nccp:request>";ba({c:!0,dk:{Jd:l,We:d,url:c+
"/"+m+"/"+d,body:a,timeout:1E3*b.Ve,al:l.S,pf:t&&t.mslServiceTokens,dy:!X[d],jk:!!X[d],ij:!0}})}h=h||{};var m=a.xj(d),Ya,va;g(h)?h(l,function(a){a.c?(Ya=a.ey,G()):ba(a)}):(Ya=h,G())}function m(c,f,g,k,l){function ba(a){n.trace("Sending NCCP request",{Method:c});d.send(a,function(a){if(a.c){n.trace("Received NCCP response",{Method:c});var b=a.body;W={mslServiceTokens:a.pf};p(b)}else Aa(a)})}function p(a){wd(a,function(a){var y;if(a.c&&"response"==(y=a.object)[ig]){a=y;var d,f;try{var g=a.responseheader.clientservertimes;
d=Da(g.clienttime);f=Da(g.servertime)}catch(k){n.error("Exception while checking clienttime in NCCP response",k)}if(Ya==d||Ya+1==d){b.xh=f-tb();var t;n.trace("Processing NCCP response",{Method:c});try{var l=a.result,ba=l.status,p=a.parameters;b.kf=Da(p.retrycontrol);b.Ve=Da(p.mintimeout);b.$g=Da(p.loginterval);b.bh=Da(p.maxlogsize);b.Te=ua(p.loglevel);var G=ua(p.playbackparameters.sendheartbeats);b.wh=/^true$/i.test(G);b.zd=Da(p.playbackparameters.heartbeatinterval);(b.hh||q)();if("true"!=ba.success[Ib]){var m=
ba.error||{},va=Da(m.code),Oa=Da(m.reasoncode,0),H=Da(m.actionid),v=ua(m.description),X=m.usertext,Ga=X?ua(X.text):h,bb=X?ua(X.bcp47):h;n.warn("NCCP responded with error",{Method:c,ActionId:H,Code:va,Description:v});var ka=P.dm;8==H&&(ka=P.li);t={ek:m,Ic:H,g:ka,P:va,td:va,sg:Oa,C:v,Zo:Ga,uv:bb}}else t={c:!0,Vr:l,Yc:l[c],Ia:W}}catch(J){n.error("Exception while processing NCCP response",J),t={g:P.Ef,C:N(J)}}Aa(t)}else{f=a.result.status;var La,Z;"true"!=f.success[Ib]&&(La=f.error||{},Z=Da(La.code),La=
ua(La.description));Aa({g:d?P.Wl:P.Xl,P:Z,C:La})}}else n.error("Unable to parse NCCP response as xml",{Method:c}),Aa({g:P.cm})})}function Aa(a){n.trace("Executed NCCP method",{Method:c,Success:!!a.c},a.c?h:eb(a));l=l||q;a.method=c;a.hc=va;l(a)}var n=k.log,Ya=tb(),va=sa(a.hc),W;n.trace("Executing NCCP method",{Method:c});G(va,c,f,g,Ya,k,function(a){a.c?ba(a.dk):Aa(a)})}function v(c,d,f,g,h){function t(){m(c,d,f,g,function(d){var f=d.Ic,ba;if(!d.c){var p;if(Ge(d.g))switch(f){case 7:ka[d.hc]=!0;if(d.ek){var Aa=
ua(d.ek.nccpendpoint);ba=function(a,b){k.info("ActionId redirect",{Method:c,From:d.hc,To:Aa});var y=sa(Aa);ka[y]?b({g:P.mi,C:"Loop detected: "+d.hc+", "+y}):(gg({nccpControllerUrl:y}),b(xa))}}break;case 2:p=!0}else fe(d.g)?a.Wr&&(p=!0):ud(d.g)&&2==d.Jc&&(p=!0);if(!ba)if(p)if(p=b.kf,l<p){l++;var G=J(l);k.warn("Method failed, retrying",{Method:c,Attempt:l,WaitTime:G,RetryControl:p},eb(d));ba=function(a,b){Xa(function(){b(xa)},G)}}else k.error("Method failed, retry limit exceeded, giving up",{Method:c,
Attempt:l,RetryControl:p},eb(d));else k.error("Method failed, not retrying",{Method:c},eb(d))}if(ba){var n={Method:c,ActionId:""+f,MslCode:""+d.Jc};k.info("Handling failed method",n);ba(g,function(a){a.c?(k.info("Handle success, retrying method",n),t()):(k.error("Handle error",n,eb(a)),h(a))})}else h(d)})}var k=g.log,l=0;h=h||q;t()}function p(){return Eb(tb())}function Eb(a){return a+b.xh}function W(b,c,d){var f={},g={movieid:b.movieId,sessionstart:b.sessionStartEpoch};c?(g.heartbeattype=d,f={heartbeatdata:g}):
(g.sessionend=b.sessionEpoch,f={},b.isLicensed&&!a.An||n(f,{appid:b.appId,sessionid:b.sessionId,trackid:b.trackingId,xid:b.xid},{Ye:!0}),f.sessiondata=g,b.securestop&&(f.securestop=b.securestop));(d=b.playback)?(c=d.playTimes,g.firstpts={pts:Ua(d.startPosition),timestamp:d.startEpoch},g.lastpts={pts:Ua(b.position),timestamp:b.sessionEpoch},b=g.playbacktime={total:Ua(c.total)},Na(b,"videostreamplaytimes",c.video),Na(b,"audiostreamplaytimes",c.audio),Na(b,"timedtextstreamplaytimes",c.timedtext)):b.errorDisplayCode?
g.error={}:(g.lastpts=g.firstpts={pts:Ua(b.position),timestamp:b.sessionEpoch},g.playbacktime={total:"0"});return f}function $a(c,f,g,h){function k(c){d.Qn(c,function(c){if(c.c){var d=1E3*b.Ve;l({c:!0,Ip:{responseType:eh,url:p+"/"+a.xj("playdata")+"/playdata",lh:c.body,withCredentials:!0,Pb:d,Kd:d,Cb:"nccp-playdata"}})}else l(c)})}function l(a){h&&(a.method="playdata",h(a))}var ba=tb(),p=sa(a.hc);G(p,"playdata",c,g.playbackTokens,ba,f,function(a){a.c?k(a.dk):l(a)})}function Na(a,b,c){c&&c.length&&
(a[b]={streamplaytime:c.map(I)})}function I(a){return{downloadableid:a.downloadableId,playtime:Ua(a.duration)}}function H(a,b){var y=[];c(b,function(a,b){var c=Ja(b)?b:ob.stringify(b);y.push({name:a,value:c})});if(y.length){var d={};d[a]=y;return d}}function sa(a){return"/"==a[a.length-1]?a.substr(0,a.length-1):a}function J(a){a=1E3*dh(2,Fa(a-1,b.kf));return xb(1E3,a)}var Z=0,X=Fb(["license"]),ka={};n(this,{ping:function(a,b){v("ping",h,h,a,b)},fv:function(a,b){var c=n({},a);c.S=h;k(c,b)},ea:k,by:function(a,
b,c,y){k(n({ea:b,Ya:c},a),y)},ay:function(a,b,c,y){k(n({gj:b,kr:c},a),y)},md:function(a,b,c){var y={movieid:a.ma,appid:a.Sf,sessionid:a.yh},d=H("authparam",a.ge);d&&(y.authparams=d);y.contentprofiles={videoprofiles:{videoprofile:a.Rh},audioprofiles:{audioprofile:a.Vf},timedtextprofiles:{timedtextprofile:a.ad}};v("authorization",y,a.Ia,b,function(a){if(a.c){var b=a.Yc;c({c:!0,Fn:b.authorizationdata||b,Ia:a.Ia})}else c(a)})},Zg:function(a,b,c){var y=b.log,d;d=a.bo;var f=a.Gr,g;switch(a.ic){case "playready":g=
"soapresponse";d={drmtype:"PlayReady",pssh:f,soaprequest:d};break;case "widevine":g="widevineceflicense";d={drmtype:"WidevineCEF",pssh:f,widevinecefchallenge:d};break;case "fps":g="fpslicense";d={drmtype:"FPS",pssh:f,fpschallenge:d};break;default:c({g:P.$l});return}var f={playbacktype:a.pr},h=H("sessionparam",a.Zc);h&&(f.sessionparams=h);n(f,{downloadableid:a.J,appid:a.Sf,sessionid:a.yh,trackid:a.za,xid:a.qa,drmdata:d});v("license",f,a.Ia,b,function(a){if(a.c){var b=ua(a.Yc.licensedata[g]);Wa(b)?
c({c:!0,hq:b,Ia:a.Ia}):(y.error("no license response"),c({g:P.am}))}else c(a)})},bf:function(a,b,c){var y=W(a,!1);v("playdata",y,a.playbackTokens,b,c)},eg:function(a,b,c){var y=W(a,!1);$a(y,b,a,c)},Qg:function(a,b,c,y){b=W(a,!0,b);v("heartbeat",b,a.playbackTokens,c,y)},qq:function(a,b,c){Z++;for(var y=",esn="+f.lc+",snum="+Z+",lnum=",d,g=0;g<a.length;g++){var k=a[g],k=Eb(k.ho)+" "+k.qj()+y+(g+1);d=d?d+("\n"+k):k}a=d?S(d):"";v("logblob",{sequencenumber:Z,logdata:a},h,b,c)},Kw:l,Lw:function(a,b,c){var y=
{$j:a.uo,Dq:a.Tx,Cq:a.Rq,Bq:a.Uu,Eq:zc(a.cy)};n(y,b);k(y,function(y){y.c?l(a,b,function(a){a.c?(a.ea=y.ea,a.Ya=y.Ya,a.gh=y.gh,a.sh=y.sh,c(a)):c(y)}):c(y)})},Bg:function(a,b){v("fpsappdata",h,h,a,function(a){if(a.c){var c=a.Yc;a=ua(c.appcert);c=Da(c.expiration);b({c:!0,me:a,$o:c})}else b(a)})},wd:p,qo:Eb})}function Qe(a,b,c){var d;return d={S:a,Kc:!0,rh:!1,Pe:ja(),load:function(a){(a||q)(xa)},save:function(){d.Kc=!0},remove:function(a){d.Kc=!1;(a||q)(xa)},de:v.Ib.tk,Pc:function(){var a=Rc();return{ea:a[b],
Ya:a[c]}},Jk:function(a,y){(new RegExp("^"+b+"=.*")).test(a);(new RegExp("^"+c+"=.*")).test(y);ub.cookie=a;ub.cookie=y;Rc()[b]!=a.match(/[^=]*=([^;]*)/)[1]||"s"==lf.href[5]&&(Rc(),y.match(/[^=]*=([^;]*)/))},eo:function(){var a="=;Expires=Thu, 01 Jan 1970 00:00:00 GMT";ub.cookie=b+a;ub.cookie=c+a;a+=";Domain=.netflix.com;Path=/";ub.cookie=b+a;ub.cookie=c+a+";Secure";Rc()[b]||Rc()},Rj:!0}}function Re(a){if(a=jg[a])return of=a;throw new Za("invalid accountKey");}function Sf(a,b){var c=yi[a];c||(yi[a]=
c=Kb(function(b){var c=jg[a];c?b({c:!0,dc:c}):(c=new Se(a),jg[a]=c,c.load(function(a){a.c?b({c:!0,dc:c}):b(a)}))}));c(b)}function Se(a){this.S=a}function Te(a){var b={},d=ja(),f={};a.forEach(function(a){var b=a.url;f[b]||(f[b]=[]);f[b].push(a)});var g=[];c(f,function(a,b){g.push(bd(b,d))});b.urls=ob.stringify(g);return b}function bd(a,b){var d=a[0],f={url:d.url,bitrate:d.f,cdnid:d.i&&d.i.id,dltype:d.Fo,id:d.J},g={};a.forEach(function(a){var b=a.c||a.c===h||a.g===P.Za||a.g===P.cd?"success":"fail";
g[b]||(g[b]=[]);g[b].push(a)});c(g,function(a,c){"fail"===a?f.failures=Od(c):"success"===a&&(f.downloads=Tf(c,b))});return f}function Tf(a,b){var d={};a.forEach(function(a){var b=a.io;d[b]||(d[b]=[]);d[b].push(a)});var f=[];c(d,function(a,c){var y=[];c.forEach(function(a){y.push(a);(a=a.g===P.Za||a.g===P.cd?!0:void 0)&&(f.push(Ve(y,b)),y=[])});0<y.length&&f.push(Ve(y,b))});return f}function Ve(a,b){var c=a[0],d=a[a.length-1],f=c.D,g=Nd(a),c={time:f.requestTime,tresp:(f.O||b)-(f.requestTime||b),first:g,
ranges:Uf(a,g),dur:(d.D.M||b)-(c.D.O||b),trace:We(a,b),status:d.c?"complete":d.c===h?"open":d.g===P.Za?"abort":d.g===P.cd?"stall":"other"};v.re.length&&(c.servertcp=Ng(a));return c}function Ng(a){var b=v.re;return a.reduce(function(a,c){var d=[];if(c.Sk){var y={};c.Sk.split(";").forEach(function(a){a=a.split("=");2==a.length&&(y[a[0]]=a[1])});b.forEach(function(a){d.push(y[a])})}a.push(d);return a},[])}function Nd(a){var b=0;a.forEach(function(a){a.Kb&&(b=Fa(b,a.Kb[0]))});return b}function Uf(a,b){var c=
[];a.forEach(function(a){a.Kb?c.push([a.Kb[0]-b,a.Kb[1]-b]):c.push([0,-1])});return c}function We(a,b){var c=[],d;a.forEach(function(a){a=a.D;d&&(c.push([a.requestTime-d.M,-2]),c.push([(a.O||b)-a.requestTime,-3]));c.push([(a.M||b)-(a.O||b),a.X||0]);d=a});return c}function Od(a){var b=[];a.forEach(function(a){var c=a.D;b.push({time:c.requestTime,tresp:c.O-c.requestTime,dur:c.M-c.O,range:a.Kb||[0,-1],reason:a.Ca||a.g===P.bd?"http":a.g===P.Bf?"timeout":"network",httpcode:a.Ca,nwerr:oe(a.g)})});return b}
function Vf(a){var b=a.L,c=b.stream,d=b.track,f=b.url,g=Wf(d,f),k=h;switch(g){case zb:case cb:k=b.stream.J;break;case gh:case zi:k=d.J}c={f:c&&c.f,Fo:g,J:k,D:a.D,i:b.i,url:f};b.offset!==h&&b.length!=h&&(c.Kb=[b.offset,b.offset+b.length-1]);return a.Go=c}function Ue(a){var b=a.Go;b&&(b.P=a.P,b.Ca=a.Ca,b.g=a.g,b.c=a.c,b.Sk=a.headers&&a.headers["X-TCP-Info"],b.io=Xf(a))}function Wf(a,b){if(a)return a.type;if(0<=b.indexOf("netflix.com")){if(0<=b.indexOf("nccp"))return"nccp";if(0<=b.indexOf("api"))return"api"}return"other"}
function Xf(a){if(a.headers&&(a=a.headers["X-Session-Info"]))return a=(a?a.split(";"):[]).filter(function(a){return 0==a.indexOf("port=")}).map(function(a){return a.split("=")[1]})[0],B(a)}function Ye(a,b){function c(a,y,f){for(var g,k,h,t,l,p=[];f;)h=a==cb?f.videoprofile[Ib]:f.audioprofile[Ib],g=Da(f.bitrate),k=d(f.downloadurls.downloadurl,!0),g=new Rg(b,y,a,ua(f.downloadableid),g,Da(f.size),k,h),f.resolution&&(k=Da(f.resolution.width),h=Da(f.resolution.height),f.pixelaspect&&(t=Da(f.pixelaspect.width),
l=Da(f.pixelaspect.height),t>l?k=k*t/l:h=h*l/t),0<k&&0<h&&(g.width=ya(k),g.height=ya(h))),a==cb&&(g.Tj=!!f.superhd,g.Yg=g.Tj||!!f.hd,k=Tb(f,"hdcpversions","version"),g.yk=!(!k||"none"==ua(k))),g.yk&&"never"==v.Vn||p.push(g),f=f[Nb];p.sort(function(a,b){return a.f-b.f});n(p,ve);a=jc(a,v.Ps,v.Qs);if(pf&&pf.length)var ba=p.Ud(a),p=pf.call(p,function(a){return 0<=ba.indexOf(a.f)});p.sort(function(a,b){return a.f-b.f});n(p,ve);return p}function d(a,b){for(var c={},y;a;)c[a.cdnid[Ib]]=a.url[Ib],b&&(y=Da(a.expiration),
0<y&&(q=q?Fa(q,y):y)),a=a[Nb];return c}var f=new b.log.r("NccpParseAuth"),g,k,l,m,p,q,W=[],$a,Na;for(l=Tb(a,"locations","location");l;){if($a=ua(l.locationid))Na={id:$a,Wa:Da(l.rank),fq:Da(l.level),weight:Da(l.weight)},W.push(Na);l=l[Nb]}var I=v.Yn,H=v.Xn,sa=[],J=[];for(l=Tb(a,"cdns","cdn");l;)$a=Da(l.cdnid),W.some(function(a){if(a.id===ua(l.locationid,""))return Na=a,!0}),Na||(Na={id:$a,Wa:Da(l.rank),fq:1,weight:Da(l.weight)}),(!I.length||0<=I.indexOf($a))&&0>H.indexOf($a)&&(l.lowgrade?J:sa).push({id:$a,
location:Na,type:ua(l.type,"unknown"),Wa:Da(l.rank),name:l.name[Ib],Sp:!!l.exclusive}),l=l[Nb];sa.sort(function(a,b){return a.Wa-b.Wa});W.forEach(function(a){var b=sa.filter(function(b){return b.location.id===a.id});a.I=b});W.sort(function(a,b){return a.Wa-b.Wa});f.trace("Parsed cdns",{Count:sa.length,LowGradeCount:J.length});if(!sa.length)throw new Za("no valid cdns");$a=[];for(l=Tb(a,"trickplay");l;){for(;l;)I=l.resolution,H=l.pixelaspect,I=new Ij(b,ua(l.trickplayid),Da(I.height),Da(I.width),Da(H.height),
Da(H.width),Da(l.size),d(l.downloadurls.downloadurl,!1)),$a.push(I),l=l[Nb];$a.sort(function(a,b){return a.size-b.size})}I=[null];H={none:null};l=Tb(a,"timedtexttracks","timedtexttrack");for(var Z;l;){g=[];for(J=l.timedtextdownloadables.timedtextdownloadable;J;)g.push(J),J=J[Nb];g.sort(function(a,b){return Ze(a)-Ze(b)});J=g[0];Z=ua(J.timedtextprofile);"nflx-cmisc"==Z&&(J=gd(g));g=ua(l.timedtexttrackid);p=ua(l.timedtexttype);Z=ua(J.timedtextprofile);m={};if("nflx-cmisc"==Z){var X=Tb(J,"imagebasedtext");
m.offset=ua(X.masterindexoffset)|0;m.length=ua(X.masterindexsize)|0;X=Tb(X,"resolution");m.hy={width:ua(X.width),height:ua(X.height)}}m=new ic(b,g,ua(J.downloadableid),d(J.downloadurls.downloadurl,!1),ua(l.language.bcp47),ua(l.language.displayname.text),Ai[p]||qf,p,Z,m);I.push(m);H[g]=m;f.trace("Parsed timed text track",m);l=l[Nb]}I.sort($e);J=[];Z={};for(X=Tb(a,"audiogroups","audiogroup");X;){p=X.audiotype.audiotypeid[Ib];if(0==v.Qk.length||0<=v.Qk.indexOf(p))for(l=X.audiotracks.audiotrack;l;){g=
l.audiotrackid[Ib];m={type:zb,ka:g,Yk:Ai[p]||qf,Pq:p,bb:ua(l.language.bcp47),displayName:ua(l.language.displayname.text),isNative:!!l.isnative,Ri:ua(l.channels)};m.oa=c("audio",m,l.audiodownloadables.audiodownloadable);var ka=I,ga=[];if(l.disallowedtimedtexttracks){k={};for(var Ga=l.disallowedtimedtexttracks.timedtexttrackid;Ga;)k[Ga[Ib]]=!0,ga.push(Ga[Ib]),Ga=Ga[Nb];ka=ka.filter(function(a){return!(a?k[a.ka]:k.none)})}m.hv=ga;m.Ma=ka;m.Ga={Bcp47:m.bb,TrackId:m.ka};f.trace("Parsed audio track",m,
{StreamCount:m.oa.length,AllowedTimedTextTracks:m.Ma.length});m.oa.length?(Z[g]=m,J.push(m)):f.warn("Audio track has no streams",m);l=l[Nb]}X=X[Nb]}if(!J.length)throw new Za("no valid audio tracks");J.sort($e);g=[];for(l=Tb(a,"videotracks","videotrack");l;)m={type:cb},m.oa=c("video",m,l.videodownloadables.videodownloadable),f.trace("Parsed video track",{StreamCount:m.oa.length}),m.oa.length?g.push(m):f.warn("Video track has no streams"),l=l[Nb];if(!g.length)throw new Za("no valid video tracks");p=
[];for(l=Tb(a,"preferredtrackcombinations","preferredtrackcombination")||Tb(a,"defaulttrackcombinations","defaulttrackcombination");l;)m=ua(l.audiotrackid),ka=Z[m],X=ua(l.timedtexttrackid),ga=H[X],ka&&0<=ka.Ma.indexOf(ga)?p.push({W:ka,$:ga,sk:Da(l.preferenceorder)}):f.warn("Invalid default track combination",{AudioTrackId:m,TimedTextTrackId:X}),l=l[Nb];p.sort(function(a,b){return a.sk-b.sk});m=p[0]||{};H=g[0];Z=m.W||J[0];m=m.$||Z.Ma[0];var Oa;(l=a.bookmark)&&(Oa={time:1E3*Da(l)});f.trace("Parsed bookmark",
{Value:Oa?Oa.time:"None"});var vb;(l=a.runtime)&&(vb=1E3*Da(l));vb||(vb=Z.oa[0],X=H.oa[0],vb=md(Ea(8192*vb.size/(1E3*vb.f),8192*X.size/(1E3*X.f))),f.trace("Estimating runtime",{EstimatedRuntime:Ca(vb)}));var r;(l=a.clientipaddr)&&(r=ua(l));f.trace("Parsed client IP address",{IP:r});b.I=sa;b.Zn=W;b.Ab=J;b.Sh=g;b.ob===h&&(b.ob=Oa?Oa.time:0);b.Ma=I;b.$b=$a;b.ug=vb;b.Fk=r;b.wr=p;b.bc.set(H);b.W.set(Z);b.$.set(m);W=1E3*(q-Ob.wd());1E4<W?b.ld=ja()+W:f.error("Invalid url expiration, ignoring")}function Ze(a){var b=
ua(a.timedtextprofile),c=v.ad.indexOf(b);return 0<v.Uk&&"dfxp-ls-sdh"===b&&Da(a.size)>v.Uk?v.ad.length+1:0<=c?c:v.ad.length}function $e(a,b){if(!a)return-1;if(!b)return 1;var c=a.displayName,d=b.displayName;return c?d?c.localeCompare?c.localeCompare(d):c.charCodeAt(0)-d.charCodeAt(0):1:-1}function ne(){var a=we&&we.height;if(b(a))return 1080<=a?1080:720;wa.error("screen height not available",kc)}function gd(a){var b;a=a.filter(function(a){return"nflx-cmisc"===ua(a.timedtextprofile)});var c=v.Mj?v.Mj:
ne();c&&(b=a.filter(function(a){return c===Da(a.imagebasedtext.resolution.height)})[0]);b||(b=a[0]);return b}function xd(a){function c(){var d={accountKey:k,playbackTokens:l,isLicensed:!!n,appId:H,sessionId:sa,trackingId:a.za,xid:a.qa,movieId:a.ma,sessionStartEpoch:Ob.qo(a.Xj),sessionEpoch:Ob.wd()};b(a.v.value)&&(d.position=a.v.value);p&&(d.playback={startPosition:m,startEpoch:W,playTimes:a.Md.zp()});I&&v.Sd&&(d.keySessionId=I);var f=a.Da;f&&Wa(f.qd)&&(d.errorDisplayCode=f.qd);return d}function d(){d=
q;Uc(a,h,g);a.fireEvent(Bi)}function f(){f=q;a.fireEvent(kg)}var g=new a.log.r("NccpPlayback"),k=a.dc.S,h={Vg:a.ua,log:new a.log.r("Nccp"),S:k},l,n,p,m,W,$a,Na,I,H=v.Nq||xe,sa=v.Oq||xe;a.addEventListener(Zc,function(){p=!0;m=a.v.value;W=Ob.wd()});a.addEventListener(Ci,function(a){I=a.Ne});return{Jd:h,md:function(b){var c=ja();Ob.md({Sf:H,yh:sa,Zc:a.Nd.Zc,ge:a.Nd.ge,ma:a.ma,za:a.za,Rh:v.Rh,Vf:v.Vf,ad:v.ad},h,function(d){$a=ja()-c;if(d.c)try{l=d.Ia,Ye(d.Fn,a),b(xa),f()}catch(h){g.error("Exception processing authorization response",
h),b({g:P.Ef})}else b(d)})},Zg:function(b,c){var f=ja(),k=S(b.Fr),O=S(b.data),p=l,Aa=a.Nd.Zc;if(v.Wb){var m=b.iq;ia(v.Wj)&&(m=v.Wj);p=Ec(p);Aa=Ec(Aa);m&&(Aa.limitedDuration=m);p.mslServiceTokens=l.mslServiceTokens.filter(function(a){return a.name.match("movie")})}Ob.Zg({Ia:p,Sf:H,yh:sa,Zc:Aa,qa:a.qa,J:a.U.J,za:a.za,pr:"standard",ic:b.ic,Gr:k,bo:O},h,function(a){Na=ja()-f;if(a.c)try{l=a.Ia,n=!0,c({c:!0,gq:{data:zc(a.hq)}}),d()}catch(b){g.error("Exception processing license response",b),c({g:P.Ef})}else c(a)})},
Qg:function(a,b){Ob.Qg(c(),a,h,function(a){a.c&&a.Ia&&(l=a.Ia);b&&b(a)})},bf:function(a,b){Ob.bf(a,h,function(a){a.c&&a.Ia&&(l=a.Ia);b&&b(a)})},eg:function(a,b){Ob.eg(a,h,b)},Vi:c,Bg:function(a){Ob.Bg(h,a)},ip:function(){return $a},wp:function(){return Na}}}function Uc(a,b,c){Uc=q;if(Ob.ea&&v.ft){var f=a.dc;a=f.Pc().ea;a=Qa(a);var g=v.Qq;if("usr"==a||Wa(hg)&&$b.lc!=hg||Wa(g)&&$b.jj!=g)c.info("Upgrading NetflixId",{bt:a,prefix:g,downloadedEsn:hg}),Ob.ea(b,function(a){a.c?(c.trace("Setting upgraded NetflixId"),
f.Jk(a.gh,a.sh),d(Xg(f.Pc().ea))):c.error("NetflixId upgrade failed",eb(a))})}}function Qd(a,b,c,d){d=d||{};v.Fe&&(d.groupname=v.Fe);var f=tb();c={type:b,sev:c,devmod:hh};Di&&(c.nettype=Di);n(c,d);n(c,{jssid:xe,jsoffms:ja(),client_utc:f,lver:yk||"2012.2-CAD"});a?n(c,{xid:a.qa,soffms:a.Ub(),mid:a.ma,lvpi:a.Uc}):c.xid=Ei;this.data=c;this.type=b;this.ho=f}function $f(a){function c(d){var f=lf.href,g=T(a.Ub()),k=a.za,h="parallel"===v.dg?"multi":"single",t=T(a.ob||0),l=a.index,O=new ArrayBuffer(4),p=new ab(O),
O=new Uint32Array(O);p[0]=161;p[1]=178;p[2]=195;p[3]=212;f={browserua:kc,browserhref:f,playdelay:g,trackid:k,connection_type:h,bookmark:t,pbnum:l,endianness:3569595041==O[0]?"LE":2712847316==O[0]?"BE":"undefined"};a.po&&(f.controllerESN=a.po);b(a.nd)&&(f.bookmarkact=T(a.nd));b(a.nd)&&(f.bookmarkact=T(a.nd));(g=J.ip())&&(f.nccpat=g);(g=J.wp())&&(f.nccplt=g);(g=m())&&(f.downloadables=g);$b&&ia($b.kj)&&(f.esnSource=$b.kj);Xc&&n(f,Xc,{prefix:"pi_"});f.usejsase=v.pa;if(a.state.value>=db)try{var ba=a.Aa();
if(ba){var G=Sg(ba);x=aa(G);f.maxbitrate=x}}catch(Aa){H.error("Exception computing max bitrate",Aa)}try{var W=Na();W&&(f.pdltime=W)}catch(ga){}try{n(f,a.eh,{prefix:"sm_"}),n(f,a.Og(),{prefix:"vd_"})}catch(va){}I("startplay",d,lc|lg|Pb|mg|rf|ih|jh,f)}function d(){var b={waittime:T(a.Ub()),abortedevent:"startplay"};try{var c=Na();c&&(b.pdltime=c)}catch(f){}I("playbackaborted",!1,lc|Pb,b)}function f(){if(a.I){var b;(b=sa%v.og?B.filter(function(a){return a.sg}):B)&&0<b.length&&(B=B.filter(function(a){return!a.D.M}),
b=Te(b),v.re.length&&(b.tcpinfo=v.re.join(",")),I("dlreport",!1,Pb,b))}}function g(b){var c=b.L,d=c.track;if(d){var f=!b.c&&b.g!=P.Za,k=d.type,h=b.D;if(f||a.Uc){h={dltype:k,url1:c.url,url2:b.url||"",cdnid:c.i.id,tresp:T(h.O-h.requestTime),brecv:ae(h.X),trecv:T(h.M-h.O)};b.Kb&&(h.range=b.Kb);switch(k){case zb:h.adlid=c.stream.J;break;case cb:h.vdlid=c.stream.J;break;case gh:h.ttdlid=d.J}(c=oe(b.g))&&(h.nwerr=c);b.Ca&&(h.httperr=b.Ca);I("dlreq",f,Pb,h)}}}function k(){try{var b=Wd.timing.navigationStart-
(kd+(a.Tc||ja())),c=Wd.getEntries("resource"),d=c.length-v.bj;0<d&&(c=c.slice(d));var f=c.map(function(a){return{u:a.name,s:jb(a.startTime+b),d:jb(a.duration)}}),g={dlinfos:ob.stringify(f)};I("dlprestart",!1,lc|Pb,g)}catch(h){}}function l(){if(a.state.value==db){var b=p();b.midplayseq=w++;var c=a.A.value;b.prstate=c==$c?"playing":c==sf?"paused":c==Oc?"ended":"waiting";I("midplay",!1,lc|Pb|rf|mg,b)}}function m(){if(a.Sh&&a.Ab){var b=[];a.Sh.concat(a.Ab).forEach(function(a){a.oa.forEach(function(a){b.push({dlid:a.J,
type:a.type,bitrate:a.f})})});return ob.stringify(b)}}function bb(){function b(a,c){var y=a.cdnId,g=f[y];g||(g={cdnid:y,dls:[]},f[y]=g,d.push(g));y={bitrate:a.bitrate,tm:T(a.duration)};y[c]=a.downloadableId;g.dls.push(y)}var c=a.Md.hp(),d=[],f={};c.audio.forEach(function(a){b(a,"adlid")});c.video.forEach(function(a){b(a,"dlid")});return ob.stringify(d)}function p(){var c=a.Md,d={totaltime:Ua(c.Cj()),cdndldist:bb(),reposcount:u,intrplaycount:na};try{var f={numskip:0,numlowqual:0},g=a.ha,h;h=g.Ce();
b(h)&&(d.totfr=h,f.numren=h);h=g.Oc();b(h)&&(d.totdfr=h,f.numrendrop=h);h=g.Ae();b(h)&&(d.totcfr=h,f.numrenerr=h);h=g.De();b(h)&&(d.totfdl=h);d.playqualvideo=ob.stringify(f);d.videofr=a.k.value.j.Cg.toFixed(3);d.abrdel=c.jp();var k=c.kp();k&&n(d,k);d.rbfrs=na;d.maxbitrate=x;var t=a.xa(),l,O,p,ba;for(ba=0;ba<t.length;ba++){l=t[ba];if(p=a.Ue.sc(l)){d.maxbitrate=O?O.f:0;d.bitratefilters=p.join("|");break}O=l}if(a&&a.nb&&a.Oi&&a.aa){var G=a.Oi,Aa={ab:ya(G.Ei),actual60:a.aa.Bj(),b20:ya(G.Gi),b50:ya(G.Hi),
b90:ya(G.Ii),std:ya(G.Bs),ns:G.Vs,ss:G.lf,filt:G.filter};d.expectedbw=ob.stringify(Aa)}a.xb&&(d.trickplay=a.xb.Aj());null!==a.Zb.he&&(d.avg_subt_delay=a.Zb.he)}catch(m){H.error("Exception reading some of the endplay fields",m)}n(d,a.Og(),{prefix:"vd_"});return d}function Eb(a,b){a.browserua=kc;I("securestop",!a.success,lc|rf,a);b||(I=q)}function W(){var b,c=[];v.Fq&&(sc.addListener(kh,l),v.Gq.forEach(function(a){c.push(Xa(l,a))}),v.ak&&(b=Sb($a,v.ak)),a.addEventListener(Ab,function(){sc.removeListener(kh,
l);c.forEach(function(a){mb(a)});b&&yb(b)}))}function $a(){nd.flush(!0)}function Na(){var a=/wwwplayer.*js|coreplayer.*js/,b=Wd.getEntries("resource").filter(function(b){return null!==a.exec(b.name)});if(b)return b=jb(b[0].duration),ob.stringify(b)}function I(b,c,d,f,g){ag(f,a,c,d);b=new Qd(a,b,g||(c?"error":"info"),f);nd.uk(b)}var H=new a.log.r("NccpLogging"),sa=a.qa,J=a.ib,Z,X=a.paused.value,ka,ga,Ga,Oa,vb,r,La=[],u=0,na=0,w=0,ha=0,B=[],A,x,Nc,N;(function(){function b(c){vb="rebuffer";I("intrplay",
!1,lc|Pb,{vdlid:a.k.value.J,cdnid:a.i.value.id,playingms:La[$c]||0,pausedms:La[sf]||0,cause:c.Ac,intrplayseq:na++});ka=ja();ta(l)}function l(){if(ka&&a.A.value!=Qb){var b=ja()-ka;I("resumeplay",!1,lc|lg|Pb,{playdelay:T(b),reason:vb,intrplayseq:na-1});ga&&ga!=a.W.value&&I("audioswitch",!1,lc|Pb,{switchdelay:T(ja()-Ga),newtrackinfo:a.W.value.ka,oldtrackinfo:ga.ka});vb=ka=h}}function G(){a.Fc.value&&a.Ra.value&&(a.Fc.removeListener(G),a.Ra.removeListener(G),k())}a.addEventListener(ue,g,1);v.og&&(a.addEventListener(nf,
function(a){B.push(Vf(a))}),a.addEventListener(ue,Ue),ha=Sb(f,v.Ho));a.paused.addListener(function(a){var b=a.newValue;a.bx&&b||b==X||(I("statechanged",!1,lc|Pb,{newstate:b?"Paused":"Playing",oldstate:X?"Paused":"Playing"}),X=b)});a.addEventListener(tf,b);a.addEventListener(zk,b);a.A.addListener(function(a){a=a.oldValue;var b=ja();a==Qb?La=[]:La[a]=(La[a]||0)+(b-r);r=b});a.addEventListener(Xd,function(a){switch(a.Ac){case Fi:case Gi:if(vb&&ka){var b=ja()-ka;I("playbackaborted",!1,lc|Pb,{waittime:T(b),
abortedevent:"resumeplay",resumeplayreason:vb})}else Z||d();vb="repos";I("repos",!1,lc|Pb,{moffold:Ua(a.ih),reposseq:u++});ka=ja();ta(l)}});a.A.addListener(l);a.W.addListener(function(a){Ga=ja();ga=a.oldValue});a.addEventListener(Zc,function(){Z=!0;c(!1);W();v.Pj&&(A=Xa(function(){nd&&nd.flush(!1);A=h},v.Pj))});a.addEventListener(Ab,function(){A&&mb(A);if(Z){v.og&&(ha&&yb(ha),f());var b=!!a.Da,g=p();g.browserua=kc;g.usejsase=v.pa;a.xb&&"downloaded"===a.xb.Aj()&&(g.trickplay_ms=a.Wd.offset,g.trickplay_res=
a.Wd.zk);g.endreason=b?"error":a.A.value==Oc?"ended":"stopped";Xc&&n(g,Xc,{prefix:"pi_"});var h=a.Da,k,l;if(l=b&&h)h=h.errorCode,l=h==U.Ff||h==U.Cf;l&&(k="info");I("endplay",b,lc|lg|Pb|rf|mg|jh,g,k)}else a.Da?c(!0):d();N||(I=q)});a.je&&a.je.addListener(function(a){I("bitraterestriction",!1,lc|Pb,a.newValue)});a.k.addListener(function(b){if(b.oldValue&&b.Si){var c=b.oldValue,d=b.newValue,f=b.Si;b=v.pa?a.rf:a.aa.le();c={moff:Ua(f),vbitrate:d.f,vbitrateold:c.f,vdlid:d.J,vdlidold:c.J,lbw:b};(d=a.Ra.value)?
(b=Xe(d.ej),c.bw=ya(896E3/(b.Fd+896E3/b.rf)*7.8125)):c.bw=b;I("chgstrm",!1,Pb,c)}});var m;a.ub.addListener(function(a){if(a.newValue){var b=a.newValue.stream;m!=b&&(m&&I("renderstrmswitch",!1,Pb,{moff:Ua(a.newValue.G.startTime),vbitrate:b.f,vdlidold:m.J,vdlid:b.J,vbitrateold:m.f}),m=b)}});a.i.addListener(function(b){if((b=b.newValue)&&Oa!=b){var c=Oa,d=a.Ra&&a.Ra.value&&a.Ra.value.ej,f=b.id,g={selcdnid:f};if(d){var h=Xe(d),d=h.Fd,h=ya(896E3/(h.Fd+896E3/h.rf)*7.8125);g.selcdnrtt=d;g.selcdnbw=h;g.cdnbwdata=
ob.stringify([{id:f,rtt:d,bw:h}])}c&&(g.oldcdnid=c.id);n(g,b.fc);I("cdnsel",!1,ih,g);Oa=b}});v.bj&&(a.Fc.addListener(G),a.Ra.addListener(G));v.Sd&&a.state.addListener(function(){a.state.value==db&&(Nc=a.rc,Nc.addEventListener(Hi,function(){N=!0;Nc.Yd().then(Eb)}))})})();this.hs=Eb}function oe(a){switch(a){case P.bd:return"http";case P.Bf:return"connectiontimeout";case P.cd:return"readtimeout";case P.Af:return"corruptcontent";case P.Za:return"abort";case P.Xh:case P.Yh:return"unknown"}}function ag(a,
b,d,f){f&lc&&0<=b.v.value&&(a.moff=Ua(b.v.value));if(f&lg){var g=b.i.value,h=b.Yb.value||b.Fc.value,k=b.ub.value||b.Ra.value;g&&(a.cdnid=g.id,a.cdnname=g.name);h&&(a.adlid=h.stream.J,a.abitrate=h.stream.f);k&&(a.vdlid=k.stream.J,a.vbitrate=k.stream.f)}f&Pb&&((g=b.n)&&0<=b.v.value&&(a.abuflmsec=T(g.qb()),a.vbuflmsec=T(g.Fa()),a.abuflbytes=ae(g.pj()),a.vbuflbytes=ae(g.Dj())),(g=b.R&&b.R.Gg&&b.R.Gg())&&(a.curdlstatename=g));if(f&mg){cf(a);try{var l=b.Xa.getBoundingClientRect();a.rendersize=l.width+"x"+
l.height;a.renderpos=l.left+"x"+l.top}catch(m){}}f&rf&&(l=Yb.hardwareConcurrency,0<=l&&(a.numcores=l),0<=b.ne&&(a.cpuspeed=b.ne),(l=b.sd&&b.sd.lp())&&(a.droppedFrames=ob.stringify(l)),l=b.sd&&b.sd.yp(v.Oo),c(l,function(b,c){a["droppedFramesP"+b]=ob.stringify(c)}));if(f&ih)try{a.pricdnid=b.Od.id,a.cdninfo=ob.stringify(b.I.map(function(a){return{id:a.id,nm:a.name,rk:a.Wa,wt:a.location.weight}}))}catch(p){}d&&f&jh&&((b=b.Da)?bf(a,b):a.errorcode=U.cc)}function bf(a,b){a.errorcode=fg+(b.errorCode||U.cc);
b.g&&(a.errorsubcode=b.g);b.P&&(a.errorextcode=b.P);b.C&&(a.errordetails=b.C);b.Ca&&(a.httperr=b.Ca);b.td&&(a.nccperr=b.td);var c=oe(b.g);c&&(a.nwerr=c)}function cf(a){a.screensize=we.width+"x"+we.height;a.screenavailsize=we.availWidth+"x"+we.availHeight;a.clientsize=C.innerWidth+"x"+C.innerHeight}function pe(a){function b(){return Jb.wh&&a.state.value==db&&J&&!H&&(0<Jb.zd||W!=Bd)}function c(a,d){var y=a||Bd;y!=Bd&&(W=y);b()&&(y=W!=Bd?v.Rg:Ea(v.Rg,1E3*Jb.zd),y=Ea(y-(ja()-$a),d||0),!d&&(!$a||500>=
y||Na==Bd&&W!=Bd)?g():f(y))}function d(){I&&(mb(I),I=h)}function f(a){d();I=Xa(c,a)}function g(){if(b()){d();H=!0;var f=W;W=Bd;a.ib.Qg(f,function(b){b.c||n.error("Heartbeat failed",{Type:f},eb(b));Na=f;$a=ja();H=!1;11==b.Ic?a.Pa(new Hb(U.Zl,b)):c()})}}function k(){if(J){var b=a.ib.Vi();l(b);v.qr&&(X=b,a.ib.eg(b,function(a){X==b&&(Z=a.c?a.Ip:h)}))}}function l(a,b){0<v.kh&&v.Wc?fb.save(v.Wc,ob.stringify(a),!1,b):b&&b(xa)}function m(b){bg(a,function(a){a.c&&(yd(),k());b&&b(a)})}function p(){if(Z){var b=
v.Ib.Dr,c;try{if(Wa(b)){var d=Z.url.match(/^[a-z]*:\/\/[^\/]*(.*)$/i)[1],b=b.replace(/^\//,"").replace(/\/$/,"").replace(/\/controller$/i,"").replace(/\/nccp$/i,"");c="/"+b+d}}catch(f){}c&&(n.info("Sending last playdata synchronously",{Url:c}),Z.url=c,b=pc(Z),b.c&&/result[\s\S]*status[\s\S]*success[\s\S]*true[\s\S]*success[\s\S]*status[\s\S]*result/i.test(b.content))?yd():(n.info("Sending last playdata asynchronously"),a.ua.N(Z,q),k())}}var n=new a.log.r("PlayDataManager"),W=Bd,$a=0,Na,I,H,sa,J,Z,
X;a.addEventListener(kg,function(){ye&&m()});a.addEventListener(Bi,function(){J=!0;0<v.kh&&(sa=Sb(k,v.kh));k()});a.addEventListener(Ab,function(){function b(){c&&f&&g&&(b=q,a.Tq())}gb.removeListener(Pc,p);d();sa&&(yb(sa),sa=h);var c,f,g,k;if(J){a.dl();var t=a.ib.Vi();l(t,function(){function d(){a.ib.bf(t,function(d){d.c?yd(function(b){b=b.c?d:b;k&&a.rc.Ph(b)}):(n.error("Unable to send playdata"),k&&a.rc.Ph(d));c=!0;b()})}v.Sd?(a.rc.Yd().then(function(){g=!0;b()}),a.rc.cl().then(function(a){a.c?(t.securestop=
a.data,k=!0):g=!0;d()})):(g=!0,d())})}else g=c=!0;nd?(a.dl(),nd.flush(!1,function(a){a.c||n.error("Unable to send logblob");f=!0;b()})):f=!0});a.addEventListener(Xd,k);a.addEventListener(Zc,function(){a.A.addListener(function(){c(a.A.value==$c?Ak:Bk,a.A.value==Oc?500:0)});b()&&f(Ea(v.Rg,1E3*Jb.zd));k()},1);gb.addListener(Pc,p);return{qs:function(b){lh?lh.then(function(){b(xa)}):ye&&ye.movieId==a.ma?m(b):b(xa)}}}function bg(a,b){b=b||q;var c=ye;if(c){var d=c.accountKey;ye=null;if(d){var f;lh=new Vd(function(a){f=
a});Sf(d,function(g){var h=g.dc;if(g.c&&h){g=function(g){k=a?Ec(a.ib.Jd):{Vg:ld,log:new wa.r("Nccp")};k.S=d;k.log.info("Sending persisted playdata",{PersistedXid:c.xid,SessionEpoch:c.sessionEpoch,MediaTime:c.position});g&&(c.securestop=g.data);Ob.bf(c,k,function(a){g?g.c&&(wa.info("SecureStop Ack For Persisted Playback "),p.Ph(a)):(f(),b(a))})};var k,h=c.keySessionId,l=c.xid;if(a&&v.Bk)if(h){var p=new bi(a,h);p.Rc();p.cl().then(g);p.Yd().then(function(c){f();b(xa);c.persisted=!0;c.previousXid=l;a.fk.hs(c,
!0)})}else wa.error("SSManager: prev keysession not available",{ErrorCode:U.Km}),g();else g()}else f(),b(xa)})}else b(xa)}else b(xa)}function yd(a){fb&&v&&v.Wc&&fb.remove(v.Wc,function(b){b.c||wa.error("Error deleting playdata",b);a&&a(b)})}function df(a,b,c,d){this.V=a;this.jf=b;this.uf=c;this.tf=d;this.totalTime=this.jf+this.uf}function ef(a){function b(){var a=1E3*ya(kd/1E3),c=I.uj(),d=I.vj(),f=I.ud(),y=I.Ng(),g=I.xd();c&&g&&(a=new df(a+d,f,y,g),Na&&(c in J||(J[c]=[]),J[c].push(a)))}function d(){Na in
Z||(Z[Na]={});var a=Z[Na],b=0;c(J,function(c,d){var f;f=c in a?a[c]:[];for(var y=g(d,v.Tg),h=y.length;h--;)y[h].V>ka&&f.push(y[h]),b<y[h].V&&(b=y[h].V);a[c]=f;ka=b})}function f(){sa||(sa=!0);for(var a in J)J[a]=g(J[a],v.Tg);p()}function g(a,b){var c=[],d=[],f=1E3*b,y;if(0<a.length){for(var k=a[0].V,t=0;t<a.length;t++)y=a[t],Bc(k-y.V)<=f?d.push(y):(c.push(h(d)),k=y.V,d=[y]);0<d.length&&c.push(h(d))}return c}function h(a){for(var b=0,c=0,d=0,f=a.length,y=0;y<f;y++)b+=a[y].jf,c+=a[y].uf,d+=a[y].tf;return new df(a[0].V,
b,c,d)}function k(){if(l()>v.Jj){var a=[],b,d;c(Z,function(f,y){y&&c(y,function(c,f){b=f.length;for(d=0;d<b;d++)a.push(f[d])})});a.sort(function(a,b){return b.V-a.V});var f=a[v.Jj-1].V;c(Z,function(a,y){y&&(c(y,function(a,c){b=c.length;for(d=0;d<b;d++)c[d].V<f&&(c.splice(d,1),--d,--b);0===c.length&&delete y[a]}),0===Mb.keys(y).length&&delete Z[a])})}}function l(){var a=0,b;for(b in Z){var c=Z[b],d;for(d in c)a+=c[d].length}return a}function m(){Na&&fb.load(Ii,function(a){if(a.c&&(a=a.data))a:{Z=W(a);
a=Na;var b=Ck(Z),c=[],d;if(fd(a))d=v.Gp;else if(He(a))d=v.Hp;else{X=c;break a}for(var f=0;f<b.length;f++)Ra(a,b[f],d)&&c.push(b[f]);X=c}})}function p(){Na&&(d(),k(),fb.save(Ii,n(Z)))}function n(a){var b={};Mb.keys(a).forEach(function(c){b[c]={};Mb.keys(a[c]).forEach(function(d){for(var f=a[c][d],y=f.length,g=[],h=0;h<y;h++)g.push({sT:f[h].V,rT:f[h].jf,trT:f[h].uf,tB:f[h].tf,toT:f[h].totalTime});b[c][d]=g})});return b}function W(a){var b={};Mb.keys(a).forEach(function(c){b[c]={};Mb.keys(a[c]).forEach(function(d){for(var f=
a[c][d],y=f.length,g,h=[],k=0;k<y;k++)g={},"undefined"!==typeof f[k].sT&&"undefined"!==typeof f[k].rT&&"undefined"!==typeof f[k].trT&&"undefined"!==typeof f[k].tB&&"undefined"!==typeof f[k].toT&&(g.V=f[k].sT,g.jf=f[k].rT,g.uf=f[k].trT,g.tf=f[k].tB,g.totalTime=f[k].toT,h.push(g));0<h.length&&(b[c][d]=h)});0===Mb.keys(b[c]).length&&delete b[c]});return b}var q=this,Na,I,H,sa=!1;a.addEventListener(kg,function(){a.Ug=q;I=a.aa;Na=a.Fk;H=new Hc(1E3*v.Tg,f);H.Ch();a.addEventListener(ng,b);a.addEventListener(Ab,
function(){p();H.pd()});a.A.addListener(function(){a.A.value===Oc&&H.pd()});m()});var J={},Z={},X=[],ka=0;this.rp=function(a,b){var c;if(Na){c=[];if(a in J&&sa)return c=J[a],new ff(c,b,v.Gj,v.Kj,v.Ij,v.Hj,l());for(var d=X.length,f,y;d--;)if(f=X[d],a in Z[f])for(f=Z[f],y=f[a],f=y.length;f--;)c.push(y[f]);if(0!==c.length)return new ff(c,b,v.Gj,v.Kj,v.Ij,v.Hj,l())}}}function ff(a,b,c,d,f,g,h){this.Jq=f;this.yq=g;a=Xb(a,b,c,d,this.Jq,this.yq);b=[];for(c=0;c<a.length;c++)b.push(7.8125*qa(a[c].tf/a[c].totalTime,
mh,nh));this.Ze=F(b);this.lf=this.Ze.length;this.Ei=V(this.Ze)/this.Ze.length;a=this.Ze;c=this.lf;d=this.Ei;f=[];for(g=0;g<c;g++)f.push(dh(a[g]-d,2));this.Bs=Dk(V(f)/f.length);this.Gi=sb(b,.2);this.Hi=sb(b,.5);this.Ii=sb(b,.9);this.filter=og;this.Vs=h}function Xb(a,b,c,d,f,g){var h=[],k=c,l=md(b%604800/86400);b%=86400;var p,m,n;og=c;if(k===Ek){for(n=0;n<a.length;n++)c=a[n],p=c.V%86400,m=md(c.V%604800/86400),l===m&&Bc(p-b)<=d&&h.push(c);h.length<f&&(og=k=Ji,h=[])}if(k===Ji){for(n=0;n<a.length;n++)c=
a[n],p=c.V%86400,m=md(c.V%604800/86400),Bc(p-b)<=d&&h.push(c);h.length<f&&(og=Ki,h=[])}k===Ki&&(h=a,h.length<f&&(h=[]));h.length>g&&(h=h.sort(function(a,b){return a.V<b.V?-1:a.V>b.V?1:0}).slice(0,g));a=[];for(d=0;d<h.length;d++)0<h[d].totalTime&&a.push(h[d]);return a}function Sc(){n(this,{S:"b",ma:0,Nd:{za:0,Zc:{},ge:{}},za:0,index:1,qa:0xceb86ce78ed,Xa:{align:"",gx:null,fx:null,contextMenu:null,Xv:{},Lx:null,Kx:null,Jx:null,Ix:null,Hx:null,onsubmit:null,Gx:null,onshow:null,onselect:null,Fx:null,
Ex:null,onscroll:null,onresize:null,onreset:null,Cx:null,onprogress:null,Bx:null,Ax:null,zx:null,onmousewheel:null,onmouseup:null,onmouseover:null,onmouseout:null,onmousemove:null,onmouseleave:null,onmouseenter:null,onmousedown:null,onloadstart:null,yx:null,xx:null,onload:null,onkeyup:null,onkeypress:null,onkeydown:null,wx:null,oninput:null,onfocus:null,onerror:null,onended:null,vx:null,ux:null,tx:null,sx:null,rx:null,qx:null,px:null,ox:null,nx:null,ondblclick:null,mx:null,oncontextmenu:null,onclose:null,
onclick:null,onchange:null,oncanplaythrough:null,lx:null,kx:null,onblur:null,onabort:null,spellcheck:!0,isContentEditable:!1,contentEditable:"",Ox:"",innerText:"",accessKey:"",hidden:!1,Wy:"",draggable:!1,tabIndex:-1,dir:"",translate:!0,lang:"",title:"",ontouchstart:null,ontouchmove:null,ontouchend:null,ontouchcancel:null,childElementCount:2,lastElementChild:{},firstElementChild:{},children:{},Nx:null,Mx:null,nextElementSibling:null,previousElementSibling:null,onwheel:null,onselectstart:null,Dx:null,
onpaste:null,oncut:null,oncopy:null,jx:null,ix:null,hx:null,shadowRoot:null,dataset:{},classList:{},className:"",outerHTML:"",innerHTML:"",scrollHeight:545,scrollWidth:2560,scrollTop:0,scrollLeft:0,clientHeight:545,clientWidth:2560,clientTop:0,clientLeft:0,offsetParent:{},offsetHeight:545,offsetWidth:2560,offsetTop:0,offsetLeft:0,localName:"",prefix:null,namespaceURI:"",id:"",style:{},attributes:{},tagName:"",parentElement:{},textContent:"",baseURI:"",ownerDocument:{},nextSibling:null,previousSibling:null,
lastChild:{},firstChild:{},childNodes:{},parentNode:{},nodeType:1,nodeValue:null,nodeName:""},Uc:!1,Ga:{Xt:0,vu:0,wu:0},eh:{Vv:0,Fu:0,at:0,zy:0,yy:0,gw:0,Jw:0,dw:0,tw:0,ew:0,Ty:0},log:{Ha:{}},state:{value:2},v:{value:0},paused:{value:!1},muted:{value:!1},volume:{value:1},A:{value:1},o:{value:2},W:{value:{}},bc:{value:{}},$:{value:{}},ec:{value:null},Kh:{value:null},k:{value:{}},F:{value:{}},i:{value:{}},Yb:{value:null},ub:{value:null},te:{value:{}},ue:{value:{}},Fc:{value:{}},Ra:{value:{}},ke:{value:{}},
ua:{},dh:{},aa:{},lg:{},af:{},pk:{},nk:{},sd:{},Ue:{},Ug:{},Tc:0,Xj:0,dc:{S:"",Kc:!0,rh:!1,Pe:0,de:{},Rj:!0},ta:{},ib:{Jd:{}},fk:{},I:[{},{},{},{},{}],Zn:[{},{},{},{},{}],Ab:[{}],Sh:[{}],ob:0,Ma:[null,{}],$b:[{},{}],ug:0,Fk:0,wr:[{}],ld:0,Od:{id:0,location:{},type:0,Wa:1,name:"",Sp:!1,dq:0,fc:{}},Ms:[{},{},{}],Ih:[{},{},{}],Ss:0,ne:0,Xc:{track:{},type:"",J:0,f:0,size:0,Qa:{},j:{},Ga:{},Ie:!0},U:{track:{},type:"",J:0,f:0,size:0,Qa:{},j:{},Ga:{},width:0,height:0,Tj:!1,Yg:!1,yk:!1,Ie:!0,Ad:{}},n:{$a:{},
yb:{}},duration:0,ac:{width:0,height:0},nd:0,ha:{},cb:{R:{},Y:{},Rb:{},eb:{},Db:0,pb:{},nb:!1},R:{},Zb:{he:null},Lh:{},Md:{},Kp:{},rc:{},Jh:{Er:q,Kv:q,Hv:q,zu:q,vs:q}})}function td(a){function b(){a.n.pe()}var c=[];this.sc=function(a){for(var b=[],d=c.length;d--;){var f=c[d];f.sc(a)&&b.push(f.xg)}if(b.length)return b};Li.forEach(function(b){(b=b(a))&&c.push(b)});0<c.length&&a.addEventListener(Zc,b)}function Tc(a){Li.push(a)}function Vc(a,b){var c=a.length,d,f=b.length,g,h,k;for(d=0;d<c;d++)for(g=
a[d],k=g[0],h=g[1],g=0;g<f;g++)if(b[g]>=h&&0>=--k)return!0}function Lc(a){function b(f){a.removeEventListener(oh,b);try{var g=f.data,h=g.length,k;f=0;for(var l,p,n,m={};f<0+h;){k=g[f];l=k&7;p=k>>3;var v=g,q=f,I=q+1,H=v.length,sa=I,J=0,Z={},X=[],ka=void 0,ga=void 0,r=0;if(I>=H)throw new Za("Invalid Range for Protobuf - start: "+I+" , len: "+H);for(;sa<H;){J++;ka=v[sa];ga=ka&127;X.push(ga);if(!(ka&128))break;sa++}for(var Oa=X.length-1;0<=Oa;Oa--)r<<=7,r|=X[Oa];Z.count=J;Z.value=r;Z.start=q+J+1;n=Z;
if(!n.count)throw new Za("Parsing error. bytes length is 0 for the tag "+k);f+=n.count+1;2==l&&(f+=n.value);m[p]={Av:p,Xy:l,value:n.value,count:n.count,start:n.start}}var u;var w;u=m&&(w=m[1])?w.value:void 0;1==u&&m[5]&&m[5].value&&(d=!0,a.ws());c.trace("RA check",{HasRA:d})}catch(La){c.error("RA check exception",La)}}var c=new a.log.r("RAF"),d;a.addEventListener(oh,b);return{xg:"ra",sc:function(a){if(!d)return a.Yg}}}function Pd(a,b){var c,d,f,g,h=a.$a,k=a.yb,h=h.Q.Ja||h.Q;d=ya(h.endTime/(h.index+
1));h=k.Q.Ja||k.Q;f=ya(h.endTime/(h.index+1));c=d*f;g=.128*d*b.f;this.Ob=function(a,b){return ya(((c-f*(b+g/a))/d-b)*a/f*7.8125)}}function qc(a){var b,c=[],d=100,f=128,g=0,h=0,k=0,l,p;a.addEventListener(ue,function(b){var g=b.D,O=b.L;O.i&&(l=O.i.location.id);p=g.requestTime;if(b.c&&g.X>Mi&&b.type==Ac){for(c.push(g);c.length>Fk;)c.shift();var n=0,m,v=c.length;h=k=0;if(0<v){var q,va;for(b=v;b--;)m=c[b],g=dd(m),O=m.requestTime+g,n+=g,k+=m.X,m.M>q||(h+=va-q||0,va=m.M),q=O;h+=va-q||0;d=md(n/v);f=qa(k/
h,mh,nh);a.fireEvent(ng)}}});a.addEventListener(Ab,function(){n&&n.wb()});var n=new Jc(6E4,function(){g=f;n.wb()});n.jc();this.ud=function(){return d};this.Lg=function(){return f};this.Bj=function(){return g};this.xd=function(){return k};this.Ng=function(){return h};this.uj=function(){return l};this.vj=function(){return p};this.ga=function(a){return d+a/f};this.Ob=function(){b=b||new Pd(a.n,a.Xc);return b.Ob(f,d)};this.le=function(){return ya(896E3/(d+896E3/f)*7.8125)}}function dd(a){a=Fa(a.O-a.requestTime,
(a.M-a.requestTime)*Gk);a=ya(a);return qa(a,Hk,Ik)}function Xe(a){var b=dd(a);a=qa(ya(a.X/(a.M-(a.requestTime+b))),mh,nh);return{Fd:b,rf:a}}function qe(a){function b(){d();var a=p.ba(0,!0);m=k(l,0,a);return 0>m.Gb||0>m.tb}function c(a){for(a=f(a);a&&a.j;)a=a.lower;return a}function d(b){var c=a.Aa();if(b){b=a.xa().Ud(v.Qp);for(var f=c.length,g=[],h=0;h<f;h++)-1!==b.indexOf(c[h].f)&&g.push(c[h]);c=g}b=c.length;n(c,ve);for(f=0;f<b;f++)c[f].lower=c[f-1],c[f].Ad=c[f+1];p=c}function f(b){var c=p.ba(b.f);
if(!c.Ad)return c;var d=a.n.Mc(),d=Gc(v.Xf,d);b=Gc(v.Rk,b.f)[0];b=Fa(b,l.Ob()/(1+d[2]/100));b=p.ca(b+1);return b.f<=c.f?c:b}function g(){for(var b,c=a.Ra.value.stream,d=f(c),h,t=a.n.Mc(),p=Gc(v.Ki,t),O=Gc(v.Xf,t),m,n;d;){if(d.j)if(b=d.f>c.f?O:p,m=v.Va+(b[0]||0),n=v.Va+(b[1]||0),h=d,b=k(l,b[2],d),b.Gb<m||b.tb<n){if(d.f<=c.f&&v.cj&&t>v.cj)break}else break;d=d.lower}d||(d=h);return{k:d,Gb:b.Gb-m,tb:b.tb-n}}function k(b,c,d){function f(){for(;Aa&&Aa.media&&va<G;)va+=Aa.duration,Aa=Aa.next;for(;Ya&&Ya.media&&
r<G;)r+=Ya.duration,Ya=Ya.next}function g(){if(t>=bb){for(var a=d.lower;a&&!a.j;a=a.lower);a&&(d=a,n=a.j.t);g=q}}var h=(c||0)/100+1,t=a.v.value,l=a.n,p=a.F.value,O=l.$a,m=l.yb,l=p.j.t,n=d.j.t,ba=[];ba.reduction=c;c=v.Gd;v.Hb&&(c=Fa(c,ya(v.Hb/(.192*(p.f+d.f)))));var G=c-v.Fi,Aa=O.fb(t),va=Ea(Aa.startTime-t,0),Ya=m.fb(t),r=Ea(Ya.startTime-t,0);f();var bb=t+r+v.Fp,p=v.Mk?t+Fa(r,va)+v.Mk:145152E5,O=va;c=r;for(var u,Eb,w;t<p;)if(f(),w=m=Eb=0,u=Fa(va-G,r-G),0<u&&(t+=u,va-=u,r-=u),Aa&&(va<r||!Ya)?(u=l[Aa.index],
Eb=u.length,m=u.duration,Aa=Aa.next):Ya&&(g(),u=n[Ya.index])&&(Eb=u.length,w=u.duration,Ya=Ya.next),0<Eb)Eb=b.ga(Eb)*h,t+=Eb,va-=Eb,r-=Eb,O>va&&(O=va),c>r&&(c=r),va+=m,r+=w;else break;return{Gb:O,tb:c,Ay:ba}}var l=a.aa,m,p,r=v.tr;n(this,{Lc:function(b){var c=l.le()/v.Dn;return a.Eb().ca(c,b)},gb:function(b){d(b);b=l.Ob();var f=jb(Gc(v.sr,b)[0]);b=(b=p.ca(f+1,!0))||a.U;var g=a.n,h=v.qk,O=k(l,h[2],b),m=g.Fb(),n=g.Tb(),m=m?g.$a.Q.endTime-m.startTime:0,n=n?g.yb.Q.endTime-n.startTime:0,ba=g.qb(),q=g.Fa(),
g=-O.Gb+v.Va+(h[0]||0),h=-O.tb+v.Va+(h[1]||0),g=Ea(g,v.mh-ba),g=Fa(g,Ea(r-ba,0),m),h=Ea(h,v.nh-q),h=Fa(h,Ea(r-q,0),n),f=p.ca(f+1,!1);f==b&&f.j&&(f=c(b));return{k:b,Ua:f,jb:g,kb:h}},Nc:function(){d();var a=g(),b=a.k,f=c(b);f&&(a=Fa(a.Gb,a.tb),l.ga(f.mj())<=a||(f=p[0],f=f.j?null:f));return{k:b,Ua:f}},Dd:b,Eh:function(){var c=a.k.value.f,d=p.ba(0,!1).f;return a.n.wj()<v.qn&&c!==d&&b()},zj:function(a){var b=g(),b={Gb:b.Gb-v.fe[0],tb:b.tb-v.fe[1]},b=Fa(b.Gb,b.tb);a=l.ga(a);a*=1+.01*v.fe[2];return a<b},
Ig:function(){d();var b=k(l,v.Ki[2],p[p.length-1]);return a.n.Fa()-b.tb}});a.addEventListener(Yd,function(){m=h});a.addEventListener(Zc,function(){r=v.Kr})}function zd(a){function b(){var c=v.Gd,d=a.F,f=a.k;v.Hb&&(c=Fa(c,ya(v.Hb/(.192*(d.f+f.f)))));return c}function c(a,b,d){var f=0;b=b||0;a=a.j.t;var g=a.length-b;d=Pa.min(d||g,g);B&&(b=0,d=a.length);0<d&&(b=a.slice(b,b+d),0<b.length&&(f=b.reduce(function(a,b){return{length:a.length+b.length}},{length:0}),f=f.length/d));return f}function d(a){a=a.j.t.slice(0,
a.j.t.length);return 0===a.length?0:a.reduce(function(a,b){return a.length>b.length?a:b}).length}function f(a,b,c){a=a.j.t.slice(b||0,c||a.j.t.length);return 0===a.length?0:a.reduce(function(a,b){return a.length<b.length?a:b}).length}function g(){var a=M.ba(0,!0),b=M.ca(Number.POSITIVE_INFINITY,!0);return 8*d(b)/a.f}function k(){return T*J/100-E-L}function l(){return Pa.min(v.Va,2*K)}function m(a){var b=M.ba(0,!0),c=b.j.t,d=l(),f=0;if(!c)return H;for(var g=Pa.min(c.length,a+Z),y=0;a<g;a++){var h=
c[a],y=y+(8*h.length/b.f-h.duration);f<y&&(f=y)}f<d?f=d:f>Pa.min(T,H)&&(f=Pa.min(T,H));return f}function p(a,b){P.push(a);10<P.length&&(P=P.slice(-10));S.push(b);10<S.length&&(S=S.slice(-10))}function q(a,b,g){var y,h,k,l,p,O=M.ba(b.f,!0),m=M.ba(0,!0);if(1>=S.length||1>=g){if(1===Nc||A)h="historical"===v.Ji?D.xd()/(D.ud()+D.Ng()):D.Lg(),y=h>O.f*R?O:h<b.f*R?M.ca(b.f,!0):b;return y}h=2>S.length?0:a-S[S.length-2];k=c(b,0,b.j.t.length);l=d(b);p=b.j.t[g-1].length;if(ha)if(y=l/k,N&&(l=Pa.min(b.j.t.length-
g-1,F),g+l+1<b.j.t.length&&(y=f(b,g,g+l)/k)),x?1>=y?a=1:(g=L+E+z,a=a>g?1:(y-1)*(g-a)/g+1):a=y,g=K-8*p/(O.f*a),h>g)y=O;else if(0<=h)y=b;else for(y=O,b=K-8*p/(y.f*a);h<b;){y=M.ca(y.f,!0);if(y===m)break;b=K-8*p/(y.f*a)}return y}function W(a,b,d,f){var g=M.ca(b.f,!0),y=M.ba(b.f,!0),h=M.ba(0,!0),k,p;p=M.ba(0,!0).f*K/8;var O=M.ca(Number.POSITIVE_INFINITY,!0).f*K/8;p=(a-E-L)/z*(O-p)+p;p=Pa.max(0,p);var O=M.ba(0,!0),m=M.ca(Number.POSITIVE_INFINITY,!0),m=R*K*m.f/8;na&&(m=ka?(a-E)*O.f/8:(a-l())*O.yt/8);a=m;
var n=m=0,ba=g.j.t,G=y.j.t,Aa=b.j.t[d].length,O=b;p=Pa.min(p,a);ba&&(m=c(g,d,f),1<f&&(m=Pa.max(m,ba[d].length)));G&&(n=c(y,d,f),1<f&&(n=Pa.max(n,G[d].length)));if(na&&Aa>a){for(;;){O=M.ca(O.f,!0);if(O.f===h.f){k=h;break}b=O.j.t[d].length;if(b<a){k=O;break}}return k}if(0<n&&p>n)k=y;else if(0<m&&p<m)for(O=g,b=m;b>p;){k=O;O=M.ca(O.f,!0);if(O.f===h.f)break;b=c(O,d,f);1<f&&(b=Pa.max(b,O.j.t[d]))}else k=b;return k}function r(){var f=a.Ra.value.stream,n,ba=M.ba(0,!0),v=a.n.Mc(),Z=a.n.sb();n=Z.duration;var J=
0,I=2>S.length?0:v-S[S.length-2],u,ha=1;K===h&&(K=n);R===h&&(R=d(f)/c(f));T===h&&(T=b());1===Nc&&(C=ga,Q=0===P.length?f.f:P.reduce(function(a,b){return a+b},0),0<Q&&(Q/=P.length,Q=Pa.min(Q,P[P.length-1]),U=M.ca(Q,!0)),S=[],P=[]);p(f.f,v);C=X?C-1:-1;0===C&&0<I?C+=1:X&&-1===C&&(0<I?C=1:u=!0);ka?(J=m(Z.index),E<J&&(E=J)):Ga?(E=Oa,E<l()&&(E=l())):E=l();if(0>L||2===Nc||1===Nc)L=v-E,L=Pa.max(0,L),L+E>H&&(L=H-E),L>sa&&(L=sa),ia=!1,v>=k()+E+L&&(ia=!0);!vb&&ka?z=k():vb?(z=w,z<g()()?z=g():z>k()&&(z=k())):z=
g();La&&(ha=(v-E-L)/n,ha=1>ha?1:ha);v<E+L?(n=ba,ia=!1):v>E+L+z-n?(n=M.ca(Number.POSITIVE_INFINITY,!0),ia?n=0<I?M.ba(f.f,!0):f:C=-1):(n=W(v,f,Z.index,ha),ia&&(n=0<=I?f:M.ca(f.f,!0)));X&&0<=C?(v=q(v,f,Z.index),U&&v.f<U.f&&(0<I?v=M.ba(f.f,!0):0>I&&(U=h)),U&&v.f>=U.f&&(U=h),v.f>n.f&&(n=v)):u&&(0<I?n=f:n.f<=f.f/2?n=M.ca(f.f/2,!0):u=!1);Nc=0;n||(n=ba);return n}var u=new qe(a),I=v.Pn,H=I.Aq,sa=I.zq,J=I.vq,Z=I.Ur,X=I.Hs,ka=I.Ro,ga=I.Gs,Ga=I.Vp,Oa=I.tq,vb=I.Rp,w=I.sq,La=I.Up,B=I.Yp,na=I.Zp,A=I.Zs,ha=I.Is,
x=I.Js,N=I.Es,F=I.Fs,Nc=0,D=a.aa,T,M,E=0,z=0,S=[],P=[],C=ga,L=0,K,Q,U,ia,R;a.addEventListener(Xd,function(){Nc=1});a.addEventListener(tf,function(){Nc=2});return{Lc:u.Lc,gb:u.gb,Nc:function(){var b=a.Aa(),c=b.length;n(b,ve);for(var d=0;d<c;d++)b[d].lower=b[d-1],b[d].Ad=b[d+1];M=b;b=r();c=a.n;d=M.ba(b.f);if(d.Ad)var f=a.n.Mc(),f=Gc(v.Xf,f),g=Gc(v.Rk,b.f)[0],g=Fa(g,D.Ob()/(1+f[2]/100)),f=M.ca(g+1),d=f.f<=d.f?d:f;for(;d&&d.j;)d=d.lower;d&&(c=Fa(c.qb(),c.Mc())-K,D.ga(d.mj())<=c||(c=M[0],d=c.j?null:c));
return{k:b,Ua:d}},Dd:u.Dd}}function cg(a){function b(c){c=a.xa().filter(c?rd:Td);return sd(c)}return{Lc:function(b){b=a.Eb().filter(b?rd:Td);return sd(b)},gb:function(){var c=a.n,d=c.qb(),f=c.Fa(),d=Ea(v.mh+v.Va-d,0),f=Ea(v.nh+v.Va-f,0),g=c.Fb(),h=c.Tb(),h=h?c.yb.Q.endTime-h.startTime:0,d=Fa(d,g?c.$a.Q.endTime-g.startTime:0),f=Fa(f,h);return{k:b(!0),Ua:b(!1),jb:d,kb:f}},Nc:function(){return{k:b(!0),Ua:b(!1)}},Dd:function(){return!1},Eh:function(){return!1},zj:function(){return!0},Ig:function(){return 4E3}}}
function Pg(a){function b(){var c=v.dp,d=a.n.Tb();if(d)for(var d=d.startTime,f,g=c.length,h,k=0,k=0;k<g;k++)if(h=c[k],d>=h[0])f=h[1];else break;c=a.Aa();f=ve.gc.call(c,f||0);c=c.filter(Td)[0];return{k:f,Ua:c}}n(this,{Lc:function(b){b=a.Eb().filter(b?rd:Td);return sd(b)},gb:function(){var c=b(),d=a.n,f=d.qb(),g=d.Fa(),f=Ea(v.mh+v.Va-f,0),g=Ea(v.nh+v.Va-g,0),h=d.Fb(),k=d.Tb(),k=k?d.yb.Q.endTime-k.startTime:0,f=Fa(f,h?d.$a.Q.endTime-h.startTime:0),g=Fa(g,k);c.jb=f;c.kb=g;return c},Nc:b,Dd:function(){return!1},
Eh:function(){return!1},zj:function(){return!0},Ig:function(){return 0}})}function Rd(a){function b(){for(var a,c,d,f,g=m.length,y=n.length,h=0;h<g;h++){var k=m[h];if(-1===n.indexOf(k)&&k<aa(n))for(a=0;a<y-1;a++)if(c=n[a],f=n[a+1],k>=f&&k<=c){a=l[c];d=l[f];l[k]=(k-c)/((f-c)/(d-a))+a;break}}}function d(){var b=[],f=a.Eb(),g=a.xa(),h=a.n.Fb().index,k=a.n.Tb().index,t=a.n.$a,p=a.n.yb;c(l,function(a,c){var d,y=f.gc(a,!0),l=g.gc(a,!0),O=0,n=0,m;d=Fa(md(v.Li)/4,t.Q.index-h+1);for(m=0;m<d;m++)O+=y.j.t[h+
m].length;d=Fa(v.Li,p.Q.index-k+1);for(m=0;m<d;m++)n+=l.j.t[k+m].length;d=Ea((O+n)/d*2/128/c,a);y={};y.f=a;y.Rr=d;y.ev=c;b.push(y)});return b=b.sort(function(a,b){return Mc(a.f)<Mc(b.f)?-1:Mc(a.f)>Mc(b.f)?1:0})}function f(){for(var a,b=p.length;b--;)if(a=p[b],a.Rr<=k)return a.f}var g,h,k,l={},n=[],p=[],m;this.tj=function(q){m=a.xa().Ud(v.Qj);if((g=a.Ug)&&q&&(h=g.rp(q,ya(kd/1E3)+ja()))&&0!==h.lf)return c(v.Wn,function(a,b){l[a]=rc(b);n.push(B(a))}),n=F(n).reverse(),b(),p=d(),k=(20===v.Mi?h.Gi:90===
v.Mi?h.Ii:h.Hi)*(1-.01*(v.qk[2]||0)),f()};this.qp=function(){return h}}function re(a,b,c){function d(a){if(p.state.value==uf||p.state.value==ac||p.state.value==db)H.info("Playback closing",p,a?{ErrorCode:a.qd}:h),gb.removeListener(Pc,k),u.B(ph,{qt:I}),p.Da=a,u.B(Ab),p.state.set(qh),sa||ta(f)}function f(){var a=p.Re;p.Re=h;a?Zd.Nr(a,function(){g()}):g()}function g(){g=q;var a=od.indexOf(p);od.splice(a,1);p.state.set(pg);u.B(qg,{},!0);u.Ec()}function k(){d()}function l(){var a=p.v.value;J!=a&&(H.trace("MediaTime changed",
{MediaTime:Ca(a)}),J=a,u.B(vf))}function n(a){a.newValue!=Qb&&(p.A.removeListener(n),u.B(Zc))}var p=this,m,r=new Rb(1E3),u=new rb,Na={},I={};rg?(m=rg,rg=h):m=1E4*tb()+ya(1E4*kf());Ei=m;p.addEventListener=u.addListener;p.removeEventListener=u.removeListener;p.fireEvent=u.B;p.S=a;p.ma=b;p.Nd=c||{};p.za=p.Nd.za||0;p.index=++Jk;p.qa=m;p.Xa=Ha("DIV","position:relative;width:100%;height:100%;overflow:hidden");p.Uc=v.bl&&!(m%v.bl);p.Ga={MovieId:p.ma,TrackingId:p.za,Xid:p.qa,AccountKey:p.S};p.eh=Na;a=new Ld(p);
p.log=a;sg||(sg=a);var H=new p.log.r("Playback");H.info("Playback created",p.Ga);p.Uc?H.info("Playback selected for trace playback info logging"):H.trace("Playback not selected for trace playback info logging");p.state=new Va(uf);p.state.addListener(function(a){H.info("Playback state changed",{From:a.oldValue,To:a.newValue})});p.Xq=function(){p.log.Ha.Tc=p.Tc=ja();p.Xj=tb();p.state.set(ac)};p.Wq=function(){p.state.value==ac&&p.state.set(db)};p.na=function(a){H.trace("Milestone",{Id:a});Na[a]=p.Ub()};
p.close=function(a){a&&(p.state.value==pg?a():p.addEventListener(qg,function(){a()}));d()};p.Pa=function(a){function b(){d(a)}if(p.state.value==uf)p.Da||(p.Da=a,p.load());else{var c=v.Xi&&a&&v.Xi[a.errorCode];Wa(c)&&(c=B(c));H.error("Fatal playback error",{Error:""+a,HandleDelay:""+c});0<=c?Xa(b,c):b()}};p.dl=function(){sa=!0};p.Tq=function(){f()};p.Xd=function(){u.B(Ni)};var sa;gb.addListener(Pc,k,1);p.v=new Va;var J;p.v.addListener(function(){r.lb(l)});p.ep=function(){l()};p.paused=new Va(!1);p.paused.addListener(function(a){H.info("Paused changed",
{From:a.oldValue,To:a.newValue,MediaTime:Ca(p.v.value)})});p.muted=new Va(!1);p.volume=new Va(v.Ao/100);p.A=new Va(Qb);p.A.addListener(function(a){H.info("PresentingState changed",{From:a.oldValue,To:a.newValue,MediaTime:Ca(p.v.value)},p.n.Ee())});p.o=new Va(bc);p.o.addListener(function(a){H.info("BufferingState changed",{From:a.oldValue,To:a.newValue,MediaTime:Ca(p.v.value)},p.n.Ee())});p.W=new Va(null);p.W.addListener(function(a){H.info("AudioTrack changed",a.newValue&&{ToBcp47:a.newValue.bb,To:a.newValue.ka},
a.oldValue&&{FromBcp47:a.oldValue.bb,From:a.oldValue.ka},{MediaTime:Ca(p.v.value)});p.F.set(p.ta.Lc())});p.bc=new Va(null);p.bc.addListener(function(){p.k.set(p.xa()[0])});p.$=new Va(null);p.$.addListener(function(a){H.info("TimedTextTrack changed",a.newValue?{ToBcp47:a.newValue.bb,To:a.newValue.ka}:{To:"none"},a.oldValue?{FromBcp47:a.oldValue.bb,From:a.oldValue.ka}:{From:"none"},{MediaTime:Ca(p.v.value)})});p.ec=new Va(null);p.Kh=new Va(null);p.k=new Va(null);p.F=new Va(null);p.i=new Va(null);p.i.addListener(function(a){a=
a.newValue;var b=p.I;b.splice(b.indexOf(a),1);b.unshift(a)});p.Yb=new Va(null);p.ub=new Va(null);p.te=new Va(null);p.ue=new Va(null);p.Fc=new Va(null);p.Ra=new Va(null);p.je=new Va(null);p.A.addListener(n);p.ke=new Va;Ad(p);p.Og=function(){u.B(ph,{qt:I});return I};p.ws=function(){I.HasRA=!0};od.push(p);p.ua=new Of(p);p.dh=new Ne(p);p.aa="sliding_window"===v.Ji?new L(p):new qc(p);p.lg=new dg;p.af=new Sd(p);p.pk=new hf(p);p.nk=new pe(p);p.Ue=new td(p);v.So&&(p.Ug=new ef(p));Oi.forEach(function(a){a(p)});
Qg(this)}function Qg(b){function d(a){return"parallel"===v.dg?new Ig(a):new Gg(a)}function g(a,c){k||(k=!0,b.Pa(new Hb(a,c)))}var h=new b.log.r("Playback"),k,l,n,m,r,p;b.load=function(a){this.load=M;r=a;b.state.value==uf&&(h.info("Playback loading",b),b.Xq(),tg(function(a){a.c?b.ro():g(a.errorCode||U.$d,a)}))};b.ro=function(){try{var a=b.S,c=a?Re(a):of;b.S=c.S;b.dc=c;switch(v.Ep){case "random":b.ta=new cg(b);break;case "fixed":b.ta=new Pg(b);break;case "bb":b.ta=new zd(b);break;default:b.ta=new qe(b)}b.ib=
new xd(b);b.fk=new $f(b);b.nt()}catch(d){g(U.Hl,{g:P.Nb,C:N(d)})}};b.nt=function(){if(b.Da)b.Pa(b.Da);else if(f(b.ma,1)){var a=b.dc.Pc();if(v.Sr){var c=a.ea;if(!Wa(c)){g(U.di);return}c=Qa(c);if("usr"!=c&&"dbl"!=c){h.error("Invalid NetflixId",{bt:c});g(U.ci);return}}v.Tr&&!Wa(a.Ya)?g(U.fi):b.co()}else g(U.ul)};b.co=function(){var a=Zd.Gk;a?a.c?b.bg():g(U.gi,a):b.Qf()};b.bg=function(){v.bg?se(function(){b.Qf()},b):b.Qf()};b.Qf=function(){b.state.value==ac&&(v.Wo?Zd.Ci(Kk,function(a){a.c?(b.Re=a.Re,
b.nf()):g(U.ei)}):b.nf())};b.nf=function(){b.state.value==ac&&(b.na("ic"),b.nk.qs(function(a){a.error&&h.error("Error sending persisted playdata",eb(a));b.md()}))};b.md=function(){b.state.value==ac&&(h.info("Authorizing",b),b.na("ats"),b.ib.md(function(d){if(b.state.value==ac){b.na("at");if(!d.c)switch(d.method){case "register":g(U.Ul,d);return;case "authenticationrenewal":g(U.Tl,d);return;default:g(U.Sl,d);return}var f;try{l=b.Eb().Ud(v.Pp);n=b.xa().Ud(v.Qj);m=b.Eb().gc(l[0]||0);p=b.xa().gc(n[0]||
0);f=pf.call(b.I,function(b){return a(m.Qa[b.id])&&a(p.Qa[b.id])});b.Od=f[0];b.Ms=f;var k={};f.forEach(function(a){var b=a.location.id;k[b]||(k[b]=[]);k[b].push(a)});var O=[];c(k,function(a,b){var c=b[0].location;c.I=b;O.push(c)});b.Ih=O.sort(function(a,b){return a.Wa-b.Wa});b.Od!=b.I[0]&&h.error("Primary CDN does not have downloadUrls for a/v streams",{CdnId:b.I[0].id})}catch(ba){h.error("Exception while picking initial streams",ba)}m&&p&&f.length?b.xr():g(U.Vl)}}))};b.xr=function(){r?(h.info("Processing post-authorize",
b),r(b,function(a){a.c?b.dj():g(U.Ll,a)})):b.dj()};b.dj=function(){function a(){if(!(0<O)||ba){var c=d.ba(0,!0),h=f.ba(0,!0);c&&h?(m=c,p=h,a=q,b.rr()):0>=O&&(a=q,g(U.Kl,r))}}if(b.state.value==ac){h.info("Downloading initial stream headers",b,{Audio:l.join("|"),Video:n.join("|")});b.na("shs");var c;v.Ag&&(c=b.Ab.filter(function(a){return a.bb==v.Ag||a.ka==v.Ag}))&&c.length&&b.W.set(c[0]);v.ze&&(c=b.Ma.filter(function(a){return a?a.bb==v.ze||a.ka==v.ze:"none"==v.ze.toLowerCase()}))&&c.length&&b.$.set(c[0]);
var d=b.Eb(),f=b.xa(),k=[d[0],f[0]],O=0,ba=!1,r;l.forEach(function(a){a=d.gc(a);0<=k.indexOf(a)||k.push(a)});n.forEach(function(a){a=f.gc(a);0<=k.indexOf(a)||k.push(a)});c=O=k.length;for(var u=0;u<c;u++)h.trace("Downloading header",{Type:k[u].type,Bitrate:k[u].f}),k[u].Ba(function(b){b.c||(r=b);O--;a()});Xa(function(){0<O&&h.debug("Not all initial headers downloaded within the deadline ("+v.Oj+" ms)");ba=!0;a()},v.Oj)}};b.rr=function(){try{if(b.state.value==ac){b.na("sh");h.trace("Initializing primary streams and MediaBuffer");
v.pa||(b.F.set(b.Xc=b.ta.Lc(!0)),b.k.set(b.U=p));b.n=new Tg(b);var a=b.n.$a,c=b.n.yb,d=a.Q.endTime,k=c.Q.endTime;b.duration=Ea(d,k);Bc(d-k)>Fa(a[0].duration,c[0].duration)&&h.error("Large audio and video duration gap",{AudioMS:d,VideoMS:k,MovieId:b.ma,AudioDlId:b.Xc.J,VideoDlId:b.U.J});var l={width:1,height:1};b.xa().forEach(function(a){l.width*l.height<a.width*a.height&&(l.width=a.width,l.height=a.height)});b.ac=l;var O=B(v.Mn[b.ma]);f(O)?(h.info("Overriding bookmark",{From:b.ob,To:O}),b.ob=O):((O=
b.ob)&&O<Kf(v.Nn,b.duration)&&(h.trace("Ignoring bookmark because it's to close to beginning"),b.ob=0),O&&O>b.duration-Kf(v.On,b.duration)&&(h.trace("Ignoring bookmark because it's to close to end"),b.ob=0));b.so()}}catch(n){g(U.Il,{g:P.Nb,C:N(n)})}};b.so=function(){try{b.ha=new Pe(b),b.R=d(b),b.Zb=new Dj(b),v.Qr&&(b.Lh=new Ej(b)),b.Md=new Fj(b),b.Kp=new Hj(b),Pi.forEach(function(a){a(b)}),b.Wq()}catch(a){g(U.Jl,{g:P.Nb,C:N(a)})}}}function Ad(a){function c(){return a.state.value==ac||a.state.value==
db&&a.A.value==Qb}function d(){c()?p||(p=Sb(f,100)):p&&(yb(p),p=h,ta(f))}function f(){var d=ja(),t=g.value,t=t?t.df:0,p,Aa=a.state.value==ac||c()&&199<d-k,q,H,r;Aa&&a.state.value==db?(a.o.value==mc?(H=t,q=!0):(p=d+(a.R.nc()||0),l=l||d,n=n||l+v.Hq+1,b(p)&&(p=Ea(p,n),H=a.R.vd(),H=jb(1E3*qa((d-l)/(p-l),0,H))/1E3)),H<t&&(t-H<v.zr/100?(H=t,m=h):m?d-m>v.yr?(r=!0,m=h):H=t:(m=d,H=t))):m=n=l=h;(d=Aa?{Nk:q,df:H,Ar:r}:null)&&g&&g.value&&d.df===g.value.df||g.set(d)}var g=a.ke,k=0,l,n,m,p;a.state.addListener(function(){d();
f()},1);a.A.addListener(function(a){if(a.oldValue!=Qb||a.newValue!=Qb)k=ja();d()});a.o.addListener(function(){d()});p||(p=Sb(f,100))}function se(a,b){var c=od[0];c==b&&(c=od[1]);c?c.close(function(){se(a,b)}):a&&a(xa)}function Wc(a,b){switch(a){case rh:Oi.push(b);break;case ug:Pi.push(b)}}function gf(a,b,c){return v.pa?new Sc:new re(a,b,c)}function Sd(a){function d(){if(!B){J=Sb(m,1E3);a.Xa.appendChild(u);for(var b=I.length;b--;)I[b].addListener(q);for(b=H.length;b--;)a.addEventListener(H[b],q);B=
!0}l()}function f(){if(B){yb(J);X=Z=h;a.Xa.removeChild(u);for(var b=I.length;b--;)I[b].removeListener(q);for(b=H.length;b--;)a.removeEventListener(H[b],q);p.lb();B=!1}}function g(){B?f():d()}function k(){var d=a.n,f=[],g;f.push({Version:"2.0000.340.011",Esn:$b?$b.lc:"UNKNOWN",UserAgent:Yb.userAgent});try{f.push({MovieId:a.ma,TrackingId:a.za,Xid:a.qa+" ("+od.map(function(a){return a.qa}).join(", ")+")",Position:Ca(a.v.value),Duration:Ca(a.duration),Volume:jb(100*a.volume.value)+"%"+(a.muted.value?
" (Muted)":"")})}catch(l){}try{var t=a.R?a.R.nc():h;f.push({"Player state":ka[a.state.value],"Buffering state":ga[a.o.value]+(b(t)?", ETA:"+Ca(t):""),"Rendering state":Ga[a.A.value]})}catch(p){}try{var n=d.xd(),m=v.Hb,O=a.Yb.value,ba=O&&O.stream,G=a.ub.value,Aa=G&&G.stream,q=a.i.value;f.push({"Playing bitrate (a/v)":ba&&Aa?ba.f+" / "+Aa.f+" ( "+Aa.j.Co+" )":"?","Buffering bitrate (a/v)":a.F.value.f+" / "+a.k.value.f,"Buffer size in Bytes (a/v)":d.pj()+" / "+d.Dj(),"Buffer size in Bytes":n+(m?" ("+
(100*n/m).toFixed(0)+"% of max)":""),"Buffer size in Seconds (a/v)":Ca(d.qb())+" / "+Ca(d.Fa()),"Will Rebuffer":a.ta.Dd(),"Current CDN":q.name+", Id: "+q.id})}catch(H){}try{var r=a.Yb.value.stream,u=r.j,X=r.track,va=a.ub.value.stream.j,Oa=a.ec.value;f.push({"Audio Track":X.bb+", Id: "+X.ka+", Channels: "+X.Ri+", Codec: "+(u&&u.cg),"Video Track":"Codec: "+(va&&va.cg),"Timed Text Track":Oa?Oa.bb+", Profile: "+Oa.gk+", Id: "+Oa.ka:"none"})}catch(J){}try{f.push({Framerate:a.k.value.j.Cg.toFixed(3),"Current Dropped Frames":b(Z)?
Z:"","Total Frames":a.ha.Ce(),"Total Dropped Frames":a.ha.Oc(),"Total Corrupted Frames":a.ha.Ae(),"Total Frame Delay":a.ha.De(),"Main Thread stall/sec":sh?sh.up().join(" "):"DISABLED",VideoDiag:vg(a.Og())})}catch(I){}try{a.n&&(v.pa?f.push({Throughput:a.rf+" kbps"}):f.push({Latency:a.aa.ud()+" ms",Throughput:(7.8125*a.aa.Lg()).toFixed(0)+" KBPS","Bandwidth (normalized)":a.aa.le()+" KBPS","Max Sustainable Video Bitrate":a.aa.Ob()+" KBPS"}))}catch(Ya){}try{c(sa,function(a,b){g=g||{};g[a]=ob.stringify(b)}),
g&&f.push(g)}catch(bb){}return f}function l(){if(W.selectionStart==W.selectionEnd){var a="";k().forEach(function(b){a=a?a+"\n":"";c(b,function(c){a+=c+": "+b[c]+"\n"})});W.style.fontSize=qa(ya(u.clientHeight/60),8,18)+"px";W.value=a}}function m(){var b=a.ha.Oc();Z=b-X;X=b;q()}function q(){p.lb(l)}function r(a){a.ctrlKey&&a.altKey&&a.shiftKey&&(68==a.keyCode||81==a.keyCode)&&g()}var p=new Rb(1E3),u=Ha("DIV","position:absolute;left:10px;top:10px;right:10px;bottom:10px",h,{"class":"player-info"}),W=
Ha("TEXTAREA","position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;padding:10px;background-color:rgba(0,0,0,0.4);color:#fff;font-size:12px;font-family:Arial;overflow:auto"),w=Ha("DIV","position:absolute;top:2px;right:2px"),B,I=[a.v,a.i,a.Yb,a.ub,a.F,a.k,a.ec,a.state,a.o,a.A,a.volume,a.muted],H=[Yd,ng],sa={},J,Z,X;this.ts=function(a){sa.DFR=a};var ka={};ka[uf]="Not Loaded";ka[ac]="Loading";ka[db]="Normal";ka[qh]="Closing";ka[pg]="Closed";var ga={};ga[nc]="Normal";ga[bc]="Pre-buffering";
ga[mc]="Network stalled";var Ga={};Ga[Qb]="Waiting for decoder";Ga[$c]="Playing";Ga[sf]="Paused";Ga[Oc]="Media ended";W.setAttribute("readonly","readonly");u.appendChild(W);u.appendChild(w);var Oa=Ha("BUTTON",null,"X");Oa.addEventListener("click",f,!1);w.appendChild(Oa);gb.addListener(Cd,r);a.addEventListener(Ab,function(){gb.removeListener(Cd,r);f()});n(this,{toggle:g,show:d,Sg:f,tp:k})}function hf(a){function b(){J||(k(),a.Xa.appendChild(r),J=!0)}function c(){J&&(a.Xa.removeChild(r),J=!1)}function d(){J?
c():b()}function f(){var b=[],c={ranges:[]};a.Aa().forEach(function(a){c.profile||(c.profile=a.oo);c.ranges.push({min:a.f,max:a.f})});b.push(c);a.Jh.vs(b);a.n.reset();a.Jh.seek(a.v.value)}function g(){var b=a.xa().filter(function(a){return Z[a.f]});b.length||b.push(a.U);return b}function k(){var b=a.W.value,c=a.bc.value,d=a.I;b&&(d=d.slice(),d.sort(function(a,b){return a.Wa-b.Wa}),p(I,b.oa.map(function(b){return{value:b.f,caption:b.f,selected:b==a.F.value}})));c&&(p(H,c.oa.map(function(b){var c=a.Ue.sc(b),
d=b=b.f;c&&(d+=" ("+c.join("|")+")");return{value:b,caption:d,selected:a.Aa!=g?!c:Z[b]}})),H.removeAttribute("disabled"));d&&(p(sa,d.map(function(b){return{value:b.id,caption:"["+b.id+"] "+b.name,selected:b==a.i.value}})),sa.removeAttribute("disabled"))}function l(){J&&k()}function m(a){var b=Ha("DIV","display:inline-block;vertical-align:top;margin:5px;");a=Ha("DIV",h,a);var c=Ha("select","width:120px;height:180px",h,{disabled:"disabled",multiple:"multiple"});b.appendChild(a);b.appendChild(c);u.appendChild(b);
return c}function p(a,b){a.innerHTML="";b.forEach(function(b){var c={title:b.caption};b.selected&&(c.selected="selected");c=Ha("option",h,b.caption,c);c.value=b.value;a.appendChild(c)})}function q(a){a.ctrlKey&&a.altKey&&a.shiftKey&&83==a.keyCode&&d()}var r=Ha("DIV","position:absolute;left:0;top:50%;right:0;bottom:0;text-align:center;color:#040;font-size:11px;font-family:monospace",h,{"class":"player-streams"}),u=Ha("DIV","display:inline-block;background-color:rgba(255,255,255,0.86);border:3px solid #fff;padding:5px;margin-top:-90px"),
w=Ha("DIV","width:100%;text-align:center"),I=m("Audio Bitrate"),H=m("Video Bitrate"),sa=m("CDN"),J,Z={};r.appendChild(u);u.appendChild(w);var X=Ha("BUTTON",h,"Override");X.addEventListener("click",function(){Z={};for(var b=H.options,d=b.length;d--;){var h=b[d];h.selected&&(Z[h.value]=1)}a.Aa=g;a.n.pe();v.pa&&(a.R.ag(),f());if(b=a.I){var k=sa.value;(b=b.filter(function(a){return a.id==k})[0])&&b!=a.i.value&&(b.fc={testreason:"streammanager",selreason:"userselection"},a.i.set(b))}c()},!1);w.appendChild(X);
X=Ha("BUTTON",h,"Reset");X.addEventListener("click",function(){delete a.Aa;a.n.pe();v.pa&&(a.R.ag(),f());c()},!1);w.appendChild(X);gb.addListener(Cd,q);a.addEventListener(Ab,function(){gb.removeListener(Cd,q)});a.i.addListener(l);a.W.addListener(l);a.bc.addListener(l);n(this,{toggle:d,show:b,Sg:c})}function dg(){function a(){k=!1;for(var b=c.length,h;b--;)h=c[b],g[h]&&(g[h]=!1,f.B(h+"changed",{getModel:d[h]}))}function b(c){g[c]=!0;k||(k=!0,ta(a))}var c=[],d={},f=new rb,g={},k=!1;return{register:function(a,
b){c.indexOf(a);d[a]=b;c.push(a)},hh:b,xp:function(a){return(a=d[a])?a():h},addEventListener:function(a,c){f.addListener(a,c);d[a]&&b(a)},removeEventListener:function(a,b){f.removeListener(a,b)}}}function Rg(c,d,f,g,h,k,l,m){function r(a){if(!(0<=oc(a,"ftyp").Ui.indexOf("dash")))throw new Za("ftyp is not dash compatable");for(var c=af(a),d=oc(th(c),"moov"),f=[],g=d.children.filter(function(a){return"trak"===a.type}),h=0;h<g.length;h++){var k=g[h].rb("mdia/minf/stbl/stsd/mp4a|enca|ec-3|avc1|encv|hvcC");
W(d,k);f.push(k)}k=f[0];a=oc(a,"sidx");f=k.type;c={stream:w,cg:f,pg:"encv"==f||"enca"==f,Np:c,Hd:d};d=0;switch(w.type){case zb:d=v.Uf;break;case cb:d=v.ot;try{var y=k.rb("4E657466-6C69-7846-7261-6D6552617465"),l=y.ar/y.Bo;b(l,1)&&(c.Cg=l)}catch(t){}y=k.rb("pasp");l=k.width;f=k.height;y.xf<y.Ge?l=ya(l*y.Ge/y.xf):f=ya(f*y.xf/y.Ge);l==w.width&&f==w.height||B.error("Stream resolution does not match",{Nccp:w.width+"x"+w.height,Header:l+"x"+f},H);c.Co="res: "+k.width+"x"+k.height+", par: "+y.Ge+"x"+y.xf}c.t=
me(w,d,a);return c}function p(a,b){B.trace("Downloading header",{Cdn:b.id},H);a=a||q;var g={responseType:Ac,Xb:eg,url:w.Qa[b.id],i:b,track:d,stream:w,offset:0,length:I||u(m),Cb:f+"-"+h+"-hdr",zc:!0};c.ua.N(g,function(c){var d;if(c.c){try{var f=c.content;if(!I){var g=oc(f,Pj);I=g.dr+g.cp;if(0<I&&!(I<=f.byteLength)){B.warn("Header size underestimated, retrying",{Estimated:f.byteLength,Actual:I},H);p(a,b);return}}var h=r(f);h&&(B.trace("Header parsed",{Chunks:h.t.length},H),w.j=h);v.pa&&(xa.Ka=c.parsed?
c.Ka:c.content,xa.Ka=xa.Ka.slice(0,I));d=xa}catch(k){B.error("Exception while parsing header",k,H),d={c:!1,g:P.Af}}a(d)}else B.warn("Unable to download header",eb(c),H),a(c)})}function u(a){var b;if(b=a)b=a?-1<Oj.indexOf(a):void 0;return b?md(Lk+c.ug*Mk):md(Nk+c.ug*Ok)}function W(a,b){var d=v.Jp;d.length&&a.children.forEach(function(a){"pssh"==a.type&&0<=d.indexOf(a.rd)&&a.Ka&&a.Ka.set([102,114,101,101],4)});if(v.fl&&f==zb){var g=a.rb("mvex/trex");g.kg.Ak&&(B.trace("Applying sampleIsDifferenceSample workaround",
H,{Box:"trex"}),Gb(g))}if(v.vt&&"playready"==fa()&&"encv"==b.type){var h=function(){var a=c.U.j.Hd.children.filter(function(a){return"pssh"==a.type&&"9A04F079-9840-4286-AB92-E65BE0885F95"==a.rd})[0],d;try{d=zc(ib(a.data.subarray(10,a.data.length-10),"KID"))}catch(f){B.error("Exception parsing KID in PSSH",f)}d&&16==d.length&&b.children.map(function(a){try{if("sinf"==a.type)return a.rb("schi/tenc|8974DBCE-7BE7-4C51-84F9-7148F9882554")}catch(b){B.error("Exception finding TENC box",b)}}).filter(ia).forEach(function(a){var b=
a.Vj;if(b&&Id(d,b)){var c=function(a,c){var d=b[a];b[a]=b[c];b[c]=d};B.trace("Applying KID byte order workaround",H,{Box:a.type});c(0,3);c(1,2);c(4,5);c(6,7)}})};if(c.U)h();else{var k=function(a){a.newValue==db&&(c.state.removeListener(k),h())};c.state.addListener(k)}}}var w=this,B=new c.log.r("CadmiumMediaStream"),I,H={Type:f,Bitrate:h,DownloadableId:g};n(w,{track:d,type:f,J:g,f:h,oo:m,size:k,Qa:l,j:null,mj:u,Ba:Kb(function(b){function d(a){if(a.c)b(a);else{var c,h;for(h=0;h<g.length;h++)if(c=g[h],
f[c.id]>v.Dp)c=null;else break;c?(f[c.id]=(f[c.id]||0)+1,p(d,c)):b(a)}}w.Ie=!0;var f={},g=pf.call(c.I,function(b){return a(l[b.id])});d({c:!1})}),Ga:H,toJSON:function(){return H},Xp:function(){var a=!1,b;f===cb?b=c.Aa():f===zb&&(b=c.Eb());-1!==b.indexOf(this)&&(a=!0);return a}})}function eg(a){var b=new ab(a),b=th(b);b.byteLength=a.byteLength;return b}function af(a){var b,c,d=v.Op,f=[],g=d.length,h=0,k=0;d.indexOf("moov");for(b=0;b<g;b++)c=oc(a,d[b]).Ka,f.push(c),h+=c.length;a=new ab(h);for(b=0;b<
g;b++)c=f[b],a.set(c,k,c.length),k+=c.length;return a}function me(a,b,c){var d,f,g=[],h=c.sf,k=c.Mr,l=k.length;b=jb(b*h/1E3);var p,m=c.Ka,n=m.byteOffset+m.byteLength+c.bp,v=0;c=0;d=n;for(var q=v,m=0;m<l;m++)p=k[m],v+=p.duration,p=n+p.size,n=v-q,m<l-1&&Bc(n-b)>Bc(n+k[m+1].duration-b)||(d={index:c++,stream:a,offset:d,length:p-d,startTime:ya(1E3*q/h),duration:ya(1E3*(v-q)/h),all:g,next:null,Ja:null},d.Ga={Type:d.stream.type,Bitrate:d.stream.f,ChunkNum:d.index,StartTime:Ca(d.startTime),Duration:Ca(d.duration)},
f&&(d.Ja=f,f.next=d,Bc(f.duration-(d.startTime-f.startTime)),f.duration=d.startTime-f.startTime),g.push(d),f=d,q=v,d=p),n=p;return g}function jc(a,b,c){if(a==zb)return b;if(a==cb)return c}function rd(a){return!!a.j}function Td(a){return!a.j}function Sg(a){return a.map(function(a){return a.f})}function Tg(a){function b(d,f){var g=d.length,k=M-r(f);if(k>g)return!0;var l=a.v.value,p,m,n;n=l-N;p=Ga.first;for(m=x.first;p||m;)if(p&&p.endTime>=n&&(p=h),m&&m.endTime>=n&&(m=h),p&&(!m||p.endTime<m.endTime)?
(k+=c(p),p=p.next):m&&(k+=c(m),m=m.next),k>g)return!0;p=Ga.Q;for(m=x.Q;p||m;)if(p&&p.startTime<=d.startTime&&(p=h),m&&m.startTime<=d.startTime&&(m=h),p&&(!m||p.startTime>m.startTime)?(k+=c(p),p=p.Ja):m&&(k+=c(m),m=m.Ja),k>g)return!0;n=l-ha*(d.startTime-l);p=Ga.first;for(m=x.first;p||m;)if(p&&p.endTime>=n&&(p=h),m&&m.endTime>=n&&(m=h),p&&(!m||p.endTime<m.endTime)?(k+=c(p),p=p.next):m&&(k+=c(m),m=m.next),k>g)return!0}function c(a){var b=a.media;a.media=null;a.qc=h;a.va(ad);return b?b.length:0}function d(){return Fa(l(),
p())}function f(){return M?v.Hb?qa((m()+q())/v.Hb,0,1):0:qa(d()/v.Gd,0,1)}function g(){return E?B(Ga):J(Ga)}function k(){return E?B(x):J(x)}function l(){var b=a.v.value,c=qd(b,Ga);return c?Ea(0,c.endTime-b):0}function m(){return hd(a.v.value,Ga)}function p(){var b=a.v.value,c=qd(b,x);return c?Ea(0,c.endTime-b):0}function q(){return hd(a.v.value,x)}function r(b){for(var c=La.length,d,f,g=0,h=a.k.value.j.t,k=a.F.value.j.t;c--;)d=La[c],(f=d.media)?g+=f.length:b&&d.se&Pk&&(d.type===cb?g+=h[d.index].length:
d.type==zb&&(g+=k[d.index].length));return g}function u(a){a=a.first;for(var b=[];a;)a.media&&a.qc&&b.push(a.qc.Lv()),a=a.next;return b}function w(){return{AudioBufferLength:Ca(l()),VideoBufferLength:Ca(p())}}function I(b){for(var d=a.v.value,f,g,h=b.first,k=0;h;)h.media&&(f=f||h,g=h,k+=h.duration),h=h.next;d=Ea(d-N,0);for(d=b.fb(d).index;k>na&&f&&f.index<d;)f.media&&(c(f),k-=f.duration),f=f.next;for(b=b.fb((f?f.endTime:a.v.value)+na).index;k>na&&g&&g.index>b;)g.media&&(c(g),k-=g.duration),g=g.Ja}
function H(){I(Ga);I(x);if(v.pa){var b={};b[Qk]=u(Ga);b[Rk]=u(x);a.Jh.Er(b,a.v.value)}}function B(b){for(b=b.fb(a.v.value);b&&(b.media||b.se!==ad);b=b.next);return b}function J(b){for(b=b.fb(a.v.value);b&&b.media;b=b.next);return b}function Z(){a.fireEvent(Yd);ga.hh("buffer")}function X(b,d){ka.trace("Disgarding media due to a track change");for(var f=d.first;f;)f.media&&f.media.stream.track!=b&&c(f),f=f.next;a.fireEvent(Qi);Z()}var ka=new a.log.r("MediaBuffer"),ga=a.lg,Ga=Fd(a.Xc,145152E5),Oa=a.U,
A=a.ta,x=Fd(a.U,v.jo?Ga.Q.endTime+ya(1E3/(Oa.j.Cg||60)):h),La=Ga.concat(x),N=v.Fi,na=v.Gd,M=v.Hb,ha=v.Ln/100,F=na-N,E="parallel"===v.dg,Oa=new Ic(function(){var a;if(!(a=.9<=f())){a=g();var b=k();a=!(a||b)}return a}),D=a.U.j.t;D.length!=x.length&&(D=D[D.length-1],ka.error("Clipping video chunks to be less than audio",{FromEndTime:Ca(D.startTime+D.duration),ToEndTime:Ca(x.Q.endTime),AudioEndTime:Ca(Ga.Q.endTime)}));if(!(0<=N&&na>Ga.first.duration&&na>=2*N))throw new Za("bad buffer size");a.W.addListener(function(a){X(a.newValue,
Ga)});a.bc.addListener(function(a){X(a.newValue,x)});a.addEventListener(qg,function(){var a;for(a=Ga.first;a;)a.media=null,a.qc=null,a=a.next;for(a=x.first;a;)a.media=null,a.qc=null,a=a.next});n(this,{$a:Ga,yb:x,Fb:g,Tb:k,sb:function(){var b=a.v.value,c=g(),d=k();c&&c.startTime-b>F&&(c=null);d&&d.startTime-b>F&&(d=null);if(d)if(c){if(d.startTime<=c.startTime&&c.startTime>b)return d}else return d;return c},vf:M?b:z,Ld:function(b,c,d,f,g,k,l){for(var t=0,p=0;p<b.length;p++){var m=b[p],n=c[p];if(d.type==
zb&&d.track!=a.W.value||d.type==cb&&d.track!=a.bc.value){ka.trace("Rejecting received chunk because it doesn't match most recent track",m,d);return}if(m.media&&m.media.stream.f>=d.f){if(m.media.stream.Xp()){m.va(Ri);ka.warn("Rejecting received chunk because it is lower bitrate than existing chunk",m,d);return}m.media=null;v.pa&&(m.qc=h)}var O=1<b.length?new ab(new ab(f.buffer,t,n.length)):f,t=t+n.length;m.media={stream:d,Tf:O,length:O.length,i:g};m.va(Ri);v.pa&&l&&(m.qc=l,l.Eu=!0);H();jc(d.type,a.Fc,
a.Ra).set({G:m,stream:d,i:g,ej:k});ka.trace("Received chunk",m,{CdnId:g.id},w())}Z()},Sq:function(a){a.Cd=!0;v.aj&&(a=a.media)&&(a.Tf=null)},Vq:function(a){a.Cd=h;v.aj&&c(a)},Uq:function(){for(var a=La.length,b,d;a--;)b=La[a],b.Cd=h,(d=b.media)&&!d.Tf&&c(b)},pe:function(){for(var b=a.Aa(),d=x.first,f;d;)d.media&&!d.Cd&&0>b.indexOf(d.media.stream)&&(c(d),f=!0),d=d.next;f&&(ka.trace("Disgarding media based on stream filters"),Z())},Eo:function(){for(var b=a.Aa(),d=x.first,f,g,h,k=A.Ig(),k=Ea(k,8008);d;)d.media&&
(d.Cd&&(g=d.index,h=g+k/d.duration),!(d.index>=g&&d.index<=h)&&0>b.indexOf(d.media.stream)&&(c(d),f=!0)),d=d.next;f&&(ka.trace("Discarding media based on stream filters"),Z())},np:function(){var b=a.v.value,c=qd(b,Ga),d=qd(b,x),f;c&&d&&(f=Fa(c.endTime,d.endTime));return kb(f,b)},Mc:d,wj:f,qb:l,pj:m,Fa:p,Dj:q,Iv:u,xd:r,Jv:function(){var b=a.v.value,c=qd(b,x);return c?c.endTime:b},Ee:w,Xg:Oa.get,compact:H,reset:function(){var a;for(a=Ga.first;a;)a.media&&(c(a),a.va(ad),a.Cd=h,a.qc=h),a=a.next;for(a=
x.first;a;)a.media&&c(a),a=a.next},Pv:function(b){var c=a.v.value;return(b=b.G)&&b.startTime-c>F?!1:!0}})}function qd(a,b){var c=b.fb(a);if(c.media){for(;c.next&&c.next.media;)c=c.next;return c}}function hd(a,b){var c=b.fb(a),d=0;for(c&&c.media&&(d+=ya(qa((a-c.startTime)/c.duration,0,1)*c.media.length),c=c.next);c&&c.media;)d+=c.media.length,c=c.next;return d}function Fd(a,b){var c=a.j.t,d,f=[],g,h,k=c.length;if(1>=k)throw new Za("few chunks");for(var l=0;l<k;l++){d=c[l];g=d.startTime;d=d.duration;
var p=g+d;if(p>b)break;g={type:a.type,index:l,startTime:g,duration:d,endTime:p,se:ad,media:null,all:f,Ja:null,next:null,va:function(a){this.se=a}};g.Ga={Type:g.type,"Chunk index":g.index,StartTime:Ca(g.startTime),EndTime:Ca(g.endTime)};h&&(h.next=g,g.Ja=h);h=g;f.push(g)}f.fb=Ug;f.first=f[0];f.Q=h;f.pn=2<=f.length?(f.length-1)/(f.Q.startTime-f.first.startTime):1;return f}function Ug(a){for(var b=this[qa(ya(a*this.pn),0,this.length-1)];b.startTime>a&&b.Ja;b=b.Ja);for(;b.endTime<a&&b.next;b=b.next);
return b}function Ce(a,b,c){function d(a){if(a.c){var b=a.L;u[b.stream.type+"$"+b.i.id]=a.D}w--;f()}function f(){if(!(0<w)||I){var a,b,c,d,k=[],y;for(y=0;y<l.length;y++)a=l[y],c=u[zb+"$"+a.id],d=u[cb+"$"+a.id],c&&d&&(c=Ea(c.O-c.requestTime,d.O-d.requestTime),k.push({i:a,Fd:c}),b=b===h?c:Fa(c,b));if(y=k.length){for(;y--&&1<k.length;)a=k[y],a.Fd>b+v.os&&k.splice(y,1);g(k[0].i)}else 0>=w&&g()}}function g(a){a&&(a.fc={testreason:b,selreason:"relativelatency"});g=f=q;c({c:!!a,mb:a})}var k=a.ua,l=a.I,m=
a.F.value,p=a.k.value,n=a.n;a=n.Fb();for(var n=n.Fb(),r,u={},w=0,I,H,B=0;B<l.length;B++)r=l[B],H=te(r,m,a),r=te(r,p,n),H&&r&&(w+=2,k.N(H,d),k.N(r,d));Xa(function(){I=!0;f()},v.ps)}function te(a,b,c){if(b.Qa[a.id])return{responseType:Ac,url:b.Qa[a.id],Xb:jf,offset:b.j.t[c?c.index:0].offset,length:8,i:a,track:b.track,stream:b,Cb:b.type+"-"+b.f+"-ping",zc:!0}}function jf(a){a=new ab(a);a=new Yc(a);var b=a.l();if(8>b||b>Sk)throw new Za("cdnping-badsize");if("moof"!=a.Lb(4))throw new Za("cdnping-badtype");
return!0}function Zh(a,b,d){function f(b,c){var d=H[b.da].I,k;c.type==cb?(k=(a.o.value==nc?u.Nc():u.gb()).k,k.j||(k=a.U)):k=a.F.value;for(var l=0;l<d.length;l++){var t=d[l];if(b.sa===l){var p=a.n.Fa(),p=Be(c,k,t,v.ie,p);q.trace("Downloading",{CdnId:t.id},c,k,{Count:p.wa.length,Offset:p.offset,Length:p.length});r.N(p,g)}else p=te(t,k,c),q.trace("Pinging",{CdnId:t.id},c,k),r.N(p,h)}}function g(a){var b=a.L;a.c?w.Ld(b.wa,b.Qc,b.stream,a.content,b.i,a.D):b.wa&&b.wa.forEach(function(a){a.media=null;a.va(ad)});
k(a);l()}function h(a){k(a)}function k(a){var b=a.L.i,c=b.id,d=b.location.id;a.c?(J[d]||(J[d]={}),J[d][c]={i:b,D:a.D}):J[d]&&J[d][c]&&delete J[d][c]}function l(){var a,c=H[B.da];a=c.id;c=c.I[B.sa].id;a=J[a]&&J[a][c]?p(J[a][c].D):void 0;if(a>v.mf)a=H[B.da].I[B.sa],a.fc={testreason:b,selreason:"fastselection",fastselthreshold:v.mf},d({c:!0,mb:a});else{if(c=a=w.sb()){var c=B,g=H[c.da].id,h=H[c.da].I[c.sa].id;J[g]&&J[g][h]?c=m(c):(c.sa<H[c.da].I.length-1?(c.sa++,g=!0):g=void 0,c=g||m(c))}c?f(B,a):(a=
n(J),d({c:!!a,mb:a}))}}function m(a){if(a.da<H.length-1)return a.da++,a.sa=0,!0}function p(a){if(a)return 7.8125*a.X/(a.M-a.requestTime)}function n(a){var d,f=0;c(a,function(a,b){b&&c(b,function(a,b){var c=p(b.D)*b.i.location.weight;c>f&&(f=c,d=b.i)})});d&&(d.fc={testreason:b,selreason:"maxweightedbw"});return d}var q=new a.log.r("CdnSelBw"),r=a.ua,u=a.ta,I=a.aa,H=a.Ih,w=a.n,J={},B={da:0,sa:0},X=w.sb();X?f(B,X):d({c:!0,mb:a.i.value||a.Od});return{hb:function(){return I.ga(v.ie)*(H.length-B.da)}}}
function Fg(a,b,d,f,g){function h(b,c){var g=J[b.da].I,p;c.type==zb&&(p=a.F.value);for(var m=0;m<g.length;m++){var n=g[m];c.type==cb&&((p=d.tj(n.location.id))?(p=f.ca(p+1,!0),X.push(n.location.id)):(p=H.gb(!0),p=p.k,p.j||(p=a.U)));if(b.sa===m){var O=a.n.Fa(),O=Be(c,p,n,v.ie,O);u.trace("Downloading",{CdnId:n.id},c,p,{Count:O.wa.length,Offset:O.offset,Length:O.length});I.N(O,k)}else O=te(n,p,c),u.trace("Pinging",{CdnId:n.id},c,p),I.N(O,l)}}function k(a){var b=a.L;a.c?B.Ld(b.wa,b.Qc,b.stream,a.content,
b.i,a.D):b.wa&&b.wa.forEach(function(a){a.media=null;a.va(ad)});m(a);p()}function l(a){m(a)}function m(a){var b=a.L.i,c=b.id,d=b.location.id;a.c?(ka[d]||(ka[d]={}),ka[d][c]={i:b,D:a.D}):ka[d]&&ka[d][c]&&delete ka[d][c]}function p(){var c,d=J[ga.da];c=d.id;d=d.I[ga.sa].id;c=ka[c]&&ka[c][d]?q(ka[c][d].D):void 0;if(c>v.mf)c=J[ga.da].I[ga.sa],c.fc={testreason:b,selreason:"fastselection",fastselthreshold:v.mf},g({c:!0,mb:c,nb:-1<X.indexOf(a.i.value)});else{if(d=c=B.sb()){var d=ga,f=J[d.da].id,k=J[d.da].I[d.sa].id;
ka[f]&&ka[f][k]?d=n(d):(d.sa<J[d.da].I.length-1?(d.sa++,f=!0):f=void 0,d=f||n(d))}d?h(ga,c):(c=r(ka),g({c:!!c,mb:c,nb:-1<X.indexOf(a.i.value)}))}}function n(a){if(a.da<J.length-1)return a.da++,a.sa=0,!0}function q(a){if(a)return 7.8125*a.X/(a.M-a.requestTime)}function r(a){var d,f=0;c(a,function(a,b){b&&c(b,function(a,b){var c=q(b.D)*b.i.location.weight;c>f&&(f=c,d=b.i)})});d&&(d.fc={testreason:b,selreason:"maxweightedbw"});return d}var u=new a.log.r("CdnSelCarrera"),I=a.ua,H=a.ta,w=a.aa,J=a.Ih,B=
a.n,X=[],ka={},ga={da:0,sa:0},A=B.sb();A?h(ga,A):g({c:!0,mb:a.i.value||a.Od,nb:-1<X.indexOf(a.i.value)});return{hb:function(){return w.ga(v.ie)*(J.length-ga.da)}}}function Gg(a){function c(){ld.removeEventListener(ze,f);I&&I.response&&I.response.abort()}function d(){var a=w.sb();I&&I.response&&a!=I.G&&I.response.abort();f()}function f(){if(a.state.value==db&&a.A.value!=Oc)if(a.ld&&a.ld<=ja())a.o.value!=nc&&a.Pa(new Hb(U.yf));else if(a.o.value==bc&&(pd()||a.o.set(mc)),a.o.value==mc&&pd()&&a.o.set(bc),
a.F.value.j)if(a.k.value.j)if(A)k(A),A=h;else{var b=w.sb(),c;a.o.value!=nc&&(c=r.gb(),0>=c.jb&&0>=c.kb&&g("Heuristics"),b||g("Full"));if(!(I||H&&H.stream.type==cb&&H.stream.f>a.k.value.f)){if(b){a.o.value==nc&&(c=r.Nc());var d=b.index,t;if(b.type==cb)t=c.k,t.j&&t.j.t[d]||(n.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:t.f,BitrateNew:a.U.f}),t=a.U),t!=a.k.value&&(n.trace("Stream switch",{BitraetOld:a.k.value.f,BitrateNew:t.f}),a.k.set(t));else if(b.type==
zb)t=a.F.value;else return;var O=t.j.t[d];w.vf(O)||(t.type==zb&&w.qb()<v.Va?n.trace("Ignoring max buffer bytes",b,t):t.type==cb&&w.Fa()<v.Va?(t=a.xa().ba(0,!0),O=t.j.t[d],n.trace("Ignoring max buffer bytes, and reverting to lowest video stream",b,t)):(g("NoRoom"),O=h));if(O){if(a.o.value==bc&&c){for(var d=c.jb,q=c.kb,Aa=w.Fb(),B=w.Tb(),ga=a.F.value.j.t,sa=a.k.value.j.t,x=0;0<d&&Aa;)Aa.media||Aa==b||(x+=u.ga(ga[Aa.index].length)),d-=Aa.duration,Aa=Aa.next;for(;0<q&&B;)B.media||B==b||(x+=u.ga(sa[B.index].length)),
q-=B.duration,B=B.next;ka=x;Z=u.ud();X=Ea(u.ga(O.length)-Z,1)}else X=Z=ka=h;if(J>v.Dk){k("dlfail");return}O=a.i.value;d=a.n.Fa();d=Be(b,t,O,h,d);n.trace("Downloading chunk",b,t,{Offset:d.offset,Length:d.length});b.va(wf);jc(t.type,a.te,a.ue).set({G:b,stream:t,i:O});I={type:uh,stream:t,G:b,response:p.N(d,m)}}}!H&&c&&c.Ua&&l(c.Ua)}}else l(a.k.value);else l(a.F.value)}function g(b){a.o.value!=nc&&(n.trace("Buffering complete",{Cause:b},w),a.o.set(nc),ga||(ga=!0,a.na("pb")))}function k(b){n.trace("Selecting a CDN");
I={type:Si};switch(v.Ek){case "bandwidth":b=Zh(a,b,m);I.hb=b&&b.hb;break;default:Ce(a,b,m)}}function l(a){function b(){H==c&&(H=null);c=null;f()}if(!(H&&H.stream==a||a.Ie)){n.trace("Downloading header",a);var c={stream:a,Ds:ja()};H=c;a.Ba(b);Xa(b,v.Fj)}}function m(b){var c=I;I=null;a.state.value==db&&(c.type!=Ti&&(b.c?(J=0,c.type==uh?(c=b.L,a.o.value==mc&&a.o.set(bc),w.Ld(c.wa,c.Qc,c.stream,b.content,c.i,b.D)):a.i.set(b.mb)):b.g!=P.Za&&(I={type:Ti},Xa(m,sa[J]),++J>=sa.length&&(a.o.value==bc&&a.o.set(mc),
J=sa.length-1))),f())}var n=new a.log.r("MediaDownloader"),p=a.ua,r=a.ta,u=a.aa,w=a.n,B=new Rb(500),I,H,sa=v.eb,J=0,Z,X,ka,ga,A="startup";(function(){ta(f);a.addEventListener(vf,function(){ta(f)});a.addEventListener(tf,function(b){b.Ac==vh&&a.o.set(bc);ta(f)});a.addEventListener(Xd,function(){var b;a.F.value.j&&a.k.value.j&&(b=r.gb());b&&0>=b.jb&&0>=b.kb?n.trace("Repositioned without rebuffer",w):(n.trace("Repositioned, buffering",w),a.o.set(bc));B.lb(d)});ld.addEventListener(ze,f);a.addEventListener(Ab,
c)})();this.nc=function(){var c;if(a.o.value==bc&&I){var d;try{if(I.type==uh){var f=I.response,g=f.D;if(b(g.O))d=(1-(g.X||0)/f.L.length)*X;else{var h=ja()-g.requestTime;d=Ea(Z-h,0)+X}}}catch(k){}c=(d||0)+(ka||0);(d=I.hb&&I.hb())&&(c=Ea(d,c))}return c};this.Gg=q;this.vd=function(){return.99}}function Be(a,b,c,d,f){var g=b.j.t,h=g[a.index].offset,k=0,l=[],p=[];do{var m=g[a.index],k=k+m.length;l.push(a);p.push(m);a=a.next}while(k<d&&a);a=v.Pb;ia(f)&&v.mt&&!v.Hb&&(a=Pa.max(v.Iq,Pa.min(f/v.mo,v.Pb+f/v.Gd*
v.no)));return{responseType:Ac,Xb:lb,url:b.Qa[c.id],offset:h,length:k,i:c,track:b.track,stream:b,wa:l,Qc:p,Cb:b.type+"-"+b.f+"-"+l.map(function(a){return a.index}).join("+"),zc:!0,Pb:a}}function Hg(){var a;a=["avc1.640028","hev1.2.6.L153.B0","dvhe.01000000"].filter(function(a){a=ed('{0}/mp4;codecs="{1}"',"video",a);return Dd.isTypeSupported(a)});return ed('{0}/mp4;codecs="{1}"',"video",a.join(", "))}function Ig(a){function b(){pd()&&n&&n.Xd()}function c(a,b){h.trace(ed("transitioning from {0} to {1}, reason: {2}",
n&&n.getName()||"null",a.getName(),b));n&&n.vg();n=a;n.Hc();d()}function d(){w.lb(f)}function f(){a.state.value==db&&(I(),n.update())}function g(){var a=v.jr;k.wj()>a&&(B.Y.zh(l),I=q)}var h=new a.log.r("ParallelMediaDownloader"),k=a.n,l=v.Zj,p,n,r,w=new Rb(Tk),B={R:this,Y:{},Rb:new Y(v.Dk)},I=g;a.cb=B;B.Y="subchunk"===v.ir?new D(l,l,a):new u(l,a);B.Bc="startup";(function(){function f(){d()}p=new m(a,B);"carrera"==v.Wg?c(p.Mp,"using carrera for initial playback."):c(p.Zf,"select first CDN before playback.");
r=Sb(d,500);B.Y.addEventListener(wg,f);a.addEventListener(Ab,function(){yb(r);w.Ec();ld.removeEventListener(ze,b);B.Y.removeEventListener(wg,f);B.Y.yc()});d();a.addEventListener(vf,function(){d()});a.addEventListener(tf,function(a){a.Ac==vh&&(B.Y.zh(1),I=g,n.er(),d())});a.addEventListener(Xd,function(){n.mk();d()});a.addEventListener(Ni,function(){n.Xd()});ld.addEventListener(ze,b)})();this.Oa=c;this.nc=function(){return n.nc()};this.ag=function(a){B.Y.od();B.Y.yc(a)};this.Gg=function(){return n&&
n.getName()||"null"};this.vd=function(){return n.vd()}}function Ed(a){var b=a.cb,c,d=b.Y,f=b.R,g=b.pb;this.getName=function(){return"BaseState"};this.Rc=function(){this.log=new a.log.r(this.getName())};this.Rc();this.vd=function(){return.99};this.Xd=this.update=this.vg=this.Hc=q;this.er=function(){a.o.set(bc);f.Oa(g.Lr,"buffer underrun")};this.mk=function(){f.Oa(g.uh,"user seek")};this.oj=function(){return c};this.nc=function(){return 0};this.vh=function(){return b.Rb.Kk(a.i.value)?(b.Bc="dlfail",
b.Db=0,f.Oa(g.Zf,"download failures"),!0):!1};this.ng=function(a,b){d.Gc({G:a,gf:b})};this.Ba=function(a){function b(){c==d&&(c=null);d=null}if(!(c&&c.stream==a||a.Ie)){this.log.trace("Downloading header",a);var d={stream:a,Ds:ja()};c=d;a.Ba(b);Xa(b,v.Fj)}};this.Dg=function(b,c){if(b.type===cb)var d=c.k;else if(b.type==zb)d=a.F.value;else return h;return d.j.t[b.index]}}function Q(a){function b(){f.Eh()&&(h.od(),h.yc())}var c=new Ed(a),d=a.cb,f=a.ta,g=a.n,h=d.Y,k=new Rb(1E3);n(this,c);d.Bc="startup";
this.getName=function(){return"PlayingState"};this.Hc=function(){d.Rb.Ti();a.o.set(nc);v.fp&&a.A.set($c);d.Y.vb(!0)};this.update=function(){if(a.state.value==db&&a.A.value!=Oc)if(k.lb(b),a.ld&&a.ld<=ja())a.o.value!=nc&&a.Pa(new Hb(U.yf));else if(!a.F.value.j)this.Ba(a.F.value);else if(!a.k.value.j)this.Ba(a.k.value);else if(!this.vh()){var c=g.sb(),h=this.oj();if(!(h&&h.stream.type==cb&&h.stream.f>a.k.value.f)&&c&&d.Y.Xe()){var l=f.Nc(),t=this.Dg(c,l);g.vf(t,!0)&&a.o.value==nc&&this.ng(c,l);!h&&l&&
l.Ua&&this.Ba(l.Ua)}}}}function dc(a){function b(c){r.log.trace("in _exitBufferingState()");a.o.value!=nc&&(r.log.trace("Buffering complete",{Cause:c},h),p||(p=!0,a.na("pb")));f.Oa(m.cf,"exiting buffering: "+c)}var c=new Ed(a),d=a.cb,f=d.R,g=d.Y,h=a.n,k=a.ha,l=a.aa,p,m=d.pb,v=a.ta,q,r=this;n(this,c);this.getName=function(){return"BufferingState"};this.Hc=function(){a.o.set(bc);d.Y.vb(!0)};this.nc=function(){g.Mg();return q};this.update=function(){pd()?a.o.value==mc&&a.o.set(bc):a.o.set(mc);if(!a.F.value.j)this.Ba(a.F.value);
else if(!a.k.value.j)this.Ba(a.k.value);else if(!this.vh()){var c=h.sb(),f=v.gb();if(k.ig()){if(0>=f.jb&&0>=f.kb){b("Heuristics");return}if(!c&&h.Xg()){b("Full");return}}for(var g=f.jb,t=f.kb,p=h.Fb(!0),m=h.Tb(!0),n=a.F.value.j.t,ba=a.k.value.j.t,u=0;0<g&&p;)p.media||p==c||(u+=l.ga(n[p.index].length)),g-=p.duration,p=p.next;for(;0<t&&m;)m.media||m==c||(u+=l.ga(ba[m.index].length)),t-=m.duration,m=m.next;q=u;g=this.oj();if(!(g&&g.stream.type==cb&&g.stream.f>a.k.value.f)){if(c&&d.Y.Xe()){if(!f.k.j){this.Ba(f.k);
return}t=this.Dg(c,f);h.vf(t,!0)&&this.ng(c,f)}!g&&f&&f.Ua&&r.Ba(f.Ua)}}}}function Ta(a){var b=new Ed(a),c=a.cb,d=c.R,f=c.Y,g=a.ta,h=a.n,k=c.pb;n(this,b);this.getName=function(){return"SeekingState"};this.Hc=function(){f.od();f.yc()};this.update=function(){var b;a.F.value.j&&a.k.value.j&&(b=g.gb());b&&0>=b.jb&&0>=b.kb&&a.o.value!==mc?(this.log.trace("Repositioned without rebuffer",h),d.Oa(k.cf,"no buffering required during seek.")):(this.log.trace("Repositioned, buffering",h),d.Oa(k.o,"buffering required during seek."))}}
function hb(a){var b=new Ed(a),c=a.cb,d=c.R,f=c.Y,g=c.pb;n(this,b);this.getName=function(){return"RebufferingState"};this.Hc=function(){f.od();f.yc()};this.update=function(){c.Bc="buffer underrun";d.Oa(g.Zf,"CDN selection due to rebuffer.")}}function x(a){function b(){pd()?w.lb(c):this.$f()}function c(){if(!p){p={type:Si};var b=l.Bc;B.log.trace("Selecting a CDN");if("startup"===b&&"carrera"===v.Wg)b=Fg(a,b,B.Yf,B.oa,f),p&&(p.hb=b&&b.hb);else switch(v.Ek){case "bandwidth":b=Zh(a,b,d);p&&(p.hb=b&&b.hb);
break;default:Ce(a,b,d)}}}function d(b){b.c?(a.i.set(b.mb),B.log.trace("cdn selected: ",{name:b.mb.name}),l.Bc=h,q||(a.o.value==bc||a.o.value==mc?l.R.Oa(l.pb.o,"underrun, buffer media before resume."):l.R.Oa(l.pb.cf,"buffer has media, resume playback"))):(B.$f(),a.o.value==mc&&(w.Ah(r[u]),u=u<r.length-1?u+1:r.length-1),p=null);q&&l.R.Oa(l.pb.uh,"user seek")}function f(b){b.c?(a.i.set(b.mb),B.log.trace("cdn selected: ",{name:b.mb.name}),l.Bc=h,l.nb=b.nb):(B.$f(),a.o.value==mc&&(w.Ah(r[u]),u=u<r.length-
1?u+1:r.length-1),p=null);q&&l.R.Oa(l.pb.uh,"user seek")}function g(){var b=a.Aa(),c=b.length;n(b,ve);for(var d=0;d<c;d++)b[d].lower=b[d-1],b[d].Ad=b[d+1];return b}var k=new Ed(a),l=a.cb,m=l.Y,p,q,r=v.eb,u=0,w=new Rb(0),B=this;"carrera"===v.Wg&&(B.Yf=new Rd(a),B.oa=g());n(this,k);this.getName=function(){return"CDNSelectionState"};this.nc=function(){var a=m.Mg()||0;if(p){var b=p.hb&&p.hb();b&&(a=Ea(b,a))}return a};this.Hc=function(){w.Ah(0);u=0;l.Rb.Ti();q=!1};this.vg=function(){w.Ec();p=null};this.Xd=
function(){a.o.value==mc&&pd()&&w.as(c)};this.update=v.ht&&b||c;this.mk=function(){q=!0};this.$f=function(){a.o.value==bc&&a.o.set(mc)};this.vd=function(){return.5}}function w(a){function b(c){u.log.trace("in _exitBufferingState()");a.o.value!=nc&&(u.log.trace("Buffering complete",{Cause:c},g),m||(m=!0,a.na("pb")));f.Oa(p.cf,"exiting buffering: "+c)}var c=new x(a),d=a.cb,f=d.R,g=a.n,h=a.ha,k=a.aa,l=a.ta,p=d.pb,m,q=!1,r,u=this;d.nb=!1;n(this,c);this.getName=function(){return"InitBitrateSelectionState"};
this.vg=function(){a.nb=d.nb;a.Oi=u.Yf.qp()};this.update=function(){if(a.i.value)a:if(!a.F.value.j)u.Ba(a.F.value);else if(!a.k.value.j)u.Ba(a.k.value);else{if(!u.vh()){var f=g.qb()>=v.Uf?0:v.Uf-g.qb(),p=g.Fa()>=v.Ni?0:v.Ni-g.Fa();if(d.nb&&0===p&&0===f&&h.ig())b("Carrera");else{r||q||(r=u.Yf.tj(a.i.value.location.id));q=!r;var m=g.sb();if(q){if(f=l.gb(!0),0>=f.kb&&0>=f.jb&&h.ig()){b("Heuristics");break a}}else{d.nb=!0;var n=u.oa.ca(r+1,!0),ba=u.oa.ba(r+1,!1),f={k:n,Ua:ba,jb:f,kb:p}}for(var p=f.jb,
n=f.kb,ba=g.Fb(!0),B=g.Tb(!0),w=a.F.value.j.t,ga=a.k.value.j.t,A=0;0<p&&ba;)ba.media||ba==m||(A+=k.ga(w[ba.index].length)),p-=ba.duration,ba=ba.next;for(;0<n&&B;)B.media||B==m||(A+=k.ga(ga[B.index].length)),n-=B.duration,B=B.next;m&&d.Y.Xe()&&(p=u.Dg(m,f),g.vf(p,!0)&&u.ng(m,f))}}}else c.update.apply(u)}}function m(a,b){function c(b){b=new b(a);b.Rc.call(b);return b}b.pb=this;this.cf=c(Q);this.uh=c(Ta);this.Lr=c(hb);this.Zf=c(x);this.o=c(dc);this.Mp=c(w)}function k(a,b,c){function d(){!n&&m&&(p=a.Dc())&&
f(p)}function f(a){function c(a){var f;b.state.value==db&&(a&&a.c?(q.Db=0,f=a.L,h.Ld(f.wa,f.Qc,f.stream,a.content,f.i,a.D)):(p&&(f=p.G)&&(f.media=null,f.va(ad)),a&&a.g==P.Za||(a&&(f=a.L,q.Rb.Nh(f.i,f.wa[0],f.stream)),++q.Db>=q.eb.length&&(q.Db=q.eb.length-1))),ta(d));r.B(Ui);p=null;n&&(n=null)}var y=a.G,t=a.gf,m=y.index;if(y.type===cb)t=t.k,t.j&&t.j.t[m]||(g.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:t.f,BitrateNew:b.U.f}),t=b.U),t!=b.k.value&&
(g.trace("Stream switch",{BitrateOld:b.k.value.f,BitrateNew:t.f,"Chunk Index":m}),b.k.set(t,{Si:t.j.t[m].startTime}));else if(y.type==zb)t=b.F.value;else return;if(t.j.t[m]){var ba=b.i.value,m=l(y,t,ba);y.va(wf);jc(t.type,b.te,b.ue).set({G:y,stream:t,i:ba});n=y={type:Uk,stream:t,G:y};y.response=k.N(m,c);a.response=y.response}}var g=new b.log.r("MediaDownloadWorker"),h=b.n,k=b.dh,m=c,p,n,q=b.cb,r=new rb;this.addEventListener=r.addListener;q.eb=v.eb;q.Db=0;a.addEventListener(Vi,function(a){!n&&m&&(a.Ej=
!0,d())});this.isEnabled=function(){return m};this.vb=function(a){m=a};this.Fg=function(){return p};this.Pf=function(a){n&&n.response&&p&&(a?a(p):1)&&(p.G.media=null,p.G.va(ad),g.trace("Aborted download of chunk:",p.G.index),n.response.abort(),p=n=null)}}function l(a,b,c){var d=b.j.t,f=d[a.index].offset,g=0,h=[],k=[];do{var l=d[a.index],g=g+l.length;h.push(a);k.push(l);a=a.next}while(void 0>g&&a);return{responseType:Ac,Xb:lb,url:b.Qa[c.id],offset:f,length:g,i:c,track:b.track,stream:b,wa:h,Qc:k,Cb:b.type+
"-"+b.f+"-"+h.map(function(a){return a.index}).join("+"),zc:!0}}function u(a,c){var d=[],f=c.aa,g=new za.zb,h=new rb;this.addEventListener=h.addListener;this.removeEventListener=h.removeListener;this.Gc=function(a){var b=g.Gc(a);a.G.va(wh);h.Dh(Vi);return b};this.Dc=function(){return g.Dc()};this.$e=function(){return g.$e()};this.size=function(){return g.size()};this.contains=function(a,b){return g.contains(a,b)};this.forEach=function(a){return g.forEach(a)};this.vb=function(a){d.forEach(function(b){b.vb(a)})};
this.Mg=function(){var a=0;d.forEach(function(d){var f=d.Fg();if(f&&f.G.se===wf){d=f.G;var g=f.gf,g=d.type===cb?g.k:c.F.value,h=f.response;h&&(f=f.response.D,a=b(f.O)?a+Ea(h.L.length-(f.X||0),0):a+g.j.t[d.index].length)}});a=a||0;return f.ga(a)};this.yc=function(a){d.forEach(function(b){b.Pf(a)})};this.zh=function(a){var b=d.length;a=qa(a,0,b);for(var c=0;c<b;c++)d[c].vb(c<a)};this.od=function(){g.forEach(function(a){a.G.va(ad)});g.clear()};this.Xe=function(){return 2>g.size()};for(var l=0;l<a;l++){var m=
new k(this,c,1>l);m.addEventListener(Ui,function(){h.B(wg)});d.push(m)}}function r(a){var b=this;this.Je=a||65536;this.lo=function(a,c,d){var f=[],g,h;if(1===d||a.length<=b.Je)f.push({offset:a.offset,length:a.length,we:a.offset+a.length,Jb:c});else{var k=Pa.floor(Pa.floor(a.length/b.Je)/d)*b.Je||b.Je,l=Pa.floor(a.length/k),l=0<l?l-1:0,y=a.length-k*l;for(d=0;d<l;d++)g=a.offset+d*k,h=g+k-1,f.push({offset:g,length:k,we:h,Jb:c});0<y?(g=a.offset+l*k,f.push({offset:g,length:y,we:g+y,Jb:c})):f[f.length-
1].we+=1}a=f.length;for(d=0;d<a;d++)c=f[d].Jb,f[d].index=d+1,f[d].Ga={name:ed("{0}_{1} - {2}/{3}",c.type,c.index,d+1,a)};return f}}function D(a,c,d){function f(a){if(a){var b=a.G;a=a.gf;var c=b.type===cb?a.k:b.type===zb?d.F.value:void 0;a=c.j.t[b.index];b.content=new ab(a.length);b.Mb=w.lo(a,b,B);b.Mb.forEach(function(a){a.i=d.i.value;a.stream=c;H.Gc(a);J.Dh(xh)})}}function g(a){a&&(a.media=null,a.va(ad),a.Mb=null)}function h(a){function b(a){if(a.Mb){for(var c=a.Mb.length,d=0;d<c;d++){var f=a.Mb[d];
if(!f.response||!f.response.c)return!1}return!0}return!1}if(a){var c=a.Jb,l,y=d.cb;if(a.response.c){if(b(c)){c.Mb.forEach(function(a){c.content.set(a.response.content,a.offset-c.L.offset)});try{c.content=ec(c.content),l=!0}catch(p){g(c),y.Rb.Nh(a.i,c,a.stream),m.warn("Exception parsing response",p,c)}delete I[c.type+"_"+c.index];l&&u.Ld([c],c.L.Qc,a.stream,c.content,a.i,k(c));c.Mb=null;c.content=null;a=A;A=null;f(a);J.B(wg)}}else a.response=null,y.Rb.Kk(a.i)&&q.vb(!1),H.Gc(a),J.Dh(xh)}}function k(a){var b=
{},c=a.Mb;a.Mb&&(b.requestTime=tc(c,function(a){return a.response.D.requestTime}),b.O=tc(c,function(a){return a.response.D.O}),b.M=aa(c,function(a){return a.response.D.M}),b.X=a.content.length);return b}var m=new d.log.r("SubChunkDownloadJobManager"),n=[],p=d.aa,q=this,u=d.n,B=c,w=new r(v.Ns),I={},H=new za.zb,A,J=new rb;this.addEventListener=J.addListener;this.removeEventListener=J.removeListener;this.Gc=function(a){a.G.va(wh);f(a)};this.Xe=function(){return Mb.keys(I).length<v.uq&&H.size()<=B};this.Dc=
function(){var a=H.Dc();if(!a)return null;a.i=d.i.value;var b=a.Jb;if(!I[b.type+"_"+b.index]){b.L=l(b,a.stream,a.i);jc(a.stream.type,d.te,d.ue).set({G:b,stream:a.stream,i:a.i});I[b.type+"_"+b.index]=b;b.va(wf);var c=b.index;if(b.type===cb)b=a.stream,b.j&&b.j.t[c]||(m.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:b.f,BitrateNew:d.U.f}),b=d.U),b!=d.k.value&&(m.trace("Stream switch",{BitrateOld:d.k.value.f,BitrateNew:b.f}),d.k.set(b));else if(b.type!==
zb)throw new Za("unexpected chunk type.");}return a};this.$e=function(){return H.$e()};this.size=function(){return H.size()};this.contains=function(a,b){return H.contains(a,b)};this.forEach=function(a){return H.forEach(a)};this.vb=function(a){n.forEach(function(b){b.vb(a)})};this.Mg=function(){var a=0;n.forEach(function(c){if(c=c.Fg()){var d=c.response;if(d){var f=d.D;a=b(f.O)?a+Ea(d.L.length-(f.X||0),0):a+c.length}}});a=a||0;return p.ga(a)};this.yc=function(){Mb.keys(I).forEach(function(a){g(I[a]);
delete I[a]});n.forEach(function(a){a.Pf()})};this.zh=function(a){var b=n.length;a=qa(a,0,b);for(var c=0;c<b;c++)n[c].vb(c<a)};this.od=function(){A&&(g(A.G),A=null);H.forEach(function(a){a&&g(a.Jb)});H.clear()};for(c=0;c<a;c++){var x=new la(q,d,c<B);x.addEventListener(Wi,function(a){h(a)});n.push(x)}}function la(a,b,c){function d(){!l&&k&&(l=a.Dc())&&f(l)}function f(a){var c=E(a),g={type:Vk,stream:a.stream,Fy:a};m=g;g.response=h.N(c,function(c){ta(d);var f=m;f&&b.state.value==db&&f.type!=Xi&&(c&&
c.c?n.Db=0:c&&c.g==P.Za||(n.Rb.Nh(a.i,a.Jb,a.stream),++n.Db>=n.eb.length&&(n.Db=n.eb.length-1)));q.B(Wi,l);l=null;m&&m.type!=Xi&&(m=null)});a.response=g.response}var g=new b.log.r("SubChunkDownloadWorker"),h=b.dh,k=c,l,m,n=b.cb,q=new rb;this.addEventListener=q.addListener;n.eb=v.eb;n.Db=0;a.addEventListener(xh,function(a){!l&&k&&(a.Ej=!0,d())});this.isEnabled=function(){return k};this.vb=function(a){k!=a&&(k=a)&&d()};this.Fg=function(){return l};this.Pf=function(){m&&m.response&&(g.trace("Aborted download of chunk:",
l),m.response.abort(),l=m=null)}}function E(a){var b=a.stream;return{responseType:Ac,Xb:A,url:b.Qa[a.i.id],offset:a.offset,length:a.length,wa:[a.Jb],i:a.i,track:b.track,stream:b,Cb:b.type+"-"+b.f+"-"+a.Jb.index+"- sub."+a.index,zc:!0}}function A(a){return new ab(a)}function L(a){function b(){10>=l.length?c():b=q}function c(){a.state.value!=db&&a.state.value!=ac||d()}function d(){var b=B,c;B=ja();c=B-b;b=(h=h||a.n)&&h.Xg();if(!b||w){if(++A>=J&&(A=0,a.fireEvent(ng)),0<l.length){var b=Fa(u,l[l.length-
1].M-l[0].requestTime),g=0,k=ja(),t=b>=u?k-u:l[0].requestTime,t=k-t<=v.Gh?t:k-v.Gh;r=0;l.forEach(function(a){var b=a.M-a.requestTime,c=0;if(!(0>=b||a.M<t||a.requestTime>k)){if(a.requestTime>=t&&a.M<=k)c=1;else{var d=a.M;d>=t&&d<=k?c=(a.M-t)/b:(d=a.requestTime,d>=t&&d<=k&&(c=(k-a.requestTime)/b))}g++;r+=a.X*c}});r=ya(r);m=ya(Ea(8,r/b));N=b;w=!1}}else b&&f(c)}function f(a){l.forEach(function(b){b.requestTime+=a;b.O+=a;b.M+=a})}function g(a){return ya(a/m)}var h,k,l=[],m=128,n=0,r=0,u=v.Gh,B=ja(),w,
H,A=0,J=jb(4),x,X,N,ga=0;a.addEventListener(ue,function(a){var c=a.D,d=a.L;d.i&&(H=d.i.location.id);x=c.requestTime;if(a.c&&c.X>Mi&&a.type==Ac){g(c.X);for(l.push(c);100<l.length;)l.shift();w=h&&h.Xg();b()}});this.Lg=function(){return m};this.Cp=function(){return ya(7.8125*m)};this.Bj=function(){return ya(7.8125*n)};this.xd=function(){return r};this.uj=function(){return H};this.vj=function(){return x};this.ga=g;this.Ob=function(){k=k||new Pd(a.n,a.Xc);return k.Ob(m,0)};this.le=function(){return this.Cp()};
this.Ng=function(){return N};this.ud=function(){return 0};a.addEventListener(Ab,function(){X&&yb(X)});X=Sb(c,250);var M=new Hc(1E3,function(){60<ga?M.pd():(n=(n*ga+m)/(ga+1),ga+=1)});M.Ch()}function Y(a){var b={};this.Nh=function(a,c,d){a=a.name+"_"+(d.type+"_"+c.index);b[a]=b[a]?b[a]+1:1};this.Ti=function(){b={}};this.Kk=function(c){return Mb.keys(b).some(function(d){var f=b[d];return-1<d.indexOf(c.name)&&f>a})}}function lb(a){return ec(new ab(a))}function ec(a){for(var b=th(a),c,d,f,g=0;g<b.length;g+=
2){c=b[g];if("moof"!=c.type||"mdat"!=b[g+1].type)throw new Za("data is not moof-mdat box pairs");if(v.ut&&"moof"==c.type&&(d=c.rb("traf/saio"),f=c.rb("traf/A2394F52-5A9B-4F14-A244-6C427C648DF4"),d&&f&&(f=f.Hn.byteOffset-c.Ka.byteOffset,d.Zr[0]!=f))){var h=d;d=f;f=new Yc(h.Ka);f.seek(h.size-h.X);h=f.H(1);f.H(3)&1&&(f.l(),f.l());h=1<=h?8:4;f.l();f.hl(d,h)}v.fl&&"moof"==c.type&&(c=c.rb("traf/tfhd"),(d=c.kg)&&d.Ak&&Gb(c))}return a}function Gb(a){var b=new Yc(a.Ka);b.seek(a.size-a.X);b.H(1);var c=b.H(3);
b.l();var d;switch(a.type){case "tfhd":c&1&&b.ja();c&2&&b.l();c&8&&b.l();c&16&&b.l();c&32&&(d=b.ia(2));break;case "trex":b.l(),b.l(),b.l(),d=b.ia(2)}d&&(d[1]&=254)}function da(a,b,c,d){var f=b.type;b=jc(f,"ec-3"==b.j.cg?'audio/mp4; codecs="mp4a.a6"':'audio/mp4; codecs="mp4a.40.5"',v.pt);var g={Type:f},h,k=!1,l,m=this,q;v.Wb&&v.Qe&&(q=!0,m.zg=new Va);d.trace("Adding source buffer",g,{TypeId:b});h=c.addSourceBuffer(b);ea(h);xg&&(h.addEventListener("updatestart",function(){}),h.addEventListener("update",
function(){}),h.addEventListener("updateend",function(){k=!1;l&&l();q&&h.buffered.length&&(q=!1,m.zg.set(!0))}),h.addEventListener("error",function(){a.Pa(new Hb(U.xm,jc(f,P.ae,P.ce)))}),h.addEventListener("abort",function(){}));a.addEventListener(qg,function(){h=null});n(m,{type:f,appendBuffer:function(a){h[Yi](a);xg&&(k=!0)},remove:function(a,b){try{xf&&(h.remove(a,b),xg&&(k=!0))}catch(c){d.error("SourceBuffer remove exception",c,g)}},Sb:function(){return k},Hk:function(a){l=a},mp:function(){try{var a=
h.buffered,b,c,d,f=0;if(a)for(b=[],c=0,d=a.length,c=0;c<d;c++){var g=a.start(c),k=a.end(c),f=f+(k-g);b.push(g+"-"+k)}if(b)return{Buffered:f.toFixed(3),Ranges:b.join("|")}}catch(l){}}})}function ea(a){ea=q;Yi=a.appendBuffer?"appendBuffer":"append";xf=!v.Kn&&!!a.remove;xg=!!a.addEventListener}function Fc(a){function c(b){v.fo&&(ha.removeAttribute("src"),ha.load&&ha.load(),ha.webkitDeleteKey&&ha.webkitDeleteKey(V,aa));yf.revokeObjectURL(ia);if(Y&&!b)try{Y.close()}catch(d){na.error("Exception on keysession close ",
U.Gf,d)}ma&&Wa&&"playready"==fa()&&(ma.Rc(),new ai(a,aa,ma));v.$i&&ha.removeEventListener("contextmenu",Ka);a.Xa.removeChild(ha);ha=K=null;ia=""}function d(a){try{ha&&(ea=ha.currentTime)}catch(b){na.error("Exception while getting VIDEO.currentTime",b),a&&Z(U.qm,b)}return jb(1E3*ea)}function f(){R&&R.br&&R.cr&&(R=h,qb.B(Zi))}function k(a,b,c){v.hj&&na.trace("KeySession update",a&&S(a));try{if(Y){var d=Y.update(a);d&&d.then&&d.then(x).catch(function(a){na.error("keySession update promise rejected",
a);a=nb(a);J(U.If,a)})}else ha.webkitAddKey(V,a,b,c)}catch(f){na.error("Exception calling keySession.update or addKey",f),Z(U.rm,f)}}function l(){na.trace("Video element event: seeking");R?R.cx=!0:J(U.Am)}function m(){na.trace("Video element event: seeked");R?(R.br=!0,f()):J(U.zm)}function r(){R&&(R.cr=!0,f());qb.B($i)}function u(a){na.trace("Received event: sourceopen");Bb||(Bb=!0,qb.B(aj,a))}function p(a){a=Oe(a,xc);na.error("Video element event: error",a.Se);if(ma&&ma.Me()&&!v.es){var b={ErrorCode:U.Wm};
n(b,eb(a.kc));ma.terminate(b)}else J(U.pm,a.kc)}function B(a){var b=Oe(a,Kc);na.error("Received event: keyerror",b.Se);ma&&ma.Me(a)?((a=/Chrome/.test(kc)&&1==a.systemCode&&a.errorCode&&1==a.errorCode.code)&&wa.error("SSManager , ignoring keyerror"),a||(a={ErrorCode:U.Fm},n(a,eb(b.kc)),ma.terminate(a))):J(U.If,b.kc)}function w(b){na.trace("Received event: "+b.type);if(ha){var c;if(!ja){ja=!0;a.na("lg");try{var d=Wk[fa()];c=b.initData;c instanceof ArrayBuffer&&(c=new ab(c));d&&(c=d(c,a.U.j.Hd));pa||
!Qc||v.vr&&ha.webkitGenerateKeyRequest||(ha.setMediaKeys?(Q=new Qc(V),ha.setMediaKeys(Q)):ha.msSetMediaKeys?(Q=new Qc(V),ha.msSetMediaKeys(Q)):ha.webkitSetMediaKeys&&(Q=new Qc(V),ha.webkitSetMediaKeys(Q)));pa&&Yb.requestMediaKeySystemAccess(V,[{initDataTypes:["cenc"],persistentState:"required",videoCapabilities:[{contentType:'video/mp4; codecs="avc1.640028"',robustness:"HW_SECURE_DECODE"},{contentType:'video/mp4; codecs="avc1.640028"',robustness:"SW_SECURE_DECODE"}]},{initDataTypes:["cenc"],persistentState:"required"}]).then(function(a){na.trace("supportedconfig",
ob.stringify(a.getConfiguration()));return a.createMediaKeys()}).then(function(a){ua=a;return ha.setMediaKeys(a)}).then(function(){var a=ua.createSession();a.addEventListener("message",A);a.addEventListener("keystatuseschange",function(a){na.trace("Received event: "+a.type);try{a.target.keyStatuses.forEach(function(a){na.trace("key status: "+a);"expired"==a&&J(U.oi);"internal-error"==a&&J(U.mm);"output-not-allowed"==a&&J(U.om);"output-downscaled"!=a||ta||(ta=!0,na.error("output-downscaled"))})}catch(b){na.error("Exception in iterating keystatuses",
b)}});a.generateRequest(b.initDataType,c);Y=a}).catch(function(a){na.error("Exception creating keySession",a);a=nb(a);var b=U.lm;a.g==P.nl&&(b=U.Jf);J(b,a)})}catch(f){na.error("Exception creating MediaKeys",f);Z(U.ni,f);return}if(!pa)try{var g;Q?g=Y=Q.createSession("video/mp4",c,null):(ha.webkitGenerateKeyRequest(V,c),g=ha);g.addEventListener(La+"keyerror",B);g.addEventListener(La+"keymessage",A);g.addEventListener(La+"keyadded",x)}catch(h){na.error("Exception generating key request",h),Z(U.Jf,h)}}}}
function A(b){var c=b.messageType;na.trace("Received event: "+b.type+(c?" , "+c:""));var d=b.sessionId||Y&&Y.sessionId,f=b.message;b=fa();f instanceof ArrayBuffer&&(f=new ab(f));v.hj&&na.trace("KeySession message",f&&S(f));if(!Ua&&v.jt){Ua=!0;var g=[99,100,109,95,105,100,58],h=new ab(g.length+f.length);h.set(g,0);h.set(f,g.length);k(h,f,d)}else if(v.el&&Id([8,4],f))g=zc(v.el),k(g,f,d);else if("fps"==b&&Id([99,101,114,116,105,102,105,99,97,116,101],f))a.na("scs"),Cb(a,function(b){b.c?(a.na("scr"),
k(b.me,f,d)):J(U.Yl,b)});else if(ma&&ma.aq()&&(ma.Oh({c:!0,Bb:f,ic:fa(),Ne:aa}),ma.Th().then(function(a){a.c&&k(a.kd,a.Bb,aa)})),!la||v.Wb&&ra!==Xk){la=!0;try{aa=d;var l;a.U.j.Hd.children.forEach(function(a){"pssh"==a.type&&"29701FE4-3CC7-4A34-8C5B-AE90C7439A47"==a.rd&&(l=a.data)});Ja="playready"==fa()?(g=ib(f,"PlayReadyKeyMessage","Challenge"))?zc(g):f:f;h={ic:fa(),data:Ja,Fr:l};v.Wb&&(ra++,h.iq=ra==bj,ra==Yk&&(h.xk=!0));qb.B(cj,h)}catch(m){na.error("Exception creating license challenge",m),Z(U.sm,
m)}}}function x(a){na.trace(a?"Received event: keyadded":"addKey promised resolved");if(Wa){qa||(qa=!0,qb.B(dj,{Ne:aa}));var b;a:{if(v.Wb&&v.Qe&&(ra==bj||ra==Zk))switch(fa()){case "fps":b=H;break a;case "playready":b=sa;break a}b=void 0}b&&kb.then(function(){xb=Xa(b,v.Qe)})}ma&&ma.$p()&&ma.$k()}function I(){!0===ub.hidden?ca.forEach(function(a){a.refresh();a.Cs()}):ca.forEach(function(a){a.refresh();a.Ks()})}function H(){k(id("renew"));xb=h}function sa(){T(Y,"removeEventListener");var b=Ba(a.U.j.Hd),
b=Ma(b),b=function(a){var b="";a.forEach(function(a){b+="<KeyID>"+a+"</KeyID>"});return new ab(uc('<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="true"><KeyIDs>'+b+"</KeyIDs><CustomData></CustomData></LicenseAcquisition></PlayReadyCDMData>"))}([S(b)]);Y=Q.createSession("video/mp4",new ab,b);T(Y,"addEventListener");xb=h}function J(b,c){a.Pa(new Hb(b,c,void 0))}function Z(b,c){var d={g:P.Nb,C:N(c)},f;try{(f=c.message.match(/(?:[x\W\s]|^)([0-9a-f]{8})(?:[x\W\s]|$)/i)[1].toUpperCase())&&
8==f.length&&(d.P=f)}catch(g){}a.Pa(new Hb(b,d))}function X(a){function c(){var f=a();b(f)&&d.un(f)}var d=new ee;ca.push(d);d.refresh=c;return function(){c();return d.op()}}function M(){ca.forEach(function(a){a.refresh()})}function ga(){if(ha&&2<=ha.readyState){var a=ha.webkitDecodedFrameCount;if(0<a||a===h)return L.Zi=ga=z,!0}return!1}function F(a){if(ha){a=a.qt;var b=ha&&ha.msGraphicsTrustStatus;b&&(a.ConstrictionActive=b.constrictionActive,a.Status=b.status);try{ha&&(a.readyState=""+ha.readyState,
a.currentTime=""+ha.currentTime)}catch(c){}for(var b=C.length,d;b--;)d=C[b],n(a,d.mp(),{prefix:d.type})}}function D(){if(ha)return ha.getVideoPlaybackQuality&&ha.getVideoPlaybackQuality()||ha.videoPlaybackQuality||ha.playbackQuality}function E(b){function c(a){c=q;d.wb();b(a)}var d=new Jc(500,function(){c()});d.jc();try{var f=a.k.value.j.Hd.children.filter(function(a){return"pssh"==a.type&&"9A04F079-9840-4286-AB92-E65BE0885F95"==a.rd})[0];(new Qc(V)).createSession("video/mp4",f.Ka,null).addEventListener(La+
"keyerror",function(a){a=Oe(a,Kc);c(a.kc)})}catch(g){c()}}function T(a,b){a[b](La+"keyerror",B);a[b](La+"keymessage",A);a[b](La+"keyadded",x)}var La=Sa(),L=this,na=new a.log.r("MediaPresenter"),qb=new rb,ha=oa(a.ac),C=[],K,Q,ia,R,V=v.Oe[0],Y,aa,Ja,ea=0,ca=[],xb,pa,Bb,ja,la,Ua,Wa,qa,ra=v.Wb?$k:al,ma,Ia=q,kb=Vd.resolve(),ta,ua;v.Wb&&v.Qe&&(kb=new Vd(function(b){Ia=b;a.addEventListener(Ab,b)}));v.Sd&&a.state.addListener(function(){a.state.value==db&&(ma=a.rc)});v.Br&&(g(Yb.requestMediaKeySystemAccess)?
pa=!0:na.error("Promise based eme requested but platform does not support it",{browserua:kc}));n(L,{addEventListener:qb.addListener,removeEventListener:qb.removeListener,st:ha,rj:d,seek:function(a){M();var b=d(!0);if(!(Bc(b-a)<=yh))try{na.trace("Setting video elements currentTime",{From:Ca(b),To:Ca(a)}),R={},ha.currentTime=a/1E3}catch(c){na.error("Exception while setting VIDEO.currentTime",c),Z(U.um,c)}},Bp:function(){return!!R},addSourceBuffer:function(b){var c=new da(a,b,K,na);C.push(c);b.type==
cb&&c.zg&&c.zg.addListener(Ia);return c},endOfStream:function(){na.trace("Calling endOfStream on mediaSource");v.Tn&&K.endOfStream()},tn:function(a){a=a.data;Wa=!0;k(a,Ja,aa);v.Wb&&ra++},Zi:ga,Eg:function(){var a=ha&&ha.msGraphicsTrustStatus;return!(!a||1!=a.constrictionActive)},open:function(){a.addEventListener(ph,F);if(ej){if(a.k.value.j.pg){if(!bl){J(U.pi);return}if(Qc&&Qc.isTypeSupported)try{if(!Qc.isTypeSupported(V,"video/mp4")){E(function(a){J(U.Hf,a)});return}}catch(b){Z(U.Hf,b);return}}try{K=
new Dd}catch(c){Z(U.hm,c);return}try{ia=yf.createObjectURL(K)}catch(d){Z(U.im,d);return}try{K.addEventListener("sourceopen",u);K.addEventListener(La+"sourceopen",u);ha.addEventListener("error",p);ha.addEventListener("seeking",l);ha.addEventListener("seeked",m);ha.addEventListener("timeupdate",r);ha.addEventListener(pa?"encrypted":La+"needkey",w);var f=a.Xa,g=f.lastChild;g?f.insertBefore(ha,g):f.appendChild(ha);v.$i&&ha.addEventListener("contextmenu",Ka);ha.src=ia;gb.addListener(zh,I);I()}catch(h){Z(U.jm,
h)}}else J(U.qi)},close:function(){if(ia)if(M(),gb.removeListener(zh,I),ma&&Wa&&"playready"!=fa()){ma.Rc();try{Y?Y.close():ha.webkitCancelKeyRequest(V,aa)}catch(a){na.error("Exception on keysession close ",U.Gf,a),ma.terminate({ErrorCode:U.Gf})}ma.Yd().then(c)}else c();xb&&mb(xb)},Ce:X(function(){if(ha){var a=D();return a?a.totalVideoFrames:ha.webkitDecodedFrameCount}}),Oc:X(function(){if(ha){var a=D();return a?a.droppedVideoFrames:ha.webkitDroppedFrameCount}}),Ae:X(function(){if(ha){var a=D();return a&&
a.corruptedVideoFrames}}),De:X(function(){if(ha){var a=D();return a&&jb(1E3*a.totalFrameDelay)}})})}function fa(){return/widevine/i.test(v.Oe[0])?"widevine":/fps/i.test(v.Oe[0])?"fps":"playready"}function Sa(){return C.WebKitMediaKeys||zf.prototype.webkitGenerateKeyRequest?"webkit":zf.prototype.msSetMediaKeys?"ms":""}function oa(a){var b;b=C.devicePixelRatio||1;b={width:cl||C.screen.width*b,height:dl||C.screen.height*b};a=a.width/a.height*b.height;var c=(b.width-a)/2;return v.xs?Ha("VIDEO","position:absolute;width:"+
a+"px;height:"+b.height+"px;left:"+c+"px;top:0px"):Ha("VIDEO","position:absolute;width:100%;height:100%")}function Ka(a){a.preventDefault();return!1}function ib(a,b){var c="",d,f=a.length,g;for(d=0;d<f;d++)g=a[d],0<g&&(c+=el(g));f="\\s*(.*)\\s*";for(d=arguments.length-1;0<d;d--){g=arguments[d];if(0>c.search(g))return;g="(?:[^:].*:|)"+g;f="[\\s\\S]*<"+g+"[^>]*>"+f+"</"+g+">[\\s\\S]*"}if(c=c.match(new RegExp(f)))return c[1]}function Cb(a,b){function c(a){var d;try{var f=a.match(/-----BEGIN CERTIFICATE-----([\s\S]*)-----END CERTIFICATE-----/)[1];
if(!Wa(f))throw new Za("bad PEM");d={c:!0,me:zc(f)}}catch(g){d={g:P.Nb,C:N(g)}}b(d)}var d=a.ib;fb.load("fpsappdata",function(a){if(a.c){a=a.data;var f=a.certificate;if(a.expiration>Ob.wd()){c(f);return}}d.Bg(function(a){if(a.c){var d=a.me;fb.save("fpsappdata",{certificate:d,expiration:a.$o});c(d)}else b(a)})})}function Oe(a,c){var d=a.target,f=d&&d.error,g=a.errorCode,d=f&&f.code;ia(d)||(d=g&&g.code);g=f&&f.msExtendedCode;ia(g)||(g=f&&f.systemCode);ia(g)||(g=a.systemCode);f=n({},{code:d,systemCode:g},
{Ye:!0});d={g:c(d),C:vg(f)};g=B(g);b(g)&&(d.P=vc(g));return{kc:d,Se:f}}function nb(a){var b={};b.g=ia(a.code)?Kc(a.code):P.Nb;try{var c=a.message.match(/\((\d*)\)/)[1];b.P=vc(c)}catch(d){}b.C=N(a);return b}function Pe(a){function b(){function g(){!x&&r&&u&&(g=M,z.addEventListener(Zi,f),z.addEventListener($i,function(){f();a.fireEvent(Ah)}),S.addEventListener("ended",function(){J.trace("Video element event: ended");f()}),S.addEventListener("play",function(){J.trace("Video element event: play");f()}),
S.addEventListener("pause",function(){J.trace("Video element event: pause");f();a.fireEvent(Bh)}),S.addEventListener("playing",function(){J.trace("Video element event: playing")}),X=!0,m(),J.trace("Video element initialization complete"),a.na("vi"),v.Yi?Xa(function(){F=!0;f()},v.Yi):F=!0,h(),ta(f))}function h(){if(v.Wi){var b=function(){a.A.value==Qb&&a.state.value==db&&a.o.value==nc?ia.jc():ia.wb()};ia=new Jc(v.Wi,function(){H(U.km)});a.A.addListener(b);a.o.addListener(b);a.state.addListener(b);
b()}}J.trace("Video element initializing");var k=a.Xc,n=a.k.value,p=k.j,O=n.j.pg||p.pg,r,u;S=z.st;z.addEventListener(aj,function(){try{na.La=z.addSourceBuffer(k)}catch(b){H(U.Kf,{g:P.ae,C:N(b)});return}try{qb.La=z.addSourceBuffer(n)}catch(c){H(U.Kf,{g:P.ce,C:N(c)});return}q(k)&&q(n)&&(O?J.trace("Waiting for needkey"):J.warn("Movie is not DRM protected",{MovieId:a.ma,DownloadableId:n.J}),J.trace("Waiting for loadedmetadata"))});O?(z.addEventListener(cj,function(b){x||(J.info("Requesting license"),
b.xk||a.na("lc"),a.ib.Zg(b,function(c){J.info("Received license");if(!x)if(b.xk||a.na("lr"),c.c){c=c.gq;try{z.tn(c),J.trace("Added license")}catch(d){J.error("Exception adding license",d),H(U.gm)}}else H(U.bm,c)}),a.fireEvent(oh,b))}),z.addEventListener(dj,function(b){r=!0;a.na("ld");ta(function(){g()});a.fireEvent(Ci,b)})):r=!0;Ef(S,function(){J.trace("Video element event: loadedmetadata");u=!0;a.na("md");a.addEventListener(Yd,c);na.La.Hk(c);qb.La.Hk(c);c();ta(function(){g()})});gb.addListener(Pc,
A,-1);a.addEventListener(Ab,A,-1);a.addEventListener(Qi,d);a.paused.addListener(f);a.muted.addListener(l);a.volume.addListener(l);a.o.addListener(f);z.open();B(a.ob||0,Ch);l()}function c(){X?f():v.Bn&&m()}function d(){var b=a.v.value-v.ms,b=Ea(b,E);B(b,Gi)}function f(){if(!x&&X){var b=z.Bp();b||m();xf||m();var c=a.o.value==nc,d=a.A.value,l=d==Qb?K:C,n;n=k(na,l)&&k(qb,l);a.paused.value||!n||!c||b||T?r():S.ended||!F||!L&&L!==h||(J.trace("Calling play on element"),S.play(),L=!1);if(!b)if(T&&c&&n)z.seek(D),
T=!1,xf||w(),ta(f);else{var t=z.rj(!0);T||b?d=Qb:S.ended?d==$c&&(D=a.duration,d=Oc,r()):c&&n?z.Zi()?d=S.paused?sf:$c:V.lb(g):d=Qb;d!=Qb&&d!=Oc&&(t<D?(b=D-t,t&&b>yh&&(t={ElementTime:Ca(t),MediaTime:Ca(D)},b>fl?(J.error("VIDEO.currentTime became much smaller",t),H(U.ym)):J.warn("VIDEO.currentTime became smaller",t))):D=qa(t,0,a.duration));a.v.set(D);u();t=d==Qb&&a.A.value==$c;a.A.set(d,{Yv:!0});t&&a.fireEvent(tf,{Ac:ga.Mc()>l?gl:vh})}}}function g(){v.Zq&&!na.La.Sb()&&na.La.appendBuffer(new ab([0,0,
0,8,102,114,101,101]));f()}function k(a,b){if(!a.Vc)return!0;var c=a.oe;return(c=c&&c.G)&&c.endTime-D>=b}function l(){x||(S.volume=a.volume.value,S.muted=a.muted.value)}function m(){p(na);p(qb);x||na.Vc||qb.Vc||na.La.Sb()||qb.La.Sb()||R||(R=!0,z.endOfStream())}function p(a){if(!x){var b=a.La,c=a.Cc;b.Sb()||(a.oe=c[c.length-1],a.Fh&&(a.Fh=!1,b.remove(0,jc(a.type,ga.$a,ga.yb).Q.endTime/1E3)));for(var d=a.Vc;d&&d.media&&d.startTime-D<=Q;){R=!1;var f;a:{f=d;var g=f.media,h=f.type,k=ha[h];if(!q(g.stream)||
x||k.La.Sb())f=void 0;else{try{var l=g.Tf;J.trace("Feeding media segment to decoder",f,{Bytes:g.length});k.La.appendBuffer(l);k.Cc.push({G:f,stream:g.stream,i:g.i});T&&!xf||ga.Sq(f)}catch(y){J.error("Exception while appending media",f,y);H(U.vm,jc(h,P.ae,P.ce));f=void 0;break a}f=!0}}if(!f)break;d=d.next}a.Vc=d;b.Sb()||(a.oe=c[c.length-1])}}function q(a){if(!a||!a.j)return!1;var b=a.type,c=ha[b];if(c.vo!=a)try{if(c.La.Sb())return;var d=a.j.Np;J.trace("Feeding init segment to decoder",a,{Bytes:d.length});
c.La.appendBuffer(d);c.vo=a}catch(f){J.error("Exception while appending initialization segment",f,{Type:b});H(U.wm,jc(b,P.ae,P.ce));return}return!0}function r(){S.ended||!F||L&&L!==h||(J.trace("Calling pause on element"),S.pause(),L=!0)}function u(b){if(b){for(var c=ha[b],d=c.Cc,f,g;(f=d[0])&&f.G.startTime<=D;)if(D<f.G.endTime){b=jc(b,a.Yb,a.ub);cd(f,b.value)||(g=!0,b.set(f));break}else d.shift(),ga.Vq(f.G);g&&!R&&(f=(f=f.G.Ja)&&f.startTime-1,0<f&&(c=c.La,c.Sb()||c.remove(0,f/1E3)))}else u(zb),u(cb)}
function B(b,c){if(!x){var d=ga.yb.fb(qa(b,0,145152E5)),g=d.startTime;v.ur&&(g=b);var h=ga.$a.fb(g);!d.next&&d.Ja&&(d=d.Ja,g=d.startTime,h=ga.$a.fb(g));v.Ck&&(g+=v.Ck);c==Ch&&(a.nd=g);u();var k=D;J.info("Seeking",{Requested:Ca(b),Actual:Ca(g),Cause:c});a.fireEvent(fj,{ih:k,hk:g,Ac:c});a.A.set(Qb);na.th=h;qb.th=d;w();c!=Ch&&(na.Fh=!0,qb.Fh=!0);E=D=g;a.Yb.set(null);a.ub.set(null);a.v.set(D);a.ep();a.fireEvent(Xd,{ih:k,hk:g,Ac:c});T=!0;f()}}function w(){na.Vc=na.th;na.Cc=[];na.oe=h;qb.Vc=qb.th;qb.Cc=
[];qb.oe=h;ga.Uq()}function H(b,c){x||a.Pa(new Hb(b,c,void 0))}function A(){if(!x){J.info("Closing.");gb.removeListener(Pc,A);x=!0;try{v.Mq&&(S.volume=0,S.muted=!0),r(),z.close()}catch(a){}}}var J=new a.log.r("MediaPresenter"),x,X,F,ga=a.n,D=0,E,T,z=new Fc(a),S,L,na={type:zb,Cc:[]},qb={type:cb,Cc:[]},ha={},C=v.Va,K=v.fr,Q=v.wq,R,ia,V=new Rb(yh);ha[zb]=na;ha[cb]=qb;try{b()}catch(Y){J.error("Exception while initializing",Y),H(U.fm)}n(this,{seek:function(a){B(a,Fi)},Be:function(){return z.rj(!1)},Ce:z.Ce,
Oc:z.Oc,Ae:z.Ae,De:z.De,Eg:z.Eg,ig:function(){var b=a.A.value==Qb?K:C;return k(na,b)&&k(qb,b)}})}function ic(a,b,c,d,f,g,k,l,m,n){function q(b){function c(){a.state.removeListener(c);d()}function d(){a.state.value==db?N?B(function(a){a.c?A.info("Loaded image subtitle manager"):(A.error("Unable to load image subtitles manager",a),J=Dh,X=Kb(q));b(a)}):r(function(a){a.c?(A.trace("Entries parsed",{Length:a.entries.length},x),F.i=a.i,J=hl):(A.error("Unable to retreive timed text track",eb(a),x,{url:a.url}),
J=Dh,X=Kb(q));b(a)}):b({})}J=gj;a.state.value!=ac?d():a.state.addListener(c)}function r(b){function c(g){if(g.c)b(g);else{var h,k,l;for(l=0;l<a.I.length;l++)if(h=a.I[l],k=d[h.id],f[h.id]>v.Tk||!k)h=null;else break;h&&k?(f[h.id]=(f[h.id]||0)+1,u(k,h,c)):b(g)}}if(Ja(d))u(d,h,b);else if(jd.isArray(d))b({c:!0,entries:d,track:F});else{var f={};c({c:!1})}}function u(b,c,d){A.trace("Downloading",c&&{cdn:c.id},x);var g={responseType:eh,url:b,track:F,i:c,Cb:"tt-"+f};a.ua.N(g,function(b){if(b.c){var f=a.ac;
N?d({c:!0,entries:[]}):Ie(b.content,f.width/f.height,v.Vk,v.Wk,function(a){if(a.c){a=a.entries;var b=v.Us;if(b){var f=0;a.forEach(function(a){a.startTime=f;a.endTime=f+=b})}d({c:!0,entries:a,i:c,track:F})}else a.url=g.url,d(a)})}else d(b)})}function B(b){function c(a){if(ia(a)){n.url=d[D];f.url=n.url;l[a]=(l[a]||0)+1;var y=new il(g,f);y.on("ready",function(){ga=y;b({c:!0,track:F})});y.on("error",function(d){var f={c:!1},g;for(g in d)f[g]=d[g];f.url=n.url;A.error("ImageSubtitleManager error event",
f);l[a]<=v.Tk?c(D):(D=h[k++])?c(D):b({c:!1,msg:"all cdns failed for image subs"})})}else b({c:!1,msg:"cdnId is not defined for image subs downloadUrl"})}var f={type:"image",bk:n.offset,ck:n.length,ef:a.v.value||0},g={yj:function(){return a.ha.Be()},Yj:A,L:w},h=Mb.keys(d),k=0,l={};D=h[k++];c(D)}function w(b,c){A.trace("Downloading",b);var d={url:b.url,responseType:Ac,headers:{},i:H(D)};d.headers.Range="bytes="+b.offset+"-"+(b.offset+b.size-1);a.ua.N(d,function(a){A.trace("imgsub: request status "+
a.c);a.c?c(null,new ab(a.content)):c({errorSubCode:a.g,errorExternalCode:a.P})})}function H(b){if(a.I)return a.I.filter(function(a){return a.id==b})[0]}var A=new a.log.r("TimedTextTrack"),J=jl,x={Bcp47:f,TrackId:b,DownloadableId:c},X=Kb(q),N=m&&"nflx-cmisc"==m,ga,D,F={type:gh,ka:b,Yk:k,Pq:l,gk:m,J:c,bb:f,displayName:g,getEntries:function(a){X(function(b){a(b)})},Jg:function(){return J},Ga:x,Sj:N,vp:function(){return ga}};return F}function Dj(a){function b(){w.start();a.A.value!=$c&&w.stop()}function c(){D&&
v.info("Deactivating",D);a.ec.set(null);w.Ik(B=h);g();var b=a.$.value;b&&(v.info("Activating",b),b.getEntries(d));D=b;f()}function d(b){var c=b.track;if(c==a.$.value){if(c.Sj)b.c?(N=c.vp(),q("addListener"),v.info("Activated",c),a.ec.set(c),ta(function(){N.tc(a.ha.Be())})):v.error("Failed to activate img subtitle ",b,c);else{var g=b.entries;g?(w.Ik(B=g),v.info("Activated",c),a.ec.set(c)):v.error("Failed to activate",eb(b),c)}f()}}function f(){var b;a.state.value==db&&a.A.value!=Qb&&(B?b=w.gp():a.$.value&&
(b=u[a.$.value.Jg()]));b&&b.startTime&&(A++,x+=w.Hg()-b.startTime,r.he=md(x/(A+0)));a.Kh.set(b)}function g(){N&&(N.stop(),q("removeListener"));N=h}function k(a){r.fireEvent(kl,a);v.debug("showsubtitle",a)}function l(a){r.fireEvent(ll,a);v.debug("removesubtitle",a)}function m(){N.tc(a.ha.Be())}function n(){N.pause()}function q(b){N[b]("showsubtitle",k);N[b]("removesubtitle",l);"addListener"==b?(a.addEventListener(Ah,m),a.addEventListener(Bh,n)):(a.removeEventListener(Ah,m),a.removeEventListener(Bh,
n))}var v=new a.log.r("TimedTextManager"),r=this,u={},B,w=new ge,A=0,x=0,D,X=new rb,N;this.he=null;r.addEventListener=X.addListener;r.removeEventListener=X.removeListener;r.fireEvent=X.B;this.Rf=function(b,c){var d="custom"+ ++ml,f=new ic(a,d,"1",b,"xx",c||d,qf,"primary","custom",{});a.Ma.push(f);a.Ab.forEach(function(a){a=a.Ma;0>a.indexOf(f)&&a.push(f)});a.fireEvent(hj);return f};u[gj]={hw:!0};u[Dh]={wv:!0};a.$.addListener(c);a.addEventListener(Zc,c);a.A.addListener(b);a.addEventListener(vf,b);a.addEventListener(Ab,
function(){B=h;g();w.stop();f()});w.Hg=a.ha.Be;w.jh=f}function Ej(a){function b(){d.Pr()}var c=a.Xa,d=new yc(v.Ts),f=a.ac;d.rs(f.width/f.height);c.appendChild(d.sj());a.Kh.addListener(function(a){d.us(a.newValue)});a.addEventListener(Ab,function(){gb.removeListener(Eh,b);c.removeChild(d.sj())});gb.addListener(Eh,b);this.Bh=d.Bh}function Fj(a){function b(){g(a.v.value);for(var c=0,d=u.length;d--;)c+=u[d].endTime-u[d].startTime;return c}function d(a){g(a.ih);w=a.hk;q=m=h;p&&(p.startTime=w)}function f(b){l(p,
B,a.v.value);p=b.newValue?{i:b.newValue.i,track:b.newValue,startTime:a.v.value,endTime:145152E5}:h}function g(a){m&&q&&(a=Fa(a,m.endTime),a=Fa(a,q.endTime),l(m,r,a),m.startTime=a,l(q,u,a),q.startTime=a,p&&(l(p,B,a),p.startTime=a),w=a)}function k(b,c,d){b&&l(b,c,Fa(b.endTime,a.v.value));if(d)return b=d.G,c=d.stream,{i:d.i,track:c.track,stream:c,startTime:Ea(b.startTime,w),endTime:b.endTime}}function l(a,b,c){a&&c>=a.startTime&&(a={i:a.i,track:a.track,stream:a.stream,startTime:a.startTime,endTime:c},
(c=b[b.length-1])&&c.track==a.track&&c.stream==a.stream&&c.i==a.i&&c.endTime==a.startTime?c.endTime=a.endTime:b.push(a))}var m,q,p,r=[],u=[],B=[],w=a.v.value,A={},H=!1,x={},J=v.rn,N=J.length;(function(){a.addEventListener(fj,d);a.Yb.addListener(function(a){m=k(m,r,a.newValue)});a.ub.addListener(function(a){q=k(q,u,a.newValue)});a.ec.addListener(f)})();for(A.abrdel=0;N--;)x["abrdel"+J[N]]=0,A["abrdel"+J[N]]=0;n(this,{Cj:b,hp:function(){g(a.v.value);return{audio:ke(r,$h),video:ke(u,$h)}},zp:function(){return{total:b(),
audio:ke(r,Yf),video:ke(u,Yf),timedtext:ke(B,Yf)}},jp:function(){g(a.v.value);var b=ke(u,Gj),c,d,f=0;for(d=b.length;d--;)c=b[d],f+=c.duration;if(!f)return 0;var h=0;for(d=b.length;d--;)c=b[d],h+=c.f*c.duration/f;A.abrdel=jb(h);return A.abrdel},kp:function(){if(!H){for(var a=J.length,d=b();a--;){var f=J[a];if(0==x["abrdel"+f]&&d>1E3*f){for(var g=0,h=u.length,k,l=0,m=0;m<h&&!(k=u[m],g+=k.stream.f*(k.endTime-k.startTime),l+=k.endTime-k.startTime,k=k.stream.f,l>1E3*f);m++);g&&(x["abrdel"+f]=jb((g-k*(l-
1E3*f))/(1E3*f)))}}0!==x["abrdel"+J[J.length-1]]&&(H=!0);c(x,function(a,b){A[a]=0==b?A.abrdel:b})}return A}})}function ke(a,b){var c=[],d,f,g={},h,k,l=a.length,m;for(m=0;m<l;m++)h=a[m],k=b(h),f=k.key,d=g[f],h=h.endTime-h.startTime,d?d.duration+=h:(delete k.key,d=k,d.duration=h,c.push(d),g[f]=d);return c}function Yf(a){var b,c=a.stream;c?(a=c.J,b=c.f):a=a.track.J;return{key:a+"$"+(b||0),downloadableId:a,bitrate:b}}function $h(a){var b=Yf(a);a=a.i.id;b.key+="$"+a;b.cdnId=a;return b}function Gj(a){a=
(a=a.stream)?a.f:0;return{key:a,f:a}}function Hj(a){var b=v.lr;if(b){var c=function(){a.state.value!=db||a.A.value!=sf&&a.A.value!=Oc?d.wb():d.jc()},d=new Jc(b,a.Pa.bind(a,new Hb(U.Ff))),f;a.A.addListener(c);a.state.addListener(c);if(v.Nj){var g=ja();f=new Hc(v.Nj,function(){var c=ja();c-g>b&&(a.Pa(new Hb(U.Cf)),f.pd());g=c});f.Ch()}a.addEventListener(Ab,function(){d.wb();ia(f)&&f.pd()})}}function Ij(a,b,d,f,g,h,k,l){function m(a){var b;c(a,function(a,c){if(!b){var d=H[c];d?d<v.$s+1&&(H[c]++,b={url:c,
Qi:a}):(H[c]=1,b={url:c,Qi:a})}});return b}function p(b){u.trace("Downloading",b.url,w);a.ua.N({responseType:Ac,i:q(b.Qi),url:b.url,track:r},function(b){if(b.c)try{x=Lj(b.content),B=Fh,u.trace("TrickPlay parsed",{Images:x.images.length},w),a.fireEvent(ij)}catch(c){B=jj,u.error("TrickPlay parse failed.",c)}else B=kj,u.error("TrickPlay download failed.",eb(b),w)})}function q(b){for(var c=0;c<a.I.length;c++){var d=a.I[c];if(d&&d.id==b)return d}}var r=this,u=new a.log.r("TrickPlay"),B=kj,w={},H={},A=
!0,x;n(r,{type:zi,id:b,N:function(){var a=m(l);a?(B=Gh,p(a)):A=!1},sp:function(a){if(x&&(a=ya(a/x.j.Xk),0<=a&&a<x.images.length))return{image:x.images[a],time:a*x.j.Xk,height:d,width:f,pixelAspectHeight:g,pixelAspectWidth:h}},Ap:function(){return A},Jg:function(){return B},Aj:function(){switch(B){case Fh:return"downloaded";case Gh:return"loading";case nl:return"downloadfailed";case jj:return"parsefailed";default:return"notstarted"}},Ga:w,size:k})}function Jj(a){function b(){var d=a.xb,f=d.Jg();f!=
Gh&&(f!=Fh&&d.Ap()?(d=!1,a.Md.Cj()<v.dt&&(d=a.k.value.f>v.ct),d&&(d=a.$b[a.$b.length-1],c(d.size))?a.Wd.zk="h":(d=a.$b[0],c(d.size)?a.Wd.zk="l":d=void 0),d&&(a.Wd.offset=ja(),a.xb=d,a.xb.N())):a.removeEventListener(Yd,b))}function c(b){var d=Fa(a.n.Fa(),a.n.qb());b=a.aa.ga(b);b*=1+.01*v.fe[2];return b<d*v.et}a.Wd={};a.$b&&0<a.$b.length&&(a.xb=a.$b[a.$b.length-1],a.xb&&a.addEventListener(Zc,function(){a.addEventListener(Yd,b)}))}function bi(a,b){function c(){return k===Hh}function d(a){n(a,{success:!1,
state:k});n(a,E);nd.flush();B&&mb(B);w&&mb(w);H.resolve(a);A.resolve(a);x.resolve(a);D.resolve(a);k=Ih;v.ds&&lj.show()}function f(a,b){return Xa(function(){d({ErrorCode:U.Um,ErrorDetails:a.name+" promise expired"})},b)}var g=this,k,l,m,p=new a.log.r("SSManager"),q=new rb,r=v.gs,u=v.fs,B,w,H,A,x,D,F,M,z,E={};n(g,{Rc:function(){p.trace("initiaing");H=Zf("keymessage");A=Zf("server_response");x=Zf("keyadded");D=Zf("complete");k=Hh;b&&v.Bk&&("playready"==fa()&&(b=S("*")),new ai(a,b,g),r=v.ks);B=f(H,r);
D.Pd.then(p.info.bind(p,"complete"));F=ja();q.B(Hi)},addEventListener:q.addListener,removeEventListener:q.removeListener,Me:function(){return k>=Hh&&k<Ih},cl:function(){return H.Pd},aq:c,Oh:function(a){M=ja();E.ss_km=M-F;if(c()){k=mj;l=a.Bb;m=a.ic;var b={},d,f;"widevine"==m?(d="widevinecef",f=S(a.Bb)):"fps"==m?(d="fps",f=S(a.Bb)):"playready"==m&&(d="playreadynative",f=a.Bb);b[d+"securestop"]=f;H.resolve({c:!0,data:b});mb(B);B=h}},Th:function(){return A.Pd},Ph:function(a){z=ja();E.ss_sr=z-M;var b=
A;if(k===mj){if(a.c)if("widevine"==m){var c="";try{c=ua(a.Yc.securestopack.widevinecefsecureack),b.resolve({c:!0,kd:zc(c),Bb:l}),k=yg}catch(g){d({ErrorCode:U.si,ErrorDetails:N(g)})}}else if("fps"==m)b.resolve({c:!0,kd:id("acknowledged")}),k=yg;else{if("playready"==m)try{c=ua(a.Yc.securestopack.playreadysecureack),b.resolve({c:!0,kd:zc(c),Bb:l})}catch(h){d({ErrorCode:U.si,ErrorDetails:N(h)})}}else b=a.g&&0<=[P.ti,P.Lf].indexOf(a.g)?U.Vm:U.Gm,d({ErrorCode:b,ErrorDetails:a.C||"",ErrorNccpCode:a.td||
"",ErrorSubCode:a.g||""});k==yg&&(w=f(x,u))}},Uy:function(){return x.Pd},$p:function(){return k===yg},$k:function(a){E.ss_ka=ja()-z;k=Ih;var b={success:!0};ia(a)&&(b.attempts=a);n(b,E);D.resolve(b);mb(w);w=h},Yd:function(){return D.Pd},terminate:d})}function Zf(a){var b={},c=new Vd(function(a,c){b.resolve=a;b.reject=c});b.name=a;b.Pd=c;return b}function ai(a,b,c){function d(){try{if("fps"===M)D=new Qc(F),w.webkitSetMediaKeys(D),Cb(a,function(a){a.c?(S=a.me,f()):(E.error("fps certificate failed"),
r(U.Nm,h,a))});else if("playready"===M){D=new Qc(F);var b=new ab(uc('<PlayReadyCDMData type="SecureStop"><SecureStop version="1.0" ><SessionID encoding="base64encoded">'+x+'</SessionID><ServerCert encoding="base64encoded">Q0hBSQAAAAEAAAUMAAAAAAAAAAJDRVJUAAAAAQAAAfwAAAFsAAEAAQAAAFhr+y4Ydms5rTmj6bCCteW2AAAAAAAAAAAAAAAJzZtwNxHterM9CAoJYOM3CF9Tj0d9KND413a+UtNzRTb/////AAAAAAAAAAAAAAAAAAAAAAABAAoAAABU8vU0ozkqocBJMVIX2K4dugAAADZodHRwOi8vbnJkcC5uY2NwLm5ldGZsaXguY29tL3Jtc2RrL3JpZ2h0c21hbmFnZXIuYXNteAAAAAABAAUAAAAMAAAAAAABAAYAAABcAAAAAQABAgAAAAAAglDQ2GehCoNSsOaaB8zstNK0cCnf1+9gX8wM+2xwLlqJ1kyokCjt3F8P2NqXHM4mEU/G1T0HBBSI3j6XpKqzgAAAAAEAAAACAAAABwAAAEgAAAAAAAAACE5ldGZsaXgAAAAAH1BsYXlSZWFkeSBNZXRlcmluZyBDZXJ0aWZpY2F0ZQAAAAAABjIwMjQ4AAAAAAEACAAAAJAAAQBAU73up7T8eJYVK4UHuKYgMQIRbo0yf27Y5EPZRPmzkx1ZDMor7Prs77CAOU9S9k0RxpxPnqUwAKRPIVCe0aX2+AAAAgBb65FSx1oKG2r8AxQjio+UrYGLhvA7KMlxJBbPXosAV/CJufnIdUMSA0DhxD2W3eRLh2vHukIL4VH9guUcEBXsQ0VSVAAAAAEAAAL8AAACbAABAAEAAABYyTlnSi+jZfRvYL0rk9sVfwAAAAAAAAAAAAAABFNh3USSkWi88BlSM6PZ2gMuceJFJ9hzz0WzuCiwF9qv/////wAAAAAAAAAAAAAAAAAAAAAAAQAFAAAADAAAAAAAAQAGAAAAYAAAAAEAAQIAAAAAAFvrkVLHWgobavwDFCOKj5StgYuG8DsoyXEkFs9eiwBX8Im5+ch1QxIDQOHEPZbd5EuHa8e6QgvhUf2C5RwQFewAAAACAAAAAQAAAAwAAAAHAAABmAAAAAAAAACATWljcm9zb2Z0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAUGxheVJlYWR5IFNMMCBNZXRlcmluZyBSb290IENBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAMS4wLjAuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAIAAAAkAABAECsAomwQgNY0bm6U6Au9JRvwjbNnRzmVkZi+kg7npnRQ2T+4LgyrePBdBRQ3qb/jxXkn++4sOFa7vjRpFBzV0MMAAACAIZNYc/yJW5CLFaLPCgAHPs+FSdlhYS6BSG3mxgo2TbeHYJqj8Pm5/p6kNXKKUbx9kou+59dz/5+Q060QpP6xas=</ServerCert></SecureStop></PlayReadyCDMData>'));
z=D.createSession("video/mp4",new ab,b);u(z,"addEventListener")}else E.error("Unsupported drm type ",M),r(U.Im)}catch(c){E.error("Exception on webkitSetMediaKeys",c),r(U.Qm,c)}}function f(){T++;try{z=D.createSession("keyrelease",S),u(z,"addEventListener")}catch(a){E.error("create session error",a),r(U.Hm,a)}}function g(a){var b=a.message;"fps"==fa()?Kj(b,x).then(function(a){a?k(b):(l(id("acknowledged")),L=!0,P=Xa(function(){r(U.Pm)},v.js))}).catch(function(a){E.error("exception on matching persisted keysessionId",
a);r(U.Sm,a)}):"playready"==fa()&&(b=ib(b,"PlayReadyKeyMessage","Challenge"),c.Oh({c:!0,Bb:b,ic:fa(),Ne:x}),c.Th().then(function(a){a.c&&l(a.kd)}))}function k(a){c.Oh({c:!0,Bb:a,ic:fa(),Ne:x});c.Th().then(function(a){a.c&&l(a.kd)});L=!1}function l(a){try{z&&z.update(a)}catch(b){E.error("Exception calling keySession.update ",b),r(U.Rm,b)}}function m(){L?(L=!1,mb(P),u(z,"removeEventListener"),z.close(),T<C?f():r(U.Lm)):(c.$k(T),z.close())}function p(a){var b=Oe(a,Kc);E.error("Received event: keyerror",
b.Se);var d;a:{try{var f=a.target.error,g=f.code,k=f.systemCode;if("fps"==fa()){if(2==g&&"560820082"==k){d=!0;break a}}else if("playready"==fa()&&1==g&&-2147024637==k){d=!0;break a}}catch(l){}d=void 0}d?r(U.Om):c.Me()&&r(U.Jm,h,eb(b.kc))}function q(a){a=Oe(a,xc);E.error("Video element event: error",a.Se);c.Me()&&r(U.Tm,h,eb(a.kc))}function r(a,b,d){a={ErrorCode:a};b&&(a.ErrorDetails=N(b));d&&n(a,d);a.attempts=T;c.terminate(a)}function u(a,b){a[b](B+"keyerror",p);a[b](B+"keymessage",g);a[b](B+"keyadded",
m)}var B=Sa(),w=Ha("VIDEO"),H,A,x=b,D,F=v.Oe[0],M=fa(),z,E=new a.log.r("SSManagerPersisted"),S,T=0,L,P,C=v.ls;(function(){var b=a.Xa,c=b.lastChild;c?b.insertBefore(w,c):b.appendChild(w)})();try{A=new Dd,A.addEventListener("sourceopen",d),w.addEventListener("error",q),H=yf.createObjectURL(A),w.src=H}catch(na){E.error("Exception creating MediaSource",na),r(U.Mm,na)}c.Yd().then(function(){try{w.removeAttribute("src"),w.load&&w.load()}catch(b){E.error("Exception clearing element context",b)}ia(H)&&yf.revokeObjectURL(H);
z&&z.close();try{a.Xa.removeChild(w)}catch(c){E.error("Exception removing temporary video element from Dom",c)}w=A=null;H=""})}function Kj(a,b){return new Vd(function(c){var d=zg(a),f;wd(d,function(a){f=a.object.dict.string[Ib];c(f==b)})})}function Lj(a){if(!a)throw new Za("invalid array buffer");var b=new ab(a);a=new Yc(b);var c=function(a){if(a.Ea()<nj.length+4+4+4+oj)throw new Za("array buffer too short");nj.forEach(function(b){if(b!=a.Z())throw new Za("BIF has invalid magic.");});var b=a.Rd();
if(b>ol)throw new Za("BIF version in unsupported");var c=a.Rd();if(0==c)throw new Za("BIF has no frames.");var d=a.Rd(),f=a.ia(oj);return{version:b,$q:c,Xk:d,gy:f}}(a);a=function(a){for(var d=[],f=0;f<=c.$q;f++){var g,k={timestamp:a.Rd(),offset:a.Rd()};g!=h&&d.push(b.subarray(g.offset,k.offset));g=k}return d}(a);return{j:c,images:a}}function Mj(b,c,d){function f(){p.Zb.addEventListener("showsubtitle",function(a){g(pl,a,!0)});p.Zb.addEventListener("removesubtitle",function(a){g(ql,a,!0)})}function g(a,
b,c){b=b||{};b.target=r;B.B(a,b,!c)}function k(){k=q;p.load(function(a,b){try{g(rl,h,!0),b(xa)}catch(c){b({g:P.Nb,C:N(c)})}})}function l(){w.set(p.state.value==db&&p.A.value==Oc)}function m(){if(p.state.value==db){for(var a,b,c;b=x.shift();)a=p.Zb.Rf(b.url,b.name),b.Gn&&(c=a);c&&p.$.set(c)}}var r=this,p=gf(b,c,d);b=p.lg;var u=new p.log.r("VideoPlayer"),B=new rb,w=new Va(!1,function(){g(Jh)}),A,x=[];(function(){p.addEventListener(vf,function(){g(pj)});p.addEventListener(Yd,function(){g(qj)});p.addEventListener(Xd,
function(){g(qj)});p.paused.addListener(function(){g(Kh)});p.muted.addListener(function(){g(sl)});p.volume.addListener(function(){g(tl)});p.A.addListener(l);p.state.addListener(l);p.ke.addListener(function(a){A||p.state.value!=db||a.newValue||(A=!0,g(ul));g(vl)});p.W.addListener(function(a){g(wl);a.oldValue&&a.oldValue.Ma==a.newValue.Ma||g(rj);ta(function(){var a=p.W.value.Ma;0<=a.indexOf(p.$.value)||(u.info("Changing timed text track to match audio track"),p.$.set(a[0]))})});p.$.addListener(function(){g(rj)});
p.addEventListener(hj,function(){g(sj)});p.addEventListener(ij,function(){g(xl)});p.state.addListener(function(a){switch(a.newValue){case db:g(yl);g(zl);g(Al);g(sj);g(tj);m();f();break;case qh:p.Da&&g(Bl,p.Da.Mh());break;case pg:g(Cl),B.Ec()}})})();n(r,{addEventListener:B.addListener,removeEventListener:B.removeListener,getElement:function(){return p.Xa},prepare:function(){},load:function(){k()},close:function(a){k=q;p.close(a)},play:function(){k();p.paused.set(!1)},pause:function(){k();p.paused.set(!0)},
getPaused:function(){return p.paused.value},getMuted:function(){return p.muted.value},setMuted:function(a){p.muted.set(!!a)},getVolume:function(){return p.volume.value},setVolume:function(a){p.volume.set(qa(a,0,1))},getEnded:function(){return w.value},getBusy:function(){var a=p.ke.value;if(a)return{networkStalled:!!a.Nk,stalled:!!a.Nk,progress:a.df,progressRollback:!!a.Ar}},getError:function(){var a=p.Da;return a&&a.Mh()},getCurrentTime:function(){return p.v.value},getBufferedTime:function(){var a=
p.n;if(a)return a.np()},getDuration:function(){return p.duration},seek:function(a){p.ha?p.ha.seek(a):p.ob=a},getVideoSize:function(){return p.ac?{width:p.ac.width,height:p.ac.height}:null},getAudioTrackList:function(){for(var a=[],b=0;b<p.Ab.length;b++)a.push(le(p.Ab[b]));return a},getAudioTrack:function(){return le(p.W.value)},setAudioTrack:function(a){for(var b,c=0;c<p.Ab.length;c++)if(b=p.Ab[c],le(b)==a){p.W.set(b);return}u.error("Invalid setAudioTrack call")},getTimedTextTrackList:function(){for(var a=
p.W.value.Ma,b=[],c=0;c<a.length;c++)b.push(le(a[c]));return b},tryRecoverFromStall:function(){p.Xd()},getTimedTextTrack:function(){return le(p.$.value)},setTimedTextTrack:function(a){for(var b=p.W.value.Ma,c,d=0;d<b.length;d++){c=b[d];if(!a&&null==c){p.$.set(null);return}if(le(c)==a){u.info("Setting Timed Text, profile:"+c.gk);p.$.set(c);return}}u.error("Invalid setTimedTextTrack call")},setTimedTextBounds:function(a){p.Lh&&p.Lh.Bh(a)},getTrickPlayFrame:function(a){if(p.xb)return p.xb.sp(a)},getXid:function(){return p.qa},
getAdditionalLogInfo:function(){return n({playerver:"2.0000.340.011",jssid:xe,groupName:v.Fe,xid:p.qa,pbi:p.index},Xc,{prefix:"pi_"})},induceError:function(a){p.Pa(new Hb(U.ol,P.cc,a))},loadCustomTimedTextTrack:function(b,c,d){if(!a(b))throw new Za("invalid url");x.push({url:b,name:c,Gn:d});m()},diagnostics:{addEventListener:b.addEventListener,removeEventListener:b.removeEventListener,getModel:b.xp,getTime:ja,getGroups:function(){return p.af.tp()}}})}function le(a){return a?(a.ph=a.ph||{trackId:a.ka,
bcp47:a.bb,displayName:a.displayName,trackType:a.Yk,channels:a.Ri},a.Sj&&(a.ph.isImageBased=!0),a.ph):null}function Nj(a,b,c){function d(){r.set(!1);k()<c-1&&a.play()}function f(){r.set(!0);a.pause()}function g(){var b=k()>=c||a.getEnded();b&&a.pause();r.value?f():d();v.set(b)}function k(){return qa(a.getCurrentTime()-b,0,c)}function h(d){a.seek(qa(b+d,b,b+c-2E3));g()}var l=Mb.create(a),m=new rb,q=Fb([Kh,Jh]),r=new Va(!1,function(){m.B(Kh)}),v=new Va(!1,function(){m.B(Jh)});h(b||0);a.addEventListener(tj,
function(){var d=a.getDuration();b=Fa(d-2E3,b||0);c=Fa(d-b,c||d);h(0)});a.addEventListener(pj,g);n(l,{addEventListener:function(b){(q[b]?m.addListener:a.addEventListener).apply(null,arguments)},removeEventListener:function(b){(q[b]?m.removeListener:a.removeEventListener).apply(null,arguments)},play:d,pause:f,getPaused:function(){return r.value},getEnded:function(){return v.value},getCurrentTime:k,getDuration:function(){return c},seek:h});return l}var xa={c:!0},Og=["en-US"],Oj="hevc-dv-main10-L30-dash-cenc hevc-dv-main10-L31-dash-cenc hevc-dv-main10-L40-dash-cenc hevc-dv-main10-L41-dash-cenc hevc-dv-main10-L50-dash-cenc hevc-dv-main10-L51-dash-cenc".split(" "),
Pj=["4E657466-6C69-7850-6966-665374726D21","4E657466-6C69-7848-6165-6465722E7632"],Yb=C.navigator,kc=Yb.userAgent,lf=C.location,we=C.screen,Wd=C.performance,ub=C.document,jd=C.Array,Ag=jd.prototype,Qj=Ag.sort,Wg=Ag.slice,pf=Ag.filter,gk=Ag.forEach,Mb=C.Object,Bg=Mb.create,Ck=Mb.keys,Lh=C.Date,mf=Lh.now,el=C.String.fromCharCode,Mc=C.parseInt,rc=C.parseFloat,Pa=C.Math,ya=Pa.floor,md=Pa.ceil,jb=Pa.round,Ea=Pa.max,Fa=Pa.min,kf=Pa.random,Bc=Pa.abs,dh=Pa.pow,Dk=Pa.sqrt,Za=C.Error,ob=C.JSON,Cg=C.escape,
Xg=C.unescape,Ud=C.encodeURIComponent,ei=C.decodeURIComponent,xi=C.XMLHttpRequest,ab=C.Uint8Array,Vd=C.Promise,yf=C.URL||C.webkitURL,zf=C.HTMLVideoElement,Dd=C.MediaSource||C.WebKitMediaSource,Qc=C.MediaKeys||C.WebKitMediaKeys||C.MSMediaKeys,sk=C.XMLSerializer,rk=C.DOMParser,Af=C.nfCrypto||C.webkitCrypto||C.msCrypto||C.crypto,Cc=Af&&(Af.webkitSubtle||Af.subtle),Dl=C.nfCryptokeys||C.webkitCryptokeys||C.msCryptokeys||C.cryptokeys,ah,bh,Dc,Mh,uj=C.PERSISTENT,El=C.requestFileSystem||C.webkitRequestFileSystem,
ek=C.Blob,li=C.FileReader,Nh=Yb.persistentStorage||Yb.webkitPersistentStorage,Fl=Nh?h:C.storageInfo||C.webkitStorageInfo;try{ah=C.indexedDB}catch(Gl){bh=Gl||"noex"}try{Dc=C.localStorage}catch(Hl){Mh=Hl||"noex"}var Vg=/^\S+$/,gi=function(){function a(c){return b[c]}var b={"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"},c=/[&'"<>]/g;return function(b){return b.replace(c,a)}}(),di=function(){var a=/^\s+|\s+$/gm;return function(b){return b.replace(a,"")}}(),hk,fg,Oh,hh,qk,yk,dl,cl,Di,vj,Xc,
ni,ok,pk,oi,ch,qi,ri,kk,mk,ti,ui,nk,si,lk,pi,Ph=/CrOS/.test(kc),wj=/OPR/.test(kc);fg=Ph?"C":wj?"O":"M";Oh=/OPR/.test(kc)?"NFCDOP-01-":/Windows NT/.test(kc)?"NFCDCH-02-":/Intel Mac OS X/.test(kc)?"NFCDCH-MC-":/CrOS/.test(kc)?"NFCDCH-01-":"NFCDCH-LX-";hh=Ph?"chromeos-cadmium":wj?"opera-cadmium":"chrome-cadmium";vj=/CrOS/.test(kc);oi=["heaac-2-dash"];ch=["playready-h264mpl30-dash","playready-h264mpl31-dash"];Ph&&ch.push("playready-h264mpl40-dash");qi=["dfxp-ls-sdh","simplesdh","nflx-cmisc"];ri=["com.widevine.alpha"];
ti=!!C.MediaSource;ui=!C.MediaSource;pi=function(a){return a};si={MONOSPACED_SERIF:"font-family:Courier New,Arial,Helvetica;font-weight:bolder",MONOSPACED_SANS_SERIF:"font-family:Consolas,Lucida Console,Menlo,Monaco,Arial,Helvetica;font-weight:bolder",PROPORTIONAL_SERIF:"font-family:Georgia,Times New Roman,Arial,Helvetica;font-weight:bolder",PROPORTIONAL_SANS_SERIF:"font-family:Arial,Helvetica;font-weight:bolder",CASUAL:"font-family:Gabriola,Segoe Print,Comic Sans MS,Chalkboard,Arial,Helvetica;font-weight:bolder",
CURSIVE:"font-family:Lucida Handwriting,Brush Script MT,Segoe Script,Arial,Helvetica;font-weight:bolder",SMALL_CAPITALS:"font-family:Copperplate Gothic,Copperplate Gothic Bold,Copperplate,Arial,Helvetica;font-variant:small-caps;font-weight:bolder"};ni={droppedFrameRateFilterEnabled:!0,promiseBasedEme:!0};var xj=ma(),Dg;if(!(Dg=xj))a:{try{Yb.plugins.refresh();Dg=ma();break a}catch(Vl){}Dg=void 0}var Il=Dg,Jl=!!be("name",/Chrome Remote Desktop Viewer/i),Kl=!!be("name",/Chromoting Viewer/i),Qh;a:{try{Qh=
Dd.isTypeSupported('video/mp4; codecs="avc1.640028"');break a}catch(Wl){}Qh=void 0}var Ll=Qh,Rh;a:{try{Rh=Ha("VIDEO").canPlayType('video/mp4; codecs="avc1.640028"');break a}catch(Xl){}Rh=void 0}var Ml=Rh,Sh;a:{try{if(g(Yb.requestMediaKeySystemAccess))Ia();else{Sh=Ha("VIDEO").canPlayType('video/mp4; codecs="avc1.640028"',"com.widevine.alpha");break a}}catch(Yl){}Sh=void 0}Xc={wvp:xj,wvp2:Il,crdvp:Jl,cvp:Kl,itsh264:Ll,cpth264:Ml,cpth264wv:Sh};var yj=K(10),zg=yj.hg,id=yj.qg,ci=K(3),zc=ci.hg,Yc=K(4),
th=K(5).Hr,il=K(7);g(ArrayBuffer.prototype.slice)||(ArrayBuffer.prototype.slice=function(a,b){void 0===a&&(a=0);void 0===b&&(b=this.byteLength);a=Pa.floor(a);b=Pa.floor(b);0>a&&(a+=this.byteLength);0>b&&(b+=this.byteLength);a=Pa.min(Pa.max(0,a),this.byteLength);b=Pa.min(Pa.max(0,b),this.byteLength);if(0>=b-a)return new ArrayBuffer(0);var c=new ArrayBuffer(b-a),d=new ab(c),f=new ab(this,a,b-a);d.set(f);return c});var kd=mf()-1,Yg=0,xe=""+(1E4*tb()+ya(1E4*kf())),wa={addSink:function(a){Ae.push(a)},
removeSink:function(a){Ae.splice(Ae.indexOf(a),1)},write:function(a,b,c){a={Ha:this.Ha,level:a,message:b,fields:c||{},time:ja(),index:Nl++,category:this.Pi||"General"};this.mg&&(a.mg=!0);for(b=0;b<Ae.length;b++)Ae[b](a)},ap:function(a,b){this.write(wb.FATAL,a,Wb(arguments))},error:function(a,b){this.write(wb.ERROR,a,Wb(arguments))},warn:function(a,b){this.write(wb.WARN,a,Wb(arguments))},info:function(a,b){this.write(wb.INFO,a,Wb(arguments))},trace:function(a,b){this.write(wb.TRACE,a,Wb(arguments))},
debug:function(a,b){this.write(wb.DEBUG,a,Wb(arguments))},log:function(a,b){this.write(wb.DEBUG,a,Wb(arguments))}};wa.fatal=wa.ap;wa.error=wa.error;wa.warn=wa.warn;wa.info=wa.info;wa.trace=wa.trace;wa.debug=wa.debug;wa.log=wa.log;(wa.r=function(a){this.Pi=a}).prototype=wa;Ld.prototype=wa;var wb={MIN:0,FATAL:0,ERROR:1,WARN:2,INFO:3,TRACE:4,DEBUG:5,MAX:5},Ae=[],Nl=0,Rj=/^\w*Error$/,Tj=/[\r\n]+ */g,Sj=Fb(["Details","Exception","StackTrace"]),Uj={0:"F",1:"E",2:"W",3:"I",4:"T",5:"D"},Vj=0,gb=new rb,Pc=
1,Cd=2,Eh=3,zh=4;ta(function(){function a(b,d){if(c)c.on(b,d);else C.addEventListener(b,d)}var b=C.jQuery,c=b&&b(C),b=(b=C.netflix)&&b.cadmium&&b.cadmium.addBeforeUnloadHandler,d=ub.hidden;b?b(function(a){gb.B(Pc,a)}):a("beforeunload",function(a){gb.B(Pc,a)});a("keydown",function(a){gb.B(Cd,a)});a("resize",function(){gb.B(Eh)});ub.addEventListener("visibilitychange",function(){d!==ub.hidden&&(d=ub.hidden,gb.B(zh))})});var lj=function(){function a(){ub.body&&!c()&&(ub.body.appendChild(k),f(!0))}function b(){c()&&
ub.body.removeChild(k)}function c(){return k.parentNode==ub.body}function d(){g.lb(f)}function f(a){var b=B(u.value),c=A.value?new RegExp(A.value):null,d=w.checked,g="",h,m,t=n.length;for(m=0;m<t;m++)if(h=n[m],h.level<=b&&(h=Ee(h,d,d),!c||c.test(h)))g+=h+"\n";l.value="Version: 2.0000.340.011\n"+($b?"Esn: "+$b.lc+"\n":"")+"JsSid: "+xe+", Epoch: "+tb()+", Start: "+ya(kd/1E3)+", TimeZone: "+(new Lh).getTimezoneOffset()+"\nHref: "+lf.href+"\nUserAgent: "+Yb.userAgent+"\n--------------------------------------------------------------------------------\n"+
g;k.style.cssText=q?"position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;height:30%":"position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;bottom:10px";a&&ta(function(){l.scrollTop=l.scrollHeight})}var g=new Rb(1E3),k=Ha("DIV","position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;bottom:10px",h,{"class":"player-log"}),l=Ha("TEXTAREA","position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.6)"),
m=Ha("DIV","position:absolute;top:2px;right:2px;opacity:0.8;background-color:white"),n=[],q=!0,r;l.setAttribute("wrap","off");l.setAttribute("readonly","readonly");l.addEventListener("focus",function(){r=!0;f(!1);l.style.cssText="position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.86)"});l.addEventListener("blur",function(){r=!1;f(!1);l.style.cssText="position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.6)"});
k.appendChild(l);k.appendChild(m);var u=Ha("SELECT",null,'<option value="1">Error</option><option value="2">Warn</option><option value="3" selected>Info</option><option value="4">Trace</option><option value="5">Debug</option>');u.addEventListener("change",f,!1);m.appendChild(u);var w=Ha("INPUT","display:inline-block;border:1px solid black;padding:3px;");w.setAttribute("type","checkbox");w.setAttribute("checked","true");w.setAttribute("title","Details");w.addEventListener("change",f,!1);m.appendChild(w);
var A=Ha("INPUT","display:inline-block;border:1px solid black;padding:3px;;width:150px");A.addEventListener("keydown",d,!1);A.addEventListener("change",d,!1);A.setAttribute("title","Filter (RegEx)");m.appendChild(A);var x=Ha("BUTTON","display:inline-block;border:1px solid black;padding:3px;","Update");x.addEventListener("click",f,!1);m.appendChild(x);x=Ha("BUTTON","display:inline-block;border:1px solid black;padding:3px;","Clear");x.addEventListener("click",function(){n=[];f()},!1);m.appendChild(x);
x=Ha("BUTTON","display:inline-block;border:1px solid black;padding:3px;","M");x.addEventListener("click",function(){q=!q;f()},!1);m.appendChild(x);x=Ha("BUTTON","display:inline-block;border:1px solid black;padding:3px;","X");x.addEventListener("click",b,!1);m.appendChild(x);gb.addListener(Cd,function(d){d.ctrlKey&&d.altKey&&d.shiftKey&&76==d.keyCode&&(q=!1,c()?b():a())});wa.addSink(function(a){n.push(a);v&&(a=v.mq,0<=a&&n.length>a&&n.shift());c()&&!r?d():g.lb()});return{show:function(){q=!1;a()},
Sg:b,toggle:function(){q=!1;c()?b():a()}}}();wa.addSink(function(a){var b=a.level;if(!v||b<=v.pq){a=Ee(a,!0,!0);var c=C.console;1>=b?c.error(a):2>=b?c.warn(a):c.log(a)}});var Wj=0;n(ee.prototype,{He:!1,$c:0,Vd:0,Ke:0,Bd:!1,Le:0,un:function(a){b(a)&&(a<this.$c&&(this.Vd+=this.$c),this.$c=a,this.He=!0)},op:function(){if(this.He)return this.Bd?this.Le-this.Ke:this.Vd+this.$c-this.Ke},Cs:function(){this.Bd||(this.He&&(this.Le=this.Vd+this.$c),this.Bd=!0)},Ks:function(){this.Bd&&(this.He&&(this.Ke+=this.Vd+
this.$c-this.Le),this.Le=0,this.Bd=!1)}});Yc.prototype.gl=function(a){a=new Yc(a);for(var b,c;;)if(b=a.Ea(),c=b>>>14)c=Fa(4,c),this.Uh(192|c),this.Zd(a,16384*c);else{128>b?this.Uh(b):this.hl(b|32768,2);this.Zd(a,b);break}};Yc.prototype.vk=function(){for(var a=[],b=new Yc(a),c;;){c=this.Z();if(c&128)if(128==(c&192))c&=63,c=(c<<8)+this.Z(),b.Zd(this,c);else if(c&=63,0<c&&4>=c){b.Zd(this,16384*c);continue}else throw new Za("bad asn1");else b.Zd(this,c);break}return new ab(a)};var Xj="0123456789ABCDEF",
vg,zj;(function(){function a(b){return d[b]}var d={'"':'""',"\r":"","\n":" "},f=/["\r\n]/g,g=/[", ]/;zj=function(c){return b(c)?c:Ja(c)?c.replace(f,a):!0===c||!1===c?c:""};vg=function(a){var b=zj,d="";c(a,function(a,c){var f=b(a)+"="+b(c);g.test(f)&&(f='"'+f+'"');d=d?d+(","+f):f});return d}})();Hb.prototype.toString=function(){var a="[PlayerError #"+this.qd+"]";this.C&&(a+=" "+this.C);this.qe&&(a+=" (CustomMessage: "+this.qe+")");return a};Hb.prototype.Mh=function(){var a;this.qe&&(a=["streaming_error"]);
a||"80080017"==this.P&&(a=["admin_mode_not_supported","platform_error"]);if(!a)switch(this.errorCode){case U.Ff:case U.Cf:case U.yf:case U.oi:a=["pause_timeout"];break;case U.ei:case U.gi:a=this.g?["platform_error"]:["multiple_tabs"];break;case U.di:case U.ci:case U.fi:a=["should_signout_and_signin"];break;case U.bi:case U.qi:case U.pi:case U.Kf:case U.ni:a=["platform_error","plugin_error"];break;case U.Jf:a=["no_cdm","platform_error","plugin_error"];break;case U.Hf:a=this.g?["platform_error","plugin_error"]:
["no_cdm","platform_error","plugin_error"];break;case U.If:switch(this.P){case "FFFFD000":a=["device_needs_service","platform_error"];break;case "48444350":a=["unsupported_output","platform_error"];break;case "00000024":a=["private_mode"]}}!a&&fe(this.g)&&(a=["internet_connection_problem"]);if(!a)switch(this.g){case P.Mf:a=["should_upgrade"];break;case P.li:case P.Df:a=["should_signout_and_signin"];break;case P.mi:a=["internet_connection_problem"];break;case P.xi:case P.yi:case P.ui:a=["storage_quota"];
break;case P.Dm:case P.Bm:case P.Em:case P.Cm:case P.Vh:a=["platform_error","plugin_error"];break;case P.ll:case P.Zh:case P.$h:a=["private_mode"]}switch(this.g){case P.ai:case P.wi:case P.zi:case P.Lf:v.zn&&(a=["please_call"])}a=a||[];a.push(fg+this.errorCode);this.g&&a.push(""+this.g);a={display:{code:this.qd,text:this.qe},messageIdList:a};this.Ic&&(a.nccpActionId=this.Ic);this.Jc&&(a.mslErrorCode=this.Jc);return a};var U={cc:7001,$d:7010,ul:7014,di:7016,ci:7017,fi:7018,ei:7020,gi:7022,Ll:7029,
Kl:7031,Hl:7041,Il:7042,Jl:7043,Dl:7051,wl:7052,El:7053,Fl:7054,It:7055,Lt:7056,Pt:7057,xl:7058,bi:7059,Kt:7060,Jt:7061,Ot:7062,yl:7063,Al:7064,zl:7065,Bl:7066,Cl:7067,Qt:7068,vl:7069,Mt:7081,Nt:7082,Gl:7083,Sl:7111,Ul:7113,Tl:7115,Vl:7117,bm:7121,Yl:7123,Zl:7125,Yt:7130,eu:7131,cu:7133,fm:7202,lm:7330,nu:7331,oi:7332,mm:7333,om:7334,qi:7351,pi:7352,km:7353,Hf:7354,Kf:7355,ni:7356,Jf:7357,sm:7358,gm:7359,pu:7360,pm:7361,If:7363,Gf:7364,qm:7365,um:7367,vm:7371,wm:7373,Am:7375,zm:7376,ym:7377,ou:7379,
xm:7381,rm:7385,hm:7391,im:7392,jm:7393,ol:7400,Ff:7500,Cf:7502,yf:7510,Um:7600,Fm:7601,Wm:7602,Gm:7603,si:7604,Vm:7605,Km:7620,Om:7621,Lm:7622,Mm:7623,Qm:7624,Hm:7625,Nm:7626,Sm:7627,Pm:7628,Jm:7631,Tm:7632,Rm:7633,Im:7634},P={cc:1001,Nb:1003,jl:1011,kl:1013,il:1015,Xh:1101,Yh:1102,bd:1103,Wh:1104,Bf:1105,cd:1106,Za:1107,Af:1108,ql:1110,ae:1203,ce:1204,Pl:1250,Rt:1251,Ut:1252,St:1253,Vt:1254,Tt:1255,ml:1260,Et:1261,zt:1262,Dt:1263,Ct:1264,Bt:1265,At:1266,nl:1269,bu:1303,cm:1305,Ef:1309,du:1311,fu:1312,
au:1313,$t:1315,Zt:1317,Xl:1321,Wl:1323,dm:1331,li:1333,mi:1337,gu:1341,$l:1343,am:1344,uc:1402,tu:1403,xi:1405,yi:1407,vi:1411,wi:1412,hn:1414,zi:1415,ti:1417,Lf:1418,ui:1421,dn:1423,uu:1425,$m:1427,cn:1429,bn:1431,en:1432,gn:1451,fn:1453,mu:1501,lu:1502,hu:1504,ju:1506,iu:1508,ku:1515,Vh:1553,ll:1555,Dm:1603,Bm:1605,Em:1607,Cm:1609,su:1625,qu:1627,ru:1629,Gt:1701,pl:1713,Ht:1715,Ft:1721,zf:1723,Zh:1802,tl:1803,$h:1804,sl:1805,ai:1807,rl:1809,Wt:1901,Ql:1911,ji:1913,Rl:1915,hi:1931,ki:1933,ii:1935,
Df:1957,Mf:2103,jn:2105,kn:2107},tg,Ub,Eg,Th,fi={};(function(){var a=new wa.r("loadAsync"),b=[];Ub=function(a,c){b.push({jq:c,ko:a})};tg=Kb(function(c){function d(){var c,h,l;if(c=b.shift())try{h=c.jq,g=l=c.ko,k.wb(),k.jc(),h(function(a){a.c?d():(a.errorCode=a.errorCode||l,f(a))})}catch(m){a.error("Exception while loading component",m),f({errorCode:l,g:P.jl,C:""+m})}else f(xa)}function f(a){Th=ja();f=q;k.wb();c(a)}Eg=ja();var g=0,k=new Jc(v.Cn,function(){a.error("Load timed out");f({errorCode:g,g:P.kl})});
d()})})();var Yj=/^[0-9.]*$/,Zj=/^([a-fA-F0-9]*:){2}[a-fA-F0-9:.]*$/,za={};(function(){za.Zu=function(a,b){return a<b?-1:a===b?0:1};za.jg=function(a,b){return a===b};za.dv=function(a){return null===a?"BUCKETS_NULL":za.Ed(a)?"BUCKETS_UNDEFINED":za.Wp(a)?a:a.toString()};za.Tp=function(a){return"function"===typeof a};za.Ed=function(a){return a===h};za.Wp=function(a){return"[object String]"===Mb.prototype.toString.call(a)};za.iy=function(a){return za.Tp(a)?function(b,c){return-1*a(b,c)}:function(a,b){return a<
b?1:a===b?0:-1}};za.Pu=function(a){return function(b,c){return 0===a(b,c)}};za.fa=function(){this.la=this.T=null;this.ya=0};za.fa.prototype.add=function(a,b){za.Ed(b)&&(b=this.ya);if(0>b||b>this.ya||za.Ed(a))return!1;var c=this.createNode(a);if(0===this.ya)this.la=this.T=c;else if(b===this.ya)this.la=this.la.next=c;else if(0===b)c.next=this.T,this.T=c;else{var d=this.ik(b-1);c.next=d.next;d.next=c}this.ya++;return!0};za.fa.prototype.first=function(){return null!==this.T?this.T.element:h};za.fa.prototype.Q=
function(){return null!==this.la?this.la.element:h};za.fa.prototype.indexOf=function(a,b){var c=b||za.jg;if(za.Ed(a))return-1;for(var d=this.T,f=0;null!==d;){if(c(d.element,a))return f;f++;d=d.next}return-1};za.fa.prototype.contains=function(a,b){return 0<=this.indexOf(a,b)};za.fa.prototype.remove=function(a,b){var c=b||za.jg;if(1>this.ya||za.Ed(a))return!1;for(var d=null,f=this.T;null!==f;){if(c(f.element,a))return f===this.T?(this.T=this.T.next,f===this.la&&(this.la=null)):(f===this.la&&(this.la=
d),d.next=f.next,f.next=null),this.ya--,!0;d=f;f=f.next}return!1};za.fa.prototype.clear=function(){this.la=this.T=null;this.ya=0};za.fa.prototype.equals=function(a,b){var c=b||za.jg;return a instanceof za.fa&&this.size()===a.size()?this.Yo(this.T,a.T,c):!1};za.fa.prototype.Yo=function(a,b,c){for(;null!==a;){if(!c(a.element,b.element))return!1;a=a.next;b=b.next}return!0};za.fa.prototype.Or=function(){if(!(0>=this.ya)){if(1===this.ya)this.la=this.T=null;else{var a=this.ik(-1);null===a?this.T=this.T.next:
a.next===this.la&&(this.la=a);null!==a&&(a.next=a.next.next)}this.ya--}};za.fa.prototype.forEach=function(a){for(var b=this.T;null!==b&&!1!==a(b.element);)b=b.next};za.fa.prototype.reverse=function(){for(var a=null,b=this.T,c=null;null!==b;)c=b.next,b.next=a,a=b,b=c;c=this.T;this.T=this.la;this.la=c};za.fa.prototype.size=function(){return this.ya};za.fa.prototype.ik=function(a){if(0>a||a>=this.ya)return null;if(a===this.ya-1)return this.la;for(var b=this.T,c=0;c<a;c++)b=b.next;return b};za.fa.prototype.createNode=
function(a){return{element:a,next:null}};za.zb=function(){this.list=new za.fa};za.zb.prototype.Gc=function(a){return this.list.add(a)};za.zb.prototype.Dc=function(){if(0!==this.list.size()){var a=this.list.first();this.list.Or();return a}return h};za.zb.prototype.$e=function(){return 0!==this.list.size()?this.list.first():h};za.zb.prototype.size=function(){return this.list.size()};za.zb.prototype.contains=function(a,b){return this.list.contains(a,b)};za.zb.prototype.clear=function(){this.list.clear()};
za.zb.prototype.forEach=function(a){this.list.forEach(a)}})();var ak=function(){function a(b){if(Wa(b)){b=b.toLowerCase();if("#"==b[0]){if(7==b.length)return b;if(4==b.length)return"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]}return Ol[b]}}function b(a,c,d){c=c[a];0<=c||(c=rc(a));if(0<=c)return Fa(c,d)}function d(a,b){var c=a.length,f=a[c-1];if("t"===f)return rc(a)*b|0;if("s"===f)return"m"===a[c-2]?rc(a)|0:1E3*rc(a)|0;if((c=a.match(C))&&4<=c.length)return 1E3*(3600*Mc(c[1],10)+60*Mc(c[2],10)+rc(c[3]))|0;throw new Za("dfxp-badtime");
}function g(a,b,c,d,f){var k;if(a){var l=a.style;c=l?c[l]:h;d=(l=a.region)?d[l]:h;for(var m=l=f.length,n,p,t,q,r,m=0;m<l;m++)if(n=f[m],p=a[n],p===h&&c&&(p=c[n]),p===h&&d&&(p=d[n]),p!==h&&p!==b[n]){if(!k)for(k={},t=0;t<l;t++)q=f[t],r=b[q],r!==h&&(k[q]=r);k[n]=p}}return k||b}function k(a,b,c,d,f,l,m,p,t){function q(a,k,y){var w=a[Zb],B=w.style||k.style||"",x=w.region||k.region||"",A,G;B||x?(A=B+"/"+x,G=c[A]):G=b;if(!G){G=b;var O;O=Ec(d);n(O,f[B]);G=u(G,O,m,p,t);c[B+"/"]=G;x&&(n(O,l[x]),n(O,f[B]),G=
u(G,O,m,p,t),c[A]=G)}if(!y)a:{for(y=T.length;y--;)if(w[T[y]]!==h){y=!0;break a}y=void 0}y&&(w=g(w,k,f,l,S),G=u(G,w,m,p,t));k=(a=a[fh])&&a.length;for(B=0;B<k;B++)x=a[B],ra(x)?K.test(x[ig])?v++:q(x,w,y):(r.push({text:x,lineBreaks:v,style:G}),v=0)}var r=[],v=0;q(a,d,!1);0<v&&r.push({text:"",lineBreaks:v,style:b});return r}function l(a,b,c,d,f,g,k,h){var m;c&&(c=J[c]||"top",a.verticalAlignment!==c&&(a.verticalAlignment=c));d&&(c=z[d]||"left",a.horizontalAlignment!==c&&(a.horizontalAlignment=c));var n;
f?((n=h[f])?(d=n.marginLeft,c=n.marginTop):(m=f.split(" "),d=w(m[0],k.x)||0,c=w(m[1],k.y)||0,n={Sa:0,marginLeft:d,marginTop:c,wn:d*b.Pg+b.yd,yn:c*b.Qh+b.wf},30>h.Sa&&(h.Sa++,h[f]=n)),a.marginLeft=n.wn,a.marginTop=n.yn):(c=d=0,(n=h["default"])||(h["default"]=n={Sa:0}));g&&(f=n[g],f||(m=g.split(" "),f={xn:(1-(d+(w(m[0],k.x)||0)))*b.Pg+b.yd,vn:(1-(c+(w(m[1],k.y)||0)))*b.Qh+b.wf},30>n.Sa&&(n.Sa++,n[g]=f)),a.marginRight=f.xn,a.marginBottom=f.vn)}function m(a,b,c,d,f){var g=a.displayAlign,k=a.textAlign,
h=a.origin;a=a.extent;c=Ec(c);l(c,b,g,k,h,a,d,f);c.id=F++;return c}function r(c,d,f,g){var k=b(f.characterSize||d.characterSize,Pl,2)||1,h;h=(h=c.fontSize)&&Q.test(h)?qa(B(h),25,200):void 0;k*=h/100||1;h=c.textOutline;var l,m,n;if(h&&"none"!=h){m=h.split(" ");var p;R.test(m)?(p=0,n=c.color):(p=1,n=a(m[0]));l=v(m[p]);m=v(m[p+1])}return{characterStyle:f.characterStyle||Ql[c.fontFamily]||d.characterStyle,characterSize:k*g,characterColor:a(f.characterColor||c.color||d.characterColor),characterOpacity:b(kb(f.characterOpacity,
c.opacity,d.characterOpacity),Uh,1),characterEdgeAttributes:f.characterEdgeAttributes||h&&("none"===h?Rl:m?Zg:hi)||d.characterEdgeAttributes,characterEdgeColor:a(f.characterEdgeColor||n||d.characterEdgeColor),characterEdgeWidth:l,characterEdgeBlur:m,characterItalic:"italic"===c.fontStyle,characterUnderline:"underline"===c.textDecoration,backgroundColor:a(f.backgroundColor||c.backgroundColor||d.backgroundColor),backgroundOpacity:b(kb(f.backgroundOpacity,c.opacity,d.backgroundOpacity),Uh,1)}}function u(a,
b,d,f,g){b=r(b,d,f,g);var k;c(b,function(b,c){c!==a[b]&&(k||(k=Bg(a)),k[b]=c)});return k||a}function p(a,b,c,d,f,k,h,m){var n=a[Zb];c=g(a[Zb],b,c,f,L);b=c.region;a=n.displayAlign;c=c.textAlign;f=n.origin;n=n.extent;b||a||c||f||n?((d=d[b])?d=Bg(d):a||f||n?(d=Bg(E),d.id=F++):d=Bg(M),l(d,k,a,c,f,n,h,m)):d=M;return d}function v(a){a=B(a);return f(a,0,100)?a:0}function w(a,b){var c=a[a.length-1];if("%"===c)return qa(.01*rc(a),0,1);if("c"===c)return qa(B(a)/b,0,1)}function x(a){for(var b=a.length,c=a[--b].endTime;b--;)c=
Fa(a[b].endTime,c);return c}function A(b){c(b,function(c,d){0<=c.toLowerCase().indexOf("color")&&(b[c]=a(d))})}function D(a,b){var c=a.extent,d=a.pixelAspectRatio,f,g,k={yd:0,Pg:1,wf:0,Qh:1};c&&(c=c.split(" "),2<=c.length&&(d=(d||"").split(" "),f=rc(c[0])*(rc(d[0])||1),g=rc(c[1])*(rc(d[1])||1)),f=0<f&&0<g?f/g:1280/720,d=b||1280/720,c=f/d,.01<Bc(d-f)&&d>=f&&(k.yd=(1-c)/2,k.Pg=c));return k}function H(a,b){var c;if(c=a.cellResolution)if(c=c.split(" "),2<=c.length){var d=B(c[0]);c=B(c[1]);if(0<d&&0<c)return{x:d,
y:c}}c=a.extent;var f,g;if(c&&(c=c.split(" "),2<=c.length)){var d=B(c[0]),k=B(c[1]);if(c=a.pixelAspectRatio)c=c.split(" "),f=B(c[0]),g=B(c[1]);if(d&&k)return 1.5<d*(f||1)/(k*(g||1))?Aj:Bj}return 1.5<b?Aj:Bj}var F=1,J={before:"top",center:"center",after:"bottom"},z={left:"left",start:"left",center:"center",right:"right",end:"right"},M={id:F++,verticalAlignment:"bottom",horizontalAlignment:"center",marginTop:.1,marginLeft:.1,marginRight:.1,marginBottom:.1},E={id:F++,verticalAlignment:"top",horizontalAlignment:"left",
marginTop:0,marginLeft:0,marginRight:0,marginBottom:0},T="fontFamily fontSize fontStyle textDecoration color opacity backgroundColor textOutline".split(" "),S=T.concat(["style","region"]),L=["region","textAlign","displayAlign","extent","origin"],C=/^([0-9]+):([0-9]+):([0-9.]+)$/,K=/^br$/i,Q=/^[0-9]{1,3}%$/,R=/^[0-9]/;return function(c,f,l,v,u){function w(){try{for(var a;fa;)if(R=fa[Zb],ma.push({id:F++,startTime:d(R.begin,C),endTime:d(R.end,C),region:p(fa,Bb,Q,X,Z,va,V,Ja),textNodes:k(fa,ja,la,pa,
Q,Z,Y,aa,La)}),fa=fa[Nb],a=mf(),100<a-Eb){Eb=Lh.now();ra=Xa(w,1);return}}catch(b){M({g:P.zf,C:N(b)});return}ra=Xa(z,1)}function z(){try{var a=function(a,d){for(var f,g=[],k={},h,l=c.length;l--;)f=c[l],h=f.region.id,k[h]||(k[h]=1,g.unshift(f));(f=b[b.length-1])&&f.endTime==a&&Id(f.blocks,g)?f.endTime=d:b.push({id:F++,startTime:a,endTime:d,blocks:g})};if(!ma.length){M({c:!0,entries:[]});return}Vb(ma);var b=[],c=[],d=ma[0],f,g=ma[0].startTime,k,h;for(k=1;c.length||d;){for(;!c.length||d&&d.startTime==
g;)c.push(d),g=d.startTime,d=ma[k++];f=x(c);if(!d||f<=d.startTime)for(a(g,f),g=f,h=c.length;h--;)c[h].endTime<=g&&c.splice(h,1);else a(g,d.startTime),g=d.startTime,c.push(d),d=ma[k++]}for(k=b.length;k--;)b[k].index=k,b[k].previous=b[k-1],b[k].next=b[k+1]}catch(l){M({g:P.zf,C:N(l)});return}M({c:!0,entries:b})}function M(a){Xa(function(){J.abort=q;u(a)},1)}var J={abort:function(){ra&&mb(ra)}};try{var T=c[Zb],C=1E3/(B(T.tickRate)||1),va=D(T,f),K=n(E,{marginLeft:va.yd,marginTop:va.wf,marginRight:va.yd,
marginBottom:va.wf}),Q={},Z={},X={},R,U,W,ia=c.head,ga=c.body,V=H(T,f),La=1/V.y*va.Qh,Y=n({characterStyle:"PROPORTIONAL_SANS_SERIF",characterColor:"#EBEB64",characterEdgeAttributes:Zg,characterEdgeColor:"#000000",characterSize:1},l,{Ye:!0}),aa=v||{},Ja={Sa:0};if(ia){var ca=ia.styling;if(ca)for(W=ca.style;W;)R=W[Zb],A(R),Q[R.id]=R,W=W[Nb];var ea=ia.layout;if(ea)for(var xb=ea.region;xb;){R=xb[Zb];var bb=R.id;U=Ec(Q[R.style]);U=n(U,R);for(W=xb.style;W;)n(U,W[Zb]),W=W[Nb];A(U);Z[bb]=U;X[bb]=m(U,va,K,
V,Ja);xb=xb[Nb]}}var da=ga.div,fa=da.p,ma=[],pa={},pa=g(ga[Zb],pa,Q,Z,S),pa=g(da[Zb],pa,Q,Z,S),Bb={},Bb=g(ga[Zb],Bb,Q,Z,L),Bb=g(da[Zb],Bb,Q,Z,L),ja=r(pa,Y,aa,La);n(ja,{windowColor:a(aa.windowColor||Y.windowColor),windowOpacity:b(kb(aa.windowOpacity,Y.windowOpacity),Uh,1),cellResolution:V},{Ye:!0});var la={};da.p=h;da[fh]=[]}catch(Wa){M({g:P.zf,C:N(Wa)});return}var Eb=mf(),ra;ra=Xa(w,1);return J}}(),Ql={"default":"PROPORTIONAL_SANS_SERIF",monospaceSansSerif:"MONOSPACED_SANS_SERIF",monospaceSerif:"MONOSPACED_SERIF",
proportionalSansSerif:"PROPORTIONAL_SANS_SERIF",proportionalSerif:"PROPORTIONAL_SERIF",casual:"CASUAL",cursive:"CURSIVE",smallCapitals:"SMALL_CAPITALS",monospace:"MONOSPACED_SANS_SERIF",sansSerif:"PROPORTIONAL_SANS_SERIF",serif:"PROPORTIONAL_SERIF"},Pl={SMALL:.5,MEDIUM:1,LARGE:2},Uh={NONE:0,SEMI_TRANSPARENT:.5,OPAQUE:1},Ol={black:"#000000",silver:"#c0c0c0",gray:"#808080",white:"#ffffff",maroon:"#800000",red:"#ff0000",purple:"#800080",fuchsia:"#ff00ff",magenta:"#ff00ff",green:"#00ff00",lime:"#00ff00",
olive:"#808000",yellow:"#ffff00",navy:"#000080",blue:"#0000ff",teal:"#008080",aqua:"#00ffff",cyan:"#00ffff",orange:"#ffa500",pink:"#ffc0cb"},Rl="NONE",ck="RAISED",dk="DEPRESSED",hi="UNIFORM",Zg="DROP_SHADOW",Bj={x:40,y:19},Aj={x:52,y:19},bk=10,$g={"class":"player-timedtext-text-container"},Vh;Ub(U.Dl,function(a){function b(){Nh?Nh.requestQuota(g,c,d):Fl.requestQuota(uj,g,c,d)}function c(d){d>=g?(Vh=d,a(xa)):k?(f.error("Quota request granted insufficent bytes"),a({g:P.yi})):(k=!0,b())}function d(){f.error("Request quota error");
a({g:P.xi})}var f=new wa.r("RequestQuota"),g=v.Ls,k;0<g?b():(Vh=0,a(xa))});var ii;Ub(U.wl,function(a){var b=new wa.r("FileSystem");"fs"!=v.Pk?a(xa):El(uj,Vh,function(b){ii=b;a(xa)},function(){b.error("Error calling requestFileSystem");a({g:P.ui})})});var ki={},ji={create:!0},fk={create:!0,exclusive:!0},fb;Ub(U.El,function(a){var b;switch(v.Pk){case "fs":b=Lg;break;case "idb":b=Ke;break;case "none":b=Jg}b(function(b){b.c?(fb=b.Hh,a(xa)):a(b)})});var Zd;Ub(U.Fl,function(a){function b(){b=q;var a=Sb(d,
v.lq);gb.addListener(Pc,function(b){b&&b.isPopStateEvent?g.trace("popstate event, Lock timers can stay"):(c(k,function(a,b){Dc.removeItem(b.pc)}),yb(a))},-1)}function d(){var a=tb();c(k,function(b,c){Dc.setItem(c.pc,a)})}var g=new wa.r("StorageLock"),k={};Zd={Ci:function(a,c){function d(){Dc.setItem(l,h);var a={pc:l};k[l]=a;g.trace("Lock acquired",{Name:a.pc});c({c:!0,Re:a})}if(Dc){b();var h=tb(),l="lock-"+a;try{if(l in Dc){var m=B(Dc.getItem(l)),n;f(m,0,void 0)&&(n=m);1E3*Bc(h-n)<v.kq?c({c:!1}):
(g.error("Lock was expired or invalid, ignoring",{Epoch:h,LockEpoch:n}),d())}else d()}catch(t){g.error("Error acquiring Lock",t),c({g:P.Nb,C:N(t)})}}else Mh?c({g:P.fn,C:N(Mh)}):c({g:P.gn})},Nr:function(a,b){if(Dc){try{Dc.removeItem(a.pc),delete k[a.pc],g.trace("Lock released",{Name:a.pc})}catch(c){g.error("Unable to release Lock",{Name:a.pc},c)}b&&b(xa)}}};v.Xo?Zd.Ci("session",function(b){Zd.Gk=b;a(xa)}):a(xa)});Ub(U.Gl,function(a){je()?Cc&&Cc.generateKey&&Cc.importKey&&Cc.unwrapKey?"PSK"!=v.Wf&&
"MGK"!=v.Wf||Dl?(fc("wcs"),Db(Cc.generateKey({name:"AES-CBC",length:128},!0,["encrypt","decrypt"])).then(function(){fc("wcdone");a(xa)},function(b){b=""+b;var c;0<=b.indexOf("missing crypto.subtle")?c=P.Mf:0<=b.indexOf("timeout waiting for iframe to load")&&(c=P.kn);a({g:c,C:b})})):a({g:P.jn}):a({g:P.Mf}):a(xa)});var v,gg,sh;Ub(U.xl,function(a){var b=v.rq,c=-6/(b-2-2);if(f(b,1)){var d=[],g=ya(ja()/1E3);Sb(function(){var a=ya(ja()/1E3);if(a!=g){for(var b=Fa(a-g,30);b--;)d.push(0);(b=Ea(d.length-31,
0))&&d.splice(0,b);g=a}d[d.length-1]++},1E3/b);sh={up:function(){for(var a=[],f=d.length-1;f--;){var g=d[f];a.unshift(0>=g?9:1>=g?8:g>=b-1?0:jb((g-2)*c+7))}return a}}}a(xa)});var $b,vi=/^(SDK-|SLW32-|SLW64-|SLMAC-|.{10})([A-Z0-9-=]{4,})$/,hg;Ub(U.bi,function(a){function b(g){Wa(g)&&Wa(c)?($b=new Cf(g,c,d,f),fc("devdone"),a(xa)):a({g:P.Vh})}var c=Oh,d,f,g=new wa.r("Device");fc("devs");fb.load("deviceid",function(d){function k(){fb.save("deviceid",l,!1,function(d){d.c?b(c+l):a(d)})}var l;d.c&&(l=d.data);
Wa(l)?(f="storage",b(c+l)):d.g==P.uc?v.tg&&Df()?Mf(function(a){a.c?(l=a.content,f="downloaded from server"):(g.error("Error downloading esn",eb(a)),f="generated: error downloading",l=Lf());k()}):(f="generated: "+(v.tg?"netflix id not device bound":"no config esnurl"),l=Lf(),k()):(d.c=h,a(d))})});var ld=function(){function b(){f.B(Sl);f.B(ze)}function c(){f.B(Wh);f.B(ze)}var d=new wa.r("Http"),f=new rb,g=0;Ub(U.$d,function(a){v.kt&&(C.addEventListener("online",b),C.addEventListener("offline",c),pd=
Nf);a(xa)});return{addEventListener:f.addListener,removeEventListener:f.removeListener,N:function(b,c,k){function l(){S&&(mb(S),S=null);S=Xa(k?y:u,T?M:F)}function m(){m=q;S&&(mb(S),S=null);f.removeListener(Wh,r);E&&(E.onreadystatechange=null,E.onprogress=null,E.onerror=null,E.onload=null,E.onabort=null);z.c?(b.i&&(b.i.dq=ja()),B.trace("Download success",x)):(b.i&&(b.i.aw=ja()),z.g!=P.Za?B.warn("Download failed",x,eb(z)):B.trace("Download aborted",x));var a=A;A=h;for(var c=a.length;c--;)(function(){var b=
a[c];ta(function(){b(z)})})();f.B(Tl,z,!0)}function n(a,b,c){z.c=!1;z.g=a;a=ja();z.D.O=z.D.O||a;z.D.M=z.D.M||a;0<b&&(z.Ca=z.P=b);c&&(z.C=c);m()}function r(){pd()||(n(P.Wh),E.abort())}function u(){n(T?P.cd:P.Bf);E.abort()}function y(){z.c===h&&(k.kk++,k.or.ping(k))}function w(a){n(P.Za);try{!a&&E&&E.abort()}catch(b){}}var B=b.Ha&&b.Ha.log&&new b.Ha.log.r("Http")||d,x={Num:g++},A=[c],O={requestTime:ja()},D,F=b.Pb||v.Pb,M=b.Kd||v.Kd,z=function(){var a=q,c=q;return{L:b,type:b.responseType,D:O,abort:w,
timeout:u,Di:function(a){m!==q&&A&&A.unshift(a)},lk:function(b){a(b)},ex:function(a){c(a)},xy:function(b){a=b},wy:function(a){c=a}}}();k&&(k.stream=b.stream,k.G=b.wa[0],k.Os=l,k.nj=u);var E,T,S;f.B(Ul,z,!0);ta(function(){if(a(b.url))try{Md(b,z),D=z.url,x.Url=D,pd()?(B.trace("Download starting",x),E=new xi,E.onreadystatechange=function(){if(2==E.readyState){T=!0;O.O=ja();E.onreadystatechange=null;l();for(var a=z,c=E.getAllResponseHeaders().split("\n"),d=c.length,f,g,k={};d--;)if(f=c[d])g=f.indexOf(": "),
1<=g&&g<f.length-1&&(k[f.substr(0,g)]=f.substr(g+2));a.headers=k;v.pa&&z.lk({timestamp:O.O,connect:!0,mediaRequest:b,start:O.requestTime,rt:[O.O-O.requestTime]})}},E.onprogress=function(a){T=!0;O.X=a.loaded;l();v.pa&&(a={mediaRequest:b,bytes:a.loaded,tempstamp:ja()},z.lk(a))},E.onload=function(){if(m!==q){var a;O.M=ja();O.O=O.O||O.M;if(200<=E.status&&299>=E.status)if(a=Me(E,z),b.Xb)try{z.content=b.Xb(a,z),z.c=!0,v.pa&&(z.parsed=!0,z.Ka=a)}catch(c){B.warn("Exception parsing response",c,x),n(P.Af,h,
N(c))}else v.pa&&(z.parsed=!1),z.content=a,z.c=!0;else n(P.bd,E.status);m()}},E.onabort=w,E.onerror=function(){0<E.status?n(P.bd,E.status):n(P.Xh)},vd(E,D,!1,b),l(),f.addListener(Wh,r)):ta(n.bind(h,P.Wh))}catch(c){B.error("Exception starting download",c,x),n(P.Yh)}else n(P.ql)});return z}}}(),pd=z,Ul=1,Tl=2,Sl=3,Wh=4,ze=5,eh=1,wi=2,Ac=3,Zb="$attributes",fh="$children",ig="$name",Ib="$text",uk="$parent",Nb="$sibling",tk=1,vk=3,wk=4,xk=9,$d;Ub(U.yl,function(a){function b(f){g({esn:$b.lc,esnPrefix:$b.jj,
authenticationType:v.Wf,authenticationKeyNames:v.En,systemKeyWrapFormat:v.Rs,serverIdentityId:"MSL_TRUSTED_NETWORK_SERVER_KEY",serverIdentityKeyData:A,storeState:f,notifyMilestone:fc,log:p},{result:function(a){c(a)},timeout:function(){a({g:P.ji})},error:function(b){a(d(P.ji,h,b))}})}function c(b){function f(){x&&fb.save(r,h,!1,function(a){a.c||p.error("Error persisting msl store",eb(a))})}var g=new Rb(100),h,m=k.extend({init:function(a){this.Bi=a},getResponse:function(a,b,c){b=this.Bi;var d=b.Jd.Vg||
d;a=pa(a.body)?zg(a.body):a.body;a={url:b.url,lh:a,withCredentials:!0,Cb:"nccp-"+b.We};b=this.Bi.timeout;a.Pb=b;a.Kd=b;var f=d.N(a,function(a){try{if(a.c)c.result({body:a.content});else throw n(new l("HTTP error, SubCode: "+a.g+(a.Ca?", HttpCode: "+a.Ca:"")),{cadmiumResponse:a});}catch(b){c.error(b)}});return{abort:function(){f.abort()}}}});q&&b.addEventHandler("shouldpersist",function(a){h=a.storeState;g.lb(f)});$d={send:function(a,c){var f=a.Jd,g=f.S,k=g&&Re(g),h={nccpMethod:a.We,nonReplayable:a.jk,
encrypted:a.ij,userId:a.al,body:a.body,serviceTokens:a.pf,timeout:2*a.timeout,httpLocation:new m(a),allowTokenRefresh:x};f.gj?(h.email=f.gj,h.password=f.kr||""):f.ea?(h.netflixId=f.ea,h.secureNetflixId=f.Ya):f.$j?(h.mdxControllerToken=f.$j,h.mdxPin=f.Dq,h.mdxNonce=f.Cq,h.mdxEncryptedPinB64=f.Bq,h.mdxSignature=f.Eq):w&&k&&k.Rj?(f=k.Pc(),h.netflixId=f.ea,h.secureNetflixId=f.Ya):k&&(h.getIdCookies=function(){var a=k.Pc();return{netflixId:a.ea,secureNetflixId:a.Ya}});b.send(h,{result:function(a){w&&h.netflixId&&
(w=!1);c({c:!0,body:a.body,pf:a.serviceTokens})},timeout:function(){c({g:P.ki})},error:function(a){var f=b.isErrorReauth(a)?P.Df:b.isErrorHeader(a)?P.ii:P.hi,g=b.getErrorCode(a);c(d(f,g,a))}})},Qn:function(a,c){b.buildPlayDataRequest({nccpMethod:a.We,nonReplayable:a.jk,encrypted:a.ij,userId:a.al,body:a.body,serviceTokens:a.pf,timeout:a.timeout,allowTokenRefresh:!1},{result:function(a){c({c:!0,body:a})},timeout:function(){c({g:P.ki})},error:function(a){var f=b.isErrorReauth(a)?P.Df:b.isErrorHeader(a)?
P.ii:P.hi,g=b.getErrorCode(a);c(d(f,g,a))}})},fh:b};a(xa)}function d(a,b,c){var f,g;a={g:a,Jc:b};if(c){if(f=c.cadmiumResponse)return f;f=c.errorMessage||""+c;if(g=c.stack)g=""+g,f=0<=g.indexOf(f)?g:f+g;g=B(c.internalCode)||B(c.error&&c.error.internalCode)}f&&(a.C=f);g&&(a.P=g);return a}if(je())if(Af&&Cc&&Cc.unwrapKey){try{var f=C.netflix.msl,g=f.createMslClient,k=f.IHttpLocation,l=f.MslIoException}catch(m){a({g:P.Ql});return}var p=new wa.r("Msl"),f=v.Kq,q=v.Lq,r=v.xe?"mslstoretest":"mslstore",u=Zd.Gk,
w=!0,x=!u||u.c,A=zc(v.xe?"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAm84o+RfF7KdJgbE6lggYAdUxOArfgCsGCq33+kwAK/Jmf3VnNo1NOGlRpLQUFAqYRqG29u4wl8fH0YCn0v8JNjrxPWP83Hf5Xdnh7dHHwHSMc0LxA2MyYlGzn3jOF5dG/3EUmUKPEjK/SKnxeKfNRKBWnm0K1rzCmMUpiZz1pxgEB/cIJow6FrDAt2Djt4L1u6sJ/FOy/zA1Hf4mZhytgabDfapxAzsks+HF9rMr3wXW5lSP6y2lM+gjjX/bjqMLJQ6iqDi6++7ScBh0oNHmgUxsSFE3aBRBaCL1kz0HOYJe26UqJqMLQ71SwvjgM+KnxZvKa1ZHzQ+7vFTwE7+yxwIDAQAB":"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlibeiUhffUDs6QqZiB+jXH/MNgITf7OOcMzuSv4G3JysWkc0aPbT3vkCVaxdjNtw50zo2Si8I24z3/ggS3wZaF//lJ/jgA70siIL6J8kBt8zy3x+tup4Dc0QZH0k1oxzQxM90FB5x+UP0hORqQEUYZCGZ9RbZ/WNV70TAmFkjmckutWN9DtR6WUdAQWr0HxsxI9R05nz5qU2530AfQ95h+WGZqnRoG0W6xO1X05scyscNQg0PNCy3nfKBG+E6uIl5JB4dpc9cgSNgkfAIeuPURhpD0jHkJ/+4ytpdsXAGmwYmoJcCSE1TJyYYoExuoaE8gLFeM01xXK5VINU7/eWjQIDAQAB");
f?fb.remove(r,function(){b()}):q?fb.load(r,function(c){c.c?b(c.data):c.g==P.uc?b():(p.error("Error loading msl store",eb(c)),fb.remove(r,function(c){c.c?b():a(c)}))}):b()}else a({g:P.Rl});else a(xa)});Ub(U.vl,function(a){var b=v.xe,c;c=b?"browsertest":"browser";b=new Qe(c,b?"NetflixIdTest":"NetflixId",b?"SecureNetflixIdTest":"SecureNetflixId");of=jg[c]=b;a(xa)});Se.prototype={Kc:!1,rh:!1,Pe:0,de:Og,Kg:function(){return"acc-"+this.S},load:function(a){var b=this,c=b.S;fb.load(b.Kg(),function(d){var f;
d.c&&(f=d.data);f&&(b.Kc=!0,b.Pe=f.lastAccessTime||0,b.de=f.UILanguages||Og,b.ea=f.netflixId,b.Ya=f.secureNetflixId,b.Rn=f.cTicket,b.Sn=B(f.cTicketExpiration)||0,b.cq=f.keyPairHash,b.Yq=f.nrdpStorage,$d&&(b.rh=!!$d.fh.hasUserIdToken(c)));a(xa)})},save:function(){this.Kc=!0;fb.save(this.Kg(),{lastAccessTime:this.Pe,UILanguages:this.de,netflixId:this.ea,secureNetflixId:this.Ya,cTicket:this.Rn,cTicketExpiration:this.Sn,keyPairHash:this.cq,nrdpStorage:this.Yq})},remove:function(a){var b=this,d=b.S;fb.remove(b.Kg(),
function(){var f=[];c(b,function(a){f.push(a)});for(var g=f.length;g--;)delete b[f[g]];b.S=d;$d&&$d.fh.removeUserIdToken(d);a(xa)})},Pc:function(){return{ea:this.ea,Ya:this.Ya}},Jk:q,eo:q};var jg={},yi={},of,Jb;Ub(U.Al,function(a){fb.load("deviceparameters",function(b){function c(a,b,g,k){a=d[a];return f(a,g,k)?a:b}var d={};b.c&&(d=b.data);Jb={xh:c("servertimeoffset",0,h,h),kf:c("retrycontrol",3,0,1E3),Ve:c("mintimeout",59,0,1E3),$g:c("loginterval",60,0,1E3),bh:c("maxlogsize",2E6,100,1E9),Te:d.loglevel||
"error",wh:!!d.sendheartbeats,zd:c("heartbeatinterval",60,1,1E3),hh:function(){sc.B(Bf);fb.save("deviceparameters",{servertimeoffset:Jb.xh,retrycontrol:Jb.kf,mintimeout:Jb.Ve,loginterval:Jb.$g,maxlogsize:Jb.bh,loglevel:Jb.Te,sendheartbeats:Jb.wh,heartbeatinterval:Jb.zd})}};a(xa)})});var Ob;Ub(U.zl,function(a){var b=v.Ib;(new wa.r("Nccp")).info("Creating NCCP instance",{Url:b.hc,Version:b.oh,Msl:je()});je()?(Ob=new Rf(b,Jb,$d,$b),a(xa)):a({g:P.il})});var sc=new rb,Ak="resume",Bk="suspend",Bd="interval",
Bf=1,kh=4,nd;Ub(U.Bl,function(a){function b(){var a={browserua:kc,browserhref:lf.href,browserdm:""+ub.documentMode,initstart:Eg,initdelay:Th-Eg};cf(a);var d=Wd&&Wd.timing;d&&v.oq.map(function(b){var c=d[b];c&&(a["pt_"+b]=c-kd)});var f=new Qd(sg&&sg.Ha,"startup","info",a);c(f)}function c(a){m.push(a);ta(function(){sc.B(3,{nq:a});for(var b=m,c=b.length,f=c*r;c--;)f+=b[c].qj().length;f>Jb.bh?d():k()})}function d(a,b){b=b||q;if(m.length||a){g();sc.B(kh);var c=m;m=[];Ob.qq(c,{Vg:ld,log:new wa.r("Nccp"),
S:of.S},b)}else b(xa);k()}function f(){var a=Jb.$g;u!=a&&(u=a,g(),k())}function g(){n&&(mb(n),n=null)}function k(){n||(n=Xa(h,1E3*u))}function h(){g();d()}var l=new wa.r("NccpLogBatcher"),m=[],n,r,u;l.mg=!0;r=33+$b.lc.length;sc.addListener(Bf,f);f();tg(function(){ta(b)});nd={uk:c,flush:function(a,b){l.trace("Flushing");g();sc.B(2);ta(function(){d(a,b)})}};a(xa)});(function(){function a(b){l.push(b)}function b(){sc.removeListener(Bf,b);sc.removeListener(2,c);wa.removeSink(a);wa.addSink(f);d()}function c(){g=
v.Ib.ye?wb[v.Ib.ye]:k[Jb.Te];d()}function d(){var a=l;l=[];for(var b=a.length,c=0;c<b;c++)f(a[c])}function f(a){if(!a.mg&&a.level<=g){var b={debugMessage:a.message,debugCategory:a.category};n(b,a.fields,{prefix:"debug"});a=new Qd(a.Ha,"debug",h[a.level],b);nd.uk(a)}}var g,k={fatal:wb.FATAL,error:wb.ERROR,warn:wb.WARN,info:wb.INFO,debug:wb.DEBUG},h={};h[wb.FATAL]="fatal";h[wb.ERROR]="error";h[wb.WARN]="warn";h[wb.INFO]="info";h[wb.TRACE]="debug";h[wb.DEBUG]="debug";var l=[];wa.addSink(a);sc.addListener(Bf,
function(){g=v.Ib.ye?wb[v.Ib.ye]:k[Jb.Te]});sc.addListener(Bf,b);sc.addListener(2,c)})();var qf="PRIMARY",Ai={assistive:"ASSISTIVE",closedcaptions:"ASSISTIVE",directorscommentary:"COMMENTARY",comentary:"COMMENTARY",subtitles:qf,primary:qf};Qd.prototype.qj=function(){this.Ai||(this.Ai=vg(this.data));return this.Ai};var lc=1,lg=2,Pb=4,mg=8,rf=16,ih=32,jh=64,ye,lh;Ub(U.Cl,function(a){var b=new wa.r("PlayDataManager");v.nf&&v.Wc?fb.load(v.Wc,function(c){if(c.c){var d=c.data,f;try{f=ob.parse(d)}catch(g){}}f?
(ye=f,od.length||bg(h,function(a){a.c&&yd()})):c.g!=P.uc&&(b.error("Unable to parse persisted playdata"),yd());a(xa)}):a(xa)});var Ii="HistoricalBandwidth",Ki="none",Ek="dayOfWeekTimeOfDay",Ji="timeofDay",og;Sc.prototype={Eb:function(){},xa:function(){},Aa:function(){},Ub:function(){}};var Li=[];Tc(function(a){function b(a){if(a.lower&&a.height>E)return a.height>=l()}function d(){var b=a.A.value==$c&&a.state.value==db;M?b||(yb(M),A=M=h,T&&(yb(L),L=h)):b&&(M=Sb(f,1E3),T&&(L=Sb(g,S)))}function f(){var b=
a.ub.value,b=(b=b&&b.stream)&&b.height;if(0<b){var c=ja(),d=a.ha.Oc();if(A&&2E3>c-A.time&&b==A.height){var g=d-A.Io,k=q[b];k||(q[b]=k=[],b>E&&(x.push(b),F(x)));0<g&&!(N<b)&&(N=b);k.push(g);k.length>z&&k.shift();(k=u[b])||(u[b]=k={});var h=k[g];k[g]=h?h+1:1}A={time:c,Io:d,height:b};a.af.ts(q)}}function g(){fb.save(Xh,{xid:a.qa,data:u})}function k(){a.addEventListener(Ab,function(){g()});w=[];fb.load(Cj,function(a){a.c&&(w=a.data);var b={};fb.load(Xh,function(a){a.c&&(b=a.data);b&&b.data&&Mb.keys(b.data).length&&
(w.push(b),w.length>T&&w.shift(),fb.save(Cj,w),fb.save(Xh,{}))})})}function l(){!C&&v.fj&&v.ve&&a.ne<v.fj[P]&&(D=Fa(D,v.ve),a.je.set({reason:"droppedFramesPreviousSession",height:v.ve}));C=!0;if(N){var b=x.length,c,d,f;for(c=0;c<b;c++)if(d=x[c],d>=N&&d<D&&(f=q[d])&&Vc(r,f)&&D!=d)return p.warn("Restricting resolution due to high number of dropped frames",{MaxHeight:d}),a.je.set({reason:"droppedFrames",height:d}),v.No?(a.R.ag(function(a){return a.gf.k.height>=d}),ta(a.n.Eo)):ta(a.n.pe),v.ve=D=d;N=h}return D}
function m(){var a={};u&&x.forEach(function(b){var d=u[b];if(d){var f=0,g=0;c(d,function(a,b){g+=B(a);f+=b});a[b]=g/f}});return a}function n(a){var b={};a.forEach(function(a){b[a]={}});u&&(F(a),x.forEach(function(d){var f=u[d];if(f){var g=0,k=0;c(f,function(a,b){g+=b});var h=Mb.keys(f);F(h);for(var l=h.length-1,m=h[l],n=a.length-1;0<=n;n--){for(var p=a[n];m>=p&&0<=l;)(m=f[m])&&(k+=m),m=h[--l];b[p][d]=jb(k/g*100)}}}));return b}var p=new a.log.r("DFF"),q={},r=v.Mo,u={},w=[],x=[],A,z=v.Ko,E=v.Lo,D=1E5,
N,M,T=v.Qo,S=v.Po,L,P=Yb.hardwareConcurrency||0,C;if(v.Jo)return T&&a.addEventListener(kg,k),a.sd={lp:m,yp:n},a.state.addListener(d),a.A.addListener(d),{xg:"df",sc:b}});var Cj="DroppedFramesHistory",Xh="DroppedFramesSession";Tc(function(a){return{xg:"op",sc:function(b){if(b=b.Yg){var c=a.ha;if(c&&c.Eg())return b}}}});vj&&Tc(Lc);var mh=12.8,nh=5120,Hk=1,Ik=2E3,Gk=.8,Fk=10,Mi=1024;re.prototype={Eb:function(){return this.W.value.oa},xa:function(){return this.bc.value.oa},Aa:function(){var a=this;return a.xa().filter(function(b){return!a.Ue.sc(b)})},
Ub:function(){var a=this.Tc;return a?ja()-a:0}};var Jk=0,od=[],Oi=[],Pi=[],rh=1,ug=3,sg,rg=1E4*tb()+ya(1E4*kf()),Ei=rg,vf=1,Ab=2,tf=3,fj=4,Xd=5,Zc=6,kg=7,Bi=8,qg=9,zk=10,hj=11,ph=12,Ni=13,ij=14,Ci=15,nf=21,ue=22,Yd=30,Qi=31,ng=41,oh=51,Bh=52,Ah=53,vh="network",gl="media",Ch=1,Fi=2,Gi=3,uf=0,ac=1,db=2,qh=3,pg=4,nc=1,bc=2,mc=3,Qb=1,$c=2,sf=3,Oc=4,Kk="playback";Wc(rh,function(a){function b(c){if(c.newValue>=ac){a.state.removeListener(b);var d;try{var f=""+tb();Dc.setItem("player$test",f);var k=Dc.getItem("player$test");
Dc.removeItem("player$test");d=f==k?"success":"mism"}catch(h){d="ex: "+h}c="type=openplay&sev=info&locstor="+Cg(d)+"&browserdm=";var m;try{m=""+ub.documentMode}catch(n){m="ex: "+n}l(c+Cg(m));u=ja();g()}}function d(){h("type=startplay&sev=info&outcome=success")}function f(){var b=a.Da;if(b){var d="type=startplay&sev=error&outcome=error",g={};bf(g,b);c(g,function(a,b){d+="&"+Cg(a)+"="+Cg(b||"")});h(d)}else h("type=startplay&sev=info&outcome=abort")}function g(){var a=w.shift();if(0<a){var b=Ea(a-(ja()-
u),0);r=Xa(function(){l("type=startstall&sev=info&kt="+a);g()},b)}}function k(){h("type=startplay&sev=info&outcome=unload")}function h(b){h=q;b+="&initstart="+Eg+"&initend="+Th;l(b);mb(r);a.removeEventListener(Zc,d);a.removeEventListener(Ab,f);gb.removeListener(Pc,k)}function l(b){b=B+"&jsoffms="+ja()+"&soffms="+a.Ub()+"&do="+Yb.onLine+"&"+b+"&"+ca(n({},fi,{prefix:"im_"}))+"&"+ca(n({},a.eh,{prefix:"sm_"}));m.N({url:p,lh:b,withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},
Cb:"track"},q)}var m=a.ua,p=v.Ys,r,u,w=v.Xs.slice(),B;if(v.Ws&&p){B="cat=cadplayback&dev="+Ud(hh)+"&ep="+Ud(Oh)+"&ver="+Ud("2.0000.340.011")+"&jssid="+xe+"&xid="+a.qa+"&pbi="+a.index+"&groupName="+Ud(v.Fe);if(Xc){var x=n({},Xc,{prefix:"pi_"});B+="&"+ca(x)}a.state.addListener(b);a.addEventListener(Zc,d);a.addEventListener(Ab,f);gb.addListener(Pc,k,-1)}});var zb="audio",cb="video",gh="timedtext",zi="trickplay",Nk=2292,Ok=.006,Lk=2918,Mk=.0065,ve={gc:function(a,b){var c=this;b&&(c=c.filter(rd));return c.reduce(function(b,
c){return b&&Bc(b.f-a)<Bc(c.f-a)?b:c})},ba:function(a,b){var c=this;b&&(c=c.filter(rd));return c.reduce(function(b,c){return c.f>a&&c.f<b.f?c:b},c[c.length-1])},ca:function(a,b){var c=this;b&&(c=c.filter(rd));return c.reduce(function(b,c){return c.f<a&&c.f>b.f?c:b},c[0])},Ud:function(a){var b=this.map(function(a){return a.f});jd.isArray(a)&&(b=pb(b,a));return b}},ad=1,wh=2,wf=4,Ri=8,Pk=wh|wf,Qk=0,Rk=1,Sk=1E6,uh=1,Ti=2,Si=3;Wc(rh,function(a){function b(c){(c=c.L)&&4E3<c.length&&(a.removeEventListener(nf,
b),ta(function(){for(var b=2E3,c=Wd.now(),d=c,f=[],g=0;g<b;g++){for(var k=10;k--;)a.Ss=Pa.atan2(k,k);k=Wd.now();f.push(k-d);d=k}c=d-c;k=c/b;d=[];for(g=0;g<f.length;g++)f[g]>5*k&&d.push(g);g=d.reduce(function(a,b){return a+f[b]},0);b-=d.length;a.ne=Pa.round(b/(c-g))}))}a.addEventListener(nf,b)});var Tk=200,Uk=1,Xi=2,Ui=1,Vi=1,wg=2,xh=1,Vk=1,Wi=1,Yi,xf,xg,ej=Dd&&zf&&yf&&zf.prototype.play,bl=ej&&(zf.prototype.webkitGenerateKeyRequest||Qc),jk=!0,ik=Dd&&Dd.isTypeSupported&&Dd.isTypeSupported('audio/mp4; codecs="mp4a.a6"'),
al=0,$k=1,bj=2,Zk=3,Yk=4,Xk=5,aj=1,$i=2,Zi=3,cj=4,dj=5,Wk={clearkey:function(a,b){return Ba(b)},fps:function(a,b){var c;b.children.forEach(function(a){"pssh"==a.type&&"29701FE4-3CC7-4A34-8C5B-AE90C7439A47"==a.rd&&(c=a.data)});if(!c)throw new Za("no-netflix-pssh");var d="skd://netflix/"+S(c);return id(d)}},yh=50,fl=1E3,jl=0,gj=1,hl=2,Dh=3,ml=0,kl="showsubtitle",ll="removesubtitle";Wc(ug,function(a){function b(d){if(d.ctrlKey&&d.altKey&&d.shiftKey&&84==d.keyCode){var f=Ha("INPUT",h,h,{type:"file"});
f.addEventListener("change",function(){var b=f.files[0];if(b){var d=b.name;c.info("Loading file",{FileName:d});var g=new li;g.readAsText(b);g.addEventListener("load",function(){var b=a.ac;Ie(g.result,b.width/b.height,v.Vk,v.Wk,function(b){b.c?(b=b=a.Zb.Rf(b.entries,d),a.$.set(b)):c.error("Inavlid custom DFXP")})})}});f.click()}}var c=new a.log.r("TimedTextCustomTrack");if(v.gg){c.info("Loading url",{Url:v.gg});var d=a.Zb.Rf(v.gg,"custom");a.$.set(d)}gb.addListener(Cd,b);a.addEventListener(Ab,function(){gb.removeListener(Cd,
b)})});var kj=0,Gh=1,Fh=2,nl=3,jj=4;Wc(ug,function(a){v.Uo&&(a.Qy=new Jj(a))});Wc(ug,function(a){v.Sd&&(a.rc=new bi(a))});var Hi=1,Hh=1,mj=2,yg=3,Ih=4,nj=[137,66,73,70,13,10,26,10],ol=0,oj=44,rl="loadedtracks",tj="loadedmetadata",ul="loaded",Bl="error",Cl="closed",pj="currenttimechanged",qj="bufferedtimechanged",yl="durationchanged",zl="videosizechanged",Kh="pausedchanged",Jh="endedchanged",vl="busychanged",Al="audiotracklistchanged",wl="audiotrackchanged",sj="timedtexttracklistchanged",rj="timedtexttrackchanged",
xl="trickplayframeschanged",sl="mutedchanged",tl="volumechanged",pl="showsubtitle",ql="removesubtitle",Yh={};Ub(U.$d,function(a){function b(a,c){return{encrypt:function(b,c){var d=Ja(b)?id(b):b,f=Af.getRandomValues(new ab(16));Db(Cc.encrypt({name:"AES-CBC",iv:f},a,d)).then(function(a){a=new ab(a);var b=[],d=new Yc(b);d.Uh(2);d.gl(f);d.gl(a);a=S(b);c({success:!0,encryptedDataAsn1Base64:a})},function(){c({success:!1})})},decrypt:function(b,c){var d=hc(b);Db(Cc.decrypt({name:"AES-CBC",iv:d.bq},a,d.Vo)).then(function(a){a=
new ab(a);c({success:!0,text:zg(a)})},function(){c({success:!1})})},hmac:function(a,b){var d=Ja(a)?id(a):a;Db(Cc.sign({name:"HMAC",hash:{name:"SHA-256"}},c,d)).then(function(a){a=new ab(a);b({success:!0,hmacBase64:S(a)})},function(){b({success:!1})})}}}Yh.mdx={getEsn:function(){return $b.lc},getServerEpoch:function(){return Ob.wd()},createCryptoContext:function(a){var b=$d.fh.getStateForMdx(of.S),c=b.cryptoContext,d=b.masterToken,b=b.userIdToken;d&&b?(d=["1",S(ob.stringify(d.toJSON())),S(ob.stringify(b.toJSON()))].join(),
a({success:!0,cryptoContext:{cTicket:d,encrypt:function(a,b){var d=Ja(a)?id(a):a;c.encrypt(d,{result:function(a){a=S(a);b({success:!0,mslEncryptionEnvelopeBase64:a})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})},decrypt:function(a,b){var d=zc(a);c.decrypt(d,{result:function(a){b({success:!0,text:zg(a)})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})},hmac:function(a,b){var d=Ja(a)?id(a):a;c.sign(d,{result:function(a){b({success:!0,hmacBase64:S(a)})},
timeout:function(){b({success:!1})},error:function(){b({success:!1})}})}}})):a({success:!1})},createCryptoContextFromSharedSecret:function(a,c){var d=zc(a),f=d.subarray(32,48),d=d.subarray(0,32);if(16!=f.length||32!=d.length)throw new Za("Bad shared secret");Vd.all([Db(Cc.importKey("raw",f,{name:"AES-CBC"},!1,["encrypt","decrypt"])),Db(Cc.importKey("raw",d,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]))]).then(function(a){c({success:!0,cryptoContext:b(a[0],a[1])})},function(){c({success:!1})})}};
a(xa)});C.netflix=C.netflix||{};C.netflix.player={VideoSession:function(){var a=this;ie(arguments);a.createPlayer=function(a,b){var c;b&&(c=ra(b)?{za:b.trackingId,Zc:b.sessionParams,ge:b.authParams}:{za:b});c=new Mj(b.accountKey,a,c);var d=b.clipStart,f=b.clipDuration;return 0<d||0<f?Nj(c,d,f):c};a.closeAllPlayers=function(a){se(function(){a&&a()})};a.init=function(b){tg(function(c){c.c?(n(a,Yh),b&&b(n({success:!0},Yh))):b&&(c=(new Hb(c.errorCode||U.$d,c,void 0)).Mh(),b({success:!1,error:c}))})};
a.applyConfig=function(a){gg(a)}},diag:{togglePanel:function(a,b){var c;switch(a){case "info":c=od.map(function(a){return a.af});break;case "streams":c=od.map(function(a){return a.pk});break;case "log":c=[lj]}c&&c.forEach(function(a){ia(b)?b?a.show():a.Sg():a.toggle()})},addNccpLogMessageSink:function(a){sc.addListener(3,function(b){a({data:b.nq.data})})}},log:new wa.r("Ext"),LogLevel:wb,addLogSink:function(a){Ae.push(a)}}})(window)},{10:10,3:3,4:4,5:5,7:7}],2:[function(K,C){function h(){this.q=this.q||
{};this.dd=this.dd||void 0}function S(h){return"function"===typeof h}function z(h){return"object"===typeof h&&null!==h}C.Ta=h;h.EventEmitter=h;h.prototype.q=void 0;h.prototype.dd=void 0;h.xo=10;h.prototype.setMaxListeners=function(h){if("number"!==typeof h||0>h||isNaN(h))throw TypeError("n must be a positive number");this.dd=h;return this};h.prototype.emit=function(h){var q,C,K,pa;this.q||(this.q={});if("error"===h&&(!this.q.error||z(this.q.error)&&!this.q.error.length)){q=arguments[1];if(q instanceof
Error)throw q;throw TypeError('Uncaught, unspecified "error" event.');}C=this.q[h];if(void 0===C)return!1;if(S(C))switch(arguments.length){case 1:C.call(this);break;case 2:C.call(this,arguments[1]);break;case 3:C.call(this,arguments[1],arguments[2]);break;default:q=arguments.length;K=Array(q-1);for(pa=1;pa<q;pa++)K[pa-1]=arguments[pa];C.apply(this,K)}else if(z(C)){q=arguments.length;K=Array(q-1);for(pa=1;pa<q;pa++)K[pa-1]=arguments[pa];C=C.slice();q=C.length;for(pa=0;pa<q;pa++)C[pa].apply(this,K)}return!0};
h.prototype.addListener=function(M,q){var C;if(!S(q))throw TypeError("listener must be a function");this.q||(this.q={});this.q.$w&&this.emit("newListener",M,S(q.Sc)?q.Sc:q);this.q[M]?z(this.q[M])?this.q[M].push(q):this.q[M]=[this.q[M],q]:this.q[M]=q;z(this.q[M])&&!this.q[M].tt&&(C=void 0===this.dd?h.xo:this.dd)&&0<C&&this.q[M].length>C&&(this.q[M].tt=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this.q[M].length),"function"===typeof console.trace&&console.trace());return this};h.prototype.on=h.prototype.addListener;h.prototype.once=function(h,q){function z(){this.removeListener(h,z);C||(C=!0,q.apply(this,arguments))}if(!S(q))throw TypeError("listener must be a function");var C=!1;z.Sc=q;this.on(h,z);return this};h.prototype.removeListener=function(h,q){var C,K,pa;if(!S(q))throw TypeError("listener must be a function");if(!this.q||!this.q[h])return this;C=this.q[h];pa=C.length;K=-1;if(C===
q||S(C.Sc)&&C.Sc===q)delete this.q[h],this.q.removeListener&&this.emit("removeListener",h,q);else if(z(C)){for(;0<pa--;)if(C[pa]===q||C[pa].Sc&&C[pa].Sc===q){K=pa;break}if(0>K)return this;1===C.length?(C.length=0,delete this.q[h]):C.splice(K,1);this.q.removeListener&&this.emit("removeListener",h,q)}return this};h.prototype.removeAllListeners=function(h){var q;if(!this.q)return this;if(!this.q.removeListener)return 0===arguments.length?this.q={}:this.q[h]&&delete this.q[h],this;if(0===arguments.length){for(q in this.q)"removeListener"!==
q&&this.removeAllListeners(q);this.removeAllListeners("removeListener");this.q={};return this}q=this.q[h];if(S(q))this.removeListener(h,q);else for(;q.length;)this.removeListener(h,q[q.length-1]);delete this.q[h];return this};h.prototype.listeners=function(h){return this.q&&this.q[h]?S(this.q[h])?[this.q[h]]:this.q[h].slice():[]};h.listenerCount=function(h,q){return h.q&&h.q[q]?S(h.q[q])?1:h.q[q].length:0}},{}],3:[function(K,C){function h(b,a,h){for(var q="",g=0,c=b.length,n=c-2,z;g<n;){z=(b[g++]<<
16)+(b[g++]<<8)+b[g++];if(!(0<=z&&16777215>=z))throw Error("not bytes");q+=a[z>>>18]+a[z>>>12&63]+a[z>>>6&63]+a[z&63]}if(g==n){z=(b[g++]<<8)+b[g++];if(!(0<=z&&65535>=z))throw Error("not bytes");q+=a[z>>>10]+a[z>>>4&63]+a[z<<2&63]+h}else if(g==c-1){z=b[g++];if(!(0<=z&&255>=z))throw Error("not bytes");q+=a[z>>>2]+a[z<<4&63]+h+h}return q}var S=Array.prototype.slice,z=S.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),M=S.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),
q={},ia={},ra={},pa={},b=/\s+/g;[z,M].forEach(function(b){for(var a=b.length,h;a--;)h=b[a],q[h]=a<<18,ia[h]=a<<12,ra[h]=a<<6,pa[h]=a});C.Ta={qg:function(b){return h(b,z,"=")},tv:function(b){return h(b,M,"")},hg:function(f){f=f.replace(b,"");var a=f.length,h;h=f.charAt(a-1);"="!==h&&"."!==h||a--;h=f.charAt(a-1);"="!==h&&"."!==h||a--;h=3*(a>>2);var z=0;switch(a%4){case 2:z=1;break;case 3:z=2;break;case 1:throw Error("bad base64");}for(var a=new Uint8Array(h+z),g=0,c=0,n;c<h;){n=q[f[g++]]+ia[f[g++]]+
ra[f[g++]]+pa[f[g++]];if(!(0<=n&&16777215>=n))throw Error("bad base64");a[c++]=n>>>16;a[c++]=n>>>8&255;a[c++]=n&255}if(0<z&&(n=q[f[g++]]+ia[f[g++]],a[c++]=n>>>16,1<z&&(n+=ra[f[g++]],a[c++]=n>>>8&255),!(0<=n&&16776960>=n&&0===(n&(1<z?255:65535)))))throw Error("bad base64");return a}}},{}],4:[function(K,C){function h(h){this.buffer=h;this.position=0}h.prototype={seek:function(h){this.position=h},skip:function(h){this.position+=h},Ea:function(){return this.buffer.length-this.position},Z:function(){return this.buffer[this.position++]},
ia:function(h){var z=this.position;this.position+=h;h=this.buffer;return h.subarray?h.subarray(z,this.position):h.slice(z,this.position)},H:function(h){for(var z=0;h--;)z=256*z+this.buffer[this.position++];return z},Lb:function(h){for(var z="";h--;)z+=String.fromCharCode(this.buffer[this.position++]);return z},Ir:function(){for(var h="",z;z=this.Z();)h+=String.fromCharCode(z);return h},K:function(){return this.H(2)},l:function(){return this.H(4)},ja:function(){return this.H(8)},wk:function(){return this.H(2)/
256},qh:function(){return this.H(4)/65536},Qd:function(h){for(var z,C="";h--;)z=this.Z(),C+="0123456789ABCDEF"[z>>>4]+"0123456789ABCDEF"[z&15];return C},ff:function(){return this.Qd(4)+"-"+this.Qd(2)+"-"+this.Qd(2)+"-"+this.Qd(2)+"-"+this.Qd(6)},Jr:function(h){for(var z=0,C=0;C<h;C++)z+=this.Z()<<(C<<3);return z},Rd:function(){return this.Jr(4)},Uh:function(h){this.buffer[this.position++]=h},hl:function(h,z){this.position+=z;for(var C=1;C<=z;C++)this.buffer[this.position-C]=h&255,h=Math.floor(h/256)},
xt:function(h){for(var z=h.length,C=0;C<z;C++)this.buffer[this.position++]=h[C]},Zd:function(h,z){this.xt(h.ia(z))}};C.Ta=h},{}],5:[function(K,C){function h(a,b,f){this.type=a;this.size=b;this.X=f}function S(b){var c;a:{c=b.position;var f,q;if(8<=b.Ea()){f=b.l();q=b.Lb(4);if(!Ja.test(q))throw b.seek(c),Error("mp4-badtype");if(1==f){if(8>b.Ea()){b.seek(c);c=void 0;break a}f=b.ja()}if(!(8<=f))throw b.seek(c),Error("mp4-badsize");if("uuid"==q){if(16>b.Ea()){b.seek(c);c=void 0;break a}q=b.ff()}c={type:q,
offset:c,size:f,X:c+f-b.position}}else c=void 0}if(c&&c.X<=b.Ea()){var z=c.type;f=c.size;var C=c.X;q=new h(z,f,C);z=Wa[z];if(b.Ea()<C)throw Error("mp4-shortcontent");z?(C=new a(b.ia(C)),z(q,C)):b.skip(C);b.seek(c.offset);q.Ka=b.ia(f);return q}}function z(a,b){for(var f=[],h={},q,z;0<b.Ea();){q=S(b);if(!q)throw Error("mp4-badchildren");z=q.type;f.push(q);h[z]||(h[z]=q)}a.children=f;a.yg=h}function M(a,b){a.version=b.H(1);a.mc=b.H(3)}function q(a,b){b.skip(6);a.wo=b.K();b.skip(8);a.Ou=b.K();a.lf=b.K();
b.skip(4);a.ry=b.K();b.skip(2);z(a,b)}function ia(a,b){b.skip(6);a.wo=b.K();b.skip(16);a.width=b.K();a.height=b.K();a.Uv=b.l();a.Sy=b.l();b.skip(4);a.Gv=b.K();var f=b.Z();a.Ru=b.Lb(f);b.skip(31-f);a.depth=b.K();b.skip(2);z(a,b)}function ra(a,b){M(a,b);a.Yu=b.H(3);a.bv=b.Z();a.Vj=b.ia(16)}function pa(a,b){for(var f=[],h;b--;)h=a.K(),f.push(a.ia(h));return f}function b(a){var b=a.ia(2);a={qy:b[1]>>1&7,Ak:!!(b[1]&1),ky:a.K()};f(a,(b[0]<<8|b[1])>>4);return a}function f(a,b){a.ly=b>>4&3;a.py=b>>2&3;a.ny=
b&3;return a}var a=K(4),Ja=/^[a-zA-Z0-9-]{4,4}$/;h.prototype.rb=function(a){var b=this;a=a.split("/");var f,h,q,z;for(q=0;q<a.length&&b;q++){h=a[q].split("|");f=void 0;for(z=0;z<h.length&&!f;z++)f=h[z],f=b.yg&&b.yg[f];b=f}return b};h.prototype.toString=function(){return"["+this.type+"]"};var Wa={ftyp:function(a,b){a.uw=b.Lb(4);a.Uw=b.l();for(a.Ui=[];4<=b.Ea();)a.Ui.push(b.Lb(4))},moov:z,sidx:function(a,b){M(a,b);a.$x=b.l();a.sf=b.l();a.lv=1<=a.version?b.ja():b.l();a.bp=1<=a.version?b.ja():b.l();b.skip(2);
for(var f=b.K(),h=[],q,z;f--;){q=b.l();z=q>>31;if(0!==z)throw Error("mp4-badsdix");q&=2147483647;z=b.l();b.skip(4);h.push({size:q,duration:z})}a.Mr=h},moof:z,mvhd:function(a,b){M(a,b);var f=1<=a.version?8:4;a.fg=b.H(f);a.modificationTime=b.H(f);a.sf=b.l();a.duration=b.H(f);a.Yx=b.qh();a.volume=b.wk();b.skip(70);a.ax=b.l()},pssh:function(a,b){M(a,b);a.rd=b.ff();var f=b.l();a.data=b.ia(f)},trak:z,mdia:z,minf:z,stbl:z,stsd:function(a,b){M(a,b);b.l();z(a,b)},encv:ia,avc1:ia,mp4a:q,enca:q,"ec-3":q,avcC:function(a,
b){a.version=b.Z();a.Hu=b.Z();a.Wx=b.Z();a.Gu=b.Z();a.fw=(b.Z()&3)+1;a.vy=pa(b,b.Z()&31);a.Sx=pa(b,b.Z())},pasp:function(a,b){a.Ge=b.l();a.xf=b.l()},sinf:z,frma:function(a,b){a.Wu=b.Lb(4)},schm:function(a,b){M(a,b);a.bs=b.Lb(4);a.ty=b.l();a.mc&1&&(a.sy=b.Ir())},schi:z,tenc:ra,mvex:z,trex:function(a,c){M(a,c);a.ka=c.l();a.cv=c.l();a.yo=c.l();a.zo=c.l();a.kg=b(c)},traf:z,tfhd:function(a,c){M(a,c);a.ka=c.l();var f=a.mc;f&1&&(a.Ku=c.ja());f&2&&(a.my=c.l());f&8&&(a.yo=c.l());f&16&&(a.zo=c.l());f&32&&(a.kg=
b(c))},saio:function(a,b){M(a,b);a.mc&1&&(a.In=b.l(),a.Jn=b.l());for(var f=1<=a.version?8:4,h=b.l(),q=[];h--;)q.push(b.H(f));a.Zr=q},mdat:function(a,b){a.data=b.ia(b.Ea())},tkhd:function(a,b){M(a,b);var f=1<=a.version?8:4;a.fg=b.H(f);a.modificationTime=b.H(f);a.ka=b.l();b.skip(4);a.duration=b.H(f);b.skip(8);a.cw=b.K();a.Du=b.K();a.volume=b.wk();b.skip(2);b.skip(36);a.width=b.qh();a.height=b.qh()},mdhd:function(a,b){M(a,b);var f=1<=a.version?8:4;a.fg=b.H(f);a.modificationTime=b.H(f);a.sf=b.l();a.duration=
b.H(f);f=b.K();a.language=String.fromCharCode((f>>10&31)+96)+String.fromCharCode((f>>5&31)+96)+String.fromCharCode((f&31)+96);b.skip(2)},mfhd:function(a,b){M(a,b);a.uy=b.l()},tfdt:function(a,b){M(a,b);a.Lu=b.H(1<=a.version?8:4);8==b.Ea()&&b.skip(8)},saiz:function(a,b){M(a,b);a.mc&1&&(a.In=b.l(),a.Jn=b.l());for(var f=b.Z(),h=b.l(),q=[];h--;)q.push(f||b.Z());a.oy=q},trun:function(a,c){M(a,c);var f=c.l(),h=a.mc;h&1&&(a.Xu=c.l());h&4&&(a.Dv=b(c));for(var q=[],z;f--;)z={},h&256&&(z.duration=c.l()),h&512&&
(z.size=c.l()),h&1024&&(z.mc=c.l()),h&2048&&(z.Qu=c.l()),q.push(z);a.$r=q},sdtp:function(a,b){M(a,b);for(var h=[];0<b.Ea();)h.push(f({},b.Z()));a.$r=h},"4E657466-6C69-7850-6966-665374726D21":function(a,b){M(a,b);a.fileSize=b.ja();a.sf=b.ja();a.duration=b.ja();a.dx=b.ja();a.By=b.ja();1<=a.version&&(a.Ww=b.ja(),a.Xw=b.l(),a.dr=b.ja(),a.cp=b.l(),a.Bv=b.ff())},"A2394F52-5A9B-4F14-A244-6C427C648DF4":function(a,b){M(a,b);a.mc&1&&(a.Cu=b.H(3),a.Zv=b.Z(),a.$v=b.ff());a.jy=b.l();a.Hn=b.ia(b.Ea())},"4E657466-6C69-7846-7261-6D6552617465":function(a,
b){M(a,b);a.ar=b.l();a.Bo=b.K()},"8974DBCE-7BE7-4C51-84F9-7148F9882554":ra};C.Ta={Zx:function(b,c){var f=new a(b);c&&f.seek(c);return S(f)},Hr:function(b,c){if(!b)throw Error("mp4-badinput");var f=new a(b),h=[],q;for(c&&f.seek(c);q=S(f);)h.push(q);return h}}},{4:4}],6:[function(K,C){function h(a){Ec.call(this);this.jd=a.url;this.ed=a.L;this.pp=ra;this.Of=a.ef||0;this.nn=this.fd=this.xc=null;this.ee={};this.Nf={};this.ed({url:this.jd,offset:a.offset,size:a.size},z.bind(this))}function S(a){if(!a)throw Error("Assertion Failed");
}function z(a,b){if(a)this.emit(Vb.ERROR,Bb(a,Fb.Ml));else try{var c=new kb(b),f=q(c);this.xc=f;var g=f.startOffset,h=f.entries.reduce(function(a,b){return a+b.size},0);if(h){var n={url:this.jd,offset:g,size:h};this.emit(Vb.Ol,this.xc);this.ed(n,M.bind(this))}else this.emit(Vb.ERROR,Bb({},Fb.em))}catch(z){this.emit(Vb.ERROR,Bb(z,Fb.Nl))}}function M(a,b){var f=this;if(a)f.emit(Vb.ERROR,Bb(a,Fb.Xm));else{var g=new kb(b),h=0,n=[],q=[],z=0;try{f.xc.entries.forEach(function(a){var b={},c=0;g.position=
h;b.identifier=g.Lb(4);S("sidx"===b.identifier);b.Lp=g.ia(36);b.duration=g.H(4);b.Sa=g.K();b.entries=[];for(b.Vb=[];c<b.Sa;){var f={};f.Qb=g.H(4);f.duration=g.H(4);f.gr=g.K();f.hr=g.K();f.ys=g.K();f.zs=g.K();f.oc=g.ja();f.Lj=g.H(4);c++;b.entries.push(f)}n.push(b);a.Lk=b;c=b.entries;c.length&&(b.startTime=c[0].Qb,b.endTime=c[c.length-1].Qb+c[c.length-1].duration);q.push.apply(q,b.entries);h+=a.size;z++})}catch(C){f.emit(Vb.ERROR,Bb(C,Fb.Ym));return}f.fd=n;f.nn=q;f.emit(Vb.Zm,this.fd);var M=ia.call(f,
f.Of);M.length?c.call(f,M,function(){f.emit(Vb.ri)}):f.emit(Vb.ri)}}function q(a){var b={};a.position=0;b.identifier=a.Lb(4);S("midx"===b.identifier);b.version=a.H(4);S(0===b.version);b.Lp=a.ia(36);b.fg=a.ja();b.Px=a.ja();b.ma=a.ja();b.Xr=a.K();b.Yr=a.K();b.language=a.ia(16);b.Hy=a.ia(16);b.startOffset=a.ja();b.Sa=a.K();for(var c=[],f=0;f<b.Sa;f++){var g={};g.duration=a.H(4);g.size=a.K();c.push(g)}b.entries=c;return b}function ia(a){var b=[],c;S(n(a));var f=this.ee,g=f.qf,h=f.index,q;g&&(0===h&&a<=
g.startTime?(q=!0,c=f):a>=g.startTime&&a<=g.endTime?(q=!0,c=f):(f=this.fd[h+1])&&a>=g.endTime&&a<=f.endTime&&(q=!0,c={qf:f,index:h+1}));if(!q)for(g=this.xc.entries,h=g.length,q=0;q<h;q++)if(f=g[q].Lk,a<=f.startTime||a>f.startTime&&a<=f.endTime){c={qf:g[q].Lk,index:q};break}c&&(this.ee=c);if(!c)return b;a=c.qf;c=this.fd[c.index+1];a.Vb.length||b.push(a);c&&!c.Vb.length&&b.push(c);return b}function ra(a){var f=ia.call(this,a);f.length&&c.call(this,f);var g=this.ee.qf,h=this.ee.index,f=[],h=n(h)&&this.fd[h+
1];g&&g.Vb.length&&(f=pa(g,a,[],this.xc));h&&h.Vb.length&&(a=pa(h,a,f,this.xc),f.push.apply(f,a));return b(f)}function pa(a,b,c,f){var h=a.entries,n=h.length,q=[],z,C=0;if(!h.length)return q;for(;C<n;){z=h[C];if(z.Qb<=b)z.Qb+z.duration>=b&&q.push(g(z,a.Vb[C],f));else{var M=q.length&&q[q.length-1]||c.length&&c[c.length-1];if(M&&M.Qb>b&&M.Qb!==z.Qb)break;M.oc!==z.oc&&q.push(g(z,a.Vb[C],f))}C++}return q}function b(b){return b.map(function(c,g){var h=c.duration,n;n=b.slice(g+1).filter(f.bind(null,c)).map(a).reduce(Ja,
0);c.duration=h+n;return c}).reduce(function(a,b){Wa(a,b.id)||a.push(b);return a},[])}function f(a,b){return a.id===b.id&&a.displayTime+a.duration===b.displayTime}function a(a){return a.duration}function Ja(a,b){return a+b}function Wa(a,b){return a.some(function(a){return a.id===b})}function g(a,b,c){var f={};f.displayTime=a.Qb;f.duration=a.duration;f.originX=a.gr;f.originY=a.hr;f.sizeX=a.ys;f.sizeY=a.zs;f.imageData=b;f.id=a.oc;f.rootContainerExtentX=c.Xr;f.rootContainerExtentY=c.Yr;return f}function c(a,
b){var c=this,f=a[0],g=a[a.length-1],h,q;0<f.Sa&&(h=f.entries[0].oc,q=f.entries[f.entries.length-1]);0<g.Sa&&(n(h)||(h=g.entries[0].oc),q=g.entries[g.entries.length-1]);if(h){var f=q.oc+q.Lj-h,z="o_"+h+"s_"+f;c.Nf[z]||(c.Nf[z]=!0,c.ed({url:c.jd,offset:h,size:f},function(f,g){setTimeout(function(){delete c.Nf[z]},1E3);if(f)b&&b(f);else{var n=new kb(g);a.forEach(function(a){a.entries.forEach(function(b,c){n.position=b.oc-h;a.Vb[c]=n.ia(b.Lj);var f=a.Vb[c];S("P"==String.fromCharCode(f[1]));S("N"==String.fromCharCode(f[2]));
S("G"==String.fromCharCode(f[3]))})});b&&b(null)}}))}else b&&b(null)}function n(a){return"undefined"!==typeof a}function Bb(a,b){var c=Object.create(a);a.errorString=b;return c}var Ec=K(2).EventEmitter,kb=K(4),Vb=h.events={Ol:"midxready",Zm:"sidxready",ri:"ready",ERROR:"error"},Fb={Ml:"midxdownloaderror",Nl:"midxparseerror",em:"nosidxfoundinmidx",Xm:"sidxdownloaderror",Ym:"sidxparseerror"};h.prototype=Object.create(Ec.prototype);h.prototype.constructor=h;C.Ta=h},{2:2,4:4}],7:[function(K,C){var h=
K(2).EventEmitter,S=K(9),z=K(8)(),M=K(6),q=function ra(q,b){var f=this;if(!(f instanceof ra))return new ra(q,b);h.call(f);f.wc=q.Yj||console;f.ed=q.L;f.vc=q.yj;f.ra=null;f.xu=b.type;f.jd=b.url;f.Of=b.ef;f.gd=new M({url:f.jd,offset:b.bk,size:b.ck,L:f.ed,ef:f.Of});f.gd.on("ready",function(){f.wc.info("ready event fired by subtitle stream");f.emit("ready");f.ra=new S(f.vc,f.gd.pp.bind(f.gd),f.wc);f.ra.on("showsubtitle",f.emit.bind(f,"showsubtitle"));f.ra.on("removesubtitle",f.emit.bind(f,"removesubtitle"))});
f.gd.on("error",f.emit.bind(f,"error"))};q.prototype=Object.create(h.prototype);q.prototype.tc=function(h){null!==this.ra&&this.ra.tc(h)};q.prototype.stop=function(){this.wc.info("stop called");this.gd.removeAllListeners(["ready"]);null!==this.ra&&this.ra.stop()};q.prototype.pause=function(){this.wc.info("pause called");null!==this.ra&&this.ra.pause()};q=z([{L:"function",yj:"function",Yj:"object"},{type:"string",url:"string",bk:"number",ck:"number",ef:"number"}],q);C.Ta=q},{2:2,6:6,8:8,9:9}],8:[function(K,
C){function h(h){return Object.keys(h).every(function(z){return"function"===typeof h[z]})}C.Ta=function(C){function z(b,f,a){a="undefined"!==typeof a.key?"Types: expected "+a.key:"Types: expected argument "+a.index;throw new TypeError(a+(" to be '"+b+"' but found '"+f+"'"));}function M(b,f,a){var h=ra[b];"undefined"!==typeof h?h(f)||z(b,f,a):b!==typeof f&&z(b,f,a)}function q(b,f){var a;a=b.filter(function(a){return"object"!==typeof a&&-1===pa.indexOf(a)});a=a.concat(b.filter(function(a){return"object"===
typeof a}).reduce(function(a,b){return a.concat(Object.keys(b).map(function(a){return b[a]}).filter(function(a){return-1===pa.indexOf(a)}))},[]));if(0<a.length)throw Error(a.join(",")+" are invalid types");return function(){var a=Array.prototype.slice.call(arguments);if(a.length!==b.length)throw new TypeError("Types: unexpected number of arguments");b.forEach(function(b,f){var c=a[f];if("string"===typeof b)M(b,c,{index:f});else if("object"===typeof b)Object.keys(b).forEach(function(a){M(b[a],c[a],
{key:a})});else throw Error("Types: unexpected type in type array");});return f.apply(this,a)}}var K="number boolean string object function symbol".split(" "),ra;ra={array:function(b){return Array.isArray(b)}};if("undefined"!==typeof C){if("object"!==typeof C||!h(C))throw new TypeError("Types: extensions must be an object of type definitions");Object.keys(C).forEach(function(b){if("undefined"!==typeof ra[b]||"undefined"!==typeof K[b])throw new TypeError("Types: attempting to override a built in type with "+
b);ra[b]=C[b]})}var pa=Object.keys(ra).concat(K);return q(["array","function"],q)}},{}],9:[function(K,C){function h(h,b){return b.reduce(S.bind(this,h),[])}function S(h,b,f){var a=f.displayTime-h;h=f.displayTime+f.duration-h;var q=0<b.length?b[0].timeout:Infinity;return 0<a&&a<q?[{timeout:a,type:"showsubtitle",rg:f}]:a===q?b.concat([{timeout:a,type:"showsubtitle",rg:f}]):0<h&&h<q?[{timeout:h,type:"removesubtitle",rg:f}]:h===q?b.concat([{timeout:h,type:"removesubtitle",rg:f}]):b}function z(h,b){return-1<
b.map(function(b){return b.id}).indexOf(h.id)}function M(h,b){return h.filter(function(f){return f!==b})}var q=K(2).EventEmitter,ia=K(8)({}),ra=function b(f,a,h){if(!(this instanceof b))return new b(f,a,h);q.call(this);var z=this;z.vc=f;z.ln=a;z.Na=[];z.wc=h||console;z.ra=setTimeout(function(){z.tc(f())},10)};ra.prototype=Object.create(q.prototype);ra.prototype.stop=function(){var b=this;clearTimeout(b.ra);b.Na.forEach(function(f){b.emit("removesubtitle",f)});b.Na=[]};ra.prototype.pause=function(){clearTimeout(this.ra)};
ra.prototype.tc=function(b,f){var a=this,q;clearTimeout(this.ra);q=a.ln(b);f="number"===typeof f?f:0;a.Na.forEach(function(f){f.displayTime<=b&&b<f.displayTime+f.duration||(a.Na=M(a.Na,f),a.emit("removesubtitle",f))});if(null!==q&&0<q.length){q.forEach(function(f){f.displayTime<=b&&b<f.displayTime+f.duration&&!z(f,a.Na)&&(a.emit("showsubtitle",f),a.Na=a.Na.concat([f]))});var C=h(a.vc(),q);0<C.length&&(a.ra=setTimeout(function(){C[0].displayTime>=a.vc()&&C.forEach(function(b){"showsubtitle"===b.type&&
(a.Na=a.Na.concat([b.rg]));"removesubtitle"===b.type&&(a.Na=M(a.Na,b.rg));a.emit(b.type,b.rg)});a.tc(a.vc())},C[0].timeout))}else q=250*Math.pow(2,f),a.wc.warn("rebuffering subtitles, checking buffer again in "+q+"ms"),a.ra=setTimeout(function(){a.tc(a.vc(),f+1)},q)};C.Ta=ia(["function","function","object"],ra)},{2:2,8:8}],10:[function(K,C){C.Ta={qg:function(h){var C=h.length,z;z=0;var M,q=0,K;if(!(0<=C))throw Error("bad string");for(M=C;M--;)K=h.charCodeAt(M),128>K?z++:z=2048>K?z+2:z+3;z=new Uint8Array(z);
for(M=0;M<C;M++)K=h.charCodeAt(M),128>K?z[q++]=K:(2048>K?z[q++]=192|K>>>6:(z[q++]=224|K>>>12,z[q++]=128|K>>>6&63),z[q++]=128|K&63);return z},hg:function(h){for(var C=0,z,K=h.length,q="";C<K;){z=h[C++];if(!(0<=z&&255>=z))throw Error("bad utf8");if(z&128)if(192===(z&224))z=((z&31)<<6)+(h[C++]&63);else if(224===(z&240))z=((z&15)<<12)+((h[C++]&63)<<6)+(h[C++]&63);else throw Error("unsupported utf8 character");q+=String.fromCharCode(z)}return q}}},{}]},{},[1])})();
